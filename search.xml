<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Java å¹¶å‘ç¼–ç¨‹]]></title>
    <url>%2F2019%2F04%2F16%2FJava%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[è¯·è°ˆè°ˆä½ å¯¹ volatile çš„ç†è§£volatile æ˜¯ Java è™šæ‹Ÿæœºæä¾›çš„è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ ä¿è¯å¯è§æ€§ ç¦æ­¢æŒ‡ä»¤æ’åº ä¸ä¿è¯åŸå­æ€§ JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰ ä½ è°ˆè°ˆåŸºæœ¬æ¦‚å¿µ JMM æœ¬èº«æ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µå¹¶ä¸æ˜¯çœŸå®å­˜åœ¨ï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ç»„è§„å®šæˆ–åˆ™è§„èŒƒï¼Œé€šè¿‡è¿™ç»„è§„èŒƒå®šä¹‰äº†ç¨‹åºä¸­çš„è®¿é—®æ–¹å¼ã€‚ JMM åŒæ­¥è§„å®š çº¿ç¨‹è§£é”å‰ï¼Œå¿…é¡»æŠŠå…±äº«å˜é‡çš„å€¼åˆ·æ–°å›ä¸»å†…å­˜ çº¿ç¨‹åŠ é”å‰ï¼Œå¿…é¡»è¯»å–ä¸»å†…å­˜çš„æœ€æ–°å€¼åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ åŠ é”è§£é”æ˜¯åŒä¸€æŠŠé” ç”±äº JVM è¿è¡Œç¨‹åºçš„å®ä½“æ˜¯çº¿ç¨‹ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹åˆ›å»ºæ—¶ JVM éƒ½ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªå·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜æ˜¯æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®åŒºåŸŸï¼Œè€Œ Java å†…å­˜æ¨¡å‹ä¸­è§„å®šæ‰€æœ‰å˜é‡çš„å‚¨å­˜åœ¨ä¸»å†…å­˜ï¼Œä¸»å†…å­˜æ˜¯å…±äº«å†…å­˜åŒºåŸŸï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®ï¼Œä½†çº¿ç¨‹å¯¹å˜é‡çš„æ“ä½œï¼ˆè¯»å–èµ‹å€¼ç­‰ï¼‰å¿…é¡»éƒ½å·¥ä½œå†…å­˜è¿›è¡Œçœ‹ã€‚ é¦–å…ˆè¦å°†å˜é‡ä»ä¸»å†…å­˜æ‹·è´çš„è‡ªå·±çš„å·¥ä½œå†…å­˜ç©ºé—´ï¼Œç„¶åå¯¹å˜é‡è¿›è¡Œæ“ä½œï¼Œæ“ä½œå®Œæˆåå†å°†å˜é‡å†™å›ä¸»å†…å­˜ï¼Œä¸èƒ½ç›´æ¥æ“ä½œä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œå·¥ä½œå†…å­˜ä¸­å­˜å‚¨ç€ä¸»å†…å­˜ä¸­çš„å˜é‡å‰¯æœ¬æ‹·è´ï¼Œå‰é¢è¯´è¿‡ï¼Œå·¥ä½œå†…å­˜æ˜¯æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®åŒºåŸŸï¼Œå› æ­¤ä¸åŒçš„çº¿ç¨‹é—´æ— æ³•è®¿é—®å¯¹æ–¹çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹é—´çš„é€šä¿¡(ä¼ å€¼)å¿…é¡»é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚ å†…å­˜æ¨¡å‹å›¾ ä¸‰å¤§ç‰¹æ€§ å¯è§æ€§ 123456789101112131415161718192021222324252627282930313233/** * @Author: cuzz * @Date: 2019/4/16 21:29 * @Description: å¯è§æ€§ä»£ç å®ä¾‹ */public class VolatileDemo &#123; public static void main(String[] args) &#123; Data data = new Data(); new Thread(() -&gt; &#123; System.out.println(Thread.currentThread().getName() + " coming..."); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; data.addOne(); System.out.println(Thread.currentThread().getName() + " updated..."); &#125;).start(); while (data.a == 0) &#123; // looping &#125; System.out.println(Thread.currentThread().getName() + " job is done..."); &#125;&#125;class Data &#123; // int a = 0; volatile int a = 0; void addOne() &#123; this.a += 1; &#125;&#125; å¦‚æœä¸åŠ  volatile å…³é”®å­—ï¼Œåˆ™ä¸»çº¿ç¨‹ä¼šè¿›å…¥æ­»å¾ªç¯ï¼ŒåŠ  volatile åˆ™ä¸»çº¿ç¨‹èƒ½å¤Ÿé€€å‡ºï¼Œè¯´æ˜åŠ äº† volatile å…³é”®å­—å˜é‡ï¼Œå½“æœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å€¼ï¼Œä¼šé©¬ä¸Šè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ„ŸçŸ¥åˆ°ï¼Œå½“å‰å€¼ä½œåºŸï¼Œä»æ–°ä»ä¸»å†…å­˜ä¸­è·å–å€¼ã€‚å¯¹å…¶ä»–çº¿ç¨‹å¯è§ï¼Œè¿™å°±å«å¯è§æ€§ã€‚ åŸå­æ€§ 123456789101112131415161718192021222324252627282930public class VolatileDemo &#123; public static void main(String[] args) &#123; // test01(); test02(); &#125; // æµ‹è¯•åŸå­æ€§ private static void test02() &#123; Data data = new Data(); for (int i = 0; i &lt; 20; i++) &#123; new Thread(() -&gt; &#123; for (int j = 0; j &lt; 1000; j++) &#123; data.addOne(); &#125; &#125;).start(); &#125; // é»˜è®¤æœ‰ main çº¿ç¨‹å’Œ gc çº¿ç¨‹ while (Thread.activeCount() &gt; 2) &#123; Thread.yield(); &#125; System.out.println(data.a); &#125;&#125;class Data &#123; volatile int a = 0; void addOne() &#123; this.a += 1; &#125;&#125; å‘ç°å¹¶ä¸èƒ½è¾“å…¥ 20000 æœ‰åºæ€§ è®¡ç®—æœºåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨ä¸ªå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æ’ï¼Œä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹ 3 ç§ ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’ æŒ‡ä»¤å¹¶è¡Œçš„é‡æ’ å†…å­˜ç³»ç»Ÿçš„é‡æ’ å•çº¿ç¨‹ç¯å¢ƒé‡Œé¢ç¡®ä¿ç¨‹åºæœ€ç»ˆæ‰§è¡Œçš„ç»“æœå’Œä»£ç æ‰§è¡Œçš„ç»“æœä¸€è‡´ å¤„ç†å™¨åœ¨è¿›è¡Œé‡æ’åºæ—¶å¿…é¡»è€ƒè™‘æŒ‡ä»¤ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ å¤šçº¿ç¨‹ç¯å¢ƒä¸­çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç”±äºç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’çš„å­˜åœ¨ï¼Œä¸¤ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨çš„å˜é‡èƒ½å¦ä¿è¯ç”¨çš„å˜é‡èƒ½å¦ä¸€è‡´æ€§æ˜¯æ— æ³•ç¡®å®šçš„ï¼Œç»“æœæ— æ³•é¢„æµ‹ ä»£ç ç¤ºä¾‹ 123456789101112131415161718public class ReSortSeqDemo &#123; int a = 0; boolean flag = false; public void method01() &#123; a = 1; // flag = true; // ----çº¿ç¨‹åˆ‡æ¢---- flag = true; // a = 1; &#125; public void method02() &#123; if (flag) &#123; a = a + 3; System.out.println("a = " + a); &#125; &#125;&#125; å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œmethod01 å’Œ method02 å¦‚æœçº¿ç¨‹ 1 æ‰§è¡Œ method01 é‡æ’åºäº†ï¼Œç„¶ååˆ‡æ¢çš„çº¿ç¨‹ 2 æ‰§è¡Œ method02 å°±ä¼šå‡ºç°ä¸ä¸€æ ·çš„ç»“æœã€‚ ç¦æ­¢æŒ‡ä»¤æ’åºvolatile å®ç°ç¦æ­¢æŒ‡ä»¤é‡æ’åºçš„ä¼˜åŒ–ï¼Œä»è€Œé¿å…äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç¨‹åºå‡ºç°ä¹±åºçš„ç°è±¡ å…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µï¼Œå†…å­˜å±éšœï¼ˆMemory Barrierï¼‰åˆç§°å†…å­˜æ …æ ï¼Œæ˜¯ä¸€ä¸ª CPU æŒ‡ä»¤ï¼Œä»–çš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼š ä¿è¯ç‰¹å®šæ“ä½œçš„æ‰§è¡Œé¡ºåº ä¿è¯æŸäº›å˜é‡çš„å†…å­˜å¯è§æ€§ï¼ˆåˆ©ç”¨è¯¥ç‰¹æ€§å®ç° volatile çš„å†…å­˜å¯è§æ€§ï¼‰ ç”±äºç¼–è¯‘å™¨ä¸ªå¤„ç†å™¨éƒ½èƒ½æ‰§è¡ŒæŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œå¦‚æœåœ¨æŒ‡ä»¤é—´æ’å…¥ä¸€æ¡ Memory Barrier åˆ™ä¼šå‘Šè¯‰ç¼–è¯‘å™¨å’Œ CPUï¼Œä¸ç®¡ä»€ä¹ˆæŒ‡ä»¤éƒ½ä¸èƒ½ä¸ªè¿™æ¡ Memory Barrier æŒ‡ä»¤é‡æ’åºï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡æ’å…¥å†…å­˜å±éšœç¦æ­¢åœ¨å†…å­˜å±éšœå‰åæ‰§è¡Œé‡æ’åºä¼˜åŒ–ã€‚å†…å­˜å±éšœå¦ä¸€ä¸ªä½œç”¨æ˜¯å¼ºåˆ¶åˆ·å‡ºå„ç§ CPU ç¼“å­˜æ•°æ®ï¼Œå› æ­¤ä»»ä½• CPU ä¸Šçš„çº¿ç¨‹éƒ½èƒ½è¯»å–åˆ°è¿™äº›æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ã€‚ ä¸‹é¢æ˜¯ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatileå†™æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾ï¼š ä¸‹é¢æ˜¯åœ¨ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatileè¯»æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾ï¼š çº¿ç¨‹å®‰å…¨æ€§ä¿è¯ å·¥ä½œå†…å­˜ä¸ä¸»å†…å­˜åŒæ­¥å»¶è¿Ÿç°è±¡å¯¼è‡´å¯è§æ€§é—®é¢˜ å¯ä»¥ä½¿ç”¨ synchronzied æˆ– volatile å…³é”®å­—è§£å†³ï¼Œå®ƒä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹åçš„å˜é‡ç«‹å³å¯¹å…¶ä»–çº¿ç¨‹å¯è§ å¯¹äºæŒ‡ä»¤é‡æ’å¯¼è‡´å¯è§æ€§é—®é¢˜å’Œæœ‰åºæ€§é—®é¢˜ å¯ä»¥åˆ©ç”¨ volatile å…³é”®å­—è§£å†³ï¼Œå› ä¸º volatile çš„å¦ä¸€ä¸ªä½œç”¨å°±æ˜¯ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ– ä½ åœ¨å“ªäº›åœ°æ–¹ç”¨åˆ°è¿‡ volatileå•ä¾‹ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½å­˜åœ¨çš„å®‰å…¨é—®é¢˜ 123456789101112131415161718192021@NotThreadSafepublic class Singleton01 &#123; private static Singleton01 instance = null; private Singleton01() &#123; System.out.println(Thread.currentThread().getName() + " construction..."); &#125; public static Singleton01 getInstance() &#123; if (instance == null) &#123; instance = new Singleton01(); &#125; return instance; &#125; public static void main(String[] args) &#123; ExecutorService executorService = Executors.newFixedThreadPool(10); for (int i = 0; i &lt; 10; i++) &#123; executorService.execute(()-&gt; Singleton01.getInstance()); &#125; executorService.shutdown(); &#125;&#125; å‘ç°æ„é€ å™¨é‡Œçš„å†…å®¹ä¼šå¤šæ¬¡è¾“å‡º åŒé‡é”å•ä¾‹ ä»£ç  123456789101112131415161718192021222324public class Singleton02 &#123; private static volatile Singleton02 instance = null; private Singleton02() &#123; System.out.println(Thread.currentThread().getName() + " construction..."); &#125; public static Singleton02 getInstance() &#123; if (instance == null) &#123; synchronized (Singleton01.class) &#123; if (instance == null) &#123; instance = new Singleton02(); &#125; &#125; &#125; return instance; &#125; public static void main(String[] args) &#123; ExecutorService executorService = Executors.newFixedThreadPool(10); for (int i = 0; i &lt; 10; i++) &#123; executorService.execute(()-&gt; Singleton02.getInstance()); &#125; executorService.shutdown(); &#125;&#125; å¦‚æœæ²¡æœ‰åŠ  volatile å°±ä¸ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒåŸå› æ˜¯æŒ‡ä»¤é‡æ’åºçš„å­˜åœ¨ï¼ŒåŠ å…¥ volatile å¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚ åŸå› æ˜¯åœ¨äºæŸä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°ç¬¬ä¸€æ¬¡æ£€æµ‹ï¼Œè¯»å–åˆ°çš„ instance ä¸ä¸º null æ—¶ï¼Œinstance çš„å¼•ç”¨å¯¹è±¡å¯èƒ½è¿˜æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ã€‚ instance = new Singleton() å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥å®Œæˆ 123memory = allocate(); // 1.åˆ†é…å¯¹è±¡ç©ºé—´instance(memory); // 2.åˆå§‹åŒ–å¯¹è±¡instance = memory; // 3.è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€ï¼Œæ­¤æ—¶instance != null æ­¥éª¤ 2 å’Œæ­¥éª¤ 3 ä¸å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œè€Œä¸”æ— è®ºé‡æ’å‰è¿˜æ˜¯é‡æ’åç¨‹åºçš„æ‰§è¡Œç»“æœåœ¨å•çº¿ç¨‹ä¸­å¹¶æ²¡æœ‰æ”¹å˜ï¼Œå› æ­¤è¿™ç§ä¼˜åŒ–æ˜¯å…è®¸çš„ã€‚ å‘ç”Ÿé‡æ’ 123memory = allocate(); // 1.åˆ†é…å¯¹è±¡ç©ºé—´instance = memory; // 3.è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€ï¼Œæ­¤æ—¶instance != nullï¼Œä½†å¯¹è±¡è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆinstance(memory); // 2.åˆå§‹åŒ–å¯¹è±¡ æ‰€ä»¥ä¸åŠ  volatile è¿”å›çš„å®ä¾‹ä¸ä¸ºç©ºï¼Œä½†å¯èƒ½æ˜¯æœªåˆå§‹åŒ–çš„å®ä¾‹ CAS ä½ çŸ¥é“å—ï¼Ÿ1234567891011public class CASDemo &#123; public static void main(String[] args) &#123; AtomicInteger atomicInteger = new AtomicInteger(666); // è·å–çœŸå®å€¼ï¼Œå¹¶æ›¿æ¢ä¸ºç›¸åº”çš„å€¼ boolean b = atomicInteger.compareAndSet(666, 2019); System.out.println(b); // true boolean b1 = atomicInteger.compareAndSet(666, 2020); System.out.println(b1); // false atomicInteger.getAndIncrement(); &#125;&#125; CAS åº•å±‚åŸç†ï¼Ÿè°ˆè°ˆå¯¹ UnSafe çš„ç†è§£ï¼ŸgetAndIncrement();12345678/** * Atomically increments by one the current value. * * @return the previous value */public final int getAndIncrement() &#123; return unsafe.getAndAddInt(this, valueOffset, 1);&#125; å¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼šUnSafe ç±»æ˜¯ä»€ä¹ˆï¼Ÿ UnSafe ç±»123456789101112131415161718public class AtomicInteger extends Number implements java.io.Serializable &#123; private static final long serialVersionUID = 6214790243416807050L; // setup to use Unsafe.compareAndSwapInt for updates private static final Unsafe unsafe = Unsafe.getUnsafe(); private static final long valueOffset; static &#123; try &#123; // è·å–ä¸‹é¢ value çš„åœ°å€åç§»é‡ valueOffset = unsafe.objectFieldOffset (AtomicInteger.class.getDeclaredField("value")); &#125; catch (Exception ex) &#123; throw new Error(ex); &#125; &#125; private volatile int value; // ...&#125; Unsafe æ˜¯ CAS çš„æ ¸å¿ƒç±»ï¼Œç”±äº Java æ–¹æ³•æ— æ³•ç›´æ¥è®¿é—®åº•å±‚ç³»ç»Ÿï¼Œè€Œéœ€è¦é€šè¿‡æœ¬åœ°ï¼ˆnativeï¼‰æ–¹æ³•æ¥è®¿é—®ï¼Œ Unsafe ç±»ç›¸å½“ä¸€ä¸ªåé—¨ï¼ŒåŸºäºè¯¥ç±»å¯ä»¥ç›´æ¥æ“ä½œç‰¹å®šå†…å­˜çš„æ•°æ®ã€‚Unsafe ç±»å­˜åœ¨äº sun.misc åŒ…ä¸­ï¼Œå…¶å†…éƒ¨æ–¹æ³•æ“ä½œå¯ä»¥åƒ C æŒ‡é’ˆä¸€æ ·ç›´æ¥æ“ä½œå†…å­˜ï¼Œå› ä¸º Java ä¸­ CAS æ“ä½œæ‰§è¡Œä¾èµ–äº Unsafe ç±»ã€‚ å˜é‡ vauleOffsetï¼Œè¡¨ç¤ºè¯¥å˜é‡å€¼åœ¨å†…å­˜ä¸­çš„åç§»é‡ï¼Œå› ä¸º Unsafe å°±æ˜¯æ ¹æ®å†…å­˜åç§»é‡æ¥è·å–æ•°æ®çš„ã€‚ å˜é‡ value ç”¨ volatile ä¿®é¥°ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¹‹é—´çš„å†…å­˜å¯è§æ€§ã€‚ CAS æ˜¯ä»€ä¹ˆ CAS çš„å…¨ç§° Compare-And-Swapï¼Œå®ƒæ˜¯ä¸€æ¡ CPU å¹¶å‘ã€‚ å®ƒçš„åŠŸèƒ½æ˜¯åˆ¤æ–­å†…å­˜æŸä¸€ä¸ªä½ç½®çš„å€¼æ˜¯å¦ä¸ºé¢„æœŸï¼Œå¦‚æœæ˜¯åˆ™æ›´æ”¹è¿™ä¸ªå€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åŸå­çš„ã€‚ CAS å¹¶å‘åŸä½“ç°åœ¨ JAVA è¯­è¨€ä¸­å°±æ˜¯ sun.misc.Unsafe ç±»ä¸­çš„å„ä¸ªæ–¹æ³•ã€‚è°ƒç”¨ UnSafe ç±»ä¸­çš„ CAS æ–¹æ³•ï¼ŒJVM ä¼šå¸®æˆ‘ä»¬å®ç°å‡º CAS æ±‡ç¼–æŒ‡ä»¤ã€‚è¿™æ˜¯ä¸€ç§å®Œå…¨ä¾èµ–ç¡¬ä»¶çš„åŠŸèƒ½ï¼Œé€šè¿‡å®ƒå®ç°äº†åŸå­æ“ä½œã€‚ç”±äº CAS æ˜¯ä¸€ç§ç³»ç»Ÿæºè¯­ï¼Œæºè¯­å±äºæ“ä½œç³»ç»Ÿç”¨è¯­èŒƒç•´ï¼Œæ˜¯ç”±è‹¥å¹²æ¡æŒ‡ä»¤ç»„æˆï¼Œç”¨äºå®ŒæˆæŸä¸€ä¸ªåŠŸèƒ½çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”åŸè¯­çš„æ‰§è¡Œå¿…é¡»æ˜¯è¿ç»­çš„ï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸å…è®¸è¢«ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´ CAS æ˜¯ä¸€æ¡åŸå­æŒ‡ä»¤ï¼Œä¸ä¼šé€ æˆæ‰€è°“çš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ åˆ†æä¸€ä¸‹ getAndAddInt è¿™ä¸ªæ–¹æ³• 12345678// unsafe.getAndAddIntpublic final int getAndAddInt(Object obj, long valueOffset, long expected, int val) &#123; int temp; do &#123; temp = this.getIntVolatile(obj, valueOffset); // è·å–å¿«ç…§å€¼ &#125; while (!this.compareAndSwap(obj, valueOffset, temp, temp + val)); // å¦‚æœæ­¤æ—¶ temp æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œå°±èƒ½é€€å‡ºå¾ªç¯ï¼Œå¦åˆ™é‡æ–°è·å– return temp;&#125; CAS çš„ç¼ºç‚¹ï¼Ÿ å¾ªç¯æ—¶é—´é•¿å¼€é”€å¾ˆå¤§ å¦‚æœ CAS å¤±è´¥ï¼Œä¼šä¸€ç›´å°è¯•ï¼Œå¦‚æœ CAS é•¿æ—¶é—´ä¸€ç›´ä¸æˆåŠŸï¼Œå¯èƒ½ä¼šç»™ CPU å¸¦æ¥å¾ˆå¤§çš„å¼€é”€ï¼ˆæ¯”å¦‚çº¿ç¨‹æ•°å¾ˆå¤šï¼Œæ¯æ¬¡æ¯”è¾ƒéƒ½æ˜¯å¤±è´¥ï¼Œå°±ä¼šä¸€ç›´å¾ªç¯ï¼‰ï¼Œæ‰€ä»¥å¸Œæœ›æ˜¯çº¿ç¨‹æ•°æ¯”è¾ƒå°çš„åœºæ™¯ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ å¯¹äºå¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªç¯ CAS å°±æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚ å¼•å‡º ABA é—®é¢˜ åŸå­ç±» AtomicInteger çš„ ABA é—®é¢˜è°ˆä¸€è°ˆï¼ŸåŸå­æ›´æ–°å¼•ç”¨çŸ¥é“å—ï¼Ÿ åŸå­å¼•ç”¨ 12345678910public class AtomicReferenceDemo &#123; public static void main(String[] args) &#123; User cuzz = new User("cuzz", 18); User faker = new User("faker", 20); AtomicReference&lt;User&gt; atomicReference = new AtomicReference&lt;&gt;(); atomicReference.set(cuzz); System.out.println(atomicReference.compareAndSet(cuzz, faker)); // true System.out.println(atomicReference.get()); // User(userName=faker, age=20) &#125;&#125; ABA é—®é¢˜æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ 123456789101112131415161718192021222324252627/** * @program: learn-demo * @description: ABA * @author: cuzz * @create: 2019-04-21 23:31 **/public class ABADemo &#123; private static AtomicReference&lt;Integer&gt; atomicReference = new AtomicReference&lt;&gt;(100); public static void main(String[] args) &#123; new Thread(() -&gt; &#123; atomicReference.compareAndSet(100, 101); atomicReference.compareAndSet(101, 100); &#125;).start(); new Thread(() -&gt; &#123; // ä¿è¯ä¸Šé¢çº¿ç¨‹å…ˆæ‰§è¡Œ try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; atomicReference.compareAndSet(100, 2019); System.out.println(atomicReference.get()); // 2019 &#125;).start(); &#125;&#125; å½“æœ‰ä¸€ä¸ªå€¼ä» A æ”¹ä¸º B åˆæ”¹ä¸º Aï¼Œè¿™å°±æ˜¯ ABA é—®é¢˜ã€‚ æ—¶é—´æˆ³åŸå­å¼•ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142package com.cuzz.thread;import java.util.concurrent.atomic.AtomicReference;import java.util.concurrent.atomic.AtomicStampedReference;/** * @program: learn-demo * @description: ABA * @author: cuzz * @create: 2019-04-21 23:31 **/public class ABADemo2 &#123; private static AtomicStampedReference&lt;Integer&gt; atomicStampedReference = new AtomicStampedReference&lt;&gt;(100, 1); public static void main(String[] args) &#123; new Thread(() -&gt; &#123; int stamp = atomicStampedReference.getStamp(); System.out.println(Thread.currentThread().getName() + " çš„ç‰ˆæœ¬å·ä¸ºï¼š" + stamp); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; atomicStampedReference.compareAndSet(100, 101, atomicStampedReference.getStamp(), atomicStampedReference.getStamp() + 1 ); atomicStampedReference.compareAndSet(101, 100, atomicStampedReference.getStamp(), atomicStampedReference.getStamp() + 1 ); &#125;).start(); new Thread(() -&gt; &#123; int stamp = atomicStampedReference.getStamp(); System.out.println(Thread.currentThread().getName() + " çš„ç‰ˆæœ¬å·ä¸ºï¼š" + stamp); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; boolean b = atomicStampedReference.compareAndSet(100, 2019, stamp, stamp + 1); System.out.println(b); // false System.out.println(atomicStampedReference.getReference()); // 100 &#125;).start(); &#125;&#125; æˆ‘ä»¬å…ˆä¿è¯ä¸¤ä¸ªçº¿ç¨‹çš„åˆå§‹ç‰ˆæœ¬ä¸ºä¸€è‡´ï¼Œåé¢ä¿®æ”¹æ˜¯ç”±äºç‰ˆæœ¬ä¸ä¸€æ ·å°±ä¼šä¿®æ”¹å¤±è´¥ã€‚ æˆ‘ä»¬çŸ¥é“ ArrayList æ˜¯çº¿ç¨‹ä¸å®‰å…¨ï¼Œè¯·ç¼–å†™ä¸€ä¸ªä¸å®‰å…¨çš„æ¡ˆä¾‹å¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆï¼Ÿ æ•…éšœç°è±¡ 123456789101112public class ContainerDemo &#123; public static void main(String[] args) &#123; List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); Random random = new Random(); for (int i = 0; i &lt; 100; i++) &#123; new Thread(() -&gt; &#123; list.add(random.nextInt(10)); System.out.println(list); &#125;).start(); &#125; &#125;&#125; å‘ç°æŠ¥ java.util.ConcurrentModificationException å¯¼è‡´åŸå›  è§£å†³æ–¹æ¡ˆ new Vector(); Collections.synchronizedList(new ArrayList&lt;&gt;()); ä¼˜åŒ–å»ºè®® 1 å‚è€ƒé“¾æ¥ Javaå†…å­˜æ¨¡å‹-volatile]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç”Ÿäº§è€…æ¶ˆè´¹è€…]]></title>
    <url>%2F2019%2F04%2F06%2F%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%2F</url>
    <content type="text"><![CDATA[ç»´åŸºç™¾ç§‘è§£é‡Šï¼š In computing, the producerâ€“consumer problem[1][2] (also known as the bounded-buffer problem) is a classic example of a multi-process) synchronization) problem. The problem describes two processes, the producer and the consumer, who share a common, fixed-size buffer) used as a queue). The producerâ€™s job is to generate data, put it into the buffer, and start again. At the same time, the consumer is consuming the data (i.e., removing it from the buffer), one piece at a time. The problem is to make sure that the producer wonâ€™t try to add data into the buffer if itâ€™s full and that the consumer wonâ€™t try to remove data from an empty buffer. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import java.util.LinkedList;import java.util.List;import java.util.Random;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;/** * @Author: cuzz * @Date: 2019/4/6 13:03 * @Description: ç”Ÿäº§è€…æ¶ˆè´¹è€… */public class ProducerConsumerDemo &#123; public static void main(String[] args) &#123; Container container = new Container(); ExecutorService executor = Executors.newFixedThreadPool(2); executor.execute(() -&gt; container.produce()); executor.execute(() -&gt; container.consume()); executor.shutdown(); &#125;&#125;class Container &#123; private List&lt;Integer&gt; list = new LinkedList&lt;&gt;(); private final int MAX_SIZE = 5; private Random random = new Random(); public void produce() &#123; while (true) &#123; synchronized (this) &#123; try &#123; while (list.size() &gt;= MAX_SIZE) &#123; wait(); &#125; int i = random.nextInt(); System.out.println("produce..." + i); list.add(i); notify(); Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; public void consume() &#123; while (true) &#123; try &#123; synchronized (this) &#123; while (list.isEmpty()) &#123; wait(); &#125; int i = list.remove(1); System.out.println("consume..." + i); notify(); Thread.sleep(1000); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125;]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ProducerConsumer</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LRUCache]]></title>
    <url>%2F2019%2F03%2F16%2FLRUCache%2F</url>
    <content type="text"><![CDATA[LRUï¼ˆLeast recently usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•æ ¹æ®æ•°æ®çš„å†å²è®¿é—®è®°å½•æ¥è¿›è¡Œæ·˜æ±°æ•°æ®ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡ä¹Ÿæ›´é«˜â€ ã€‚ ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899/** * @Author: cuzz * @Date: 2019/3/16 15:35 * @Description: LRU cache */public class LRUCache &#123; private Map&lt;Integer, DLinkedList&gt; cache = new HashMap&lt;&gt;(); private int count; private int capacity; private DLinkedList head, tail; public LRUCache(int capacity) &#123; this.count = 0; this.capacity = capacity; this.head = new DLinkedList(); this.tail = new DLinkedList(); head.next = tail; tail.pre = head; &#125; public int get(int key) &#123; DLinkedList node = cache.get(key); if (node == null) &#123; return -1; &#125; removeNode(node); addHead(node); return node.value; &#125; public void put(int key, int value) &#123; DLinkedList node = cache.get(key); if (node == null) &#123; node = new DLinkedList(key, value); addHead(node); cache.put(key, node); count++; if (count &gt; capacity) &#123; DLinkedList preTail = tail.pre; removeNode(preTail); cache.remove(preTail.key); count--; &#125; &#125; else &#123; node.value = value; removeNode(node); addHead(node); &#125; &#125; // ç§»é™¤ç»™å®šçš„ç»“ç‚¹ private void removeNode(DLinkedList node) &#123; DLinkedList pre = node.pre; DLinkedList next = node.next; pre.next = next; next.pre = pre; &#125; // æŠŠç»“ç‚¹æ·»åŠ å¤´èŠ‚ç‚¹ private void addHead(DLinkedList node) &#123; DLinkedList next = head.next; head.next = node; node.next = next; next.pre = node; node.pre = head; &#125; public static void main(String[] args) &#123; LRUCache cache = new LRUCache(2); cache.put(1, 1); cache.put(2, 2); System.out.println(cache.get(1)); // è¿”å› 1 cache.put(3, 3); // ä½¿ 2 ä½œåºŸ System.out.println(cache.get(2)); // è¿”å› -1 cache.put(4, 4); // ä½¿ 1 ä½œåºŸ System.out.println(cache.get(1)); // è¿”å› -1 æœªæ‰¾åˆ° System.out.println(cache.get(3)); // è¿”å› 3 System.out.println(cache.get(4)); // è¿”å› 4 &#125;&#125;class DLinkedList &#123; int key; int value; DLinkedList pre; DLinkedList next; public DLinkedList() &#123;&#125;; public DLinkedList(int key, int value) &#123; this.key = key; this.value = value; &#125;&#125;]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>LRUCache</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆå››ï¼‰]]></title>
    <url>%2F2019%2F03%2F04%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88%E5%9B%9B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[synchronized å­—èŠ‚ç åˆ†ææˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¸€ä¸ªç®€å•çš„æ–¹æ³• 123456789101112/** * @Author: cuzz * @Date: 2019/3/4 13:34 * @Description: */public class MyTest02 &#123; int x = 0; public void setX(int x) &#123; this.x = x; &#125;&#125; ä½¿ç”¨ javap -v com.cuzz.jvm.bytecode.MyTest02 å‘½ä»¤ï¼Œæ‰¾åˆ° setX æ–¹æ³• 12345678910111213141516public void setX(int); descriptor: (I)V flags: ACC_PUBLIC Code: stack=2, locals=2, args_size=2 0: aload_0 1: iload_1 2: putfield #2 // Field x:I 5: return LineNumberTable: line 12: 0 line 13: 5 LocalVariableTable: Start Length Slot Name Signature 0 6 0 this Lcom/cuzz/jvm/bytecode/MyTest02; 0 6 1 x I å¦‚æœæˆ‘ä»¬åœ¨æ–¹æ³•ä¸­æ·»åŠ  synchronzied å…³é”®å­— 1234567public class MyTest02 &#123; int x = 0; public synchronized void setX(int x) &#123; this.x = x; &#125;&#125; æˆ‘ä»¬å†åç¼–è¯‘ä¸€ä¸‹ 12345678910111213141516public synchronized void setX(int); descriptor: (I)V flags: ACC_PUBLIC, ACC_SYNCHRONIZED Code: stack=2, locals=2, args_size=2 0: aload_0 1: iload_1 2: putfield #2 // Field x:I 5: return LineNumberTable: line 12: 0 line 13: 5 LocalVariableTable: Start Length Slot Name Signature 0 6 0 this Lcom/cuzz/jvm/bytecode/MyTest02; 0 6 1 x I å¯¹æ¯”è¿™ä¸¤ä¸ªåç¼–è¯‘çš„ç»“æœï¼Œæˆ‘ä»¬å‘ç°åœ¨ flags ä¸­å¤šäº† ACC_SYNCHRONIZEDï¼Œä¸ä¼šå‡ºç° monitorenter å’Œ monitorexitã€‚ å¦‚æœæˆ‘ä»¬æ˜¯åœ¨æ–¹æ³•ä½“é‡æ·»åŠ  synchronized å…³é”®å­— 12345678910public class MyTest02 &#123; String lock = "lock"; int x = 0; public int getX() &#123; synchronized (lock) &#123; return x; &#125; &#125;&#125; æˆ‘ä»¬åç¼–è¯‘ä¸€ä¸‹ æ‰¾åˆ° getX æ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536public int getX(); descriptor: ()I flags: ACC_PUBLIC Code: stack=2, locals=3, args_size=1 0: aload_0 1: getfield #3 // Field lock:Ljava/lang/String; 4: dup 5: astore_1 6: monitorenter 7: aload_0 8: getfield #4 // Field x:I 11: aload_1 12: monitorexit 13: ireturn 14: astore_2 15: aload_1 16: monitorexit 17: aload_2 18: athrow Exception table: from to target type 7 13 14 any 14 17 14 any LineNumberTable: line 17: 0 line 18: 7 line 19: 14 LocalVariableTable: Start Length Slot Name Signature 0 19 0 this Lcom/cuzz/jvm/bytecode/MyTest02; StackMapTable: number_of_entries = 1 frame_type = 255 /* full_frame */ offset_delta = 14 locals = [ class com/cuzz/jvm/bytecode/MyTest02, class java/lang/Object ] stack = [ class java/lang/Throwable ] åœ¨ 6 ä¸­å‡ºç° monitorenterï¼Œåœ¨ 16 ä¸­å‡ºç° moniterexit]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis]]></title>
    <url>%2F2019%2F02%2F23%2FRedis%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯ Redis ï¼ŸRedisï¼Œå…¨ç§° Remote Dictionary Serverï¼Œæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„é«˜æ€§èƒ½ Key-Value æ•°æ®åº“ã€‚ å¦å¤–ï¼ŒRedis å·²ç»æˆä¸ºäº’è”ç½‘å…¬å¸åœ¨ç¼“å­˜ç»„ä»¶é€‰æ‹©çš„å”¯ä¸€ï¼Œæ›´å¤šçš„å…³æ³¨ç‚¹æ˜¯ï¼Œå¦‚ä½•ä½¿ç”¨å¥½ Redis ã€‚ Redis æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ1ã€é€Ÿåº¦å¿« å› ä¸ºæ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äº HashMap ï¼ŒHashMap çš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O (1) ã€‚ Redis æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Key-Value ç±»å‹çš„å†…å­˜æ•°æ®åº“ï¼Œå¾ˆåƒMemcached ï¼Œæ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ® flush åˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚ å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼ŒRedis çš„æ€§èƒ½éå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10 ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„ Key-Value æ•°æ®åº“ã€‚ å¦‚æœæˆ‘ä»¬æŸ¥çœ‹åœ¨é˜¿é‡Œäº‘é”€å”®çš„ Redis è§„æ ¼ï¼Œæœ€ä½çš„ä¹Ÿæ˜¯ 8W QPS ã€‚ 2ã€æ”¯æŒä¸°å¯Œæ•°æ®ç±»å‹ æ”¯æŒ String ï¼ŒListï¼ŒSetï¼ŒSorted Setï¼ŒHash ã€‚ Redis çš„å‡ºè‰²ä¹‹å¤„ä¸ä»…ä»…æ˜¯æ€§èƒ½ï¼ŒRedis æœ€å¤§çš„é­…åŠ›æ˜¯æ”¯æŒä¿å­˜å¤šç§æ•°æ®ç»“æ„ï¼Œæ­¤å¤–å•ä¸ª Value çš„æœ€å¤§é™åˆ¶æ˜¯1GBï¼Œä¸åƒ Memcachedåªèƒ½ä¿å­˜1MBçš„æ•°æ®ï¼Œå› æ­¤Rediså¯ä»¥ç”¨æ¥å®ç°å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ã€‚æ¯”æ–¹è¯´ï¼š ç”¨ä»–çš„ List æ¥åš FIFO åŒå‘é“¾è¡¨ï¼Œå®ç°ä¸€ä¸ªè½»é‡çº§çš„é«˜æ€§èƒ½æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ã€‚ ç”¨ä»–çš„ Set å¯ä»¥åšé«˜æ€§èƒ½çš„ tag ç³»ç»Ÿç­‰ç­‰ã€‚ 3ã€ä¸°å¯Œçš„ç‰¹æ€§ è®¢é˜…å‘å¸ƒ Pub / Sub åŠŸèƒ½ Key è¿‡æœŸç­–ç•¥ äº‹åŠ¡ æ”¯æŒå¤šä¸ª DB è®¡æ•° â€¦ å¹¶ä¸”åœ¨ Redis 5.0 å¢åŠ äº† Stream åŠŸèƒ½ï¼Œä¸€ä¸ªæ–°çš„å¼ºå¤§çš„æ”¯æŒå¤šæ’­çš„å¯æŒä¹…åŒ–çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæä¾›ç±»ä¼¼ Kafka çš„åŠŸèƒ½ã€‚ 4ã€æŒä¹…åŒ–å­˜å‚¨ Redis æä¾› RDB å’Œ AOF ä¸¤ç§æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆï¼Œè§£å†³å†…å­˜æ•°æ®åº“æœ€æ‹…å¿ƒçš„ä¸‡ä¸€ Redis æŒ‚æ‰ï¼Œæ•°æ®ä¼šæ¶ˆå¤±æ‰ã€‚ Redis æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ ç”±äº Redis æ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ‰€ä»¥ï¼Œå•å°æœºå™¨ï¼Œå­˜å‚¨çš„æ•°æ®é‡ï¼Œè·Ÿæœºå™¨æœ¬èº«çš„å†…å­˜å¤§å°ã€‚è™½ç„¶ Redis æœ¬èº«æœ‰ Key è¿‡æœŸç­–ç•¥ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦æå‰é¢„ä¼°å’ŒèŠ‚çº¦å†…å­˜ã€‚å¦‚æœå†…å­˜å¢é•¿è¿‡å¿«ï¼Œéœ€è¦å®šæœŸåˆ é™¤æ•°æ®ã€‚ å¦å¤–ï¼Œå¯ä½¿ç”¨ Redis Clusterã€Codis ç­‰æ–¹æ¡ˆï¼Œå¯¹ Redis è¿›è¡Œåˆ†åŒºï¼Œä»å•æœº Redis å˜æˆé›†ç¾¤ Redis ã€‚ å¦‚æœè¿›è¡Œå®Œæ•´é‡åŒæ­¥ï¼Œç”±äºéœ€è¦ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œä¼ è¾“ï¼Œä¼šå ç”¨ä¸»æœºçš„ CPU ï¼Œå¹¶ä¼šæ¶ˆè€—ç°ç½‘çš„å¸¦å®½ã€‚ä¸è¿‡ Redis2.8 ç‰ˆæœ¬ï¼Œå·²ç»æœ‰éƒ¨åˆ†é‡åŒæ­¥çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¯èƒ½æœ‰å®Œæ•´é‡åŒæ­¥çš„ã€‚æ¯”å¦‚ï¼Œæ–°ä¸Šçº¿çš„å¤‡æœºã€‚ ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè¿›è¡Œé‡å¯ï¼Œå°†ç¡¬ç›˜ä¸­çš„æ•°æ®åŠ è½½è¿›å†…å­˜ï¼Œæ—¶é—´æ¯”è¾ƒä¹…ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒRedis ä¸èƒ½æä¾›æœåŠ¡ã€‚ Redis å’Œ Memcached çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ1ã€Redis æ”¯æŒå¤æ‚çš„æ•°æ®ç»“æ„ Memcached ä»…æä¾›ç®€å•çš„å­—ç¬¦ä¸²ã€‚ Redis æä¾›å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œä¸°å¯Œçš„æ•°æ®æ“ä½œã€‚ ä¹Ÿå› ä¸º Redis æ”¯æŒå¤æ‚çš„æ•°æ®ç»“æ„ï¼ŒRedis å³ä½¿å¾€äº Memcached æ¨å‡ºï¼Œå´è·å¾—æ›´å¤šå¼€å‘è€…çš„é’çã€‚ Redis ç›¸æ¯” Memcached æ¥è¯´ï¼Œæ‹¥æœ‰æ›´å¤šçš„æ•°æ®ç»“æ„ï¼Œèƒ½æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®æ“ä½œã€‚å¦‚æœéœ€è¦ç¼“å­˜èƒ½å¤Ÿæ”¯æŒæ›´å¤æ‚çš„ç»“æ„å’Œæ“ä½œï¼ŒRedis ä¼šæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ 2ã€Redis åŸç”Ÿæ”¯æŒé›†ç¾¤æ¨¡å¼ åœ¨ Redis3.x ç‰ˆæœ¬ä¸­ï¼Œå®˜æ–¹ä¾¿èƒ½æ”¯æŒ Cluster æ¨¡å¼ã€‚ Memcached æ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ã€‚ 3ã€æ€§èƒ½å¯¹æ¯” Redis åªä½¿ç”¨å•æ ¸ï¼Œè€Œ Memcached å¯ä»¥ä½¿ç”¨å¤šæ ¸ï¼Œæ‰€ä»¥å¹³å‡æ¯ä¸€ä¸ªæ ¸ä¸Š Redisåœ¨å­˜å‚¨å°æ•°æ®æ—¶æ¯” Memcached æ€§èƒ½æ›´é«˜ã€‚ åœ¨ 100k ä»¥ä¸Šçš„æ•°æ®ä¸­ï¼ŒMemcached æ€§èƒ½è¦é«˜äº Redis ã€‚è™½ç„¶ Redis æœ€è¿‘ä¹Ÿåœ¨å­˜å‚¨å¤§æ•°æ®çš„æ€§èƒ½ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯æ¯”èµ· Memcachedï¼Œè¿˜æ˜¯ç¨æœ‰é€Šè‰²ã€‚ æ›´å¤šå…³äºæ€§èƒ½çš„å¯¹æ¯”ï¼Œå¯ä»¥çœ‹çœ‹ ã€ŠMemcached ä¸ Redis çš„å…³é”®æ€§èƒ½æŒ‡æ ‡æ¯”è¾ƒã€‹ ã€‚ 4ã€å†…å­˜ä½¿ç”¨æ•ˆç‡å¯¹æ¯” ç®€å•çš„ Key-Value å­˜å‚¨çš„è¯ï¼ŒMemcached çš„å†…å­˜åˆ©ç”¨ç‡æ›´é«˜ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼å†…å­˜æ± ã€‚ å¦‚æœ Redis é‡‡ç”¨ hash ç»“æ„æ¥åš key-value å­˜å‚¨ï¼Œç”±äºå…¶ç»„åˆå¼çš„å‹ç¼©ï¼Œ å…¶å†…å­˜åˆ©ç”¨ç‡ä¼šé«˜äº Memcached ã€‚ Redis å’Œ Memcached çš„å†…å­˜ç®¡ç†æ–¹æ³•ä¸åŒï¼ŒRedis é‡‡ç”¨çš„æ˜¯åŒ…è£…çš„ malloc/free ï¼Œ ç›¸è¾ƒäº Memcached çš„å†…å­˜ç®¡ç†æ–¹æ³• tcmalloc / jmalloc æ¥è¯´ï¼Œè¦ç®€å•å¾ˆå¤š ã€‚ 5ã€ç½‘ç»œ IO æ¨¡å‹ Memcached æ˜¯å¤šçº¿ç¨‹ï¼Œéé˜»å¡ IO å¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼ŒåŸå‹ä¸Šæ¥è¿‘ Nignx ã€‚ Redis ä½¿ç”¨å•çº¿ç¨‹çš„ IO å¤ç”¨æ¨¡å‹ï¼Œè‡ªå·±å°è£…äº†ä¸€ä¸ªç®€å•çš„ AeEvent äº‹ä»¶å¤„ç†æ¡†æ¶ï¼Œä¸»è¦å®ç°äº† epoll, kqueue å’Œ select ï¼Œæ›´æ¥è¿‘ Apache æ—©æœŸçš„æ¨¡å¼ã€‚ TODO æœ‰ç‚¹çœ‹ä¸æ‡‚ï¼Œæ‰¾äºšæ™®è¡¨å¼Ÿç¡®è®¤ä¸­ã€‚ 6ã€æŒä¹…åŒ–å­˜å‚¨ Memcached ä¸æ”¯æŒæŒä¹…åŒ–å­˜å‚¨ï¼Œé‡å¯æ—¶ï¼Œæ•°æ®è¢«æ¸…ç©ºã€‚ Redis æ”¯æŒæŒä¹…åŒ–å­˜å‚¨ï¼Œé‡å¯æ—¶ï¼Œå¯ä»¥æ¢å¤å·²æŒä¹…åŒ–çš„æ•°æ®ã€‚ ä¹Ÿæ¨èé˜…è¯»ä¸‹ ã€Šè„šè¸ä¸¤åªèˆ¹çš„å›°æƒ‘ - Memcached ä¸ Redisã€‹ ã€‚ è¯·è¯´è¯´ Redis çš„çº¿ç¨‹æ¨¡å‹ï¼Ÿ è‰¿è‰¿ï¼šè¿™ä¸ªæ˜¯æˆ‘ä»ç½‘ç»œä¸Šæ‰¾çš„èµ„æ–™ï¼Œè®²çš„ç°å¸¸ä¸é”™ã€‚ redis å†…éƒ¨ä½¿ç”¨æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ file event handlerï¼Œè¿™ä¸ªæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ redis æ‰å«åšå•çº¿ç¨‹çš„æ¨¡å‹ã€‚å®ƒé‡‡ç”¨ IO å¤šè·¯å¤ç”¨æœºåˆ¶åŒæ—¶ç›‘å¬å¤šä¸ª socketï¼Œæ ¹æ® socket ä¸Šçš„äº‹ä»¶æ¥é€‰æ‹©å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚ æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨çš„ç»“æ„åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š å¤šä¸ª socket IO å¤šè·¯å¤ç”¨ç¨‹åº æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ äº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰ å¤šä¸ª socket å¯èƒ½ä¼šå¹¶å‘äº§ç”Ÿä¸åŒçš„æ“ä½œï¼Œæ¯ä¸ªæ“ä½œå¯¹åº”ä¸åŒçš„æ–‡ä»¶äº‹ä»¶ï¼Œä½†æ˜¯ IO å¤šè·¯å¤ç”¨ç¨‹åºä¼šç›‘å¬å¤šä¸ª socketï¼Œä¼šå°† socket äº§ç”Ÿçš„äº‹ä»¶æ”¾å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œäº‹ä»¶åˆ†æ´¾å™¨æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªäº‹ä»¶ï¼ŒæŠŠè¯¥äº‹ä»¶äº¤ç»™å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚ æ¥çœ‹å®¢æˆ·ç«¯ä¸ redis çš„ä¸€æ¬¡é€šä¿¡è¿‡ç¨‹ï¼š å®¢æˆ·ç«¯ socket01 å‘ redis çš„ server socket è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œæ­¤æ—¶ server socket ä¼šäº§ç”Ÿä¸€ä¸ª AE_READABLE äº‹ä»¶ï¼ŒIO å¤šè·¯å¤ç”¨ç¨‹åºç›‘å¬åˆ° server socket äº§ç”Ÿçš„äº‹ä»¶åï¼Œå°†è¯¥äº‹ä»¶å‹å…¥é˜Ÿåˆ—ä¸­ã€‚æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä»é˜Ÿåˆ—ä¸­è·å–è¯¥äº‹ä»¶ï¼Œäº¤ç»™è¿æ¥åº”ç­”å¤„ç†å™¨ã€‚è¿æ¥åº”ç­”å¤„ç†å™¨ä¼šåˆ›å»ºä¸€ä¸ªèƒ½ä¸å®¢æˆ·ç«¯é€šä¿¡çš„ socket01ï¼Œå¹¶å°†è¯¥ socket01 çš„ AE_READABLE äº‹ä»¶ä¸å‘½ä»¤è¯·æ±‚å¤„ç†å™¨å…³è”ã€‚ å‡è®¾æ­¤æ—¶å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ª set key value è¯·æ±‚ï¼Œæ­¤æ—¶ redis ä¸­çš„ socket01 ä¼šäº§ç”Ÿ AE_READABLE äº‹ä»¶ï¼ŒIO å¤šè·¯å¤ç”¨ç¨‹åºå°†äº‹ä»¶å‹å…¥é˜Ÿåˆ—ï¼Œæ­¤æ—¶äº‹ä»¶åˆ†æ´¾å™¨ä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥äº‹ä»¶ï¼Œç”±äºå‰é¢ socket01 çš„ AE_READABLE äº‹ä»¶å·²ç»ä¸å‘½ä»¤è¯·æ±‚å¤„ç†å™¨å…³è”ï¼Œå› æ­¤äº‹ä»¶åˆ†æ´¾å™¨å°†äº‹ä»¶äº¤ç»™å‘½ä»¤è¯·æ±‚å¤„ç†å™¨æ¥å¤„ç†ã€‚å‘½ä»¤è¯·æ±‚å¤„ç†å™¨è¯»å– socket01 çš„ key value å¹¶åœ¨è‡ªå·±å†…å­˜ä¸­å®Œæˆ key value çš„è®¾ç½®ã€‚æ“ä½œå®Œæˆåï¼Œå®ƒä¼šå°† socket01 çš„ AE_WRITABLE äº‹ä»¶ä¸ä»¤å›å¤å¤„ç†å™¨å…³è”ã€‚ å¦‚æœæ­¤æ—¶å®¢æˆ·ç«¯å‡†å¤‡å¥½æ¥æ”¶è¿”å›ç»“æœäº†ï¼Œé‚£ä¹ˆ redis ä¸­çš„ socket01 ä¼šäº§ç”Ÿä¸€ä¸ª AE_WRITABLE äº‹ä»¶ï¼ŒåŒæ ·å‹å…¥é˜Ÿåˆ—ä¸­ï¼Œäº‹ä»¶åˆ†æ´¾å™¨æ‰¾åˆ°ç›¸å…³è”çš„å‘½ä»¤å›å¤å¤„ç†å™¨ï¼Œç”±å‘½ä»¤å›å¤å¤„ç†å™¨å¯¹ socket01 è¾“å…¥æœ¬æ¬¡æ“ä½œçš„ä¸€ä¸ªç»“æœï¼Œæ¯”å¦‚ okï¼Œä¹‹åè§£é™¤ socket01 çš„ AE_WRITABLE äº‹ä»¶ä¸å‘½ä»¤å›å¤å¤„ç†å™¨çš„å…³è”ã€‚ è¿™æ ·ä¾¿å®Œæˆäº†ä¸€æ¬¡é€šä¿¡ã€‚ğŸ˜ˆ è€å¿ƒç†è§£ä¸€ä¸‹ï¼Œç°å¸¸é‡è¦ã€‚å¦‚æœè¿˜æ˜¯ä¸èƒ½ç†è§£ï¼Œå¯ä»¥åœ¨ç½‘ç»œä¸Šæœä¸€äº›èµ„æ–™ï¼Œåœ¨ç†è§£ç†è§£ã€‚ ä¸ºä»€ä¹ˆ Redis å•çº¿ç¨‹æ¨¡å‹ä¹Ÿèƒ½æ•ˆç‡è¿™ä¹ˆé«˜ï¼Ÿ 1ã€çº¯å†…å­˜æ“ä½œã€‚ Redis ä¸ºäº†è¾¾åˆ°æœ€å¿«çš„è¯»å†™é€Ÿåº¦ï¼Œå°†æ•°æ®éƒ½è¯»åˆ°å†…å­˜ä¸­ï¼Œå¹¶é€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†æ•°æ®å†™å…¥ç£ç›˜ã€‚æ‰€ä»¥ Redis å…·æœ‰å¿«é€Ÿå’Œæ•°æ®æŒä¹…åŒ–çš„ç‰¹å¾ã€‚ å¦‚æœä¸å°†æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œç£ç›˜ I/O é€Ÿåº¦ä¸ºä¸¥é‡å½±å“ Redis çš„æ€§èƒ½ã€‚ 2ã€æ ¸å¿ƒæ˜¯åŸºäºéé˜»å¡çš„ IO å¤šè·¯å¤ç”¨æœºåˆ¶ã€‚ 3ã€å•çº¿ç¨‹åè€Œé¿å…äº†å¤šçº¿ç¨‹çš„é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ã€‚ Redis åˆ©ç”¨é˜Ÿåˆ—æŠ€æœ¯ï¼Œå°†å¹¶å‘è®¿é—®å˜ä¸ºä¸²è¡Œè®¿é—®ï¼Œæ¶ˆé™¤äº†ä¼ ç»Ÿæ•°æ®åº“ä¸²è¡Œæ§åˆ¶çš„å¼€é”€ 4ã€Redis å…¨ç¨‹ä½¿ç”¨ hash ç»“æ„ï¼Œè¯»å–é€Ÿåº¦å¿«ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå¯¹æ•°æ®å­˜å‚¨è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¦‚å‹ç¼©è¡¨ï¼Œå¯¹çŸ­æ•°æ®è¿›è¡Œå‹ç¼©å­˜å‚¨ï¼Œå†å¦‚ï¼Œè·³è¡¨ï¼Œä½¿ç”¨æœ‰åºçš„æ•°æ®ç»“æ„åŠ å¿«è¯»å–çš„é€Ÿåº¦ã€‚ Redis æœ‰å‡ ç§æŒä¹…åŒ–æ–¹å¼ï¼ŸæŒä¹…åŒ–æ–¹å¼Redis æä¾›äº†ä¸¤ç§æ–¹å¼ï¼Œå®ç°æ•°æ®çš„æŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚ ã€å…¨é‡ã€‘RDB æŒä¹…åŒ–ï¼Œæ˜¯æŒ‡åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ã€‚å®é™…æ“ä½œè¿‡ç¨‹æ˜¯ï¼Œfork ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…ˆå°†æ•°æ®é›†å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥æˆåŠŸåï¼Œå†æ›¿æ¢ä¹‹å‰çš„æ–‡ä»¶ï¼Œç”¨äºŒè¿›åˆ¶å‹ç¼©å­˜å‚¨ã€‚ ã€å¢é‡ã€‘AOFæŒä¹…åŒ–ï¼Œä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æœåŠ¡å™¨æ‰€å¤„ç†çš„æ¯ä¸€ä¸ªå†™ã€åˆ é™¤æ“ä½œï¼ŒæŸ¥è¯¢æ“ä½œä¸ä¼šè®°å½•ï¼Œä»¥æ–‡æœ¬çš„æ–¹å¼è®°å½•ï¼Œå¯ä»¥æ‰“å¼€æ–‡ä»¶çœ‹åˆ°è¯¦ç»†çš„æ“ä½œè®°å½•ã€‚ äºŒè€…çš„åŒºåˆ«RDBæŒä¹…åŒ–æ˜¯æŒ‡åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œå®é™…æ“ä½œè¿‡ç¨‹æ˜¯forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…ˆå°†æ•°æ®é›†å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥æˆåŠŸåï¼Œå†æ›¿æ¢ä¹‹å‰çš„æ–‡ä»¶ï¼Œç”¨äºŒè¿›åˆ¶å‹ç¼©å­˜å‚¨ã€‚ AOFæŒä¹…åŒ–ä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æœåŠ¡å™¨æ‰€å¤„ç†çš„æ¯ä¸€ä¸ªå†™ã€åˆ é™¤æ“ä½œï¼ŒæŸ¥è¯¢æ“ä½œä¸ä¼šè®°å½•ï¼Œä»¥æ–‡æœ¬çš„æ–¹å¼è®°å½•ï¼Œå¯ä»¥æ‰“å¼€æ–‡ä»¶çœ‹åˆ°è¯¦ç»†çš„æ“ä½œè®°å½•ã€‚ äºŒè€…ä¼˜ç¼ºç‚¹RDBå­˜åœ¨å“ªäº›ä¼˜åŠ¿å‘¢ï¼Ÿ ä¸€æ—¦é‡‡ç”¨è¯¥æ–¹å¼ï¼Œé‚£ä¹ˆä½ çš„æ•´ä¸ªRedisæ•°æ®åº“å°†åªåŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™å¯¹äºæ–‡ä»¶å¤‡ä»½è€Œè¨€æ˜¯éå¸¸å®Œç¾çš„ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æ‰“ç®—æ¯ä¸ªå°æ—¶å½’æ¡£ä¸€æ¬¡æœ€è¿‘24å°æ—¶çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜è¦æ¯å¤©å½’æ¡£ä¸€æ¬¡æœ€è¿‘30å¤©çš„æ•°æ®ã€‚é€šè¿‡è¿™æ ·çš„å¤‡ä»½ç­–ç•¥ï¼Œä¸€æ—¦ç³»ç»Ÿå‡ºç°ç¾éš¾æ€§æ•…éšœï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸å®¹æ˜“çš„è¿›è¡Œæ¢å¤ã€‚ å¯¹äºç¾éš¾æ¢å¤è€Œè¨€ï¼ŒRDBæ˜¯éå¸¸ä¸é”™çš„é€‰æ‹©ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥éå¸¸è½»æ¾çš„å°†ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å‹ç¼©åå†è½¬ç§»åˆ°å…¶å®ƒå­˜å‚¨ä»‹è´¨ä¸Šã€‚ æ€§èƒ½æœ€å¤§åŒ–ã€‚å¯¹äºRedisçš„æœåŠ¡è¿›ç¨‹è€Œè¨€ï¼Œåœ¨å¼€å§‹æŒä¹…åŒ–æ—¶ï¼Œå®ƒå”¯ä¸€éœ€è¦åšçš„åªæ˜¯forkå‡ºå­è¿›ç¨‹ï¼Œä¹‹åå†ç”±å­è¿›ç¨‹å®Œæˆè¿™äº›æŒä¹…åŒ–çš„å·¥ä½œï¼Œè¿™æ ·å°±å¯ä»¥æå¤§çš„é¿å…æœåŠ¡è¿›ç¨‹æ‰§è¡ŒIOæ“ä½œäº†ã€‚ ç›¸æ¯”äºAOFæœºåˆ¶ï¼Œå¦‚æœæ•°æ®é›†å¾ˆå¤§ï¼ŒRDBçš„å¯åŠ¨æ•ˆç‡ä¼šæ›´é«˜ã€‚ RDBåˆå­˜åœ¨å“ªäº›åŠ£åŠ¿å‘¢ï¼Ÿ .å¦‚æœä½ æƒ³ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ï¼Œå³æœ€å¤§é™åº¦çš„é¿å…æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆRDBå°†ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚å› ä¸ºç³»ç»Ÿä¸€æ—¦åœ¨å®šæ—¶æŒä¹…åŒ–ä¹‹å‰å‡ºç°å®•æœºç°è±¡ï¼Œæ­¤å‰æ²¡æœ‰æ¥å¾—åŠå†™å…¥ç£ç›˜çš„æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚ ç”±äºRDBæ˜¯é€šè¿‡forkå­è¿›ç¨‹æ¥ååŠ©å®Œæˆæ•°æ®æŒä¹…åŒ–å·¥ä½œçš„ï¼Œå› æ­¤ï¼Œå¦‚æœå½“æ•°æ®é›†è¾ƒå¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨åœæ­¢æœåŠ¡å‡ ç™¾æ¯«ç§’ï¼Œç”šè‡³æ˜¯1ç§’é’Ÿã€‚ AOFçš„ä¼˜åŠ¿æœ‰å“ªäº›å‘¢ï¼Ÿ è¯¥æœºåˆ¶å¯ä»¥å¸¦æ¥æ›´é«˜çš„æ•°æ®å®‰å…¨æ€§ï¼Œå³æ•°æ®æŒä¹…æ€§ã€‚Redisä¸­æä¾›äº†3ä¸­åŒæ­¥ç­–ç•¥ï¼Œå³æ¯ç§’åŒæ­¥ã€æ¯ä¿®æ”¹åŒæ­¥å’Œä¸åŒæ­¥ã€‚äº‹å®ä¸Šï¼Œæ¯ç§’åŒæ­¥ä¹Ÿæ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œå…¶æ•ˆç‡ä¹Ÿæ˜¯éå¸¸é«˜çš„ï¼Œæ‰€å·®çš„æ˜¯ä¸€æ—¦ç³»ç»Ÿå‡ºç°å®•æœºç°è±¡ï¼Œé‚£ä¹ˆè¿™ä¸€ç§’é’Ÿä¹‹å†…ä¿®æ”¹çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚è€Œæ¯ä¿®æ”¹åŒæ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºåŒæ­¥æŒä¹…åŒ–ï¼Œå³æ¯æ¬¡å‘ç”Ÿçš„æ•°æ®å˜åŒ–éƒ½ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜ä¸­ã€‚å¯ä»¥é¢„è§ï¼Œè¿™ç§æ–¹å¼åœ¨æ•ˆç‡ä¸Šæ˜¯æœ€ä½çš„ã€‚è‡³äºæ— åŒæ­¥ï¼Œæ— éœ€å¤šè¨€ï¼Œæˆ‘æƒ³å¤§å®¶éƒ½èƒ½æ­£ç¡®çš„ç†è§£å®ƒã€‚ ç”±äºè¯¥æœºåˆ¶å¯¹æ—¥å¿—æ–‡ä»¶çš„å†™å…¥æ“ä½œé‡‡ç”¨çš„æ˜¯appendæ¨¡å¼ï¼Œå› æ­¤åœ¨å†™å…¥è¿‡ç¨‹ä¸­å³ä½¿å‡ºç°å®•æœºç°è±¡ï¼Œä¹Ÿä¸ä¼šç ´åæ—¥å¿—æ–‡ä»¶ä¸­å·²ç»å­˜åœ¨çš„å†…å®¹ã€‚ç„¶è€Œå¦‚æœæˆ‘ä»¬æœ¬æ¬¡æ“ä½œåªæ˜¯å†™å…¥äº†ä¸€åŠæ•°æ®å°±å‡ºç°äº†ç³»ç»Ÿå´©æºƒé—®é¢˜ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œåœ¨Redisä¸‹ä¸€æ¬¡å¯åŠ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡redis-check-aofå·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚ å¦‚æœæ—¥å¿—è¿‡å¤§ï¼ŒRediså¯ä»¥è‡ªåŠ¨å¯ç”¨rewriteæœºåˆ¶ã€‚å³Redisä»¥appendæ¨¡å¼ä¸æ–­çš„å°†ä¿®æ”¹æ•°æ®å†™å…¥åˆ°è€çš„ç£ç›˜æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶Redisè¿˜ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç”¨äºè®°å½•æ­¤æœŸé—´æœ‰å“ªäº›ä¿®æ”¹å‘½ä»¤è¢«æ‰§è¡Œã€‚å› æ­¤åœ¨è¿›è¡Œrewriteåˆ‡æ¢æ—¶å¯ä»¥æ›´å¥½çš„ä¿è¯æ•°æ®å®‰å…¨æ€§ã€‚ AOFåŒ…å«ä¸€ä¸ªæ ¼å¼æ¸…æ™°ã€æ˜“äºç†è§£çš„æ—¥å¿—æ–‡ä»¶ç”¨äºè®°å½•æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶å®Œæˆæ•°æ®çš„é‡å»ºã€‚ AOFçš„åŠ£åŠ¿æœ‰å“ªäº›å‘¢ï¼Ÿ å¯¹äºç›¸åŒæ•°é‡çš„æ•°æ®é›†è€Œè¨€ï¼ŒAOFæ–‡ä»¶é€šå¸¸è¦å¤§äºRDBæ–‡ä»¶ã€‚RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚ æ ¹æ®åŒæ­¥ç­–ç•¥çš„ä¸åŒï¼ŒAOFåœ¨è¿è¡Œæ•ˆç‡ä¸Šå¾€å¾€ä¼šæ…¢äºRDBã€‚æ€»ä¹‹ï¼Œæ¯ç§’åŒæ­¥ç­–ç•¥çš„æ•ˆç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼ŒåŒæ­¥ç¦ç”¨ç­–ç•¥çš„æ•ˆç‡å’ŒRDBä¸€æ ·é«˜æ•ˆã€‚ äºŒè€…é€‰æ‹©çš„æ ‡å‡†ï¼Œå°±æ˜¯çœ‹ç³»ç»Ÿæ˜¯æ„¿æ„ç‰ºç‰²ä¸€äº›æ€§èƒ½ï¼Œæ¢å–æ›´é«˜çš„ç¼“å­˜ä¸€è‡´æ€§ï¼ˆaofï¼‰ï¼Œè¿˜æ˜¯æ„¿æ„å†™æ“ä½œé¢‘ç¹çš„æ—¶å€™ï¼Œä¸å¯ç”¨å¤‡ä»½æ¥æ¢å–æ›´é«˜çš„æ€§èƒ½ï¼Œå¾…æ‰‹åŠ¨è¿è¡Œsaveçš„æ—¶å€™ï¼Œå†åšå¤‡ä»½ï¼ˆrdbï¼‰ã€‚rdbè¿™ä¸ªå°±æ›´æœ‰äº› eventually consistent çš„æ„æ€äº†ã€‚ å¸¸ç”¨é…ç½®RDBæŒä¹…åŒ–é…ç½® Redisä¼šå°†æ•°æ®é›†çš„å¿«ç…§dumpåˆ°dump.rdbæ–‡ä»¶ä¸­ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥ä¿®æ”¹RedisæœåŠ¡å™¨dumpå¿«ç…§çš„é¢‘ç‡ï¼Œåœ¨æ‰“å¼€6379.confæ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬æœç´¢saveï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„é…ç½®ä¿¡æ¯ï¼š 123save 900 1 # åœ¨900ç§’(15åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™dumpå†…å­˜å¿«ç…§ã€‚save 300 10 # åœ¨300ç§’(5åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™dumpå†…å­˜å¿«ç…§ã€‚save 60 10000 # åœ¨60ç§’(1åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™dumpå†…å­˜å¿«ç…§ã€‚ AOFæŒä¹…åŒ–é…ç½® åœ¨Redisçš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ä¸‰ç§åŒæ­¥æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š 123appendfsync always # æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶ã€‚appendfsync everysec # æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œè¯¥ç­–ç•¥ä¸ºAOFçš„ç¼ºçœç­–ç•¥ã€‚appendfsync no # ä»ä¸åŒæ­¥ã€‚é«˜æ•ˆä½†æ˜¯æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ã€‚ å¦‚ä½•é€‰æ‹© ä¸è¦ä»…ä»…ä½¿ç”¨ RDBï¼Œå› ä¸ºé‚£æ ·ä¼šå¯¼è‡´ä½ ä¸¢å¤±å¾ˆå¤šæ•°æ® ä¹Ÿä¸è¦ä»…ä»…ä½¿ç”¨ AOFï¼Œå› ä¸ºé‚£æ ·æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ï¼Œä½ é€šè¿‡ AOF åšå†·å¤‡ï¼Œæ²¡æœ‰ RDB åšå†·å¤‡ï¼Œæ¥çš„æ¢å¤é€Ÿåº¦æ›´å¿«; ç¬¬äºŒï¼ŒRDB æ¯æ¬¡ç®€å•ç²—æš´ç”Ÿæˆæ•°æ®å¿«ç…§ï¼Œæ›´åŠ å¥å£®ï¼Œå¯ä»¥é¿å… AOF è¿™ç§å¤æ‚çš„å¤‡ä»½å’Œæ¢å¤æœºåˆ¶çš„ bug ã€‚ Redis æ”¯æŒåŒæ—¶å¼€å¯å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç»¼åˆä½¿ç”¨ AOF å’Œ RDB ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼Œç”¨ AOF æ¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½œä¸ºæ•°æ®æ¢å¤çš„ç¬¬ä¸€é€‰æ‹©; ç”¨ RDB æ¥åšä¸åŒç¨‹åº¦çš„å†·å¤‡ï¼Œåœ¨ AOF æ–‡ä»¶éƒ½ä¸¢å¤±æˆ–æŸåä¸å¯ç”¨çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ RDB æ¥è¿›è¡Œå¿«é€Ÿçš„æ•°æ®æ¢å¤ã€‚ å¦‚æœåŒæ—¶ä½¿ç”¨ RDB å’Œ AOF ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼Œé‚£ä¹ˆåœ¨ Redis é‡å¯çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ AOF æ¥é‡æ–°æ„å»ºæ•°æ®ï¼Œå› ä¸º AOF ä¸­çš„æ•°æ®æ›´åŠ å®Œæ•´ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œ å¦‚æœæƒ³è¾¾åˆ°è¶³ä»¥åª²ç¾ PostgreSQL çš„æ•°æ®å®‰å…¨æ€§ï¼Œ ä½ åº”è¯¥åŒæ—¶ä½¿ç”¨ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½ã€‚å¦‚æœä½ éå¸¸å…³å¿ƒä½ çš„æ•°æ®ï¼Œ ä½†ä»ç„¶å¯ä»¥æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆä½ å¯ä»¥åªä½¿ç”¨ RDB æŒä¹…åŒ–ã€‚ æœ‰å¾ˆå¤šç”¨æˆ·éƒ½åªä½¿ç”¨ AOF æŒä¹…åŒ–ï¼Œä½†å¹¶ä¸æ¨èè¿™ç§æ–¹å¼ï¼šå› ä¸ºå®šæ—¶ç”Ÿæˆ RDB å¿«ç…§ï¼ˆsnapshotï¼‰éå¸¸ä¾¿äºè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œ å¹¶ä¸” RDB æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦æ¯”AOFæ¢å¤çš„é€Ÿåº¦è¦å¿«ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨ RDB è¿˜å¯ä»¥é¿å…ä¹‹å‰æåˆ°çš„ AOF ç¨‹åºçš„ bugã€‚ åœ¨ Redis4.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå…è®¸ä½ ä½¿ç”¨ RDB-AOF æ··åˆæŒä¹…åŒ–æ–¹å¼ï¼Œè¯¦ç»†å¯è§ ã€ŠRedis4.0 ä¹‹ RDB-AOF æ··åˆæŒä¹…åŒ–ã€‹ ã€‚ä¹Ÿå› æ­¤ï¼ŒRDB å’Œ AOF åŒæ—¶ä½¿ç”¨ï¼Œæ˜¯å¸Œæœ›è¾¾åˆ°å®‰å…¨çš„æŒä¹…åŒ–çš„æ¨èæ–¹å¼ã€‚ è‡ªåŠ¨åŒ–è§¦å‘ RDB æŒä¹…åŒ–çš„æ–¹å¼ æ ¹æ® redis.conf é…ç½®ä¸­ SAVE m n å®šæ—¶è§¦å‘ï¼ˆä½¿ç”¨çš„BGSAVEï¼‰ ä¸»ä»å¤åˆ¶æ—¶ï¼Œä¸»èŠ‚ç‚¹è‡ªåŠ¨è§¦å‘ æ‰§è¡Œ Debug Reload æ‰§è¡Œ Shutdown ä¸”æ²¡æœ‰å¼€å¯ AOF æŒä¹…åŒ– BGSAVE åŸç†ï¼š é‡è¦çŸ¥è¯†ï¼š bgsave åšé•œåƒå…¨é‡æŒä¹…åŒ–ï¼ŒAOF åšå¢é‡æŒä¹…åŒ–ã€‚å› ä¸º bgsave ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œä¸å¤Ÿå®æ—¶ï¼Œåœ¨åœæœºçš„æ—¶å€™ä¼šå¯¼è‡´å¤§é‡ä¸¢å¤±æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ AOF æ¥é…åˆä½¿ç”¨ã€‚åœ¨ Redis å®ä¾‹é‡å¯æ—¶ï¼Œä¼šä½¿ç”¨ bgsave æŒä¹…åŒ–æ–‡ä»¶é‡æ–°æ„å»ºå†…å­˜ï¼Œå†ä½¿ç”¨ AOF é‡æ”¾è¿‘æœŸçš„æ“ä½œæŒ‡ä»¤æ¥å®ç°å®Œæ•´æ¢å¤é‡å¯ä¹‹å‰çš„çŠ¶æ€ã€‚ å¯¹æ–¹è¿½é—®é‚£å¦‚æœçªç„¶æœºå™¨æ‰ç”µä¼šæ€æ ·ï¼Ÿå–å†³äº AOF æ—¥å¿— sync å±æ€§çš„é…ç½®ï¼Œå¦‚æœä¸è¦æ±‚æ€§èƒ½ï¼Œåœ¨æ¯æ¡å†™æŒ‡ä»¤æ—¶éƒ½ sync ä¸€ä¸‹ç£ç›˜ï¼Œå°±ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ä½†æ˜¯åœ¨é«˜æ€§èƒ½çš„è¦æ±‚ä¸‹æ¯æ¬¡éƒ½ sync æ˜¯ä¸ç°å®çš„ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨å®šæ—¶ sync ï¼Œæ¯”å¦‚ 1 ç§’ 1 æ¬¡ï¼Œè¿™ä¸ªæ—¶å€™æœ€å¤šå°±ä¼šä¸¢å¤± 1 ç§’çš„æ•°æ®ã€‚ å¯¹æ–¹è¿½é—® bgsave çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä½ ç»™å‡ºä¸¤ä¸ªè¯æ±‡å°±å¯ä»¥äº†ï¼Œfork å’Œ cow ã€‚fork æ˜¯æŒ‡ Redis é€šè¿‡åˆ›å»ºå­è¿›ç¨‹æ¥è¿›è¡Œ bgsave æ“ä½œã€‚cow æŒ‡çš„æ˜¯ copy on write ï¼Œå­è¿›ç¨‹åˆ›å»ºåï¼Œçˆ¶å­è¿›ç¨‹å…±äº«æ•°æ®æ®µï¼Œçˆ¶è¿›ç¨‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ï¼Œå†™è„çš„é¡µé¢æ•°æ®ä¼šé€æ¸å’Œå­è¿›ç¨‹åˆ†ç¦»å¼€æ¥ã€‚ Redis æœ‰å‡ ç§æ•°æ®â€œè¿‡æœŸâ€ç­–ç•¥ï¼ŸRedis çš„è¿‡æœŸç­–ç•¥ï¼Œå°±æ˜¯æŒ‡å½“ Redis ä¸­ç¼“å­˜çš„ key è¿‡æœŸäº†ï¼ŒRedis å¦‚ä½•å¤„ç†ã€‚ Redis æä¾›äº† 3 ç§æ•°æ®è¿‡æœŸç­–ç•¥ï¼š è¢«åŠ¨åˆ é™¤ï¼šå½“è¯»/å†™ä¸€ä¸ªå·²ç»è¿‡æœŸçš„ key æ—¶ï¼Œä¼šè§¦å‘æƒ°æ€§åˆ é™¤ç­–ç•¥ï¼Œç›´æ¥åˆ é™¤æ‰è¿™ä¸ªè¿‡æœŸ key ã€‚ ä¸»åŠ¨åˆ é™¤ï¼šç”±äºæƒ°æ€§åˆ é™¤ç­–ç•¥æ— æ³•ä¿è¯å†·æ•°æ®è¢«åŠæ—¶åˆ æ‰ï¼Œæ‰€ä»¥ Redis ä¼šå®šæœŸä¸»åŠ¨æ·˜æ±°ä¸€æ‰¹å·²è¿‡æœŸçš„ key ã€‚ ä¸»åŠ¨åˆ é™¤ï¼šå½“å‰å·²ç”¨å†…å­˜è¶…è¿‡ maxmemory é™å®šæ—¶ï¼Œè§¦å‘ä¸»åŠ¨æ¸…ç†ç­–ç•¥ï¼Œå³ ã€Œæ•°æ®â€œæ·˜æ±°â€ç­–ç•¥ã€ ã€‚ åœ¨ Redis ä¸­ï¼ŒåŒæ—¶ä½¿ç”¨äº†ä¸Šè¿° 3 ç§ç­–ç•¥ï¼Œå³å®ƒä»¬éäº’æ–¥çš„ã€‚ æƒ³è¦è¿›ä¸€æ­¥äº†è§£ï¼Œå¯ä»¥çœ‹çœ‹ ã€Šå…³äº Redis æ•°æ®è¿‡æœŸç­–ç•¥ã€‹ æ–‡ç« ã€‚ Redis æœ‰å“ªå‡ ç§æ•°æ®â€œæ·˜æ±°â€ç­–ç•¥ï¼ŸRedis å†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚ Redis æä¾›äº† 6 ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š volatile-lru volatile-ttl volatile-random allkeys-lru allkeys-random no-enviction å…·ä½“çš„ æ¯ç§æ•°æ®æ·˜æ±°ç­–ç•¥çš„å®šä¹‰ï¼Œå’Œ å¦‚ä½•é€‰æ‹©è®¨è®ºç­–ç•¥ï¼Œå¯è§ ã€ŠRediså®æˆ˜ï¼ˆäºŒï¼‰ å†…å­˜æ·˜æ±°æœºåˆ¶ã€‹ ã€‚ Redis LRU ç®—æ³• å¦å¤–ï¼ŒRedis çš„ LRU ç®—æ³•ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„ LRU å®ç°ã€‚è¿™æ„å‘³ç€ Redis ä¸èƒ½é€‰æ‹©æœ€ä½³å€™é€‰é”®æ¥å›æ”¶ï¼Œä¹Ÿå°±æ˜¯æœ€ä¹…æœªè¢«è®¿é—®çš„é‚£äº›é”®ã€‚ç›¸åï¼ŒRedis ä¼šå°è¯•æ‰§è¡Œä¸€ä¸ªè¿‘ä¼¼çš„ LRU ç®—æ³•ï¼Œé€šè¿‡é‡‡æ ·ä¸€å°éƒ¨åˆ†é”®ï¼Œç„¶ååœ¨é‡‡æ ·é”®ä¸­å›æ”¶æœ€é€‚åˆ(æ‹¥æœ‰æœ€ä¹…æœªè¢«è®¿é—®æ—¶é—´)çš„é‚£ä¸ªã€‚ å…·ä½“çš„å¯ä»¥çœ‹çœ‹ ã€Šä½¿ç”¨ Redis ä½œä¸ºä¸€ä¸ª LRU ç¼“å­˜ã€‹ æ–‡ç« ã€‚ MySQL é‡Œæœ‰ 2000w æ•°æ®ï¼ŒRedis ä¸­åªå­˜ 20w çš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯ Redis ä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿ è‰¿è‰¿ï¼šè¿™ä¸ªæ˜¯ä»ç½‘ç»œä¸Šæ‰¾åˆ°çš„ä¸€ä¸ªç¥å¥‡çš„é—®é¢˜ï¼Œå¹¶ä¸”çœ‹äº†ç­”æ¡ˆä¹‹åï¼Œè§‰å¾—æœ‰ç‚¹è«åçš„å¯¹ä¸ä¸Šã€‚ æ‰€ä»¥ï¼Œæ„Ÿè§‰è¿™ä¸ªé—®é¢˜çš„ç›®çš„æ˜¯ï¼Œå¦‚ä½•ä¿è¯çƒ­ç‚¹æ•°æ®ä¸è¦è¢«æ·˜æ±°ã€‚ åœ¨ ã€ŒRedis æœ‰å“ªå‡ ç§æ•°æ®â€œæ·˜æ±°â€ç­–ç•¥ï¼Ÿã€ é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œâ€œRedis å†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚â€ ã€‚ é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æ­¤æ—¶è¦ä¿è¯çƒ­ç‚¹æ•°æ®ä¸è¢«æ·˜æ±°ï¼Œé‚£ä¹ˆéœ€è¦é€‰æ‹© volatile-lru æˆ– allkeys-lru è¿™ä¸¤ä¸ªåŸºäº LRU ç®—æ³•çš„æ·˜æ±°ç­–ç•¥ã€‚ ç›¸æ¯”è¾ƒæ¥è¯´ï¼Œæœ€ç»ˆä¼šé€‰æ‹© allkeys-lru æ·˜æ±°ç­–ç•¥ã€‚åŸå› æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨å¯¹ç¼“å­˜çš„è®¿é—®ç¬¦åˆå¹‚å¾‹åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨ç›¸å¯¹çƒ­ç‚¹æ•°æ®ï¼Œæˆ–è€…æˆ‘ä»¬ä¸å¤ªæ¸…æ¥šæˆ‘ä»¬åº”ç”¨çš„ç¼“å­˜è®¿é—®åˆ†å¸ƒçŠ¶å†µï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹© allkeys-lru ç­–ç•¥ã€‚ Redis å›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œçš„ï¼Ÿ ç†è§£å›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œæ˜¯éå¸¸é‡è¦çš„ï¼š ä¸€ä¸ªå®¢æˆ·ç«¯è¿è¡Œäº†æ–°çš„å‘½ä»¤ï¼Œæ·»åŠ äº†æ–°çš„æ•°æ® Redis æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœå¤§äº maxmemory çš„é™åˆ¶, åˆ™æ ¹æ®è®¾å®šå¥½çš„ç­–ç•¥è¿›è¡Œå›æ”¶ã€‚ Redis æ‰§è¡Œæ–°å‘½ä»¤â€¦â€¦ æ‰€ä»¥æˆ‘ä»¬ä¸æ–­åœ°ç©¿è¶Šå†…å­˜é™åˆ¶çš„è¾¹ç•Œï¼Œé€šè¿‡ä¸æ–­è¾¾åˆ°è¾¹ç•Œç„¶åä¸æ–­åœ°å›æ”¶å›åˆ°è¾¹ç•Œä»¥ä¸‹ï¼ˆè·Œå®•èµ·ä¼ï¼‰ã€‚ å¦‚æœæœ‰å¤§é‡çš„ key éœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿå¦‚æœå¤§é‡çš„ key è¿‡æœŸæ—¶é—´è®¾ç½®çš„è¿‡äºé›†ä¸­ï¼Œåˆ°è¿‡æœŸçš„é‚£ä¸ªæ—¶é—´ç‚¹ï¼ŒRediså¯èƒ½ä¼šå‡ºç°çŸ­æš‚çš„å¡é¡¿ç°è±¡ã€‚ ä¸€èˆ¬éœ€è¦åœ¨æ—¶é—´ä¸ŠåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œä½¿å¾—è¿‡æœŸæ—¶é—´åˆ†æ•£ä¸€äº›ã€‚ Redis æœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿå¦‚æœä½ æ˜¯ Redis æ™®é€šç©å®¶ï¼Œå¯èƒ½ä½ çš„å›ç­”æ˜¯å¦‚ä¸‹äº”ç§æ•°æ®ç»“æ„ï¼š å­—ç¬¦ä¸² String å­—å…¸Hash åˆ—è¡¨List é›†åˆSet æœ‰åºé›†åˆ SortedSet å¦‚æœä½ æ˜¯ Redis ä¸­çº§ç©å®¶ï¼Œè¿˜éœ€è¦åŠ ä¸Šä¸‹é¢å‡ ç§æ•°æ®ç»“æ„ï¼š HyperLogLog Geo Pub / Sub å¦‚æœä½ æ˜¯ Redis é«˜ç«¯ç©å®¶ï¼Œä½ å¯èƒ½ç©è¿‡ Redis Module ï¼Œå¯ä»¥å†åŠ ä¸Šä¸‹é¢å‡ ç§æ•°æ®ç»“æ„ï¼š BloomFilter RedisSearch Redis-ML JSON å¦å¤–ï¼Œåœ¨ Redis 5.0 å¢åŠ äº† Stream åŠŸèƒ½ï¼Œä¸€ä¸ªæ–°çš„å¼ºå¤§çš„æ”¯æŒå¤šæ’­çš„å¯æŒä¹…åŒ–çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæä¾›ç±»ä¼¼ Kafka çš„åŠŸèƒ½ã€‚ğŸ˜ˆ é»˜é»˜è·Ÿé¢è¯•å®˜åœ¨è£…ä¸€æ³¢ã€‚ èŠèŠ Redis ä½¿ç”¨åœºæ™¯Redis å¯ç”¨çš„åœºæ™¯éå¸¸ä¹‹å¤šï¼š æ•°æ®ç¼“å­˜ ä¼šè¯ç¼“å­˜ æ—¶æ•ˆæ€§æ•°æ® è®¿é—®é¢‘ç‡ è®¡æ•°å™¨ ç¤¾äº¤åˆ—è¡¨ è®°å½•ç”¨æˆ·åˆ¤å®šä¿¡æ¯ äº¤é›†ã€å¹¶é›†å’Œå·®é›† çƒ­é—¨åˆ—è¡¨ä¸æ’è¡Œæ¦œ æœ€æ–°åŠ¨æ€ æ¶ˆæ¯é˜Ÿåˆ— åˆ†å¸ƒå¼é” è¯¦ç»†çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹å¦‚ä¸‹æ–‡ç« ï¼š ã€ŠèŠèŠ Redis ä½¿ç”¨åœºæ™¯ã€‹ ã€ŠRedis åº”ç”¨åœºæ™¯åŠå®ä¾‹ã€‹ ã€ŠRedis å¸¸è§çš„åº”ç”¨åœºæ™¯è§£æã€‹ ã€ŠRedis å’Œ Memcached å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Œä¸»è¦çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿã€‹ è¯·ç”¨ Redis å’Œä»»æ„è¯­è¨€å®ç°ä¸€æ®µæ¶æ„ç™»å½•ä¿æŠ¤çš„ä»£ç ï¼Œé™åˆ¶ 1 å°æ—¶å†…æ¯ç”¨æˆ· Id æœ€å¤šåªèƒ½ç™»å½• 5 æ¬¡ã€‚ ç”¨åˆ—è¡¨å®ç°ï¼Œåˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ ä»£è¡¨ç™»é™†æ—¶é—´ï¼Œåªè¦æœ€åçš„ç¬¬ 5 æ¬¡ç™»é™†æ—¶é—´å’Œç°åœ¨æ—¶é—´å·®ä¸è¶…è¿‡ 1 å°æ—¶å°±ç¦æ­¢ç™»é™†ã€‚ å…·ä½“çš„ä»£ç å®ç°ï¼Œå¯ä»¥çœ‹çœ‹ ã€Šä¸€é“ Redis é¢è¯•é¢˜ã€‹ ã€‚ Redis æ”¯æŒçš„ Java å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„æœ‰ä¸‰ä¸ª Java å®¢æˆ·ç«¯ï¼š Redisson Redisson ï¼Œæ˜¯ä¸€ä¸ªé«˜çº§çš„åˆ†å¸ƒå¼åè°ƒ Redis å®¢æœç«¯ï¼Œèƒ½å¸®åŠ©ç”¨æˆ·åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è½»æ¾å®ç°ä¸€äº› Java çš„å¯¹è±¡ (Bloom filter, BitSet, Set, SetMultimap, ScoredSortedSet, SortedSet, Map, ConcurrentMap, List, ListMultimap, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, ReadWriteLock, AtomicLong, CountDownLatch, Publish / Subscribe, HyperLogLog)ã€‚ Jedis Jedis æ˜¯ Redis çš„ Java å®ç°çš„å®¢æˆ·ç«¯ï¼Œå…¶ API æä¾›äº†æ¯”è¾ƒå…¨é¢çš„ Redis å‘½ä»¤çš„æ”¯æŒã€‚ Redisson å®ç°äº†åˆ†å¸ƒå¼å’Œå¯æ‰©å±•çš„ Java æ•°æ®ç»“æ„ï¼Œå’Œ Jedis ç›¸æ¯”ï¼ŒJedis åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸æ”¯æŒå­—ç¬¦ä¸²æ“ä½œï¼Œä¸æ”¯æŒæ’åºã€äº‹åŠ¡ã€ç®¡é“ã€åˆ†åŒºç­‰ Redis ç‰¹æ€§ã€‚ Redisson çš„å®—æ—¨æ˜¯ä¿ƒè¿›ä½¿ç”¨è€…å¯¹ Redis çš„å…³æ³¨åˆ†ç¦»ï¼Œä»è€Œè®©ä½¿ç”¨è€…èƒ½å¤Ÿå°†ç²¾åŠ›æ›´é›†ä¸­åœ°æ”¾åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸Šã€‚ Lettuce Lettuce æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çº¿ç¨‹å®‰å…¨çš„ Redis å®¢æˆ·ç«¯ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ª RedisConnection ã€‚å®ƒåˆ©ç”¨ä¼˜ç§€ Netty NIO æ¡†æ¶æ¥é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªè¿æ¥ã€‚ Redis å®˜æ–¹æ¨èä½¿ç”¨ Redisson æˆ– Jedis ã€‚ Spring Boot 2.x å†…ç½®ä½¿ç”¨ Lettuce ã€‚ å¦‚ä½•ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ æ–¹æ¡ˆä¸€ï¼šset æŒ‡ä»¤ å…ˆæ‹¿ setnx æ¥äº‰æŠ¢é”ï¼ŒæŠ¢åˆ°ä¹‹åï¼Œå†ç”¨ expire ç»™é”åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´é˜²æ­¢é”å¿˜è®°äº†é‡Šæ”¾ã€‚ è¿™æ—¶å€™å¯¹æ–¹ä¼šå‘Šè¯‰ä½ è¯´ä½ å›ç­”å¾—ä¸é”™ï¼Œç„¶åæ¥ç€é—®å¦‚æœåœ¨ setnx ä¹‹åæ‰§è¡Œ expire ä¹‹å‰è¿›ç¨‹æ„å¤– crash æˆ–è€…è¦é‡å¯ç»´æŠ¤äº†ï¼Œé‚£ä¼šæ€ä¹ˆæ ·ï¼Ÿ è¿™æ—¶å€™ä½ è¦ç»™äºˆæƒŠè®¶çš„åé¦ˆï¼šå”‰ï¼Œæ˜¯å–”ï¼Œè¿™ä¸ªé”å°±æ°¸è¿œå¾—ä¸åˆ°é‡Šæ”¾äº†ã€‚ç´§æ¥ç€ä½ éœ€è¦æŠ“ä¸€æŠ“è‡ªå·±å¾—è„‘è¢‹ï¼Œæ•…ä½œæ€è€ƒç‰‡åˆ»ï¼Œå¥½åƒæ¥ä¸‹æ¥çš„ç»“æœæ˜¯ä½ ä¸»åŠ¨æ€è€ƒå‡ºæ¥çš„ï¼Œç„¶åå›ç­”ï¼šæˆ‘è®°å¾— set æŒ‡ä»¤æœ‰éå¸¸å¤æ‚çš„å‚æ•°ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯å¯ä»¥åŒæ—¶æŠŠ setnx å’Œ expire åˆæˆä¸€æ¡æŒ‡ä»¤æ¥ç”¨çš„ï¼å¯¹æ–¹è¿™æ—¶ä¼šæ˜¾éœ²ç¬‘å®¹ï¼Œå¿ƒé‡Œå¼€å§‹é»˜å¿µï¼šæ‘ï¼Œè¿™å°å­è¿˜ä¸é”™ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ set æŒ‡ä»¤ï¼Œå®ç°åˆ†å¸ƒå¼é”ã€‚æŒ‡ä»¤å¦‚ä¸‹ï¼š 1SET key value [EX seconds] [PX milliseconds] [NX|XX] å¯ä»¥ä½¿ç”¨ SET key value EX seconds NX å‘½ä»¤ï¼Œå°è¯•è·å¾—é”ã€‚ å…·ä½“çš„å®ç°ï¼Œå¯ä»¥å‚è€ƒ ã€ŠRedis åˆ†å¸ƒå¼é”çš„æ­£ç¡®å®ç°æ–¹å¼ï¼ˆJavaç‰ˆï¼‰ã€‹ æ–‡ç« ã€‚ æ–¹æ¡ˆäºŒï¼šredlock set æŒ‡ä»¤çš„æ–¹æ¡ˆï¼Œé€‚åˆç”¨äºåœ¨å•æœº Redis èŠ‚ç‚¹çš„åœºæ™¯ä¸‹ï¼Œåœ¨å¤š Redis èŠ‚ç‚¹çš„åœºæ™¯ä¸‹ï¼Œä¼šå­˜åœ¨åˆ†å¸ƒå¼é”ä¸¢å¤±çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼ŒRedis ä½œè€… Antirez åŸºäºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹æå‡ºäº†ä¸€ç§æ›´é«˜çº§çš„åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼šRedlock ã€‚ å…·ä½“çš„æ–¹æ¡ˆï¼Œèƒ–å‹å¯ä»¥çœ‹çœ‹è€å‹é£å“¥çš„ä¸¤ç¯‡åšå®¢ï¼š ã€ŠRedlockï¼šRedisåˆ†å¸ƒå¼é”æœ€ç‰›é€¼çš„å®ç°ã€‹ ã€ŠRedisson å®ç° Redis åˆ†å¸ƒå¼é”çš„ N ç§å§¿åŠ¿ã€‹ å¯¹æ¯” Zookeeper åˆ†å¸ƒå¼é” ä»å¯é æ€§ä¸Šæ¥è¯´ï¼ŒZookeeper åˆ†å¸ƒå¼é”å¥½äº Redis åˆ†å¸ƒå¼é”ã€‚ ä»æ€§èƒ½ä¸Šæ¥è¯´ï¼ŒRedis åˆ†å¸ƒå¼é”å¥½äº Zookeeper åˆ†å¸ƒå¼é”ã€‚ æ‰€ä»¥ï¼Œæ²¡æœ‰ç»å¯¹çš„å¥½åï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æ¥å…·ä½“é€‰æ‹©ã€‚ å¦‚ä½•ä½¿ç”¨ Redis å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿä¸€èˆ¬ä½¿ç”¨ list ç»“æ„ä½œä¸ºé˜Ÿåˆ—ï¼Œrpush ç”Ÿäº§æ¶ˆæ¯ï¼Œlpop æ¶ˆè´¹æ¶ˆæ¯ã€‚å½“ lpop æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦é€‚å½“ sleep ä¸€ä¼šå†é‡è¯•ã€‚ å¦‚æœå¯¹æ–¹è¿½é—®å¯ä¸å¯ä»¥ä¸ç”¨ sleep å‘¢ï¼Ÿlist è¿˜æœ‰ä¸ªæŒ‡ä»¤å« blpop ï¼Œåœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒä¼šé˜»å¡ä½ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚ å¦‚æœå¯¹æ–¹è¿½é—®èƒ½ä¸èƒ½ç”Ÿäº§ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡å‘¢ï¼Ÿä½¿ç”¨ pub / sub ä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ï¼Œå¯ä»¥å®ç° 1:N çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ å¦‚æœå¯¹æ–¹è¿½é—® pub / sub æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿåœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå¾—ä½¿ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—å¦‚ rabbitmq ç­‰ã€‚ å¦‚æœå¯¹æ–¹è¿½é—® redis å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—ï¼Ÿæˆ‘ä¼°è®¡ç°åœ¨ä½ å¾ˆæƒ³æŠŠé¢è¯•å®˜ä¸€æ£’æ‰“æ­»å¦‚æœä½ æ‰‹ä¸Šæœ‰ä¸€æ ¹æ£’çƒæ£çš„è¯ï¼Œæ€ä¹ˆé—®çš„è¿™ä¹ˆè¯¦ç»†ã€‚ä½†æ˜¯ä½ å¾ˆå…‹åˆ¶ï¼Œç„¶åç¥æ€è‡ªè‹¥çš„å›ç­”é“ï¼šä½¿ç”¨ sortedset ï¼Œæ‹¿æ—¶é—´æˆ³ä½œä¸º score ï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸º key è°ƒç”¨ zadd æ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨ zrangebyscore æŒ‡ä»¤è·å– N ç§’ä¹‹å‰çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚ åˆ°è¿™é‡Œï¼Œé¢è¯•å®˜æš—åœ°é‡Œå·²ç»å¯¹ä½ ç«–èµ·äº†å¤§æ‹‡æŒ‡ã€‚ä½†æ˜¯ä»–ä¸çŸ¥é“çš„æ˜¯æ­¤åˆ»ä½ å´ç«–èµ·äº†ä¸­æŒ‡ï¼Œåœ¨æ¤…å­èƒŒåã€‚ å½“ç„¶ï¼Œå®é™…ä¸Š Redis çœŸçš„çœŸçš„çœŸçš„ä¸æ¨èä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨ï¼Œå®ƒæœ€å¤šåªæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„å­˜å‚¨å±‚ï¼Œä¸Šå±‚çš„é€»è¾‘ï¼Œè¿˜éœ€è¦åšå¤§é‡çš„å°è£…å’Œæ”¯æŒã€‚ å¦å¤–ï¼Œåœ¨ Redis 5.0 å¢åŠ äº† Stream åŠŸèƒ½ï¼Œä¸€ä¸ªæ–°çš„å¼ºå¤§çš„æ”¯æŒå¤šæ’­çš„å¯æŒä¹…åŒ–çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæä¾›ç±»ä¼¼ Kafka çš„åŠŸèƒ½ã€‚ ä»€ä¹ˆæ˜¯ Redis Pipelining ï¼Ÿä¸€æ¬¡è¯·æ±‚/å“åº”æœåŠ¡å™¨èƒ½å®ç°å¤„ç†æ–°çš„è¯·æ±‚å³ä½¿æ—§çš„è¯·æ±‚è¿˜æœªè¢«å“åº”ã€‚è¿™æ ·å°±å¯ä»¥å°†å¤šä¸ªå‘½ä»¤å‘é€åˆ°æœåŠ¡å™¨ï¼Œè€Œä¸ç”¨ç­‰å¾…å›å¤ï¼Œæœ€ååœ¨ä¸€ä¸ªæ­¥éª¤ä¸­è¯»å–è¯¥ç­”å¤ã€‚ è¿™å°±æ˜¯ç®¡é“ï¼ˆpipeliningï¼‰ï¼Œæ˜¯ä¸€ç§å‡ åå¹´æ¥å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯ã€‚ä¾‹å¦‚è®¸å¤š POP3 åè®®å·²ç»å®ç°æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå¤§å¤§åŠ å¿«äº†ä»æœåŠ¡å™¨ä¸‹è½½æ–°é‚®ä»¶çš„è¿‡ç¨‹ã€‚ Redis å¾ˆæ—©å°±æ”¯æŒç®¡é“ï¼ˆpipeliningï¼‰æŠ€æœ¯ï¼Œå› æ­¤æ— è®ºä½ è¿è¡Œçš„æ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨ç®¡é“ï¼ˆpipeliningï¼‰æ“ä½œ Redisã€‚ Redis å¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥ï¼Ÿ Redis2.6 å¼€å§‹ï¼ŒRedis-cli æ”¯æŒä¸€ç§æ–°çš„è¢«ç§°ä¹‹ä¸º pipe mode çš„æ–°æ¨¡å¼ç”¨äºæ‰§è¡Œå¤§é‡æ•°æ®æ’å…¥å·¥ä½œã€‚ å…·ä½“å¯è§ ã€ŠRedis å¤§é‡æ•°æ®æ’å…¥ã€‹ æ–‡ç« ã€‚ ä»€ä¹ˆæ˜¯ Redis äº‹åŠ¡ï¼Ÿå’Œä¼—å¤šå…¶å®ƒæ•°æ®åº“ä¸€æ ·ï¼ŒRedis ä½œä¸º NoSQL æ•°æ®åº“ä¹ŸåŒæ ·æä¾›äº†äº‹åŠ¡æœºåˆ¶ã€‚åœ¨Redisä¸­ï¼ŒMULTI / EXEC / DISCARD / WATCH è¿™å››ä¸ªå‘½ä»¤æ˜¯æˆ‘ä»¬å®ç°äº‹åŠ¡çš„åŸºçŸ³ã€‚ç›¸ä¿¡å¯¹æœ‰å…³ç³»å‹æ•°æ®åº“å¼€å‘ç»éªŒçš„å¼€å‘è€…è€Œè¨€è¿™ä¸€æ¦‚å¿µå¹¶ä¸é™Œç”Ÿï¼Œå³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼šç®€è¦çš„åˆ—å‡º Redis ä¸­äº‹åŠ¡çš„å®ç°ç‰¹å¾ï¼š 1ã€åœ¨äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½å°†ä¼šè¢«ä¸²è¡ŒåŒ–çš„é¡ºåºæ‰§è¡Œï¼Œäº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼ŒRedis ä¸ä¼šå†ä¸ºå…¶å®ƒå®¢æˆ·ç«¯çš„è¯·æ±‚æä¾›ä»»ä½•æœåŠ¡ï¼Œä»è€Œä¿è¯äº†äº‹ç‰©ä¸­çš„æ‰€æœ‰å‘½ä»¤è¢«åŸå­çš„æ‰§è¡Œã€‚ 2ã€å’Œå…³ç³»å‹æ•°æ®åº“ä¸­çš„äº‹åŠ¡ç›¸æ¯”ï¼Œåœ¨ Redis äº‹åŠ¡ä¸­å¦‚æœæœ‰æŸä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«ç»§ç»­æ‰§è¡Œã€‚ 3ã€æˆ‘ä»¬å¯ä»¥é€šè¿‡ MULTI å‘½ä»¤å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæœ‰å…³ç³»å‹æ•°æ®åº“å¼€å‘ç»éªŒçš„äººå¯ä»¥å°†å…¶ç†è§£ä¸º &quot;BEGIN TRANSACTION&quot; è¯­å¥ã€‚åœ¨è¯¥è¯­å¥ä¹‹åæ‰§è¡Œçš„å‘½ä»¤éƒ½ï¼Œå°†è¢«è§†ä¸ºäº‹åŠ¡ä¹‹å†…çš„æ“ä½œï¼Œæœ€åæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ EXEC / DISCARD å‘½ä»¤æ¥æäº¤ / å›æ»šè¯¥äº‹åŠ¡å†…çš„æ‰€æœ‰æ“ä½œã€‚è¿™ä¸¤ä¸ª Redis å‘½ä»¤ï¼Œå¯è¢«è§†ä¸ºç­‰åŒäºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ COMMIT / ROLLBACK è¯­å¥ã€‚ 4ã€åœ¨äº‹åŠ¡å¼€å¯ä¹‹å‰ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å‡ºç°é€šè®¯æ•…éšœå¹¶å¯¼è‡´ç½‘ç»œæ–­å¼€ï¼Œå…¶åæ‰€æœ‰å¾…æ‰§è¡Œçš„è¯­å¥éƒ½å°†ä¸ä¼šè¢«æœåŠ¡å™¨æ‰§è¡Œã€‚ç„¶è€Œå¦‚æœç½‘ç»œä¸­æ–­äº‹ä»¶æ˜¯å‘ç”Ÿåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ EXEC å‘½ä»¤ä¹‹åï¼Œé‚£ä¹ˆè¯¥äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«æœåŠ¡å™¨æ‰§è¡Œã€‚ 5ã€å½“ä½¿ç”¨ Append-Only æ¨¡å¼æ—¶ï¼ŒRedis ä¼šé€šè¿‡è°ƒç”¨ç³»ç»Ÿå‡½æ•° write å°†è¯¥äº‹åŠ¡å†…çš„æ‰€æœ‰å†™æ“ä½œåœ¨æœ¬æ¬¡è°ƒç”¨ä¸­å…¨éƒ¨å†™å…¥ç£ç›˜ã€‚ç„¶è€Œå¦‚æœåœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­å‡ºç°ç³»ç»Ÿå´©æºƒï¼Œå¦‚ç”µæºæ•…éšœå¯¼è‡´çš„å®•æœºï¼Œé‚£ä¹ˆæ­¤æ—¶ä¹Ÿè®¸åªæœ‰éƒ¨åˆ†æ•°æ®è¢«å†™å…¥åˆ°ç£ç›˜ï¼Œè€Œå¦å¤–ä¸€éƒ¨åˆ†æ•°æ®å´å·²ç»ä¸¢å¤±ã€‚ Redis æœåŠ¡å™¨ä¼šåœ¨é‡æ–°å¯åŠ¨æ—¶æ‰§è¡Œä¸€ç³»åˆ—å¿…è¦çš„ä¸€è‡´æ€§æ£€æµ‹ï¼Œä¸€æ—¦å‘ç°ç±»ä¼¼é—®é¢˜ï¼Œå°±ä¼šç«‹å³é€€å‡ºå¹¶ç»™å‡ºç›¸åº”çš„é”™è¯¯æç¤ºã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±è¦å……åˆ†åˆ©ç”¨ Redis å·¥å…·åŒ…ä¸­æä¾›çš„ redis-check-aof å·¥å…·ï¼Œè¯¥å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šä½åˆ°æ•°æ®ä¸ä¸€è‡´çš„é”™è¯¯ï¼Œå¹¶å°†å·²ç»å†™å…¥çš„éƒ¨åˆ†æ•°æ®è¿›è¡Œå›æ»šã€‚ä¿®å¤ä¹‹åæˆ‘ä»¬å°±å¯ä»¥å†æ¬¡é‡æ–°å¯åŠ¨RedisæœåŠ¡å™¨äº†ã€‚ å¦‚ä½•å®ç° Redis CAS æ“ä½œï¼Ÿ åœ¨ Redis çš„äº‹åŠ¡ä¸­ï¼ŒWATCH å‘½ä»¤å¯ç”¨äºæä¾›CAS(check-and-set)åŠŸèƒ½ã€‚ å‡è®¾æˆ‘ä»¬é€šè¿‡ WATCH å‘½ä»¤åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰ç›‘æ§äº†å¤šä¸ª keys ï¼Œå€˜è‹¥åœ¨ WATCH ä¹‹åæœ‰ä»»ä½• Key çš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼ŒEXEC å‘½ä»¤æ‰§è¡Œçš„äº‹åŠ¡éƒ½å°†è¢«æ”¾å¼ƒï¼ŒåŒæ—¶è¿”å› nil åº”ç­”ä»¥é€šçŸ¥è°ƒç”¨è€…äº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚ å…·ä½“çš„ç¤ºä¾‹ï¼Œå¯ä»¥çœ‹çœ‹ ã€ŠRedis äº‹åŠ¡é” CAS å®ç°ä»¥åŠæ·±å…¥è¯¯åŒºã€‹ ã€‚ Redis é›†ç¾¤éƒ½æœ‰å“ªäº›æ–¹æ¡ˆï¼ŸRedis é›†ç¾¤æ–¹æ¡ˆå¦‚ä¸‹ï¼š 1ã€Redis Sentinel 2ã€Redis Cluster 3ã€Twemproxy 4ã€Codis 5ã€å®¢æˆ·ç«¯åˆ†ç‰‡ å…³äºå‰å››ç§ï¼Œå¯ä»¥çœ‹çœ‹ ã€ŠRedis å®æˆ˜ï¼ˆå››ï¼‰é›†ç¾¤æœºåˆ¶ã€‹ è¿™ç¯‡æ–‡ç« ã€‚ å…³äºæœ€åä¸€ç§ï¼Œå®¢æˆ·ç«¯åˆ†ç‰‡ï¼Œåœ¨ Redis Cluster å‡ºç°ä¹‹å‰ä½¿ç”¨è¾ƒå¤šï¼Œç›®å‰å·²ç»ä½¿ç”¨æ¯”è¾ƒå°‘äº†ã€‚å®ç°æ–¹å¼å¦‚ä¸‹ï¼š åœ¨ä¸šåŠ¡ä»£ç å±‚å®ç°ï¼Œèµ·å‡ ä¸ªæ¯«æ— å…³è”çš„ Redis å®ä¾‹ï¼Œåœ¨ä»£ç å±‚ï¼Œå¯¹ Key è¿›è¡Œ hash è®¡ç®—ï¼Œç„¶åå»å¯¹åº”çš„ Redis å®ä¾‹æ“ä½œæ•°æ®ã€‚ è¿™ç§æ–¹å¼å¯¹ hash å±‚ä»£ç è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè€ƒè™‘éƒ¨åˆ†åŒ…æ‹¬ï¼ŒèŠ‚ç‚¹å¤±æ•ˆåçš„æ›¿ä»£ç®—æ³•æ–¹æ¡ˆï¼Œæ•°æ®éœ‡è¡åçš„è‡ªåŠ¨è„šæœ¬æ¢å¤ï¼Œå®ä¾‹çš„ç›‘æ§ï¼Œç­‰ç­‰ã€‚ é€‰æ‹© ç›®å‰ä¸€èˆ¬åœ¨é€‰å‹ä¸Šæ¥è¯´ï¼š ä½“é‡è¾ƒå°æ—¶ï¼Œé€‰æ‹© Redis Sentinel ï¼Œå•ä¸» Redis è¶³ä»¥æ”¯æ’‘ä¸šåŠ¡ã€‚ ä½“é‡è¾ƒå¤§æ—¶ï¼Œé€‰æ‹© Redis Cluster ï¼Œé€šè¿‡åˆ†ç‰‡ï¼Œä½¿ç”¨æ›´å¤šå†…å­˜ã€‚ Redis é›†ç¾¤å¦‚ä½•æ‰©å®¹ï¼Ÿ è¿™ä¸ªé—®é¢˜ï¼Œè‰¿è‰¿äº†è§£çš„ä¹Ÿä¸æ˜¯å¾ˆå¤šï¼Œå»ºè®®åœ¨æœç´¢æœ‰ä»€ä¹ˆæ–¹æ¡ˆã€‚ å¦‚æœ Redis è¢«å½“åšç¼“å­˜ä½¿ç”¨ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œå®ç°åŠ¨æ€æ‰©å®¹ç¼©å®¹ã€‚ å¦‚æœ Redis è¢«å½“åšä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ï¼Œå¿…é¡»ä½¿ç”¨å›ºå®šçš„ keys-to-nodes æ˜ å°„å…³ç³»ï¼ŒèŠ‚ç‚¹çš„æ•°é‡ä¸€æ—¦ç¡®å®šä¸èƒ½å˜åŒ–ã€‚å¦åˆ™çš„è¯(å³Redis èŠ‚ç‚¹éœ€è¦åŠ¨æ€å˜åŒ–çš„æƒ…å†µï¼‰ï¼Œå¿…é¡»ä½¿ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ•°æ®å†å¹³è¡¡çš„ä¸€å¥—ç³»ç»Ÿï¼Œè€Œå½“å‰åªæœ‰ Redis Clusterã€Codis å¯ä»¥åšåˆ°è¿™æ ·ã€‚ ä»€ä¹ˆæ˜¯ Redis ä¸»ä»åŒæ­¥ï¼ŸRedis ä¸»ä»åŒæ­¥ Redis çš„ä¸»ä»åŒæ­¥(replication)æœºåˆ¶ï¼Œå…è®¸ Slave ä» Master é‚£é‡Œï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“æ‹·è´åˆ°å®Œæ•´çš„æ•°æ®å¤‡ä»½ï¼Œä»è€Œè¾¾åˆ°ä¸»ä»æœºåˆ¶ã€‚ ä¸»æ•°æ®åº“å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œå½“å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™è‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æ•°æ®åº“ï¼Œè€Œä»æ•°æ®åº“ä¸€èˆ¬æ˜¯åªè¯»çš„ï¼Œå¹¶æ¥æ”¶ä¸»æ•°æ®åº“åŒæ­¥è¿‡æ¥çš„æ•°æ®ã€‚ ä¸€ä¸ªä¸»æ•°æ®åº“å¯ä»¥æœ‰å¤šä¸ªä»æ•°æ®åº“ï¼Œè€Œä¸€ä¸ªä»æ•°æ®åº“åªèƒ½æœ‰ä¸€ä¸ªä¸»æ•°æ®åº“ã€‚ ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œä¸»èŠ‚ç‚¹åšä¸€æ¬¡ bgsave æ“ä½œï¼Œå¹¶åŒæ—¶å°†åç»­ä¿®æ”¹æ“ä½œè®°å½•åˆ°å†…å­˜ buffer ï¼Œå¾…å®Œæˆåå°† RDB æ–‡ä»¶å…¨é‡åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹ï¼Œå¤åˆ¶èŠ‚ç‚¹æ¥å—å®Œæˆåå°† RDB é•œåƒåŠ è½½åˆ°å†…å­˜ã€‚åŠ è½½å®Œæˆåï¼Œå†é€šçŸ¥ä¸»èŠ‚ç‚¹å°†æœŸé—´ä¿®æ”¹çš„æ“ä½œè®°å½•åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹è¿›è¡Œé‡æ”¾å°±å®Œæˆäº†åŒæ­¥è¿‡ç¨‹ã€‚ å¥½å¤„ é€šè¿‡ Redis çš„å¤åˆ¶åŠŸï¼Œèƒ½å¯ä»¥å¾ˆå¥½çš„å®ç°æ•°æ®åº“çš„è¯»å†™åˆ†ç¦»ï¼Œæé«˜æœåŠ¡å™¨çš„è´Ÿè½½èƒ½åŠ›ã€‚ä¸»æ•°æ®åº“ä¸»è¦è¿›è¡Œå†™æ“ä½œï¼Œè€Œä»æ•°æ®åº“è´Ÿè´£è¯»æ“ä½œã€‚ Redis ä¸»ä»åŒæ­¥ï¼Œæ˜¯å¾ˆå¤š Redis é›†ç¾¤æ–¹æ¡ˆçš„åŸºç¡€ï¼Œä¾‹å¦‚ Redis Sentinelã€Redis Cluster ç­‰ç­‰ã€‚ æ›´å¤šè¯¦ç»†ï¼Œå¯ä»¥çœ‹çœ‹ ã€ŠRedis ä¸»ä»æ¶æ„ã€‹ ã€‚ å¦‚ä½•ä½¿ç”¨ Redis Sentinel å®ç°é«˜å¯ç”¨ï¼Ÿå¯ä»¥çœ‹çœ‹ ã€ŠRedis å“¨å…µé›†ç¾¤å®ç°é«˜å¯ç”¨ã€‹ ã€‚ å¦‚æœä½¿ç”¨ Redis Cluster å®ç°é«˜å¯ç”¨ï¼Ÿå¯ä»¥çœ‹çœ‹ ã€ŠRedis é›†ç¾¤æ•™ç¨‹ã€‹ å®Œæ•´ç‰ˆ ã€ŠRedis é›†ç¾¤æ¨¡å¼çš„å·¥ä½œåŸç†èƒ½è¯´ä¸€ä¸‹ä¹ˆï¼Ÿã€‹ ç²¾ç®€ç‰ˆ è¯´è¯´ Redis å“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿ Redis Cluster æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§ hash ï¼Œè€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µã€‚ Redis é›†ç¾¤æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ª key é€šè¿‡ CRC16 æ ¡éªŒåå¯¹ 16384 å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ï¼Œé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ† hash æ§½ã€‚ å› ä¸ºæœ€å¤§æ˜¯ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œæ‰€ä»¥è€ƒè™‘ Redis é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½åˆ†é…åˆ°ä¸€ä¸ªå“ˆå¸Œæ§½ï¼Œæ‰€ä»¥æœ€å¤šæ”¯æŒ 16384 ä¸ª Redis èŠ‚ç‚¹ã€‚ Redis Cluster çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ ä¸ºäº†ä½¿åœ¨éƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥æˆ–è€…å¤§éƒ¨åˆ†èŠ‚ç‚¹æ— æ³•é€šä¿¡çš„æƒ…å†µä¸‹é›†ç¾¤ä»ç„¶å¯ç”¨ï¼Œæ‰€ä»¥é›†ç¾¤ä½¿ç”¨äº†ä¸»ä»å¤åˆ¶æ¨¡å‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰ N-1 ä¸ªå¤åˆ¶èŠ‚ç‚¹ã€‚ æ‰€ä»¥ï¼ŒRedis Cluster å¯ä»¥è¯´æ˜¯ Redis Sentinel å¸¦åˆ†ç‰‡çš„åŠ å¼ºç‰ˆã€‚ä¹Ÿå¯ä»¥è¯´ï¼š Redis Sentinel ç€çœ¼äºé«˜å¯ç”¨ï¼Œåœ¨ master å®•æœºæ—¶ä¼šè‡ªåŠ¨å°† slave æå‡ä¸º master ï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚ Redis Cluster ç€çœ¼äºæ‰©å±•æ€§ï¼Œåœ¨å•ä¸ª Redis å†…å­˜ä¸è¶³æ—¶ï¼Œä½¿ç”¨Cluster è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€‚ Redis Cluster æ–¹æ¡ˆä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ï¼Ÿ æœ‰ Aï¼ŒBï¼ŒC ä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œåœ¨æ²¡æœ‰å¤åˆ¶æ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œå¦‚æœèŠ‚ç‚¹ B å®•æœºäº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±ä¼šä»¥ä¸ºç¼ºå°‘ 5501-11000 è¿™ä¸ªèŒƒå›´çš„æ§½è€Œä¸å¯ç”¨ã€‚ Redis Cluster ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ Redis å¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œè€Œæ˜¯ã€å¼‚æ­¥å¤åˆ¶ã€‘ï¼Œè¿™æ„å‘³è¿™åœ¨å®é™…ä¸­é›†ç¾¤åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹å¯èƒ½ä¼šä¸¢å¤±å†™æ“ä½œã€‚ Redis é›†ç¾¤å¦‚ä½•é€‰æ‹©æ•°æ®åº“ï¼Ÿ Redis é›†ç¾¤ç›®å‰æ— æ³•åšæ•°æ®åº“é€‰æ‹©ï¼Œé»˜è®¤åœ¨ 0 æ•°æ®åº“ã€‚ è¯·è¯´è¯´ç”Ÿäº§ç¯å¢ƒä¸­çš„ Redis æ˜¯æ€ä¹ˆéƒ¨ç½²çš„ï¼Ÿ é‡ç‚¹é—®é¢˜ï¼Œä»”ç»†ç†è§£ã€‚ Redis Clusterï¼Œ10 å°æœºå™¨ï¼Œ5 å°æœºå™¨éƒ¨ç½²äº† redis ä¸»å®ä¾‹ï¼Œå¦å¤– 5 å°æœºå™¨éƒ¨ç½²äº† redis çš„ä»å®ä¾‹ï¼Œæ¯ä¸ªä¸»å®ä¾‹æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œ5 ä¸ªèŠ‚ç‚¹å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è¯»å†™é«˜å³° qps å¯èƒ½å¯ä»¥è¾¾åˆ°æ¯ç§’ 5 ä¸‡ï¼Œ5 å°æœºå™¨æœ€å¤šæ˜¯ 25 ä¸‡è¯»å†™è¯·æ±‚æ¯ç§’ã€‚ æœºå™¨æ˜¯ä»€ä¹ˆé…ç½®ï¼Ÿ32G å†…å­˜ + 8 æ ¸ CPU + 1T ç£ç›˜ï¼Œä½†æ˜¯åˆ†é…ç»™ Redis è¿›ç¨‹çš„æ˜¯ 10g å†…å­˜ï¼Œä¸€èˆ¬çº¿ä¸Šç”Ÿäº§ç¯å¢ƒï¼ŒRedis çš„å†…å­˜å°½é‡ä¸è¦è¶…è¿‡ 10gï¼Œè¶…è¿‡ 10g å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚é‚£ä¹ˆï¼Œ5 å°æœºå™¨å¯¹å¤–æä¾›è¯»å†™ï¼Œä¸€å…±æœ‰ 50g å†…å­˜ã€‚ å› ä¸ºæ¯ä¸ªä¸»å®ä¾‹éƒ½æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œæ‰€ä»¥æ˜¯é«˜å¯ç”¨çš„ï¼Œä»»ä½•ä¸€ä¸ªä¸»å®ä¾‹å®•æœºï¼Œéƒ½ä¼šè‡ªåŠ¨æ•…éšœè¿ç§»ï¼ŒRedis ä»å®ä¾‹ä¼šè‡ªåŠ¨å˜æˆä¸»å®ä¾‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ã€‚ ä½ å¾€å†…å­˜é‡Œå†™çš„æ˜¯ä»€ä¹ˆæ•°æ®ï¼Ÿæ¯æ¡æ•°æ®çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿå•†å“æ•°æ®ï¼Œæ¯æ¡æ•°æ®æ˜¯ 10kb ã€‚100 æ¡æ•°æ®æ˜¯ 1mb ï¼Œ10 ä¸‡æ¡æ•°æ®æ˜¯ 1g ã€‚å¸¸é©»å†…å­˜çš„æ˜¯ 200 ä¸‡æ¡å•†å“æ•°æ®ï¼Œå ç”¨å†…å­˜æ˜¯ 20gï¼Œä»…ä»…ä¸åˆ°æ€»å†…å­˜çš„ 50%ã€‚ç›®å‰é«˜å³°æœŸæ¯ç§’å°±æ˜¯ 3500 å·¦å³çš„è¯·æ±‚é‡ã€‚ å…¶å®å¤§å‹çš„å…¬å¸ï¼Œä¼šæœ‰åŸºç¡€æ¶æ„çš„ team è´Ÿè´£ç¼“å­˜é›†ç¾¤çš„è¿ç»´ã€‚ ä»€ä¹ˆæ˜¯ Redis åˆ†åŒºï¼Ÿ è¿™ä¸ªé—®é¢˜ï¼Œå’Œ ã€ŒRedis é›†ç¾¤éƒ½æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿã€ æ˜¯åŒç±»é—®é¢˜ã€‚ å…³äºå¦‚ä¸‹å››ä¸ªé—®é¢˜ï¼Œç›´æ¥çœ‹ ã€ŠRedis åˆ†åŒºã€‹ æ–‡ç« ã€‚ Redis åˆ†åŒºæ˜¯ä»€ä¹ˆï¼Ÿ åˆ†åŒºçš„ä¼˜åŠ¿ï¼Ÿ åˆ†åŒºçš„ä¸è¶³ï¼Ÿ åˆ†åŒºç±»å‹ï¼Ÿ å¯èƒ½æœ‰èƒ–å‹ä¼šæ‡µé€¼ï¼Œåˆæ˜¯ Redis ä¸»ä»å¤åˆ¶ï¼Œåˆæ˜¯ Redis åˆ†åŒºï¼Œåˆæ˜¯ Redis é›†ç¾¤ã€‚å‚»å‚»åˆ†ä¸æ¸…å•Šï¼ Redis åˆ†åŒºæ˜¯ä¸€ç§æ¨¡å¼ï¼Œå°†æ•°æ®åˆ†åŒºåˆ°ä¸åŒçš„ Redis èŠ‚ç‚¹ä¸Šï¼Œè€Œ Redis é›†ç¾¤çš„ Redis Clusterã€Twemproxyã€Codisã€å®¢æˆ·ç«¯åˆ†ç‰‡( ä¸åŒ…æ‹¬ Redis Sentinel ) è¿™å››ç§æ–¹æ¡ˆï¼Œæ˜¯ Redis åˆ†åŒºçš„å…·ä½“å®ç°ã€‚ Redis æ¯ä¸ªåˆ†åŒºï¼Œå¦‚æœæƒ³è¦å®ç°é«˜å¯ç”¨ï¼Œéœ€è¦ä½¿ç”¨åˆ° Redis ä¸»ä»å¤åˆ¶ã€‚ ä½ çŸ¥é“æœ‰å“ªäº› Redis åˆ†åŒºå®ç°æ–¹æ¡ˆï¼Ÿ Redis åˆ†åŒºæ–¹æ¡ˆï¼Œä¸»è¦åˆ†æˆä¸¤ç§ç±»å‹ï¼š å®¢æˆ·ç«¯åˆ†åŒºï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯å°±å·²ç»å†³å®šæ•°æ®ä¼šè¢«å­˜å‚¨åˆ°å“ªä¸ª Redis èŠ‚ç‚¹æˆ–è€…ä»å“ªä¸ª Redis èŠ‚ç‚¹è¯»å–ã€‚å¤§å¤šæ•°å®¢æˆ·ç«¯å·²ç»å®ç°äº†å®¢æˆ·ç«¯åˆ†åŒºã€‚ æ¡ˆä¾‹ï¼šRedis Cluster å’Œå®¢æˆ·ç«¯åˆ†åŒºã€‚ ä»£ç†åˆ†åŒºï¼Œæ„å‘³ç€å®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€ç»™ä»£ç†ï¼Œç„¶åä»£ç†å†³å®šå»å“ªä¸ªèŠ‚ç‚¹å†™æ•°æ®æˆ–è€…è¯»æ•°æ®ã€‚ä»£ç†æ ¹æ®åˆ†åŒºè§„åˆ™å†³å®šè¯·æ±‚å“ªäº› Redis å®ä¾‹ï¼Œç„¶åæ ¹æ® Redis çš„å“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ æ¡ˆä¾‹ï¼šTwemproxy å’Œ Codis ã€‚ æŸ¥è¯¢è·¯ç”±(Query routing)çš„æ„æ€ï¼Œæ˜¯å®¢æˆ·ç«¯éšæœºåœ°è¯·æ±‚ä»»æ„ä¸€ä¸ª Redis å®ä¾‹ï¼Œç„¶åç”± Redis å°†è¯·æ±‚è½¬å‘ç»™æ­£ç¡®çš„ Redis èŠ‚ç‚¹ã€‚Redis Cluster å®ç°äº†ä¸€ç§æ··åˆå½¢å¼çš„æŸ¥è¯¢è·¯ç”±ï¼Œä½†å¹¶ä¸æ˜¯ç›´æ¥å°†è¯·æ±‚ä»ä¸€ä¸ªRedis èŠ‚ç‚¹è½¬å‘åˆ°å¦ä¸€ä¸ª Redis èŠ‚ç‚¹ï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯çš„å¸®åŠ©ä¸‹ç›´æ¥ redirect åˆ°æ­£ç¡®çš„ Redis èŠ‚ç‚¹ã€‚ åˆ†å¸ƒå¼ Redis æ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿï¼Ÿ å¦‚ä¸‹æ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªå¤§ç­”æ¡ˆï¼š æ—¢ç„¶ Redis æ˜¯å¦‚æ­¤çš„è½»é‡ï¼ˆå•å®ä¾‹åªä½¿ç”¨1Må†…å­˜ï¼‰ï¼Œä¸ºé˜²æ­¢ä»¥åçš„æ‰©å®¹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ä¸€å¼€å§‹å°±å¯åŠ¨è¾ƒå¤šå®ä¾‹ã€‚å³ä¾¿ä½ åªæœ‰ä¸€å°æœåŠ¡å™¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±è®© Redis ä»¥åˆ†å¸ƒå¼çš„æ–¹å¼è¿è¡Œï¼Œä½¿ç”¨åˆ†åŒºï¼Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ªå®ä¾‹ã€‚ ä¸€å¼€å§‹å°±å¤šè®¾ç½®å‡ ä¸ª Redis å®ä¾‹ï¼Œä¾‹å¦‚ 32 æˆ–è€… 64 ä¸ªå®ä¾‹ï¼Œå¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´è¿™æ“ä½œèµ·æ¥å¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯ä»é•¿ä¹…æ¥çœ‹åšè¿™ç‚¹ç‰ºç‰²æ˜¯å€¼å¾—çš„ã€‚ è¿™æ ·çš„è¯ï¼Œå½“ä½ çš„æ•°æ®ä¸æ–­å¢é•¿ï¼Œéœ€è¦æ›´å¤šçš„ Redis æœåŠ¡å™¨æ—¶ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯ä»…ä»…å°† Redis å®ä¾‹ä»ä¸€å°æœåŠ¡è¿ç§»åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨è€Œå·²ï¼ˆè€Œä¸ç”¨è€ƒè™‘é‡æ–°åˆ†åŒºçš„é—®é¢˜ï¼‰ã€‚ä¸€æ—¦ä½ æ·»åŠ äº†å¦ä¸€å°æœåŠ¡å™¨ï¼Œä½ éœ€è¦å°†ä½ ä¸€åŠçš„ Redis å®ä¾‹ä»ç¬¬ä¸€å°æœºå™¨è¿ç§»åˆ°ç¬¬äºŒå°æœºå™¨ã€‚ å’Œé£å“¥æ²Ÿé€šäº†ä¸‹ï¼Œè¿™ä¸ªæ“ä½œä¸æ˜¯å¾ˆåˆç†ã€‚ æ— è®ºæ€ä¹ˆè¯´ï¼Œå»ºè®®ï¼Œéœ€è¦æ­å»ºä¸‹ Redis Sentinel é«˜å¯ç”¨ï¼Œè‡³äºæ‹“å±•æ€§ï¼Œæ ¹æ®è‡ªå·±çš„æƒ…å†µï¼Œæ˜¯å¦ä½¿ç”¨ Redis Cluster é›†ç¾¤ Redis æœ‰å“ªäº›é‡è¦çš„å¥åº·æŒ‡æ ‡ï¼Ÿæ¨èé˜…è¯» ã€ŠRedis å‡ ä¸ªé‡è¦çš„å¥åº·æŒ‡æ ‡ã€‹ å­˜æ´»æƒ…å†µ è¿æ¥æ•° é˜»å¡å®¢æˆ·ç«¯æ•°é‡ ä½¿ç”¨å†…å­˜å³°å€¼ å†…å­˜ç¢ç‰‡ç‡ ç¼“å­˜å‘½ä¸­ç‡ OPS æŒä¹…åŒ– å¤±æ•ˆKEY æ…¢æ—¥å¿— å¦‚ä½•æé«˜ Redis å‘½ä¸­ç‡ï¼Ÿ æ¨èé˜…è¯» ã€Šå¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼ˆRedisï¼‰ã€‹ ã€‚ æ€ä¹ˆä¼˜åŒ– Redis çš„å†…å­˜å ç”¨æ¨èé˜…è¯» ã€ŠRedis çš„å†…å­˜ä¼˜åŒ–ã€‹ redisObject å¯¹è±¡ ç¼©å‡é”®å€¼å¯¹è±¡ å…±äº«å¯¹è±¡æ±  å­—ç¬¦ä¸²ä¼˜åŒ– ç¼–ç ä¼˜åŒ– æ§åˆ¶ key çš„æ•°é‡ ä¸€ä¸ª Redis å®ä¾‹æœ€å¤šèƒ½å­˜æ”¾å¤šå°‘çš„ keysï¼ŸListã€Setã€Sorted Set ä»–ä»¬æœ€å¤šèƒ½å­˜æ”¾å¤šå°‘å…ƒç´ ï¼Ÿ ä¸€ä¸ª Redis å®ä¾‹ï¼Œæœ€å¤šèƒ½å­˜æ”¾å¤šå°‘çš„ keys ï¼ŒListã€Setã€Sorted Set ä»–ä»¬æœ€å¤šèƒ½å­˜æ”¾å¤šå°‘å…ƒç´ ã€‚ ç†è®ºä¸Šï¼ŒRedis å¯ä»¥å¤„ç†å¤šè¾¾ 2^32 çš„ keys ï¼Œå¹¶ä¸”åœ¨å®é™…ä¸­è¿›è¡Œäº†æµ‹è¯•ï¼Œæ¯ä¸ªå®ä¾‹è‡³å°‘å­˜æ”¾äº† 2 äº¿ 5 åƒä¸‡çš„ keysã€‚ ä»»ä½• listã€setã€å’Œ sorted set éƒ½å¯ä»¥æ”¾ 2^32 ä¸ªå…ƒç´ ã€‚ å‡å¦‚ Redis é‡Œé¢æœ‰ 1 äº¿ä¸ª keyï¼Œå…¶ä¸­æœ‰ 10w ä¸ª key æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ ä½¿ç”¨ keys æŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ã€‚ å¯¹æ–¹æ¥ç€è¿½é—®ï¼šå¦‚æœè¿™ä¸ª Redis æ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨keysæŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ è¿™ä¸ªæ—¶å€™ä½ è¦å›ç­” Redis å…³é”®çš„ä¸€ä¸ªç‰¹æ€§ï¼šRedis çš„å•çº¿ç¨‹çš„ã€‚keys æŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ scan æŒ‡ä»¤ï¼Œscan æŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨ keys æŒ‡ä»¤é•¿ã€‚ Redis å¸¸è§çš„æ€§èƒ½é—®é¢˜éƒ½æœ‰å“ªäº›ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ1ã€Master æœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼Œå¦‚ RDB å†…å­˜å¿«ç…§å’Œ AOF æ—¥å¿—æ–‡ä»¶ã€‚ Master å†™å†…å­˜å¿«ç…§ï¼Œsave å‘½ä»¤è°ƒåº¦ rdbSave å‡½æ•°ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œå½“å¿«ç…§æ¯”è¾ƒå¤§æ—¶å¯¹æ€§èƒ½å½±å“æ˜¯éå¸¸å¤§çš„ï¼Œä¼šé—´æ–­æ€§æš‚åœæœåŠ¡ï¼Œæ‰€ä»¥ Master æœ€å¥½ä¸è¦å†™å†…å­˜å¿«ç…§ã€‚ Master AOF æŒä¹…åŒ–ï¼Œå¦‚æœä¸é‡å†™ AOF æ–‡ä»¶ï¼Œè¿™ä¸ªæŒä¹…åŒ–æ–¹å¼å¯¹æ€§èƒ½çš„å½±å“æ˜¯æœ€å°çš„ï¼Œä½†æ˜¯ AOF æ–‡ä»¶ä¼šä¸æ–­å¢å¤§ï¼ŒAOF æ–‡ä»¶è¿‡å¤§ä¼šå½±å“ Master é‡å¯çš„æ¢å¤é€Ÿåº¦ã€‚ æ‰€ä»¥ï¼ŒMaster æœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å†…å­˜å¿«ç…§å’Œ AOF æ—¥å¿—æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸è¦å¯ç”¨å†…å­˜å¿«ç…§åšæŒä¹…åŒ–ã€‚å¦‚æœæ•°æ®æ¯”è¾ƒå…³é”®ï¼ŒæŸä¸ª Slave å¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ 2ã€Master è°ƒç”¨ BGREWRITEAOF é‡å†™ AOF æ–‡ä»¶ï¼ŒAOF åœ¨é‡å†™çš„æ—¶å€™ä¼šå å¤§é‡çš„ CPU å’Œå†…å­˜èµ„æºï¼Œå¯¼è‡´æœåŠ¡ load è¿‡é«˜ï¼Œå‡ºç°çŸ­æš‚æœåŠ¡æš‚åœç°è±¡ã€‚ 3ã€å°½é‡é¿å…åœ¨å‹åŠ›å¾ˆå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“ã€‚ 4ã€ä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ä¸ºç¨³å®šï¼Œå³ï¼šMaster &lt;- Slave1 &lt;- Slave2 &lt;- Slave3... ã€‚ è¿™æ ·çš„ç»“æ„ï¼Œä¹Ÿæ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç° Slave å¯¹ Master çš„æ›¿æ¢ã€‚å¦‚æœ MasteræŒ‚äº†ï¼Œå¯ä»¥ç«‹åˆ»å¯ç”¨ Slave1 åš Master ï¼Œå…¶ä»–ä¸å˜ã€‚ 5ã€Redis ä¸»ä»å¤åˆ¶çš„æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒSlave å’Œ Master æœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚ å’Œé£å“¥æ²Ÿé€šè¿‡åï¼Œä»–ä»¬ä¸»èŠ‚ç‚¹å¼€å¯ AOF ï¼Œä»èŠ‚ç‚¹å¼€å¯ AOF + RDB ã€‚ å’Œæ™“å³°æ²Ÿé€šåï¼Œä»–ä»¬ä¸»èŠ‚ç‚¹å¼€å¯ AOF ï¼Œä»èŠ‚ç‚¹å¼€å¯ RDB å±…å¤šï¼Œä¹Ÿæœ‰å¼€å¯ AOF + RDB çš„ã€‚ ä¿®æ”¹é…ç½®ä¸é‡å¯ Redis ä¼šå®æ—¶ç”Ÿæ•ˆå—ï¼Ÿé’ˆå¯¹è¿è¡Œå®ä¾‹ï¼Œæœ‰è®¸å¤šé…ç½®é€‰é¡¹å¯ä»¥é€šè¿‡ CONFIG SET å‘½ä»¤è¿›è¡Œä¿®æ”¹ï¼Œè€Œæ— éœ€æ‰§è¡Œä»»ä½•å½¢å¼çš„é‡å¯ã€‚ ä» Redis 2.2 å¼€å§‹ï¼Œå¯ä»¥ä» AOF åˆ‡æ¢åˆ° RDB çš„å¿«ç…§æŒä¹…æ€§æˆ–å…¶ä»–æ–¹å¼è€Œä¸éœ€è¦é‡å¯ Redisã€‚æ£€ç´¢ CONFIG GET * å‘½ä»¤è·å–æ›´å¤šä¿¡æ¯ã€‚ ä½†å¶å°”é‡æ–°å¯åŠ¨æ˜¯å¿…é¡»çš„ï¼Œå¦‚ä¸ºå‡çº§ Redis ç¨‹åºåˆ°æ–°çš„ç‰ˆæœ¬ï¼Œæˆ–è€…å½“ä½ éœ€è¦ä¿®æ”¹æŸäº›ç›®å‰ CONFIG å‘½ä»¤è¿˜ä¸æ”¯æŒçš„é…ç½®å‚æ•°çš„æ—¶å€™ã€‚ å…¶ä»–é—®é¢˜æœ‰äº›æ¯”è¾ƒå‡¶æ®‹çš„é¢è¯•å®˜ï¼Œå¯èƒ½ä¼šé—®æˆ‘ä»¬ä¸€äº› Redis æ•°æ®ç»“æ„çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š Skiplist æ’å…¥å’ŒæŸ¥è¯¢åŸç†ï¼Ÿ å‹ç¼©åˆ—è¡¨çš„åŸç†ï¼Ÿ Redis åº•å±‚ä¸ºä»€ä¹ˆä½¿ç”¨è·³è·ƒè¡¨è€Œä¸æ˜¯çº¢é»‘æ ‘ï¼Ÿ è·³è·ƒè¡¨åœ¨èŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™æ€§èƒ½æ¯”è¾ƒé«˜ã€‚ å‚è€ƒé“¾æ¥ ç²¾å°½ Redis é¢è¯•é¢˜]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaåç«¯æ ¸å¿ƒçŸ¥è¯†]]></title>
    <url>%2F2019%2F02%2F23%2FJava%E5%90%8E%E7%AB%AF%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%2F</url>
    <content type="text"><![CDATA[ç®—æ³•å‰‘æŒ‡ Offer é¢˜è§£Leetcode é¢˜è§£ç®—æ³•æ“ä½œç³»ç»Ÿè®¡ç®—æœºæ“ä½œç³»ç»ŸLinuxç½‘ç»œè®¡ç®—æœºç½‘ç»œHTTP Brief History of HTTP Socketé¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼é¢å‘å¯¹è±¡æ€æƒ³æ•°æ®åº“æ•°æ®åº“ç³»ç»ŸåŸç†SQLLeetcode-Database é¢˜è§£MySQL MySQLæ•°æ®ç±»å‹åŠåé¢å°æ‹¬å·çš„æ„ä¹‰ RedisJavaJava åŸºç¡€ èŠèŠå¼•ç”¨å’ŒThreadlocalçš„é‚£äº›äº‹ Java å®¹å™¨Java å¹¶å‘ Javaå¹¶å‘ç¼–ç¨‹ï¼švolatileå…³é”®å­—è§£æ å¤§ç™½è¯èŠèŠJavaå¹¶å‘é¢è¯•é—®é¢˜ä¹‹volatileåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ å¤§ç™½è¯èŠèŠJavaå¹¶å‘é¢è¯•é—®é¢˜ä¹‹Java 8å¦‚ä½•ä¼˜åŒ–CASæ€§èƒ½ï¼Ÿ å¤§ç™½è¯èŠèŠJavaå¹¶å‘é¢è¯•é—®é¢˜ä¹‹è°ˆè°ˆä½ å¯¹AQSçš„ç†è§£ï¼Ÿ å¤§ç™½è¯èŠèŠJavaå¹¶å‘é¢è¯•é—®é¢˜ä¹‹å…¬å¹³é”ä¸éå…¬å¹³é”æ˜¯å•¥ï¼Ÿ å¤§ç™½è¯èŠèŠJavaå¹¶å‘é¢è¯•é—®é¢˜ä¹‹å¾®æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„è¯»å†™é”ä¼˜åŒ– Java è™šæ‹Ÿæœº JVMä¸­çš„æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼ˆEdenç©ºé—´ã€ä¸¤ä¸ªSurviorç©ºé—´ï¼‰ Javaå¯¹è±¡ç»“æ„ä¸é”å®ç°åŸç†åŠMarkWordè¯¦è§£ Java I/O NIO å…¥é—¨ æ¡†æ¶Spring Springäº‹åŠ¡ä¼ æ’­è¡Œä¸ºè¯¦è§£ ä¸­é—´ä»¶Netty Itâ€™s all about buffers: zero-copy, mmap and Java NIO Efficient data transfer through zero copy Scalable IO in Java Netty é‚£äº›äº‹å„¿ â€”â€”â€” Reactoræ¨¡å¼è¯¦è§£ ç³»ç»Ÿè®¾è®¡ç³»ç»Ÿè®¾è®¡åŸºç¡€åˆ†å¸ƒå¼é›†ç¾¤æ”»å‡»æŠ€æœ¯ç¼“å­˜æ¶ˆæ¯é˜Ÿåˆ—å·¥å…·GitDockeræ„å»ºå·¥å…·æ­£åˆ™è¡¨è¾¾å¼]]></content>
      <categories>
        <category>çŸ¥è¯†å›¾è°±</category>
      </categories>
      <tags>
        <tag>åšå®¢</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“]]></title>
    <url>%2F2019%2F02%2F22%2F%E6%95%B0%E6%8D%AE%E5%BA%93%2F</url>
    <content type="text"><![CDATA[æ•°æ®åº“æ¶æ„æ•°æ®åº“æ¶æ„å¯ä»¥åˆ†ä¸ºå­˜å‚¨æ–‡ä»¶ç³»ç»Ÿå’Œç¨‹åºå®ä¾‹ä¸¤å¤§å—ï¼Œè€Œç¨‹åºå®ä¾‹æ ¹æ®ä¸åŒçš„åŠŸèƒ½åˆå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å°æ¨¡å—ã€‚ ç´¢å¼•æ¨¡å—å¸¸è§çš„é—®é¢˜æœ‰ï¼š ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç´¢å¼• ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½æˆä¸ºç´¢å¼• ç´¢å¼•çš„æ•°æ®ç»“æ„ å¯†é›†ç´¢å¼•å’Œç¨€ç–ç´¢å¼•çš„åŒºåˆ« ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç´¢å¼•ä½¿ç”¨ç´¢å¼•å°±åƒæŸ¥å­—å…¸ä¸€æ ·ï¼Œå¯ä»¥å¿«é€ŸæŸ¥è¯¢æ•°æ® ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½æˆä¸ºç´¢å¼•ä¸»é”®ã€å”¯ä¸€é”®ä»¥åŠæ™®é€šé”®ç­‰ ç´¢å¼•çš„æ•°æ®ç»“æ„ ç”Ÿæˆç´¢å¼•ï¼Œå»ºç«‹äºŒå‰æŸ¥æ‰¾æ ‘è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ ç”Ÿæˆç´¢å¼•ï¼Œå»ºç«‹ B Tree ç»“æ„ç»“æ„è¿›è¡ŒæŸ¥æ‰¾ ç”Ÿæˆç´¢å¼•ï¼Œå»ºç«‹ B+ Tree ç»“æ„è¿›è¡ŒæŸ¥æ‰¾ ç”Ÿæˆç´¢å¼•ï¼Œå»ºç«‹ Hash ç»“æ„è¿›è¡ŒæŸ¥æ‰¾ ä»€ä¹ˆæ˜¯ B Tree ç´¢å¼•ï¼ŸB-Tree æ˜¯ä¸ºç£ç›˜ç­‰å¤–å­˜å‚¨è®¾å¤‡è®¾è®¡çš„ä¸€ç§å¹³è¡¡æŸ¥æ‰¾æ ‘ã€‚å› æ­¤åœ¨è®² B-Tree ä¹‹å‰å…ˆäº†è§£ä¸‹ç£ç›˜çš„ç›¸å…³çŸ¥è¯†ã€‚ ç³»ç»Ÿä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…å­˜æ—¶æ˜¯ä»¥ç£ç›˜å—ï¼ˆblockï¼‰ä¸ºåŸºæœ¬å•ä½çš„ï¼Œä½äºåŒä¸€ä¸ªç£ç›˜å—ä¸­çš„æ•°æ®ä¼šè¢«ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼Œè€Œä¸æ˜¯éœ€è¦ä»€ä¹ˆå–ä»€ä¹ˆã€‚ InnoDBå­˜å‚¨å¼•æ“ä¸­æœ‰é¡µï¼ˆPageï¼‰çš„æ¦‚å¿µï¼Œé¡µæ˜¯å…¶ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ã€‚InnoDB å­˜å‚¨å¼•æ“ä¸­é»˜è®¤æ¯ä¸ªé¡µçš„å¤§å°ä¸º 16 KBï¼Œå¯é€šè¿‡å‚æ•° innodb_page_size å°†é¡µçš„å¤§å°è®¾ç½®ä¸º 4Kã€8Kã€16K ï¼Œåœ¨ MySQL ä¸­å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é¡µçš„å¤§å°ï¼š 1mysql&gt; show variables like 'innodb_page_size'; è€Œç³»ç»Ÿä¸€ä¸ªç£ç›˜å—çš„å­˜å‚¨ç©ºé—´å¾€å¾€æ²¡æœ‰è¿™ä¹ˆå¤§ï¼Œå› æ­¤ InnoDB æ¯æ¬¡ç”³è¯·ç£ç›˜ç©ºé—´æ—¶éƒ½ä¼šæ˜¯è‹¥å¹²åœ°å€è¿ç»­ç£ç›˜å—æ¥è¾¾åˆ°é¡µçš„å¤§å° 16KB ã€‚InnoDB åœ¨æŠŠç£ç›˜æ•°æ®è¯»å…¥åˆ°ç£ç›˜æ—¶ä¼šä»¥é¡µä¸ºåŸºæœ¬å•ä½ï¼Œåœ¨æŸ¥è¯¢æ•°æ®æ—¶å¦‚æœä¸€ä¸ªé¡µä¸­çš„æ¯æ¡æ•°æ®éƒ½èƒ½æœ‰åŠ©äºå®šä½æ•°æ®è®°å½•çš„ä½ç½®ï¼Œè¿™å°†ä¼šå‡å°‘ç£ç›˜ I/O æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ B-Tree ç»“æ„çš„æ•°æ®å¯ä»¥è®©ç³»ç»Ÿé«˜æ•ˆçš„æ‰¾åˆ°æ•°æ®æ‰€åœ¨çš„ç£ç›˜å—ã€‚ä¸ºäº†æè¿°B-Treeï¼Œé¦–å…ˆå®šä¹‰ä¸€æ¡è®°å½•ä¸ºä¸€ä¸ªäºŒå…ƒç»„ [key, data] ï¼Œkey ä¸ºè®°å½•çš„é”®å€¼ï¼Œå¯¹åº”è¡¨ä¸­çš„ä¸»é”®å€¼ï¼Œdata ä¸ºä¸€è¡Œè®°å½•ä¸­é™¤ä¸»é”®å¤–çš„æ•°æ®ã€‚å¯¹äºä¸åŒçš„è®°å½•ï¼Œkeyå€¼äº’ä¸ç›¸åŒã€‚ ä¸€æ£µ m é˜¶çš„ B-Tree æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ m ä¸ªå­©å­ é™¤äº†æ ¹èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹å¤–ï¼Œå…¶å®ƒæ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰ Ceil(m/2) ä¸ªå­©å­ è‹¥æ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™è‡³å°‘æœ‰ 2 ä¸ªå­©å­ æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ï¼Œä¸”ä¸åŒ…å«å…¶å®ƒå…³é”®å­—ä¿¡æ¯ æ¯ä¸ªéå¶å­èŠ‚ç‚¹åŒ…å« n ä¸ªå…³é”®å­—ä¿¡æ¯ï¼ˆP0,P1,â€¦Pn, k1,â€¦knï¼‰ å…³é”®å­—çš„ä¸ªæ•° n æ»¡è¶³ï¼šceil(m/2)-1 &lt;= n &lt;= m-1 ki(i=1,â€¦n) ä¸ºå…³é”®å­—ï¼Œä¸”å…³é”®å­—å‡åºæ’åº Pi(i=0,â€¦n) ä¸ºæŒ‡å‘å­æ ‘æ ¹èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚P(i-1) æŒ‡å‘çš„å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹å…³é”®å­—å‡å°äº ki ï¼Œä½†éƒ½å¤§äº k(i-1) B-Tree ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ ¹æ®å®é™…æƒ…å†µå¯ä»¥åŒ…å«å¤§é‡çš„å…³é”®å­—ä¿¡æ¯å’Œåˆ†æ”¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºä¸€ä¸ª 3 é˜¶çš„ B-Treeï¼š æ¯ä¸ªèŠ‚ç‚¹å ç”¨ä¸€ä¸ªç›˜å—çš„ç£ç›˜ç©ºé—´ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸¤ä¸ªå‡åºæ’åºçš„ key å’Œä¸‰ä¸ªæŒ‡å‘å­æ ‘æ ¹èŠ‚ç‚¹çš„ point ï¼Œpoint å­˜å‚¨çš„æ˜¯å­èŠ‚ç‚¹æ‰€åœ¨ç£ç›˜å—çš„åœ°å€ã€‚ä¸¤ä¸ª key åˆ’åˆ†æˆçš„ä¸‰ä¸ªèŒƒå›´åŸŸï¼Œå¯¹åº”ä¸‰ä¸ª point æŒ‡å‘çš„å­æ ‘çš„æ•°æ®çš„èŒƒå›´åŸŸã€‚ ä»¥æ ¹èŠ‚ç‚¹ä¸ºä¾‹ï¼Œkey ä¸º 17 å’Œ 35 ï¼ŒP1 æŒ‡é’ˆæŒ‡å‘çš„å­æ ‘çš„æ•°æ®èŒƒå›´ä¸ºå°äº 17 ï¼ŒP2 æŒ‡é’ˆæŒ‡å‘çš„å­æ ‘çš„æ•°æ®èŒƒå›´ä¸º [17~35] ï¼ŒP3 æŒ‡é’ˆæŒ‡å‘çš„å­æ ‘çš„æ•°æ®èŒƒå›´ä¸ºå¤§äº 35 ã€‚ æ¨¡æ‹ŸæŸ¥æ‰¾ key ä¸º 29 çš„è¿‡ç¨‹ï¼š 1ã€æ ¹æ®æ ¹èŠ‚ç‚¹æ‰¾åˆ°ç£ç›˜å— 1 ï¼Œè¯»å…¥å†…å­˜ã€‚ã€ç£ç›˜I/Oæ“ä½œç¬¬1æ¬¡ã€‘ 2ã€æ¯”è¾ƒ key 29 åœ¨åŒºé—´ï¼ˆ17,35ï¼‰ï¼Œæ‰¾åˆ°ç£ç›˜å— 1 çš„æŒ‡é’ˆ P2 ã€‚ 3ã€æ ¹æ® P2 æŒ‡é’ˆæ‰¾åˆ°ç£ç›˜å— 3 ï¼Œè¯»å…¥å†…å­˜ã€‚ã€ç£ç›˜I/Oæ“ä½œç¬¬2æ¬¡ã€‘ 4ã€æ¯”è¾ƒ key 29 åœ¨åŒºé—´ï¼ˆ26,30ï¼‰ï¼Œæ‰¾åˆ°ç£ç›˜å—3çš„æŒ‡é’ˆP2ã€‚ 5ã€æ ¹æ® P2 æŒ‡é’ˆæ‰¾åˆ°ç£ç›˜å— 8 ï¼Œè¯»å…¥å†…å­˜ã€‚ã€ç£ç›˜I/Oæ“ä½œç¬¬3æ¬¡ã€‘ 6ã€åœ¨ç£ç›˜å— 8 ä¸­çš„ key åˆ—è¡¨ä¸­æ‰¾åˆ° eky 29 ã€‚ åˆ†æä¸Šé¢è¿‡ç¨‹ï¼Œå‘ç°éœ€è¦ 3 æ¬¡ç£ç›˜ I/O æ“ä½œï¼Œå’Œ 3 æ¬¡å†…å­˜æŸ¥æ‰¾æ“ä½œã€‚ç”±äºå†…å­˜ä¸­çš„ key æ˜¯ä¸€ä¸ªæœ‰åºè¡¨ç»“æ„ï¼Œå¯ä»¥åˆ©ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾æé«˜æ•ˆç‡ã€‚è€Œ 3 æ¬¡ç£ç›˜ I/O æ“ä½œæ˜¯å½±å“æ•´ä¸ª B-Tree æŸ¥æ‰¾æ•ˆç‡çš„å†³å®šå› ç´ ã€‚B-Tree ç›¸å¯¹äº AVLTree ç¼©å‡äº†èŠ‚ç‚¹ä¸ªæ•°ï¼Œä½¿æ¯æ¬¡ç£ç›˜ I/O å–åˆ°å†…å­˜çš„æ•°æ®éƒ½å‘æŒ¥äº†ä½œç”¨ï¼Œä»è€Œæé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚ ä»€ä¹ˆæ˜¯ B+Tree ç´¢å¼•ï¼ŸB+Tree æ˜¯åœ¨ B-Tree åŸºç¡€ä¸Šçš„ä¸€ç§ä¼˜åŒ–ï¼Œä½¿å…¶æ›´é€‚åˆå®ç°å¤–å­˜å‚¨ç´¢å¼•ç»“æ„ï¼ŒInnoDBå­˜å‚¨å¼•æ“å°±æ˜¯ç”¨ B+Tree å®ç°å…¶ç´¢å¼•ç»“æ„ã€‚ ä»ä¸Šä¸€èŠ‚ä¸­çš„ B-Tree ç»“æ„å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸­ä¸ä»…åŒ…å«æ•°æ®çš„ key å€¼ï¼Œè¿˜æœ‰ data å€¼ã€‚è€Œæ¯ä¸€ä¸ªé¡µçš„å­˜å‚¨ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¦‚æœ data æ•°æ®è¾ƒå¤§æ—¶å°†ä¼šå¯¼è‡´æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå³ä¸€ä¸ªé¡µï¼‰èƒ½å­˜å‚¨çš„ key çš„æ•°é‡å¾ˆå°ï¼Œå½“å­˜å‚¨çš„æ•°æ®é‡å¾ˆå¤§æ—¶åŒæ ·ä¼šå¯¼è‡´ B-Tree çš„æ·±åº¦è¾ƒå¤§ï¼Œå¢å¤§æŸ¥è¯¢æ—¶çš„ç£ç›˜ I/O æ¬¡æ•°ï¼Œè¿›è€Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚åœ¨ B+Tree ä¸­ï¼Œæ‰€æœ‰æ•°æ®è®°å½•èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç…§é”®å€¼å¤§å°é¡ºåºå­˜æ”¾åœ¨åŒä¸€å±‚çš„å¶å­èŠ‚ç‚¹ä¸Šï¼Œè€Œéå¶å­èŠ‚ç‚¹ä¸Šåªå­˜å‚¨ key å€¼ä¿¡æ¯ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§åŠ å¤§æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„ key å€¼æ•°é‡ï¼Œé™ä½ B+Tree çš„é«˜åº¦ã€‚ B+Tree ç›¸å¯¹äº B-Tree æœ‰å‡ ç‚¹ä¸åŒï¼š éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ä¿¡æ¯ã€‚ æ‰€æœ‰å¶å­èŠ‚ç‚¹ä¹‹é—´éƒ½æœ‰ä¸€ä¸ªé“¾æŒ‡é’ˆã€‚ æ•°æ®è®°å½•éƒ½å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚ B+ Tree æ›´é€‚åˆç”¨æ¥åšå­˜å‚¨ç´¢å¼•ï¼š B+ æ•°çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ B+ æ•°çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š B+ æ•°æ›´æœ‰åˆ©äºå¯¹æ•°æ®åº“çš„æ‰«æï¼ˆèŒƒå›´æŸ¥è¯¢ï¼‰ å°†ä¸Šä¸€èŠ‚ä¸­çš„ B-Tree ä¼˜åŒ–ï¼Œç”±äº B+Tree çš„éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ä¿¡æ¯ï¼Œå‡è®¾æ¯ä¸ªç£ç›˜å—èƒ½å­˜å‚¨ 4 ä¸ªé”®å€¼åŠæŒ‡é’ˆä¿¡æ¯ï¼Œåˆ™å˜æˆ B+Tree åå…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç£ç›˜å—4ä¸­çš„10æ•°æ®ï¼Œç”»é”™äº†ï¼ŒèŒƒå›´åœ¨[K[i], K[i+1])ï¼Œå·¦é—­å³å¼€ é€šå¸¸åœ¨ B+Tree ä¸Šæœ‰ä¸¤ä¸ªå¤´æŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘æ ¹èŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªæŒ‡å‘å…³é”®å­—æœ€å°çš„å¶å­èŠ‚ç‚¹ï¼Œè€Œä¸”æ‰€æœ‰å¶å­èŠ‚ç‚¹ï¼ˆå³æ•°æ®èŠ‚ç‚¹ï¼‰ä¹‹é—´æ˜¯ä¸€ç§é“¾å¼ç¯ç»“æ„ã€‚å› æ­¤å¯ä»¥å¯¹ B+Tree è¿›è¡Œä¸¤ç§æŸ¥æ‰¾è¿ç®—ï¼šä¸€ç§æ˜¯å¯¹äºä¸»é”®çš„èŒƒå›´æŸ¥æ‰¾å’Œåˆ†é¡µæŸ¥æ‰¾ï¼Œå¦ä¸€ç§æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œè¿›è¡ŒéšæœºæŸ¥æ‰¾ã€‚ å¯èƒ½ä¸Šé¢ä¾‹å­ä¸­åªæœ‰ 22 æ¡æ•°æ®è®°å½•ï¼Œçœ‹ä¸å‡º B+Tree çš„ä¼˜ç‚¹ï¼Œä¸‹é¢åšä¸€ä¸ªæ¨ç®—ï¼š InnoDB å­˜å‚¨å¼•æ“ä¸­é¡µçš„å¤§å°ä¸º 16KBï¼Œä¸€èˆ¬è¡¨çš„ä¸»é”®ç±»å‹ä¸º INTï¼ˆå ç”¨4ä¸ªå­—èŠ‚ï¼‰ æˆ– BIGINTï¼ˆå ç”¨8ä¸ªå­—èŠ‚ï¼‰ï¼ŒæŒ‡é’ˆç±»å‹ä¹Ÿä¸€èˆ¬ä¸º 4 æˆ– 8 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¡µï¼ˆB+Tree ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ä¸­å¤§æ¦‚å­˜å‚¨ 16KB/(8B+8B)=1K ä¸ªé”®å€¼ï¼ˆå› ä¸ºæ˜¯ä¼°å€¼ï¼Œä¸ºæ–¹ä¾¿è®¡ç®—ï¼Œè¿™é‡Œçš„ K å–å€¼ä¸ºã€–10ã€—^3ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ·±åº¦ä¸º 3 çš„ B+Tree ç´¢å¼•å¯ä»¥ç»´æŠ¤10^3 10^3 10^3 = 10äº¿ æ¡è®°å½•ã€‚ å®é™…æƒ…å†µä¸­æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½ä¸èƒ½å¡«å……æ»¡ï¼Œå› æ­¤åœ¨æ•°æ®åº“ä¸­ï¼ŒB+Tree çš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨ 2~4 å±‚ã€‚MySQL çš„ InnoDB å­˜å‚¨å¼•æ“åœ¨è®¾è®¡æ—¶æ˜¯å°†æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾æŸä¸€é”®å€¼çš„è¡Œè®°å½•æ—¶æœ€å¤šåªéœ€è¦ 1~3 æ¬¡ç£ç›˜ I/O æ“ä½œã€‚ ä»€ä¹ˆæ˜¯ hash ç´¢å¼•ï¼ŸåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œä¼˜ç‚¹æ˜¯æŸ¥æ‰¾éå¸¸å¿«ã€‚å¦‚ä¸‹å›¾ ï¼š å“ˆå¸Œç´¢å¼•å°±æ˜¯é‡‡ç”¨ä¸€å®šçš„å“ˆå¸Œç®—æ³•ï¼Œå°†é”®å€¼æ¢ç®—æˆæ–°çš„å“ˆå¸Œå€¼ï¼Œæ£€ç´¢æ—¶ä¸éœ€è¦æƒ³B+Treeé‚£æ ·ä»æ ¹ç»“ç‚¹å¼€å§‹æŸ¥æ‰¾ï¼Œè€Œæ˜¯ç»è¿‡è®¡ç®—ç›´æ¥å®šä½ï¼Œæ‰€ä»¥é€Ÿåº¦å¾ˆå¿«ã€‚ ä½†æ˜¯ä¹Ÿæœ‰é™åˆ¶ï¼š åªæ”¯æŒç²¾ç¡®æŸ¥æ‰¾ï¼Œä¸èƒ½ç”¨äºéƒ¨åˆ†æŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾ã€‚æ— æ³•æ’åºå’Œåˆ†ç»„ã€‚å› ä¸ºåŸæ¥æœ‰åºçš„é”®å€¼ç»è¿‡å“ˆå¸Œç®—æ³•å¾ˆå¯èƒ½æ‰“ä¹±ã€‚ å¦‚æœå“ˆå¸Œå†²çªå¾ˆå¤šï¼ŒæŸ¥æ‰¾é€Ÿåº¦å¾ˆæ…¢ã€‚æ¯”å¦‚åœ¨æœ‰å¤§é‡é‡å¤é”®å€¼çš„æƒ…å†µä¸‹ã€‚ ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•æŸ¥è¯¢ ä¸èƒ½ èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼• MyISAM ç´¢å¼•ä¸ InnoDB ç´¢å¼•çš„åŒºåˆ«ï¼Ÿ InnoDB ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼ŒMyISAM ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ã€‚ InnoDB çš„ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç€è¡Œæ•°æ®ï¼Œå› æ­¤ä¸»é”®ç´¢å¼•éå¸¸é«˜æ•ˆã€‚ MyISAM ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯è¡Œæ•°æ®åœ°å€ï¼Œéœ€è¦å†å¯»å€ä¸€æ¬¡æ‰èƒ½å¾—åˆ°æ•°æ®ã€‚ InnoDB éä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å’Œå…¶ä»–å¸¦ç´¢å¼•çš„åˆ—æ•°æ®ï¼Œå› æ­¤æŸ¥è¯¢æ—¶åšåˆ°è¦†ç›–ç´¢å¼•ä¼šéå¸¸é«˜æ•ˆ å¦‚ä½•å®šä½å¹¶ä¼˜åŒ–æ…¢æŸ¥è¯¢çš„ Sqléœ€è¦å…·ä½“åœºæ™¯å…·ä½“åˆ†æï¼Œå…¶å¤§è‡´æ€è·¯ æ ¹æ®æ…¢æ—¥å¿—å®šä½åˆ°æ…¢æŸ¥è¯¢çš„ sql ä½¿ç”¨ explain ç­‰å·¥å…·åˆ†æ sql ä¿®æ”¹ sql æˆ–è€…å°½é‡è®© sql èµ°ç´¢å¼• å®šä½æ…¢æŸ¥è¯¢sqlå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å³å¯ æ–‡ä»¶æ–¹å¼é…ç½® MySQL æ…¢æŸ¥è¯¢çš„æ–¹æ³•ï¼š æŸ¥è¯¢ MySQL æ…¢æŸ¥è¯¢çŠ¶æ€çš„æ–¹æ³•ï¼š 1SHOW VARIABLES LIKE '%query%'; åœ¨ mysql é…ç½®æ–‡ä»¶ my.cnf ä¸­å¢åŠ ï¼š 123log-slow-queries=/opt/data/slowquery.loglong_query_time=2 log-queries-not-using-indexes å‘½ä»¤æ–¹å¼é…ç½® MySQL æ…¢æŸ¥è¯¢çš„æ–¹æ³•ï¼š 123set global slow_query_log=on; set global long_query_time=1; set global slow_query_log_file=â€˜/opt/data/slow_query.logâ€™; è§£æ MySQL æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ–¹æ³•ï¼ŒæŒ‰ç…§ sql æ‰§è¡Œæ—¶é—´æœ€é•¿çš„å‰ 20 æ¡ sqlï¼š 1mysqldumpslow -s t -t 20 -g &apos;select&apos; /opt/data/slowquery.log åœ¨ log ä¸­å°±èƒ½æ‰¾åˆ°æ…¢æŸ¥è¯¢çš„ sqlã€‚ Explian å…³é”®å­— Explainå‘½ä»¤åœ¨è§£å†³æ•°æ®åº“æ€§èƒ½ä¸Šæ˜¯ç¬¬ä¸€æ¨èä½¿ç”¨å‘½ä»¤ï¼Œå¤§éƒ¨åˆ†çš„æ€§èƒ½é—®é¢˜å¯ä»¥é€šè¿‡æ­¤å‘½ä»¤æ¥ç®€å•çš„è§£å†³ï¼ŒExplainå¯ä»¥ç”¨æ¥æŸ¥çœ‹SQLè¯­å¥çš„æ‰§è¡Œæ•ˆ æœï¼Œå¯ä»¥å¸®åŠ©é€‰æ‹©æ›´å¥½çš„ç´¢å¼•å’Œä¼˜åŒ–æŸ¥è¯¢è¯­å¥ï¼Œå†™å‡ºæ›´å¥½çš„ä¼˜åŒ–è¯­å¥ã€‚ Explainè¯­æ³•ï¼šexplain select â€¦ from â€¦ [where â€¦] ä¾‹å¦‚ï¼šexplain select * from news; è¾“å‡ºï¼š 123+----+-------------+-------+-------+-------------------+---------+---------+-------+------| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-------+-------+-------------------+---------+---------+-------+------ ä¸‹é¢å¯¹å„ä¸ªå±æ€§è¿›è¡Œäº†è§£ï¼š 1ã€idï¼šè¿™æ˜¯SELECTçš„æŸ¥è¯¢åºåˆ—å· 2ã€select_typeï¼šselect_typeå°±æ˜¯selectçš„ç±»å‹ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§ï¼š SIMPLEï¼šç®€å•SELECT(ä¸ä½¿ç”¨UNIONæˆ–å­æŸ¥è¯¢ç­‰) PRIMARYï¼šæœ€å¤–é¢çš„SELECT UNIONï¼šUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„SELECTè¯­å¥ DEPENDENT UNIONï¼šUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„SELECTè¯­å¥ï¼Œå–å†³äºå¤–é¢çš„æŸ¥è¯¢ UNION RESULTï¼šUNIONçš„ç»“æœã€‚ SUBQUERYï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªSELECT DEPENDENT SUBQUERYï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªSELECTï¼Œå–å†³äºå¤–é¢çš„æŸ¥è¯¢ DERIVEDï¼šå¯¼å‡ºè¡¨çš„SELECT(FROMå­å¥çš„å­æŸ¥è¯¢) 3ã€tableï¼šæ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„ 4ã€typeï¼šè¿™åˆ—æœ€é‡è¦ï¼Œæ˜¾ç¤ºäº†è¿æ¥ä½¿ç”¨äº†å“ªç§ç±»åˆ«,æœ‰æ— ä½¿ç”¨ç´¢å¼•ï¼Œæ˜¯ä½¿ç”¨Explainå‘½ä»¤åˆ†ææ€§èƒ½ç“¶é¢ˆçš„å…³é”®é¡¹ä¹‹ä¸€ã€‚ ç»“æœå€¼ä»å¥½åˆ°åä¾æ¬¡æ˜¯ï¼š system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL ä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ°rangeçº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ°refï¼Œå¦åˆ™å°±å¯èƒ½ä¼šå‡ºç°æ€§èƒ½é—®é¢˜ã€‚ 5ã€possible_keysï¼šåˆ—æŒ‡å‡ºMySQLèƒ½ä½¿ç”¨å“ªä¸ªç´¢å¼•åœ¨è¯¥è¡¨ä¸­æ‰¾åˆ°è¡Œ 6ã€keyï¼šæ˜¾ç¤ºMySQLå®é™…å†³å®šä½¿ç”¨çš„é”®ï¼ˆç´¢å¼•ï¼‰ã€‚å¦‚æœæ²¡æœ‰é€‰æ‹©ç´¢å¼•ï¼Œé”®æ˜¯NULL 7ã€key_lenï¼šæ˜¾ç¤ºMySQLå†³å®šä½¿ç”¨çš„é”®é•¿åº¦ã€‚å¦‚æœé”®æ˜¯NULLï¼Œåˆ™é•¿åº¦ä¸ºNULLã€‚ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ 8ã€refï¼šæ˜¾ç¤ºä½¿ç”¨å“ªä¸ªåˆ—æˆ–å¸¸æ•°ä¸keyä¸€èµ·ä»è¡¨ä¸­é€‰æ‹©è¡Œã€‚ 9ã€rowsï¼šæ˜¾ç¤ºMySQLè®¤ä¸ºå®ƒæ‰§è¡ŒæŸ¥è¯¢æ—¶å¿…é¡»æ£€æŸ¥çš„è¡Œæ•°ã€‚ 10ã€Extraï¼šåŒ…å«MySQLè§£å†³æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¹Ÿæ˜¯å…³é”®å‚è€ƒé¡¹ä¹‹ä¸€ã€‚ Distinctä¸€æ—¦MYSQLæ‰¾åˆ°äº†ä¸è¡Œç›¸è”åˆåŒ¹é…çš„è¡Œï¼Œå°±ä¸å†æœç´¢äº† Not existsMYSQL ä¼˜åŒ–äº†LEFT JOINï¼Œä¸€æ—¦å®ƒæ‰¾åˆ°äº†åŒ¹é…LEFT JOINæ ‡å‡†çš„è¡Œï¼Œ å°±ä¸å†æœç´¢äº† Range checked for each Recordï¼ˆindex map:#ï¼‰æ²¡æœ‰æ‰¾åˆ°ç†æƒ³çš„ç´¢å¼•ï¼Œå› æ­¤å¯¹äºä»å‰é¢è¡¨ä¸­æ¥çš„æ¯ä¸€ ä¸ªè¡Œç»„åˆï¼ŒMYSQLæ£€æŸ¥ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Œå¹¶ç”¨å®ƒæ¥ä»è¡¨ä¸­è¿”å›è¡Œã€‚è¿™æ˜¯ä½¿ç”¨ç´¢å¼•çš„æœ€æ…¢çš„è¿æ¥ä¹‹ä¸€ Using filesortçœ‹ åˆ°è¿™ä¸ªçš„æ—¶å€™ï¼ŒæŸ¥è¯¢å°±éœ€è¦ä¼˜åŒ–äº†ã€‚MYSQLéœ€è¦è¿›è¡Œé¢å¤–çš„æ­¥éª¤æ¥å‘ç°å¦‚ä½•å¯¹è¿”å›çš„è¡Œæ’åºã€‚å®ƒæ ¹æ®è¿æ¥ç±»å‹ä»¥åŠå­˜å‚¨æ’åºé”®å€¼å’ŒåŒ¹é…æ¡ä»¶çš„å…¨éƒ¨è¡Œçš„è¡ŒæŒ‡é’ˆæ¥ æ’åºå…¨éƒ¨è¡Œ Using indexåˆ—æ•°æ®æ˜¯ä»ä»…ä»…ä½¿ç”¨äº†ç´¢å¼•ä¸­çš„ä¿¡æ¯è€Œæ²¡æœ‰è¯»å–å®é™…çš„è¡ŒåŠ¨çš„è¡¨è¿”å›çš„ï¼Œè¿™å‘ç”Ÿåœ¨å¯¹è¡¨ çš„å…¨éƒ¨çš„è¯·æ±‚åˆ—éƒ½æ˜¯åŒä¸€ä¸ªç´¢å¼•çš„éƒ¨åˆ†çš„æ—¶å€™ Using temporaryçœ‹åˆ°è¿™ä¸ªçš„æ—¶å€™ï¼ŒæŸ¥è¯¢éœ€è¦ä¼˜åŒ–äº†ã€‚è¿™ é‡Œï¼ŒMYSQLéœ€è¦åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨æ¥å­˜å‚¨ç»“æœï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨å¯¹ä¸åŒçš„åˆ—é›†è¿›è¡ŒORDER BYä¸Šï¼Œè€Œä¸æ˜¯GROUP BYä¸Š Using whereä½¿ç”¨äº†WHEREä»å¥æ¥é™åˆ¶å“ªäº›è¡Œå°†ä¸ä¸‹ä¸€å¼ è¡¨åŒ¹é…æˆ–è€…æ˜¯è¿”å›ç»™ç”¨æˆ·ã€‚å¦‚æœä¸æƒ³è¿”å›è¡¨ä¸­çš„å…¨éƒ¨è¡Œï¼Œå¹¶ä¸”è¿æ¥ç±»å‹ALLæˆ–indexï¼Œ è¿™å°±ä¼šå‘ç”Ÿï¼Œæˆ–è€…æ˜¯æŸ¥è¯¢æœ‰é—®é¢˜ å…¶ä»–ä¸€äº›Tipï¼š å½“type æ˜¾ç¤ºä¸º â€œindexâ€ æ—¶ï¼Œå¹¶ä¸”Extraæ˜¾ç¤ºä¸º â€œUsing Indexâ€ï¼Œ è¡¨æ˜ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ã€‚ è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™çš„æˆå› çœ‹çœ‹å¦‚ä¸‹åšå®¢å³å¯ è”åˆç´¢å¼•çš„æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ mysqlç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™çš„ç†è§£? ç´¢å¼•æ˜¯å»ºç«‹å¾—è¶Šå¤šè¶Šå¥½çš„å— æ•°æ®é‡å°çš„è¡¨ä¸éœ€è¦å»ºç«‹ç´¢å¼•ï¼Œå»ºç«‹ä¼šå¢åŠ é¢å¤–çš„ç´¢å¼•å¼€é”€ æ•°æ®å˜æ›´éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œå› æ­¤æ›´å¤šçš„ç´¢å¼•æ„å‘³ç€æ›´å¤šçš„ç»´æŠ¤æˆæœ¬ æ›´å¤šçš„ç´¢å¼•æ„å‘³ç€ä¹Ÿéœ€è¦æ›´å¤šçš„ç©ºé—´ é”æ¨¡å—å¸¸è§é—®é¢˜ MyISAM ä¸ InnoDB å…³äºé”æ–¹é¢çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ äº‹åŠ¡éš”ç¦»çº§åˆ«ä»¥åŠå„çº§åˆ«ä¸‹çš„å¹¶å‘è®¿é—®é—®é¢˜ InnoDB å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¦‚ä½•é¿å…å¹»è¯» RCã€RR çº§åˆ«ä¸‹çš„ InnoDB çš„éå µå¡å¦‚æœå®ç° MyISAM ä¸ InnoDB å…³äºé”æ–¹é¢çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ MyISAM é»˜è®¤ç”¨çš„æ˜¯è¡¨çº§é”ï¼Œä¸æ”¯æŒè¡Œçº§é” InnoDB é»˜è®¤ç”¨çš„æ˜¯è¡Œçº§é”ï¼Œä¹Ÿæ”¯æŒè¡¨çº§é” æ•°æ®åº“é”çš„åˆ†ç±» æŒ‰é”çš„ç²’åº¦åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºè¡¨çº§é”ã€è¡Œçº§é”å’Œé¡µçº§é” æŒ‰é”çš„çº§åˆ«åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºå…±äº«é”å’Œæ’ä»–é” æŒ‰åŠ é”çš„æ–¹å¼åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºè‡ªåŠ¨é”å’Œæ˜¾ç¤ºé” æŒ‰æ“ä½œåˆ’åˆ†ï¼Œå¯åˆ†ä¸º DML é”å’Œ DDL é” æŒ‰ä½¿ç”¨æ–¹å¼åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºä¹è§‚é”å’Œæ‚²è§‚é” ACID1. åŸå­æ€§ï¼ˆAtomicityï¼‰äº‹åŠ¡è¢«è§†ä¸ºä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒï¼Œäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚ å›æ»šå¯ä»¥ç”¨å›æ»šæ—¥å¿—æ¥å®ç°ï¼Œå›æ»šæ—¥å¿—è®°å½•ç€äº‹åŠ¡æ‰€æ‰§è¡Œçš„ä¿®æ”¹æ“ä½œï¼Œåœ¨å›æ»šæ—¶åå‘æ‰§è¡Œè¿™äº›ä¿®æ”¹æ“ä½œå³å¯ã€‚ 2. ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰æ•°æ®åº“åœ¨äº‹åŠ¡æ‰§è¡Œå‰åéƒ½ä¿æŒä¸€è‡´æ€§çŠ¶æ€ã€‚åœ¨ä¸€è‡´æ€§çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰äº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®çš„è¯»å–ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚ 3. éš”ç¦»æ€§ï¼ˆIsolationï¼‰ä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚ 4. æŒä¹…æ€§ï¼ˆDurabilityï¼‰ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°†ä¼šæ°¸è¿œä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚å³ä½¿ç³»ç»Ÿå‘ç”Ÿå´©æºƒï¼Œäº‹åŠ¡æ‰§è¡Œçš„ç»“æœä¹Ÿä¸èƒ½ä¸¢å¤±ã€‚ ä½¿ç”¨é‡åšæ—¥å¿—æ¥ä¿è¯æŒä¹…æ€§ã€‚ å¹¶å‘ä¸€è‡´æ€§é—®é¢˜åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œäº‹åŠ¡çš„éš”ç¦»æ€§å¾ˆéš¾ä¿è¯ï¼Œå› æ­¤ä¼šå‡ºç°å¾ˆå¤šå¹¶å‘ä¸€è‡´æ€§é—®é¢˜ã€‚ ä¸¢å¤±ä¿®æ”¹T1 å’Œ T2 ä¸¤ä¸ªäº‹åŠ¡éƒ½å¯¹ä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹ï¼ŒT1 å…ˆä¿®æ”¹ï¼ŒT2 éšåä¿®æ”¹ï¼ŒT2 çš„ä¿®æ”¹è¦†ç›–äº† T1 çš„ä¿®æ”¹ã€‚ è¯»è„æ•°æ®T1 ä¿®æ”¹ä¸€ä¸ªæ•°æ®ï¼ŒT2 éšåè¯»å–è¿™ä¸ªæ•°æ®ã€‚å¦‚æœ T1 æ’¤é”€äº†è¿™æ¬¡ä¿®æ”¹ï¼Œé‚£ä¹ˆ T2 è¯»å–çš„æ•°æ®æ˜¯è„æ•°æ®ã€‚ ä¸å¯é‡å¤è¯»T2 è¯»å–ä¸€ä¸ªæ•°æ®ï¼ŒT1 å¯¹è¯¥æ•°æ®åšäº†ä¿®æ”¹ã€‚å¦‚æœ T2 å†æ¬¡è¯»å–è¿™ä¸ªæ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚ å¹»å½±è¯»T1 è¯»å–æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼ŒT2 åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®ï¼ŒT1 å†æ¬¡è¯»å–è¿™ä¸ªèŒƒå›´çš„æ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚ éš”ç¦»çº§åˆ«æœªæäº¤è¯»ï¼ˆREAD UNCOMMITTEDï¼‰äº‹åŠ¡ä¸­çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚ æäº¤è¯»ï¼ˆREAD COMMITTEDï¼‰ä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å·²ç»æäº¤çš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æäº¤ä¹‹å‰å¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚ å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰ä¿è¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒæ ·æ•°æ®çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ å¯ä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œã€‚ éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»å½±è¯» åŠ é”è¯» æœªæäº¤è¯» âˆš âˆš âˆš Ã— æäº¤è¯» Ã— âˆš âˆš Ã— å¯é‡å¤è¯» Ã— Ã— âˆš Ã— å¯ä¸²è¡ŒåŒ– Ã— Ã— Ã— âˆš å‚è€ƒé“¾æ¥ æ•°æ®åº“ç³»ç»ŸåŸç†]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºç½‘ç»œ]]></title>
    <url>%2F2019%2F02%2F19%2F%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%2F</url>
    <content type="text"><![CDATA[è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„ OSIå…¶ä¸­è¡¨ç¤ºå±‚å’Œä¼šè¯å±‚ç”¨é€”å¦‚ä¸‹ï¼š è¡¨ç¤ºå±‚ ï¼šæ•°æ®å‹ç¼©ã€åŠ å¯†ä»¥åŠæ•°æ®æè¿°ï¼Œè¿™ä½¿å¾—åº”ç”¨ç¨‹åºä¸å¿…å…³å¿ƒåœ¨å„å°ä¸»æœºä¸­æ•°æ®å†…éƒ¨æ ¼å¼ä¸åŒçš„é—®é¢˜ã€‚ ä¼šè¯å±‚ ï¼šå»ºç«‹åŠç®¡ç†ä¼šè¯ã€‚ äº”å±‚åè®®æ²¡æœ‰è¡¨ç¤ºå±‚å’Œä¼šè¯å±‚ï¼Œè€Œæ˜¯å°†è¿™äº›åŠŸèƒ½ç•™ç»™åº”ç”¨ç¨‹åºå¼€å‘è€…å¤„ç†ã€‚ äº”å±‚åè®® åº”ç”¨å±‚ ï¼šä¸ºç‰¹å®šåº”ç”¨ç¨‹åºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œä¾‹å¦‚ HTTPã€DNS ç­‰ã€‚æ•°æ®å•ä½ä¸ºæŠ¥æ–‡ã€‚ ä¼ è¾“å±‚ ï¼šä¸ºè¿›ç¨‹æä¾›é€šç”¨æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç”±äºåº”ç”¨å±‚åè®®å¾ˆå¤šï¼Œå®šä¹‰é€šç”¨çš„ä¼ è¾“å±‚åè®®å°±å¯ä»¥æ”¯æŒä¸æ–­å¢å¤šçš„åº”ç”¨å±‚åè®®ã€‚è¿è¾“å±‚åŒ…æ‹¬ä¸¤ç§åè®®ï¼šä¼ è¾“æ§åˆ¶åè®® TCPï¼Œæä¾›é¢å‘è¿æ¥ã€å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºæŠ¥æ–‡æ®µï¼›ç”¨æˆ·æ•°æ®æŠ¥åè®® UDPï¼Œæä¾›æ— è¿æ¥ã€å°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºç”¨æˆ·æ•°æ®æŠ¥ã€‚TCP ä¸»è¦æä¾›å®Œæ•´æ€§æœåŠ¡ï¼ŒUDP ä¸»è¦æä¾›åŠæ—¶æ€§æœåŠ¡ã€‚ ç½‘ç»œå±‚ ï¼šä¸ºä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚è€Œä¼ è¾“å±‚åè®®æ˜¯ä¸ºä¸»æœºä¸­çš„è¿›ç¨‹æä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç½‘ç»œå±‚æŠŠä¼ è¾“å±‚ä¼ é€’ä¸‹æ¥çš„æŠ¥æ–‡æ®µæˆ–è€…ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„ã€‚ æ•°æ®é“¾è·¯å±‚ ï¼šç½‘ç»œå±‚é’ˆå¯¹çš„è¿˜æ˜¯ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œè€Œä¸»æœºä¹‹é—´å¯ä»¥æœ‰å¾ˆå¤šé“¾è·¯ï¼Œé“¾è·¯å±‚åè®®å°±æ˜¯ä¸ºåŒä¸€é“¾è·¯çš„ä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„å°è£…æˆå¸§ã€‚ ç‰©ç†å±‚ ï¼šè€ƒè™‘çš„æ˜¯æ€æ ·åœ¨ä¼ è¾“åª’ä½“ä¸Šä¼ è¾“æ•°æ®æ¯”ç‰¹æµï¼Œè€Œä¸æ˜¯æŒ‡å…·ä½“çš„ä¼ è¾“åª’ä½“ã€‚ç‰©ç†å±‚çš„ä½œç”¨æ˜¯å°½å¯èƒ½å±è”½ä¼ è¾“åª’ä½“å’Œé€šä¿¡æ‰‹æ®µçš„å·®å¼‚ï¼Œä½¿æ•°æ®é“¾è·¯å±‚æ„Ÿè§‰ä¸åˆ°è¿™äº›å·®å¼‚ã€‚ TCP/IPå®ƒåªæœ‰å››å±‚ï¼Œç›¸å½“äºäº”å±‚åè®®ä¸­æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚åˆå¹¶ä¸ºç½‘ç»œæ¥å£å±‚ã€‚ TCP/IP ä½“ç³»ç»“æ„ä¸ä¸¥æ ¼éµå¾ª OSI åˆ†å±‚æ¦‚å¿µï¼Œåº”ç”¨å±‚å¯èƒ½ä¼šç›´æ¥ä½¿ç”¨ IP å±‚æˆ–è€…ç½‘ç»œæ¥å£å±‚ã€‚ TCP/IP æ˜¯ Internetä¸Šçš„æ ‡å‡†é€šä¿¡åè®®é›†ï¼Œè¯¥åè®®é›†ç”±æ•°åä¸ªå…·æœ‰å±‚æ¬¡ç»“æ„çš„åè®®ç»„æˆï¼Œå…¶ä¸­ TCP å’Œ IP æ˜¯è¯¥åè®®é›†ä¸­çš„ä¸¤ä¸ªæœ€é‡è¦çš„æ ¸å¿ƒåè®®ã€‚TCP/IPåè®®æ—æŒ‰å±‚æ¬¡å¯åˆ†ä¸ºä»¥ä¸‹å››å±‚ï¼šåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å’Œç½‘ç»œæ¥å£å±‚ï¼Œå„å±‚å¯¹åº”çš„ PDU æ•°æ®å•å…ƒçš„åç§°å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å°ç»“OSI ä¸ƒå±‚ä½“ç³»ç»“æ„å…·æœ‰æ¦‚å¿µæ¸…æ¥šã€ç†è®ºå®Œæ•´çš„ç‰¹ç‚¹ï¼Œæ˜¯ä¸€ä¸ªç†è®ºä¸Šçš„å›½é™…æ ‡å‡†ï¼Œä½†å´ä¸æ˜¯äº‹å®ä¸Šçš„å›½é™…æ ‡å‡†ï¼›è€Œå…·æœ‰ç®€å•æ˜“ç”¨ç‰¹ç‚¹çš„ TCP/IP å››å±‚ä½“ç³»ç»“æ„åˆ™æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†ã€‚ éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œäº”å±‚ä½“ç³»ç»“æ„è™½ç„¶ç»¼åˆäº† OSI å’Œ TCP/IP çš„ä¼˜ç‚¹ï¼Œä½†å…¶åªæ˜¯ä¸ºäº†å­¦æœ¯å­¦ä¹ ç ”ç©¶è€Œæå‡ºçš„ï¼Œæ²¡æœ‰å…·ä½“çš„å®é™…æ„ä¹‰ã€‚ è¯´è¯´ TCP çš„ä¸‰æ¬¡æ¡æ‰‹è¿™ä¸€åˆ°å¾ˆå¸¸è§çš„é¢è¯•é¢˜ã€‚ ä¼ è¾“æ§åˆ¶åè®® TCP ç®€ä»‹ é¢å‘è¿æ¥çš„ã€å¯é çš„åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®® å°†åº”ç”¨å±‚çš„æ•°æ®æµåˆ†å‰²æˆæŠ¥æ–‡æ®µå¹¶å‘é€ç»™ç›®æ ‡èŠ‚ç‚¹çš„ TCP å±‚ æ•°æ®åŒ…éƒ½æ˜¯ç”±åºå·ï¼Œå¯¹æ–¹æ”¶åˆ°åˆ™å‘é€ ACK ç¡®è®¤ï¼Œæœªæ”¶åˆ°åˆ™é‡ä¼  ä½¿ç”¨æ ¡éªŒå’Œæ¥æ£€éªŒæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰è¯¯ TCP æŠ¥æ–‡å¤´ æºç«¯å£ã€ç›®çš„ç«¯å£ ï¼šæ ‡è®°è¿›ç¨‹ã€‚ åºå· ï¼šç”¨äºå¯¹å­—èŠ‚æµè¿›è¡Œç¼–å·ï¼Œä¾‹å¦‚åºå·ä¸º 301ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ä¸º 301ï¼Œå¦‚æœæºå¸¦çš„æ•°æ®é•¿åº¦ä¸º 100 å­—èŠ‚ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·åº”ä¸º 401ã€‚ ç¡®è®¤å· ï¼šæœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ã€‚ä¾‹å¦‚ B æ­£ç¡®æ”¶åˆ° A å‘é€æ¥çš„ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œåºå·ä¸º 501ï¼Œæºå¸¦çš„æ•°æ®é•¿åº¦ä¸º 200 å­—èŠ‚ï¼Œå› æ­¤ B æœŸæœ›ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ä¸º 701ï¼ŒB å‘é€ç»™ A çš„ç¡®è®¤æŠ¥æ–‡æ®µä¸­ç¡®è®¤å·å°±ä¸º 701ã€‚ æ•°æ®åç§» ï¼šæŒ‡çš„æ˜¯æ•°æ®éƒ¨åˆ†è·ç¦»æŠ¥æ–‡æ®µèµ·å§‹å¤„çš„åç§»é‡ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯é¦–éƒ¨çš„é•¿åº¦ã€‚ è¿æ¥æ ‡å¿—ï¼ˆTCP Flagsï¼‰ï¼šè¡¨ç¤ºæ§åˆ¶åŠŸèƒ½ï¼Œä¸‹é¢æ˜¯å¸¸è§çš„è¿æ¥æ ‡å¿—ã€‚ ç¡®è®¤ ACK ï¼šå½“ ACK=1 æ—¶ç¡®è®¤å·å­—æ®µæœ‰æ•ˆï¼Œå¦åˆ™æ— æ•ˆã€‚TCP è§„å®šï¼Œåœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠ ACK ç½® 1ã€‚ åŒæ­¥ SYN ï¼šåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚å½“ SYN=a1ï¼ŒACK=0 æ—¶è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è‹¥å¯¹æ–¹åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å“åº”æŠ¥æ–‡ä¸­ SYN=1ï¼ŒACK=1ã€‚ ç»ˆæ­¢ FIN ï¼šç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿æ¥ï¼Œå½“ FIN=1 æ—¶ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿æ¥ã€‚ çª—å£ ï¼šçª—å£å€¼ä½œä¸ºæ¥æ”¶æ–¹è®©å‘é€æ–¹è®¾ç½®å…¶å‘é€çª—å£çš„ä¾æ®ã€‚ä¹‹æ‰€ä»¥è¦æœ‰è¿™ä¸ªé™åˆ¶ï¼Œæ˜¯å› ä¸ºæ¥æ”¶æ–¹çš„æ•°æ®ç¼“å­˜ç©ºé—´æ˜¯æœ‰é™çš„ã€‚ ä¸‰æ¬¡æ¡æ‰‹ åœ¨ TCP/IP åè®®ä¸­ï¼Œ TCP åè®®æä¾›å¯é çš„è¿æ¥æœåŠ¡ï¼Œé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹ä¸€ä¸ªè¿æ¥ã€‚ å‡è®¾ A ä¸ºå®¢æˆ·ç«¯ï¼ŒB ä¸ºæœåŠ¡å™¨ç«¯ã€‚ é¦–å…ˆ B å¤„äº LISTENï¼ˆç›‘å¬ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·çš„è¿æ¥è¯·æ±‚ã€‚ A å‘ B å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼ŒSYN=1ï¼ŒACK=0ï¼Œé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· xã€‚ B æ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å‘ A å‘é€è¿æ¥ç¡®è®¤æŠ¥æ–‡ï¼ŒSYN=1ï¼ŒACK=1ï¼Œç¡®è®¤å·ä¸º x+1ï¼ŒåŒæ—¶ä¹Ÿé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· yã€‚ A æ”¶åˆ° B çš„è¿æ¥ç¡®è®¤æŠ¥æ–‡åï¼Œè¿˜è¦å‘ B å‘å‡ºç¡®è®¤ï¼Œç¡®è®¤å·ä¸º y+1ï¼Œåºå·ä¸º x+1ã€‚ B æ”¶åˆ° A çš„ç¡®è®¤åï¼Œè¿æ¥å»ºç«‹ã€‚ å¯¹äºå»ºé“¾æ¥çš„3æ¬¡æ¡æ‰‹ä¸»è¦æ˜¯è¦åˆå§‹åŒ–Sequence Number çš„åˆå§‹å€¼ã€‚é€šä¿¡çš„åŒæ–¹è¦äº’ç›¸é€šçŸ¥å¯¹æ–¹è‡ªå·±çš„åˆå§‹åŒ–çš„ Sequence Numberï¼ˆç¼©å†™ä¸ºISNï¼šInital Sequence Numberï¼‰â€”â€”æ‰€ä»¥å«SYNï¼Œå…¨ç§°Synchronize Sequence Numbersã€‚ä¹Ÿå°±ä¸Šå›¾ä¸­çš„ x å’Œ yã€‚è¿™ä¸ªå·è¦ä½œä¸ºä»¥åçš„æ•°æ®é€šä¿¡çš„åºå·ï¼Œä»¥ä¿è¯åº”ç”¨å±‚æ¥æ”¶åˆ°çš„æ•°æ®ä¸ä¼šå› ä¸ºç½‘ç»œä¸Šçš„ä¼ è¾“çš„é—®é¢˜è€Œä¹±åºï¼ˆTCPä¼šç”¨è¿™ä¸ªåºå·æ¥æ‹¼æ¥æ•°æ®ï¼‰ã€‚ å…³äºå»ºè¿æ¥æ—¶SYNè¶…æ—¶è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœserverç«¯æ¥åˆ°äº† client å‘çš„ SYN åå›äº† SYN-ACK å client æ‰çº¿äº†ï¼Œserver ç«¯æ²¡æœ‰æ”¶åˆ° client å›æ¥çš„ACKï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªè¿æ¥å¤„äºä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼Œå³æ²¡æˆåŠŸï¼Œä¹Ÿæ²¡å¤±è´¥ã€‚äºæ˜¯ï¼Œserver ç«¯å¦‚æœåœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°çš„TCPä¼šé‡å‘ SYN-ACKã€‚åœ¨Linuxä¸‹ï¼Œé»˜è®¤é‡è¯•æ¬¡æ•°ä¸º5æ¬¡ï¼Œé‡è¯•çš„é—´éš”æ—¶é—´ä» 1s å¼€å§‹æ¯æ¬¡éƒ½ç¿»å”®ï¼Œ5 æ¬¡çš„é‡è¯•æ—¶é—´é—´éš”ä¸º1s, 2s, 4s, 8s, 16sï¼Œæ€»å…±31sï¼Œç¬¬5æ¬¡å‘å‡ºåè¿˜è¦ç­‰32séƒ½çŸ¥é“ç¬¬5æ¬¡ä¹Ÿè¶…æ—¶äº†ï¼Œæ‰€ä»¥ï¼Œæ€»å…±éœ€è¦ 1s + 2s + 4s+ 8s+ 16s + 32s = 2^6 -1 = 63sï¼ŒTCPæ‰ä¼šæŠŠæ–­å¼€è¿™ä¸ªè¿æ¥ã€‚ å…³äºSYN Floodæ”»å‡»ä¸€äº›æ¶æ„çš„äººå°±ä¸ºæ­¤åˆ¶é€ äº†SYN Floodæ”»å‡»ï¼Œç»™æœåŠ¡å™¨å‘äº†ä¸€ä¸ªSYNåï¼Œå°±ä¸‹çº¿äº†ï¼Œäºæ˜¯æœåŠ¡å™¨éœ€è¦é»˜è®¤ç­‰ 63s æ‰ä¼šæ–­å¼€è¿æ¥ï¼Œè¿™æ ·ï¼Œæ”»å‡»è€…å°±å¯ä»¥æŠŠæœåŠ¡å™¨çš„ syn è¿æ¥çš„é˜Ÿåˆ—è€—å°½ï¼Œè®©æ­£å¸¸çš„è¿æ¥è¯·æ±‚ä¸èƒ½å¤„ç†ã€‚äºæ˜¯ï¼ŒLinuxä¸‹ç»™äº†ä¸€ä¸ªå« tcp_syncookies çš„å‚æ•°æ¥åº”å¯¹è¿™ä¸ªäº‹â€”â€”å½“SYNé˜Ÿåˆ—æ»¡äº†åï¼ŒTCPä¼šé€šè¿‡æºåœ°å€ç«¯å£ã€ç›®æ ‡åœ°å€ç«¯å£å’Œæ—¶é—´æˆ³æ‰“é€ å‡ºä¸€ä¸ªç‰¹åˆ«çš„Sequence Numberå‘å›å»ï¼ˆåˆå«cookieï¼‰ï¼Œå¦‚æœæ˜¯æ”»å‡»è€…åˆ™ä¸ä¼šæœ‰å“åº”ï¼Œå¦‚æœæ˜¯æ­£å¸¸è¿æ¥ï¼Œåˆ™ä¼šæŠŠè¿™ä¸ª SYN Cookieå‘å›æ¥ï¼Œç„¶åæœåŠ¡ç«¯å¯ä»¥é€šè¿‡cookieå»ºè¿æ¥ï¼ˆå³ä½¿ä½ ä¸åœ¨SYNé˜Ÿåˆ—ä¸­ï¼‰ã€‚ è¯·æ³¨æ„ï¼Œè¯·å…ˆåƒä¸‡åˆ«ç”¨ tcp_syncookies æ¥å¤„ç†æ­£å¸¸çš„å¤§è´Ÿè½½çš„è¿æ¥çš„æƒ…å†µã€‚å› ä¸ºï¼Œsynccookies æ˜¯å¦¥åç‰ˆçš„TCPåè®®ï¼Œå¹¶ä¸ä¸¥è°¨ã€‚å¯¹äºæ­£å¸¸çš„è¯·æ±‚ï¼Œä½ åº”è¯¥è°ƒæ•´ä¸‰ä¸ªTCPå‚æ•°å¯ä¾›ä½ é€‰æ‹©ã€‚ ç¬¬ä¸€ä¸ªæ˜¯ï¼štcp_synack_retries å¯ä»¥ç”¨ä»–æ¥å‡å°‘é‡è¯•æ¬¡æ•°ï¼› ç¬¬äºŒä¸ªæ˜¯ï¼štcp_max_syn_backlogï¼Œå¯ä»¥å¢å¤§SYNè¿æ¥æ•°ï¼› ç¬¬ä¸‰ä¸ªæ˜¯ï¼štcp_abort_on_overflow å¤„ç†ä¸è¿‡æ¥å¹²è„†å°±ç›´æ¥æ‹’ç»è¿æ¥äº† ï¼› ä¿æ´»æœºåˆ¶ å‘å¯¹æ–¹å‘é€ä¿æ´»æ¢æµ‹æŠ¥æ–‡ï¼Œå¦‚æœæœªæ”¶åˆ°å“åº”åˆ™ç»§ç»­å‘é€ å°è¯•æ¬¡æ•°è¾¾åˆ°ä¿æ´»æ¢æµ‹æ•°ä»ç„¶æœªæ”¶åˆ°å“åº”åˆ™ä¸­æ–­è¿æ¥ è°ˆè°ˆå››æ¬¡æŒ¥æ‰‹ ä»¥ä¸‹æè¿°ä¸è®¨è®ºåºå·å’Œç¡®è®¤å·ï¼Œå› ä¸ºåºå·å’Œç¡®è®¤å·çš„è§„åˆ™æ¯”è¾ƒç®€å•ã€‚å¹¶ä¸”ä¸è®¨è®º ACKï¼Œå› ä¸º ACK åœ¨è¿æ¥å»ºç«‹ä¹‹åéƒ½ä¸º 1ã€‚ A å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ã€‚ B æ”¶åˆ°ä¹‹åå‘å‡ºç¡®è®¤ï¼Œæ­¤æ—¶ TCP å±äºåŠå…³é—­çŠ¶æ€ï¼ŒB èƒ½å‘ A å‘é€æ•°æ®ä½†æ˜¯ A ä¸èƒ½å‘ B å‘é€æ•°æ®ã€‚ å½“ B ä¸å†éœ€è¦è¿æ¥æ—¶ï¼Œå‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ã€‚ A æ”¶åˆ°åå‘å‡ºç¡®è®¤ï¼Œè¿›å…¥ TIME-WAIT çŠ¶æ€ï¼Œç­‰å¾… 2 MSLï¼ˆæœ€å¤§æŠ¥æ–‡å­˜æ´»æ—¶é—´ï¼‰åé‡Šæ”¾è¿æ¥ã€‚ B æ”¶åˆ° A çš„ç¡®è®¤åé‡Šæ”¾è¿æ¥ã€‚ å››æ¬¡æŒ¥æ‰‹çš„åŸå› å®¢æˆ·ç«¯å‘é€äº† FIN è¿æ¥é‡Šæ”¾æŠ¥æ–‡ä¹‹åï¼ŒæœåŠ¡å™¨æ”¶åˆ°äº†è¿™ä¸ªæŠ¥æ–‡ï¼Œå°±è¿›å…¥äº† CLOSE-WAIT çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€æ˜¯ä¸ºäº†è®©æœåŠ¡å™¨ç«¯å‘é€è¿˜æœªä¼ é€å®Œæ¯•çš„æ•°æ®ï¼Œä¼ é€å®Œæ¯•ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå‘é€ FIN è¿æ¥é‡Šæ”¾æŠ¥æ–‡ã€‚ TCPè¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼ŒæœåŠ¡ç«¯å¯ä»¥å‘é€æ•°æ®åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥å‘é€æ•°æ®åˆ°æœåŠ¡ç«¯ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½éœ€è¦ä¸¤æ¬¡æŒ¥æ‰‹æ‰èƒ½å…³é—­ ã€‚ TIME_WAITå®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨ç«¯çš„ FIN æŠ¥æ–‡åè¿›å…¥æ­¤çŠ¶æ€ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œè¿˜éœ€è¦ç­‰å¾…ä¸€ä¸ªæ—¶é—´è®¡æ—¶å™¨è®¾ç½®çš„æ—¶é—´ 2MSLã€‚è¿™ä¹ˆåšæœ‰ä¸¤ä¸ªç†ç”±ï¼š ç¡®ä¿æœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾ã€‚å¦‚æœ B æ²¡æ”¶åˆ° A å‘é€æ¥çš„ç¡®è®¤æŠ¥æ–‡ï¼Œé‚£ä¹ˆå°±ä¼šé‡æ–°å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚æŠ¥æ–‡ï¼ŒA ç­‰å¾…ä¸€æ®µæ—¶é—´å°±æ˜¯ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚ ç­‰å¾…ä¸€æ®µæ—¶é—´æ˜¯ä¸ºäº†è®©æœ¬è¿æ¥æŒç»­æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡éƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥ä¸ä¼šå‡ºç°æ—§çš„è¿æ¥è¯·æ±‚æŠ¥æ–‡ã€‚ TCP å’Œ UDP çš„åŒºåˆ«å‰é¢æˆ‘ä»¬è¯´äº† TCP ç°åœ¨æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹ UDPã€‚ UPD çš„ç‰¹ç‚¹ é¢å‘éè¿æ¥çš„ ä¸ç»´æŠ¤è¿æ¥çŠ¶æ€ï¼Œæ”¯æŒåŒæ—¶å‘å¤šä¸ªå®¢æˆ·ç«¯ä¼ è¾“ç›¸åŒçš„æ¶ˆæ¯ æ•°æ®åŒ…æŠ¥å¤´åªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œé¢å¤–å¼€é”€è¾ƒå° ååé‡åªå—é™äºæ•°æ®ç”Ÿæˆç‡ã€ä¼ è¾“é€Ÿç‡ä»¥åŠæœºå™¨æ€§èƒ½ å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œä¸ä¿è¯å¯é äº¤ä»˜ï¼Œä¸éœ€è¦ç»´æŒå¤æ‚çš„é“¾æ¥çŠ¶æ€è¡¨ é¢å‘æŠ¥æ–‡ï¼Œä¸å¯¹åº”ç”¨ç¨‹åºæäº¤çš„æŠ¥æ–‡ä¿¡æ¯è¿›è¡Œæ‹†åˆ†æˆ–åˆ™åˆå¹¶ å¯¹æ¯” TCP æ˜¯é¢å‘è¿æ¥çš„ï¼›UDP æ˜¯æ— è¿æ¥çš„ã€‚ TCP æ˜¯å¯é çš„ï¼›UDP æ˜¯ä¸å¯é çš„ã€‚ TCP åªæ”¯æŒç‚¹å¯¹ç‚¹é€šä¿¡ï¼›UDP æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤šçš„é€šä¿¡æ¨¡å¼ã€‚ TCP æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼›UDP æ˜¯é¢å‘æŠ¥æ–‡çš„ã€‚ TCP æœ‰æ‹¥å¡æ§åˆ¶æœºåˆ¶ï¼›UDP æ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œé€‚åˆåª’ä½“é€šä¿¡ã€‚ TCP é¦–éƒ¨å¼€é”€(20 ä¸ªå­—èŠ‚)ï¼Œæ¯” UDP çš„é¦–éƒ¨å¼€é”€(8 ä¸ªå­—èŠ‚)è¦å¤§ã€‚ TCP çš„æ»‘åŠ¨çª—å£é¦–å…ˆæ˜ç¡®ï¼š TCPæ»‘åŠ¨çª—å£åˆ†ä¸ºæ¥å—çª—å£ï¼Œå‘é€çª—å£ã€‚ æ»‘åŠ¨çª—å£åè®®æ˜¯ä¼ è¾“å±‚è¿›è¡Œæµæ§çš„ä¸€ç§æªæ–½ï¼Œæ¥æ”¶æ–¹é€šè¿‡é€šå‘Šå‘é€æ–¹è‡ªå·±çš„çª—å£å¤§å°ï¼Œä»è€Œæ§åˆ¶å‘é€æ–¹çš„å‘é€é€Ÿåº¦ï¼Œä»è€Œè¾¾åˆ°é˜²æ­¢å‘é€æ–¹å‘é€é€Ÿåº¦è¿‡å¿«è€Œå¯¼è‡´è‡ªå·±è¢«æ·¹æ²¡çš„ç›®çš„ã€‚ é‡è¦æ¦‚å¿µå¯¹ACKçš„å†è®¤è¯†ï¼Œacké€šå¸¸è¢«ç†è§£ä¸ºæ”¶åˆ°æ•°æ®åç»™å‡ºçš„ä¸€ä¸ªç¡®è®¤ACKï¼ŒACKåŒ…å«ä¸¤ä¸ªéå¸¸é‡è¦çš„ä¿¡æ¯ï¼š ä¸€æ˜¯æœŸæœ›æ¥æ”¶åˆ°çš„ä¸‹ä¸€å­—èŠ‚çš„åºå·nï¼Œè¯¥nä»£è¡¨æ¥æ”¶æ–¹å·²ç»æ¥æ”¶åˆ°äº†å‰n-1å­—èŠ‚æ•°æ®ï¼Œæ­¤æ—¶å¦‚æœæ¥æ”¶æ–¹æ”¶åˆ°ç¬¬n+1å­—èŠ‚æ•°æ®è€Œä¸æ˜¯ç¬¬nå­—èŠ‚æ•°æ®ï¼Œæ¥æ”¶æ–¹æ˜¯ä¸ä¼šå‘é€åºå·ä¸ºn+2çš„ACKçš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æ¥æ”¶ç«¯æ”¶åˆ°1-1024å­—èŠ‚ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªç¡®è®¤å·ä¸º1025çš„ACK,ä½†æ˜¯æ¥ä¸‹æ¥æ”¶åˆ°çš„æ˜¯2049-3072ï¼Œå®ƒæ˜¯ä¸ä¼šå‘é€ç¡®è®¤å·ä¸º3072çš„ACK,è€Œä¾æ—§å‘é€1025çš„ACKã€‚ äºŒæ˜¯å½“å‰çš„çª—å£å¤§å°mï¼Œå¦‚æ­¤å‘é€æ–¹åœ¨æ¥æ”¶åˆ°ACKåŒ…å«çš„è¿™ä¸¤ä¸ªæ•°æ®åå°±å¯ä»¥è®¡ç®—å‡ºè¿˜å¯ä»¥å‘é€å¤šå°‘å­—èŠ‚çš„æ•°æ®ç»™å¯¹æ–¹ï¼Œå‡å®šå½“å‰å‘é€æ–¹å·²å‘é€åˆ°ç¬¬xå­—èŠ‚ï¼Œåˆ™å¯ä»¥å‘é€çš„å­—èŠ‚æ•°å°±æ˜¯y=m-(x-n).è¿™å°±æ˜¯æ»‘åŠ¨çª—å£æ§åˆ¶æµé‡çš„åŸºæœ¬åŸç† é‡ç‚¹ï¼šå‘é€æ–¹æ ¹æ®æ”¶åˆ°ACKå½“ä¸­çš„æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„åºå·nä»¥åŠçª—å£mï¼Œè¿˜æœ‰å½“å‰å·²ç»å‘é€çš„å­—èŠ‚åºå·xï¼Œç®—å‡ºè¿˜å¯ä»¥å‘é€çš„å­—èŠ‚æ•°ã€‚ å‘é€ç«¯çª—å£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åºå·ä¸€å®šæ˜¯ACKä¸­æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªå­—èŠ‚åºå·ï¼Œæ¯”å¦‚ä¸‹å›¾ï¼š ä¸Šå›¾52 53 54 55 å­—èŠ‚éƒ½æ˜¯å¯ä»¥æ–°å‘é€çš„å­—èŠ‚åºã€‚ æ¥å—ç«¯çª—å£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åºä¹‹å‰ä¸€å®šæ˜¯å·²ç»å®Œå…¨æ¥æ”¶çš„ï¼Œåé¢çª—å£é‡Œé¢çš„æ•°æ®éƒ½æ˜¯å¸Œæœ›æ¥å—çš„ï¼Œçª—å£åé¢çš„æ•°æ®éƒ½æ˜¯ä¸å¸Œæœ›æ¥å—çš„ã€‚ TCPçš„æ»‘åŠ¨çª—å£åˆ†ä¸ºæ¥æ”¶çª—å£å’Œå‘é€çª—å£ ä¸åˆ†æè¿™ä¸¤ç§çª—å£å°±è®¨è®ºæ˜¯ä¸å¦¥å½“çš„ã€‚ TCPçš„æ»‘åŠ¨çª—å£ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ˜¯æä¾›TCPçš„å¯é æ€§ï¼ŒäºŒæ˜¯æä¾›TCPçš„æµæ§ç‰¹æ€§ã€‚åŒæ—¶æ»‘åŠ¨çª—å£æœºåˆ¶è¿˜ä½“ç°äº†TCPé¢å‘å­—èŠ‚æµçš„è®¾è®¡æ€è·¯ã€‚TCP æ®µä¸­çª—å£çš„ç›¸å…³å­—æ®µã€‚ TCPçš„Windowæ˜¯ä¸€ä¸ª16bitä½å­—æ®µï¼Œå®ƒä»£è¡¨çš„æ˜¯çª—å£çš„å­—èŠ‚å®¹é‡ï¼Œä¹Ÿå°±æ˜¯TCPçš„æ ‡å‡†çª—å£æœ€å¤§ä¸º2^16-1=65535ä¸ªå­—èŠ‚ã€‚ å¦å¤–åœ¨TCPçš„é€‰é¡¹å­—æ®µä¸­è¿˜åŒ…å«äº†ä¸€ä¸ªTCPçª—å£æ‰©å¤§å› å­ï¼Œoption-kindä¸º3ï¼Œoption-lengthä¸º3ä¸ªå­—èŠ‚ï¼Œoption-dataå–å€¼èŒƒå›´0-14ã€‚çª—å£æ‰©å¤§å› å­ç”¨æ¥æ‰©å¤§TCPçª—å£ï¼Œå¯æŠŠåŸæ¥16bitçš„çª—å£ï¼Œæ‰©å¤§ä¸º31bitã€‚ æ»‘åŠ¨çª—å£åŸºæœ¬åŸç†å¯¹äºTCPä¼šè¯çš„å‘é€æ–¹ï¼Œä»»ä½•æ—¶å€™åœ¨å…¶å‘é€ç¼“å­˜å†…çš„æ•°æ®éƒ½å¯ä»¥åˆ†ä¸º4ç±»ï¼Œâ€œå·²ç»å‘é€å¹¶å¾—åˆ°å¯¹ç«¯ACKçš„â€ï¼Œâ€œå·²ç»å‘é€ä½†è¿˜æœªæ”¶åˆ°å¯¹ç«¯ACKçš„â€ï¼Œâ€œæœªå‘é€ä½†å¯¹ç«¯å…è®¸å‘é€çš„â€ï¼Œâ€œæœªå‘é€ä¸”å¯¹ç«¯ä¸å…è®¸å‘é€â€ã€‚â€œå·²ç»å‘é€ä½†è¿˜æœªæ”¶åˆ°å¯¹ç«¯ACKçš„â€å’Œâ€œæœªå‘é€ä½†å¯¹ç«¯å…è®¸å‘é€çš„â€è¿™ä¸¤éƒ¨åˆ†æ•°æ®ç§°ä¹‹ä¸ºå‘é€çª—å£ã€‚ å½“æ”¶åˆ°æ¥æ”¶æ–¹æ–°çš„ACKå¯¹äºå‘é€çª—å£ä¸­åç»­å­—èŠ‚çš„ç¡®è®¤æ˜¯ï¼Œçª—å£æ»‘åŠ¨ï¼Œæ»‘åŠ¨åŸç†å¦‚ä¸‹å›¾ã€‚ å½“æ”¶åˆ°ACK=36æ—¶çª—å£æ»‘åŠ¨ã€‚ 2ï¼‰å¯¹äºTCPçš„æ¥æ”¶æ–¹ï¼Œåœ¨æŸä¸€æ—¶åˆ»åœ¨å®ƒçš„æ¥æ”¶ç¼“å­˜å†…å­˜åœ¨3ç§ã€‚â€œå·²æ¥æ”¶â€ï¼Œâ€œæœªæ¥æ”¶å‡†å¤‡æ¥æ”¶â€ï¼Œâ€œæœªæ¥æ”¶å¹¶æœªå‡†å¤‡æ¥æ”¶â€ï¼ˆç”±äºACKç›´æ¥ç”±TCPåè®®æ ˆå›å¤ï¼Œé»˜è®¤æ— åº”ç”¨å»¶è¿Ÿï¼Œä¸å­˜åœ¨â€œå·²æ¥æ”¶æœªå›å¤ACKâ€ï¼‰ã€‚å…¶ä¸­â€œæœªæ¥æ”¶å‡†å¤‡æ¥æ”¶â€ç§°ä¹‹ä¸ºæ¥æ”¶çª—å£ã€‚ å‘é€çª—å£ä¸æ¥æ”¶çª—å£å…³ç³»TCPæ˜¯åŒå·¥çš„åè®®ï¼Œä¼šè¯çš„åŒæ–¹éƒ½å¯ä»¥åŒæ—¶æ¥æ”¶ã€å‘é€æ•°æ®ã€‚TCPä¼šè¯çš„åŒæ–¹éƒ½å„è‡ªç»´æŠ¤ä¸€ä¸ªâ€œå‘é€çª—å£â€å’Œä¸€ä¸ªâ€œæ¥æ”¶çª—å£â€ã€‚å…¶ä¸­å„è‡ªçš„â€œæ¥æ”¶çª—å£â€å¤§å°å–å†³äºåº”ç”¨ã€ç³»ç»Ÿã€ç¡¬ä»¶çš„é™åˆ¶ï¼ˆTCPä¼ è¾“é€Ÿç‡ä¸èƒ½å¤§äºåº”ç”¨çš„æ•°æ®å¤„ç†é€Ÿç‡ï¼‰ã€‚å„è‡ªçš„â€œå‘é€çª—å£â€åˆ™è¦æ±‚å–å†³äºå¯¹ç«¯é€šå‘Šçš„â€œæ¥æ”¶çª—å£â€ï¼Œè¦æ±‚ç›¸åŒã€‚ æ»‘åŠ¨çª—å£å®ç°é¢å‘æµçš„å¯é æ€§ æœ€åŸºæœ¬çš„ä¼ è¾“å¯é æ€§æ¥æºäºâ€œç¡®è®¤é‡ä¼ â€æœºåˆ¶ã€‚ TCPçš„æ»‘åŠ¨çª—å£çš„å¯é æ€§ä¹Ÿæ˜¯å»ºç«‹åœ¨â€œç¡®è®¤é‡ä¼ â€åŸºç¡€ä¸Šçš„ã€‚ å‘é€çª—å£åªæœ‰æ”¶åˆ°å¯¹ç«¯å¯¹äºæœ¬æ®µå‘é€çª—å£å†…å­—èŠ‚çš„ACKç¡®è®¤ï¼Œæ‰ä¼šç§»åŠ¨å‘é€çª—å£çš„å·¦è¾¹ç•Œã€‚ æ¥æ”¶çª—å£åªæœ‰åœ¨å‰é¢æ‰€æœ‰çš„æ®µéƒ½ç¡®è®¤çš„æƒ…å†µä¸‹æ‰ä¼šç§»åŠ¨å·¦è¾¹ç•Œã€‚å½“åœ¨å‰é¢è¿˜æœ‰å­—èŠ‚æœªæ¥æ”¶ä½†æ”¶åˆ°åé¢å­—èŠ‚çš„æƒ…å†µä¸‹ï¼Œçª—å£ä¸ä¼šç§»åŠ¨ï¼Œå¹¶ä¸å¯¹åç»­å­—èŠ‚ç¡®è®¤ã€‚ä»¥æ­¤ç¡®ä¿å¯¹ç«¯ä¼šå¯¹è¿™äº›æ•°æ®é‡ä¼ ã€‚ æ»‘åŠ¨çª—å£çš„æµæ§ç‰¹æ€§TCPçš„æ»‘åŠ¨çª—å£æ˜¯åŠ¨æ€çš„ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡æˆå°å­¦å¸¸è§çš„ä¸€ä¸ªæ•°å­¦é¢˜ï¼Œä¸€ä¸ªæ°´æ± ï¼Œä½“ç§¯Vï¼Œæ¯å°æ—¶è¿›æ°´é‡V1ï¼Œå‡ºæ°´é‡V2ã€‚å½“æ°´æ± æ»¡äº†å°±ä¸å…è®¸å†æ³¨å…¥äº†ï¼Œå¦‚æœæœ‰ä¸ªæ¶²å‹ç³»ç»Ÿæ§åˆ¶æ°´æ± å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ§åˆ¶æ°´çš„æ³¨å…¥é€Ÿç‡å’Œé‡ã€‚è¿™æ ·çš„æ°´æ± å°±ç±»ä¼¼TCPçš„çª—å£ã€‚åº”ç”¨æ ¹æ®è‡ªèº«çš„å¤„ç†èƒ½åŠ›å˜åŒ–ï¼Œé€šè¿‡æœ¬ç«¯TCPæ¥æ”¶çª—å£å¤§å°æ§åˆ¶æ¥å¯¹å¯¹å¯¹ç«¯çš„å‘é€çª—å£æµé‡é™åˆ¶ã€‚ åº”ç”¨ç¨‹åºåœ¨éœ€è¦ï¼ˆå¦‚å†…å­˜ä¸è¶³ï¼‰æ—¶ï¼Œé€šè¿‡APIé€šçŸ¥TCPåè®®æ ˆç¼©å°TCPçš„æ¥æ”¶çª—å£ã€‚ç„¶åTCPåè®®æ ˆåœ¨ä¸‹ä¸ªæ®µå‘é€æ—¶åŒ…å«æ–°çš„çª—å£å¤§å°é€šçŸ¥ç»™å¯¹ç«¯ï¼Œå¯¹ç«¯æŒ‰é€šçŸ¥çš„çª—å£æ¥æ”¹å˜å‘é€çª—å£ï¼Œä»¥æ­¤è¾¾åˆ°å‡ç¼“å‘é€é€Ÿç‡çš„ç›®çš„ã€‚ HTTPHTTP åè®®ï¼Œæ˜¯ Hyper Text Transfer Protocolï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„ç¼©å†™ï¼Œæ˜¯ç”¨äºä»ä¸‡ç»´ç½‘ï¼ˆWWW:World Wide Web ï¼‰æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚ ä¸»è¦ç‰¹ç‚¹å¦‚ä¸‹ï¼š ç®€å•å¿«é€Ÿï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚è¯·æ±‚æ–¹æ³•å¸¸ç”¨çš„æœ‰ GETã€HEADã€POST ç­‰ç­‰ã€‚æ¯ç§æ–¹æ³•è§„å®šäº†å®¢æˆ·ä¸æœåŠ¡å™¨è”ç³»çš„ç±»å‹ä¸åŒã€‚ç”±äº HTTP åè®®ç®€å•ï¼Œä½¿å¾— HTTP æœåŠ¡å™¨çš„ç¨‹åºè§„æ¨¡å°ï¼Œå› è€Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«ã€‚ æ•°æ®æ ¼å¼çµæ´»ï¼šHTTP å…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚æ­£åœ¨ä¼ è¾“çš„ç±»å‹ç”±Content-Type åŠ ä»¥æ ‡è®°ã€‚ æ— è¿æ¥ï¼šæ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€è¿æ¥ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´ã€‚ æ— çŠ¶æ€ï¼šHTTP åè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€ï¼Œæ˜¯æŒ‡åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚æ— çŠ¶æ€æ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±è¾ƒå¿«ã€‚ æ”¯æŒ B/S åŠ C/S æ¨¡å¼ã€‚ GET å’Œ POST åŒºåˆ«ä»ä¸‰ä¸ªå±‚é¢æ¥è§£ç­”ï¼š Http æŠ¥æ–‡å±‚é¢ï¼šGET å°†è¯·æ±‚ä¿¡æ¯æ”¾åœ¨ URLä¸­ï¼ŒPOST æ–¹æ³•æŠ¥æ–‡ä¸­ æ•°æ®åº“å±‚é¢ï¼šGET ç¬¦åˆå¹‚ç­‰æ€§å’Œå®‰å…¨æ€§ï¼ŒPOST ä¸ç¬¦åˆ å…¶ä»–å±‚é¢ï¼šGET å¯ä»¥è¢«ç¼“å­˜ã€è¢«å­˜å‚¨ï¼ˆä¹¦ç­¾ï¼‰ï¼Œè€Œ POST ä¸è¡Œ Cookie å’Œ Session çš„åŒºåˆ«Cookie ç®€ä»‹ï¼š æ˜¯ç”±æœåŠ¡å™¨å‘ç»™å®¢æˆ·ç«¯çš„ç‰¹æ®Šä¿¡æ¯ï¼Œä»¥æ–‡æœ¬çš„å½¢å¼å­˜æ”¾åœ¨å®¢æˆ·ç«¯ å®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šæŠŠ Cookie å›å‘ç»™æœåŠ¡ç«¯ æœåŠ¡å™¨æ¥æ”¶åˆ°åï¼Œä¼šè§£æ Cookie ç”Ÿæˆä¸å®¢æˆ·ç«¯ç›¸å¯¹çš„å†…å®¹ Cookiet çš„è®¾ç½®ä»¥åŠå‘é€è¿‡ç¨‹ï¼š Session ç®€ä»‹ï¼š æœåŠ¡ç«¯çš„æœºåˆ¶ï¼Œåœ¨æœåŠ¡ç«¯ä¿å­˜çš„ä¿¡æ¯ è§£æå®¢æˆ·ç«¯è¯·æ±‚å¹¶æ“ä½œ Session id ï¼ŒæŒ‰éœ€ä¿å­˜çŠ¶æ€ä¿¡æ¯ Session çš„å®ç°æ–¹å¼ï¼š ä½¿ç”¨ Cookie æ¥å®ç° ä½¿ç”¨ URL å›å†™æ¥å®ç°ï¼Œæ¯æ¬¡åœ¨ URL æ·»åŠ  Session id ä¿¡æ¯ åŒºåˆ«ï¼š Cookie æ•°æ®å­˜æ”¾åœ¨å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸Šï¼ŒSession æ•°æ®å­˜æ”¾åœ¨æœåŠ¡å™¨ä¸Š Session ç›¸å¯¹äº Cookie æ›´å®‰å…¨ è‹¥è€ƒè™‘å‡è½»æœåŠ¡å™¨è´Ÿæ‹…ï¼Œåº”å½“ä½¿ç”¨ Cookie HTTP å’Œ HTTPs çš„åŒºåˆ« SSL (Security Sockets Layer) å®‰å…¨å¥—æ¥å±‚ ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®® æ˜¯æ“ä½œç³»ç»Ÿå¯¹å¤–çš„ APIï¼ŒSSL 3.0 æ›´åä¸º TLS é‡‡ç”¨èº«ä»½éªŒè¯å’Œæ•°æ®åŠ å¯†æ¥ä¿è¯ç½‘ç»œçš„é€šä¿¡çš„å®‰å…¨å’Œæ•°æ®çš„å®Œæ•´æ€§ åŒºåˆ« HTTPS éœ€è¦åˆ° CA ç”³è¯·è¯ä¹¦ï¼ŒHTTP ä¸éœ€è¦ HTTPS å¯†æ–‡ä¼ è¾“ï¼ŒHTTP æ˜æ–‡ä¼ è¾“ è¿æ¥æ–¹å¼ä¸åŒï¼ŒHTTPS é»˜è®¤ä½¿ç”¨ 443 ç«¯å£ï¼ŒHTTP ä½¿ç”¨ 80 ç«¯å£ HTTPS = HTTP + åŠ å¯† + è®¤è¯ + å®Œæ•´æ€§ä¿æŠ¤ï¼Œè¾ƒ HTTP å®‰å…¨ å…¶ä»–å†…å®¹ ä¸€ ã€åŸºç¡€æ¦‚å¿µ URI è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ äºŒã€HTTP æ–¹æ³• GET HEAD POST PUT PATCH DELETE OPTIONS CONNECT TRACE ä¸‰ã€HTTP çŠ¶æ€ç  1XX ä¿¡æ¯ 2XX æˆåŠŸ 3XX é‡å®šå‘ 4XX å®¢æˆ·ç«¯é”™è¯¯ 5XX æœåŠ¡å™¨é”™è¯¯ å››ã€HTTP é¦–éƒ¨ é€šç”¨é¦–éƒ¨å­—æ®µ è¯·æ±‚é¦–éƒ¨å­—æ®µ å“åº”é¦–éƒ¨å­—æ®µ å®ä½“é¦–éƒ¨å­—æ®µ äº”ã€å…·ä½“åº”ç”¨ è¿æ¥ç®¡ç† Cookie ç¼“å­˜ å†…å®¹åå•† å†…å®¹ç¼–ç  èŒƒå›´è¯·æ±‚ åˆ†å—ä¼ è¾“ç¼–ç  å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆ è™šæ‹Ÿä¸»æœº é€šä¿¡æ•°æ®è½¬å‘ å…­ã€HTTPs åŠ å¯† è®¤è¯ å®Œæ•´æ€§ä¿æŠ¤ HTTPs çš„ç¼ºç‚¹ ä¸ƒã€HTTP/2.0 HTTP/1.x ç¼ºé™· äºŒè¿›åˆ¶åˆ†å¸§å±‚ æœåŠ¡ç«¯æ¨é€ é¦–éƒ¨å‹ç¼© å…«ã€HTTP/1.1 æ–°ç‰¹æ€§ ä¹ã€GET å’Œ POST æ¯”è¾ƒ ä½œç”¨ å‚æ•° å®‰å…¨ å¹‚ç­‰æ€§ å¯ç¼“å­˜ XMLHttpRequest æµè§ˆå™¨è¾“å…¥åœ°å€å›è½¦åå‘ç”Ÿçš„äº‹æƒ… DNSè§£æ TCPè¿æ¥ å‘é€HTTPè¯·æ±‚ æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡ æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢ è¿æ¥ç»“æŸ Socket é€šä¿¡TCP/IPï¼ˆTransmission Control Protocol/Internet Protocolï¼‰å³ä¼ è¾“æ§åˆ¶åè®®/ç½‘é—´åè®®ï¼Œæ˜¯ä¸€ä¸ªå·¥ä¸šæ ‡å‡†çš„åè®®é›†ï¼Œå®ƒæ˜¯ä¸ºå¹¿åŸŸç½‘ï¼ˆWANsï¼‰è®¾è®¡çš„ã€‚UDPï¼ˆUser Data Protocolï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰æ˜¯ä¸TCPç›¸å¯¹åº”çš„åè®®ã€‚å®ƒæ˜¯å±äº TCP/IP åè®®æ—ä¸­çš„ä¸€ç§ã€‚ è¿™é‡Œæœ‰ä¸€å¼ å›¾ï¼Œè¡¨æ˜äº†è¿™äº›åè®®çš„å…³ç³»ã€‚ TCP/IPåè®®æ—åŒ…æ‹¬è¿è¾“å±‚ã€ç½‘ç»œå±‚ã€é“¾è·¯å±‚ã€‚ç°åœ¨ä½ çŸ¥é“TCP/IPä¸UDPçš„å…³ç³»äº†å§ã€‚ Socketåœ¨å“ªé‡Œå‘¢ï¼Ÿ ä¸Šå›¾æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ° Socket çš„å½±å­ï¼Œé‚£ä¹ˆå®ƒåˆ°åº•åœ¨å“ªé‡Œå‘¢ï¼Ÿè¿˜æ˜¯ç”¨å›¾æ¥è¯´è¯ï¼Œä¸€ç›®äº†ç„¶ã€‚ Socket æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ Socket æ˜¯åº”ç”¨å±‚ä¸ TCP/IP åè®®æ—é€šä¿¡çš„ä¸­é—´è½¯ä»¶æŠ½è±¡å±‚ï¼Œå®ƒæ˜¯ä¸€ç»„æ¥å£ã€‚åœ¨è®¾è®¡æ¨¡å¼ä¸­ï¼ŒSocket å…¶å®å°±æ˜¯ä¸€ä¸ªé—¨é¢æ¨¡å¼ï¼Œå®ƒæŠŠå¤æ‚çš„ TCP/IP åè®®æ—éšè—åœ¨ Socket æ¥å£åé¢ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ï¼Œä¸€ç»„ç®€å•çš„æ¥å£å°±æ˜¯å…¨éƒ¨ï¼Œè®©Socketå»ç»„ç»‡æ•°æ®ï¼Œä»¥ç¬¦åˆæŒ‡å®šçš„åè®®ã€‚ Socket é€šä¿¡åŸç† å…ˆä»æœåŠ¡å™¨ç«¯è¯´èµ·ã€‚æœåŠ¡å™¨ç«¯å…ˆåˆå§‹åŒ–Socketï¼Œç„¶åä¸ç«¯å£ç»‘å®š(bind)ï¼Œå¯¹ç«¯å£è¿›è¡Œç›‘å¬(listen)ï¼Œè°ƒç”¨accepté˜»å¡ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚åœ¨è¿™æ—¶å¦‚æœæœ‰ä¸ªå®¢æˆ·ç«¯åˆå§‹åŒ–ä¸€ä¸ªSocketï¼Œç„¶åè¿æ¥æœåŠ¡å™¨(connect)ï¼Œå¦‚æœè¿æ¥æˆåŠŸï¼Œè¿™æ—¶å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„è¿æ¥å°±å»ºç«‹äº†ã€‚å®¢æˆ·ç«¯å‘é€æ•°æ®è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶è¯·æ±‚å¹¶å¤„ç†è¯·æ±‚ï¼Œç„¶åæŠŠå›åº”æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¯»å–æ•°æ®ï¼Œæœ€åå…³é—­è¿æ¥ï¼Œä¸€æ¬¡äº¤äº’ç»“æŸã€‚ TCP å®ç°æœåŠ¡ç«¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * @Author: cuzz * @Date: 2019/2/19 22:36 * @Description: */public class TCPServer &#123; public static void main(String[] args) throws IOException &#123; // åˆ›å»ºsocketï¼Œå¹¶å°†socketç»‘å®šåˆ°65000ç«¯å£ ServerSocket serverSocket = new ServerSocket(65000); // æ­»å¾ªç¯ï¼Œä½¿socketä¸€ç›´ç­‰å¾…å¹¶å¤„ç†å®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚ while (true) &#123; // ç›‘å¬6500ç«¯å£ï¼Œç›´åˆ°å®¢æˆ·ç«¯è¿”å›è¿æ¥ä¿¡æ¯åæ‰è¿”å› Socket socket = serverSocket.accept(); // è·å–å®¢æˆ·ç«¯è¯·æ±‚ä¿¡æ¯åï¼Œæ‰§è¡Œç›¸å…³é€»è¾‘ new LengthCalculator(socket).start(); &#125; &#125;&#125;class LengthCalculator extends Thread &#123; private Socket socket; public LengthCalculator(Socket socket) &#123; this.socket = socket; &#125; @Override public void run() &#123; try &#123; // è·å–socketçš„è¾“å‡ºæµ OutputStream os = socket.getOutputStream(); // è·å–socketçš„è¾“å…¥æµ InputStream is = socket.getInputStream(); byte[] bytes = new byte[1024]; int len = 0; StringBuilder sb = new StringBuilder(); while ((len = is.read(bytes)) != -1) &#123; os.write(bytes, 0 , len); System.out.println(new String(bytes, 0 , len)); &#125; // ä¸è¦å¿˜è®°å…³é—­è¾“å…¥è¾“å‡ºæµ os.close(); is.close(); socket.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; å®¢æœç«¯ 12345678910111213141516171819public class TCPClinet &#123; public static void main(String[] args) throws IOException &#123; // åˆ›å»ºsocketï¼Œå¹¶æŒ‡å®šè¿æ¥çš„æ˜¯ipå’Œç«¯å£å· Socket socket = new Socket("127.0.0.1", 65000); // è·å–è¾“å‡ºæµ OutputStream os = socket.getOutputStream(); // è·å–è¾“å…¥æµ InputStream is = socket.getInputStream(); os.write("hello world".getBytes()); int len = 0; byte[] bytes = new byte[1024]; len = is.read(bytes); String content = new String(bytes, 0, len); System.out.println(content); is.close(); os.close(); socket.close(); &#125;&#125; UDP å®ç°æœåŠ¡ç«¯ 12345678910111213141516171819202122public class UDPServer &#123; public static void main(String[] args) throws Exception &#123; // æœåŠ¡ç«¯æ¥å—å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æŠ¥ DatagramSocket socket = new DatagramSocket(65001); //ç›‘å¬çš„ç«¯å£å· byte[] buff = new byte[100]; //å­˜å‚¨ä»å®¢æˆ·ç«¯æ¥å—åˆ°çš„å†…å®¹ DatagramPacket packet = new DatagramPacket(buff, buff.length); //æ¥å—å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„å†…å®¹ï¼Œå¹¶å°†å†…å®¹å°è£…è¿›DatagramPacketå¯¹è±¡ä¸­ socket.receive(packet); byte[] data = packet.getData(); //ä»DatagramPacketå¯¹è±¡ä¸­è·å–åˆ°çœŸæ­£å­˜å‚¨çš„æ•°æ® //å°†æ•°æ®ä»äºŒè¿›åˆ¶è½¬æ¢æˆå­—ç¬¦ä¸²å½¢å¼ String content = new String(data, 0, packet.getLength()); System.out.println(content); //å°†è¦å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®è½¬æ¢æˆäºŒè¿›åˆ¶ byte[] sendedContent = String.valueOf(content.length()).getBytes(); // æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®æŠ¥ //ä»DatagramPacketå¯¹è±¡ä¸­è·å–åˆ°æ•°æ®çš„æ¥æºåœ°å€ä¸ç«¯å£å· DatagramPacket packetToClient = new DatagramPacket(sendedContent, sendedContent.length, packet.getAddress(), packet.getPort()); socket.send(packetToClient); //å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ &#125;&#125; å®¢æœç«¯ 1234567891011121314151617181920212223242526public class UDPClient &#123; public static void main(String[] args) throws Exception &#123; // å®¢æˆ·ç«¯å‘æ•°æ®æŠ¥ç»™æœåŠ¡ç«¯ DatagramSocket socket = new DatagramSocket(); // è¦å‘é€ç»™æœåŠ¡ç«¯çš„æ•°æ® byte[] buf = "Hello World".getBytes(); // å°†IPåœ°å€å°è£…æˆInetAddresså¯¹è±¡ InetAddress address = InetAddress.getByName("127.0.0.1"); // å°†è¦å‘é€ç»™æœåŠ¡ç«¯çš„æ•°æ®å°è£…æˆDatagramPacketå¯¹è±¡ éœ€è¦å¡«å†™ä¸Šipåœ°å€ä¸ç«¯å£å· DatagramPacket packet = new DatagramPacket(buf, buf.length, address, 65001); // å‘é€æ•°æ®ç»™æœåŠ¡ç«¯ socket.send(packet); // å®¢æˆ·ç«¯æ¥å—æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„æ•°æ®æŠ¥ byte[] data = new byte[100]; // åˆ›å»ºDatagramPacketå¯¹è±¡ç”¨æ¥å­˜å‚¨æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„æ•°æ® DatagramPacket receivedPacket = new DatagramPacket(data, data.length); // å°†æ¥å—åˆ°çš„æ•°æ®å­˜å‚¨åˆ°DatagramPacketå¯¹è±¡ä¸­ socket.receive(receivedPacket); // å°†æœåŠ¡å™¨ç«¯å‘é€è¿‡æ¥çš„æ•°æ®å–å‡ºæ¥å¹¶æ‰“å°åˆ°æ§åˆ¶å° String content = new String(receivedPacket.getData(), 0, receivedPacket.getLength()); System.out.println(content); &#125;&#125; å‚è€ƒé“¾æ¥ è®¡ç®—æœºç½‘ç»œ è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„ç»¼è¿°ï¼ˆä¸‹ï¼‰ TCP çš„é‚£äº›äº‹å„¿ TCPåè®®çš„æ»‘åŠ¨çª—å£å…·ä½“æ˜¯æ€æ ·æ§åˆ¶æµé‡çš„ï¼Ÿ Socketé€šä¿¡åŸç†]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œ</tag>
        <tag>TCP/IP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java ä¸­æ˜¯å¦‚ä½•å®ç°çº¿ç¨‹é€šä¿¡ï¼Ÿ]]></title>
    <url>%2F2019%2F02%2F14%2FJava%20%E4%B8%AD%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå­çº¿ç¨‹å®Œæˆå„è‡ªçš„ä»»åŠ¡å°±å¯ä»¥ç»“æŸäº†ã€‚ä¸è¿‡æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å¤šä¸ªçº¿ç¨‹ååŒå·¥ä½œæ¥å®ŒæˆæŸä¸ªä»»åŠ¡ï¼Œè¿™æ—¶å°±æ¶‰åŠåˆ°äº†çº¿ç¨‹é—´é€šä¿¡äº†ã€‚ æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ï¼šthread.join(), object.wait(), object.notify(), CountdownLatch, CyclicBarrier, FutureTask, Callable ç­‰ã€‚ åŸæ–‡é“¾æ¥ï¼šJava ä¸­æ˜¯å¦‚ä½•å®ç°çº¿ç¨‹é€šä¿¡ï¼Ÿ æœ¬æ–‡æ¶‰åŠä»£ç ï¼šhttps://github.com/wingjay/HelloJava/blob/master/multi-thread/src/ForArticle.java ä¸‹é¢æˆ‘ä»å‡ ä¸ªä¾‹å­ä½œä¸ºåˆ‡å…¥ç‚¹æ¥è®²è§£ä¸‹ Java é‡Œæœ‰å“ªäº›æ–¹æ³•æ¥å®ç°çº¿ç¨‹é—´é€šä¿¡ã€‚ å¦‚ä½•è®©ä¸¤ä¸ªçº¿ç¨‹ä¾æ¬¡æ‰§è¡Œï¼Ÿ é‚£å¦‚ä½•è®©ä¸¤ä¸ªçº¿ç¨‹æŒ‰ç…§æŒ‡å®šæ–¹å¼æœ‰åºäº¤å‰è¿è¡Œå‘¢ï¼Ÿ å››ä¸ªçº¿ç¨‹ A B C Dï¼Œå…¶ä¸­ D è¦ç­‰åˆ° A B C å…¨æ‰§è¡Œå®Œæ¯•åæ‰æ‰§è¡Œï¼Œè€Œä¸” A B C æ˜¯åŒæ­¥è¿è¡Œçš„ ä¸‰ä¸ªè¿åŠ¨å‘˜å„è‡ªå‡†å¤‡ï¼Œç­‰åˆ°ä¸‰ä¸ªäººéƒ½å‡†å¤‡å¥½åï¼Œå†ä¸€èµ·è·‘ å­çº¿ç¨‹å®ŒæˆæŸä»¶ä»»åŠ¡åï¼ŒæŠŠå¾—åˆ°çš„ç»“æœå›ä¼ ç»™ä¸»çº¿ç¨‹ å¦‚ä½•è®©ä¸¤ä¸ªçº¿ç¨‹ä¾æ¬¡æ‰§è¡Œï¼Ÿå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªæ˜¯çº¿ç¨‹ Aï¼Œå¦ä¸€ä¸ªæ˜¯çº¿ç¨‹ Bï¼Œä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«ä¾æ¬¡æ‰“å° 1-3 ä¸‰ä¸ªæ•°å­—å³å¯ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ä»£ç ï¼š 123456789101112131415161718private static void demo1() &#123; Thread A = new Thread(new Runnable() &#123; @Override public void run() &#123; printNumber("A"); &#125; &#125;); Thread B = new Thread(new Runnable() &#123; @Override public void run() &#123; printNumber("B"); &#125; &#125;); A.start(); B.start();&#125; å…¶ä¸­çš„ printNumber(String) å®ç°å¦‚ä¸‹ï¼Œç”¨æ¥ä¾æ¬¡æ‰“å° 1, 2, 3 ä¸‰ä¸ªæ•°å­—ï¼š 1234567891011private static void printNumber(String threadName) &#123; int i=0; while (i++ &lt; 3) &#123; try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(threadName + " print: " + i); &#125;&#125; è¿™æ—¶æˆ‘ä»¬å¾—åˆ°çš„ç»“æœæ˜¯ï¼š B print: 1A print: 1B print: 2A print: 2B print: 3A print: 3 å¯ä»¥çœ‹åˆ° A å’Œ B æ˜¯åŒæ—¶æ‰“å°çš„ã€‚ é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ› B åœ¨ A å…¨éƒ¨æ‰“å°å®Œåå†å¼€å§‹æ‰“å°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ thread.join() æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹: 12345678910111213141516171819202122232425private static void demo2() &#123; Thread A = new Thread(new Runnable() &#123; @Override public void run() &#123; printNumber("A"); &#125; &#125;); Thread B = new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println("B å¼€å§‹ç­‰å¾… A"); try &#123; A.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; printNumber("B"); &#125; &#125;); B.start(); A.start();&#125; å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š B å¼€å§‹ç­‰å¾… AA print: 1A print: 2A print: 3 B print: 1B print: 2B print: 3 A.join æŠŠæŒ‡å®šçš„çº¿ç¨‹åŠ å…¥åˆ°å½“å‰çº¿ç¨‹ï¼Œå¯ä»¥å°†ä¸¤ä¸ªäº¤æ›¿æ‰§è¡Œçš„çº¿ç¨‹åˆå¹¶ä¸ºé¡ºåºæ‰§è¡Œçš„çº¿ç¨‹ã€‚æ¯”å¦‚åœ¨çº¿ç¨‹Bä¸­è°ƒç”¨äº†çº¿ç¨‹Açš„ join() æ–¹æ³•ï¼Œç›´åˆ°çº¿ç¨‹Aæ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œçº¿ç¨‹Bã€‚ t.join(); è°ƒç”¨ join æ–¹æ³•ï¼Œç­‰å¾…çº¿ç¨‹ t æ‰§è¡Œå®Œæ¯• t.join(1000); ç­‰å¾… t çº¿ç¨‹ï¼Œç­‰å¾…æ—¶é—´æ˜¯1000æ¯«ç§’ã€‚ æ‰€ä»¥æˆ‘ä»¬èƒ½çœ‹åˆ° A.join() æ–¹æ³•ä¼šè®© B ä¸€ç›´ç­‰å¾…ç›´åˆ° A è¿è¡Œå®Œæ¯•ã€‚ é‚£å¦‚ä½•è®©ä¸¤ä¸ªçº¿ç¨‹æŒ‰ç…§æŒ‡å®šæ–¹å¼æœ‰åºäº¤å‰è¿è¡Œå‘¢ï¼Ÿè¿˜æ˜¯ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œæˆ‘ç°åœ¨å¸Œæœ› A åœ¨æ‰“å°å®Œ 1 åï¼Œå†è®© B æ‰“å° 1, 2, 3ï¼Œæœ€åå†å›åˆ° A ç»§ç»­æ‰“å° 2, 3ã€‚è¿™ç§éœ€æ±‚ä¸‹ï¼Œæ˜¾ç„¶ Thread.join() å·²ç»ä¸èƒ½æ»¡è¶³äº†ã€‚æˆ‘ä»¬éœ€è¦æ›´ç»†ç²’åº¦çš„é”æ¥æ§åˆ¶æ‰§è¡Œé¡ºåºã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ object.wait() å’Œ object.notify() ä¸¤ä¸ªæ–¹æ³•æ¥å®ç°ã€‚ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940/** * A 1, B 1, B 2, B 3, A 2, A 3 */private static void demo3() &#123; Object lock = new Object(); Thread A = new Thread(new Runnable() &#123; @Override public void run() &#123; synchronized (lock) &#123; System.out.println("A 1"); try &#123; lock.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("A 2"); System.out.println("A 3"); &#125; &#125; &#125;); Thread B = new Thread(new Runnable() &#123; @Override public void run() &#123; synchronized (lock) &#123; System.out.println("B 1"); System.out.println("B 2"); System.out.println("B 3"); lock.notify(); &#125; &#125; &#125;); A.start(); B.start();&#125; æ‰“å°ç»“æœå¦‚ä¸‹ï¼š A 1A waitingâ€¦ B 1B 2B 3A 2A 3 æ­£æ˜¯æˆ‘ä»¬è¦çš„ç»“æœã€‚ é‚£ä¹ˆï¼Œè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ é¦–å…ˆåˆ›å»ºä¸€ä¸ª A å’Œ B å…±äº«çš„å¯¹è±¡é” lock = new Object(); å½“ A å¾—åˆ°é”åï¼Œå…ˆæ‰“å° 1ï¼Œç„¶åè°ƒç”¨ lock.wait() æ–¹æ³•ï¼Œäº¤å‡ºé”çš„æ§åˆ¶æƒï¼Œè¿›å…¥ wait çŠ¶æ€ï¼› å¯¹ B è€Œè¨€ï¼Œç”±äº A æœ€å¼€å§‹å¾—åˆ°äº†é”ï¼Œå¯¼è‡´ B æ— æ³•æ‰§è¡Œï¼›ç›´åˆ° A è°ƒç”¨ lock.wait() é‡Šæ”¾æ§åˆ¶æƒåï¼Œ B æ‰å¾—åˆ°äº†é”ï¼› B åœ¨å¾—åˆ°é”åæ‰“å° 1ï¼Œ 2ï¼Œ 3ï¼›ç„¶åè°ƒç”¨ lock.notify() æ–¹æ³•ï¼Œå”¤é†’æ­£åœ¨ wait çš„ A; A è¢«å”¤é†’åï¼Œç»§ç»­æ‰“å°å‰©ä¸‹çš„ 2ï¼Œ3ã€‚ ä¸ºäº†æ›´å¥½ç†è§£ï¼Œæˆ‘åœ¨ä¸Šé¢çš„ä»£ç é‡ŒåŠ ä¸Š log æ–¹ä¾¿è¯»è€…æŸ¥çœ‹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940private static void demo3() &#123; Object lock = new Object(); Thread A = new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println("INFO: A ç­‰å¾…é” "); synchronized (lock) &#123; System.out.println("INFO: A å¾—åˆ°äº†é” lock"); System.out.println("A 1"); try &#123; System.out.println("INFO: A å‡†å¤‡è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œæ”¾å¼ƒé” lock çš„æ§åˆ¶æƒ "); lock.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("INFO: æœ‰äººå”¤é†’äº† A, A é‡æ–°è·å¾—é” lock"); System.out.println("A 2"); System.out.println("A 3"); &#125; &#125; &#125;); Thread B = new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println("INFO: B ç­‰å¾…é” "); synchronized (lock) &#123; System.out.println("INFO: B å¾—åˆ°äº†é” lock"); System.out.println("B 1"); System.out.println("B 2"); System.out.println("B 3"); System.out.println("INFO: B æ‰“å°å®Œæ¯•ï¼Œè°ƒç”¨ notify æ–¹æ³• "); lock.notify(); &#125; &#125; &#125;); A.start(); B.start();&#125; æ‰“å°ç»“æœå¦‚ä¸‹: INFO: A ç­‰å¾…é”INFO: A å¾—åˆ°äº†é” lockA 1INFO: A å‡†å¤‡è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè°ƒç”¨ lock.wait() æ”¾å¼ƒé” lock çš„æ§åˆ¶æƒINFO: B ç­‰å¾…é”INFO: B å¾—åˆ°äº†é” lockB 1B 2B 3INFO: B æ‰“å°å®Œæ¯•ï¼Œè°ƒç”¨ lock.notify() æ–¹æ³•INFO: æœ‰äººå”¤é†’äº† A, A é‡æ–°è·å¾—é” lockA 2A 3 å››ä¸ªçº¿ç¨‹ A B C Dï¼Œå…¶ä¸­ D è¦ç­‰åˆ° A B C å…¨æ‰§è¡Œå®Œæ¯•åæ‰æ‰§è¡Œï¼Œè€Œä¸” A B C æ˜¯åŒæ­¥è¿è¡Œçš„æœ€å¼€å§‹æˆ‘ä»¬ä»‹ç»äº† thread.join()ï¼Œå¯ä»¥è®©ä¸€ä¸ªçº¿ç¨‹ç­‰å¦ä¸€ä¸ªçº¿ç¨‹è¿è¡Œå®Œæ¯•åå†ç»§ç»­æ‰§è¡Œï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨ D çº¿ç¨‹é‡Œä¾æ¬¡ join A B Cï¼Œä¸è¿‡è¿™ä¹Ÿå°±ä½¿å¾— A B C å¿…é¡»ä¾æ¬¡æ‰§è¡Œï¼Œè€Œæˆ‘ä»¬è¦çš„æ˜¯è¿™ä¸‰è€…èƒ½åŒæ­¥è¿è¡Œã€‚ æˆ–è€…è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›è¾¾åˆ°çš„ç›®çš„æ˜¯ï¼šA B C ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå„è‡ªç‹¬ç«‹è¿è¡Œå®Œåé€šçŸ¥ Dï¼›å¯¹ D è€Œè¨€ï¼Œåªè¦ A B C éƒ½è¿è¡Œå®Œäº†ï¼ŒD å†å¼€å§‹è¿è¡Œã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ CountdownLatch æ¥å®ç°è¿™ç±»é€šä¿¡æ–¹å¼ã€‚å®ƒçš„åŸºæœ¬ç”¨æ³•æ˜¯ï¼š åˆ›å»ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œè®¾ç½®åˆå§‹å€¼ï¼ŒCountdownLatch countDownLatch = new CountDownLatch(2); åœ¨ ç­‰å¾…çº¿ç¨‹é‡Œè°ƒç”¨ countDownLatch.await() æ–¹æ³•ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°è®¡æ•°å€¼å˜æˆ 0ï¼› åœ¨ å…¶ä»–çº¿ç¨‹é‡Œï¼Œè°ƒç”¨ countDownLatch.countDown() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°†è®¡æ•°å€¼å‡å° 1ï¼› å½“ å…¶ä»–çº¿ç¨‹çš„ countDown() æ–¹æ³•æŠŠè®¡æ•°å€¼å˜æˆ 0 æ—¶ï¼Œç­‰å¾…çº¿ç¨‹ é‡Œçš„ countDownLatch.await() ç«‹å³é€€å‡ºï¼Œç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚ å®ç°ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536private static void runDAfterABC() &#123; int worker = 3; CountDownLatch countDownLatch = new CountDownLatch(worker); new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println("D is waiting for other three threads"); try &#123; countDownLatch.await(); System.out.println("All done, D starts working"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); for (char threadName='A'; threadName &lt;= 'C'; threadName++) &#123; final String tN = String.valueOf(threadName); new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(tN + " is working"); try &#123; Thread.sleep(100); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; System.out.println(tN + " finished"); countDownLatch.countDown(); &#125; &#125;).start(); &#125;&#125; ä¸‹é¢æ˜¯è¿è¡Œç»“æœï¼š D is waiting for other three threadsA is workingB is workingC is working A finishedC finishedB finishedAll done, D starts working å…¶å®ç®€å•ç‚¹æ¥è¯´ï¼ŒCountDownLatch å°±æ˜¯ä¸€ä¸ªå€’è®¡æ•°å™¨ï¼Œæˆ‘ä»¬æŠŠåˆå§‹è®¡æ•°å€¼è®¾ç½®ä¸º3ï¼Œå½“ D è¿è¡Œæ—¶ï¼Œå…ˆè°ƒç”¨ countDownLatch.await() æ£€æŸ¥è®¡æ•°å™¨å€¼æ˜¯å¦ä¸º 0ï¼Œè‹¥ä¸ä¸º 0 åˆ™ä¿æŒç­‰å¾…çŠ¶æ€ï¼›å½“A B C å„è‡ªè¿è¡Œå®Œåéƒ½ä¼šåˆ©ç”¨countDownLatch.countDown()ï¼Œå°†å€’è®¡æ•°å™¨å‡ 1ï¼Œå½“ä¸‰ä¸ªéƒ½è¿è¡Œå®Œåï¼Œè®¡æ•°å™¨è¢«å‡è‡³ 0ï¼›æ­¤æ—¶ç«‹å³è§¦å‘ Dçš„ await() è¿è¡Œç»“æŸï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ å› æ­¤ï¼ŒCountDownLatch é€‚ç”¨äºä¸€ä¸ªçº¿ç¨‹å»ç­‰å¾…å¤šä¸ªçº¿ç¨‹çš„æƒ…å†µã€‚ ä¸‰ä¸ªè¿åŠ¨å‘˜å„è‡ªå‡†å¤‡ï¼Œç­‰åˆ°ä¸‰ä¸ªäººéƒ½å‡†å¤‡å¥½åï¼Œå†ä¸€èµ·è·‘ä¸Šé¢æ˜¯ä¸€ä¸ªå½¢è±¡çš„æ¯”å–»ï¼Œé’ˆå¯¹ çº¿ç¨‹ A B C å„è‡ªå¼€å§‹å‡†å¤‡ï¼Œç›´åˆ°ä¸‰è€…éƒ½å‡†å¤‡å®Œæ¯•ï¼Œç„¶åå†åŒæ—¶è¿è¡Œã€‚ä¹Ÿå°±æ˜¯è¦å®ç°ä¸€ç§çº¿ç¨‹ä¹‹é—´äº’ç›¸ç­‰å¾…çš„æ•ˆæœï¼Œé‚£åº”è¯¥æ€ä¹ˆæ¥å®ç°å‘¢ï¼Ÿ ä¸Šé¢çš„ CountDownLatch å¯ä»¥ç”¨æ¥å€’è®¡æ•°ï¼Œä½†å½“è®¡æ•°å®Œæ¯•ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„ await() ä¼šå¾—åˆ°å“åº”ï¼Œæ— æ³•è®©å¤šä¸ªçº¿ç¨‹åŒæ—¶è§¦å‘ã€‚ ä¸ºäº†å®ç°çº¿ç¨‹é—´äº’ç›¸ç­‰å¾…è¿™ç§éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ CyclicBarrier æ•°æ®ç»“æ„ï¼Œå®ƒçš„åŸºæœ¬ç”¨æ³•æ˜¯ï¼š å…ˆåˆ›å»ºä¸€ä¸ªå…¬å…± CyclicBarrier å¯¹è±¡ï¼Œè®¾ç½® åŒæ—¶ç­‰å¾…çš„çº¿ç¨‹æ•°ï¼ŒCyclicBarrier cyclicBarrier = new CyclicBarrier(3); è¿™äº›çº¿ç¨‹åŒæ—¶å¼€å§‹è‡ªå·±åšå‡†å¤‡ï¼Œè‡ªèº«å‡†å¤‡å®Œæ¯•åï¼Œéœ€è¦ç­‰å¾…åˆ«äººå‡†å¤‡å®Œæ¯•ï¼Œè¿™æ—¶è°ƒç”¨ cyclicBarrier.await(); å³å¯å¼€å§‹ç­‰å¾…åˆ«äººï¼› å½“æŒ‡å®šçš„ åŒæ—¶ç­‰å¾…çš„çº¿ç¨‹æ•°éƒ½è°ƒç”¨äº† cyclicBarrier.await();æ—¶ï¼Œæ„å‘³ç€è¿™äº›çº¿ç¨‹éƒ½å‡†å¤‡å®Œæ¯•å¥½ï¼Œç„¶åè¿™äº›çº¿ç¨‹æ‰ åŒæ—¶ç»§ç»­æ‰§è¡Œã€‚ å®ç°ä»£ç å¦‚ä¸‹ï¼Œè®¾æƒ³æœ‰ä¸‰ä¸ªè·‘æ­¥è¿åŠ¨å‘˜ï¼Œå„è‡ªå‡†å¤‡å¥½åç­‰å¾…å…¶ä»–äººï¼Œå…¨éƒ¨å‡†å¤‡å¥½åæ‰å¼€å§‹è·‘ï¼š 1234567891011121314151617181920212223242526272829303132private static void runABCWhenAllReady() &#123; int runner = 3; CyclicBarrier cyclicBarrier = new CyclicBarrier(runner); final Random random = new Random(); for (char runnerName='A'; runnerName &lt;= 'C'; runnerName++) &#123; final String rN = String.valueOf(runnerName); new Thread(new Runnable() &#123; @Override public void run() &#123; long prepareTime = random.nextInt(10000) + 100; System.out.println(rN + " is preparing for time: " + prepareTime); try &#123; Thread.sleep(prepareTime); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; try &#123; System.out.println(rN + " is prepared, waiting for others"); cyclicBarrier.await(); // å½“å‰è¿åŠ¨å‘˜å‡†å¤‡å®Œæ¯•ï¼Œç­‰å¾…åˆ«äººå‡†å¤‡å¥½ &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (BrokenBarrierException e) &#123; e.printStackTrace(); &#125; System.out.println(rN + " starts running"); // æ‰€æœ‰è¿åŠ¨å‘˜éƒ½å‡†å¤‡å¥½äº†ï¼Œä¸€èµ·å¼€å§‹è·‘ &#125; &#125;).start(); &#125;&#125; æ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š A is preparing for time: 4131B is preparing for time: 6349C is preparing for time: 8206 A is prepared, waiting for others B is prepared, waiting for others C is prepared, waiting for others C starts runningA starts runningB starts running å­çº¿ç¨‹å®ŒæˆæŸä»¶ä»»åŠ¡åï¼ŒæŠŠå¾—åˆ°çš„ç»“æœå›ä¼ ç»™ä¸»çº¿ç¨‹å®é™…çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸è¦åˆ›å»ºå­çº¿ç¨‹æ¥åšä¸€äº›è€—æ—¶ä»»åŠ¡ï¼Œç„¶åæŠŠä»»åŠ¡æ‰§è¡Œç»“æœå›ä¼ ç»™ä¸»çº¿ç¨‹ä½¿ç”¨ï¼Œè¿™ç§æƒ…å†µåœ¨ Java é‡Œè¦å¦‚ä½•å®ç°å‘¢ï¼Ÿ å›é¡¾çº¿ç¨‹çš„åˆ›å»ºï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠ Runnable å¯¹è±¡ä¼ ç»™ Thread å»æ‰§è¡Œã€‚Runnableå®šä¹‰å¦‚ä¸‹ï¼š 123public interface Runnable &#123; public abstract void run();&#125; å¯ä»¥çœ‹åˆ° run() åœ¨æ‰§è¡Œå®Œåä¸ä¼šè¿”å›ä»»ä½•ç»“æœã€‚é‚£å¦‚æœå¸Œæœ›è¿”å›ç»“æœå‘¢ï¼Ÿè¿™é‡Œå¯ä»¥åˆ©ç”¨å¦ä¸€ä¸ªç±»ä¼¼çš„æ¥å£ç±» Callableï¼š 12345678910@FunctionalInterfacepublic interface Callable&lt;V&gt; &#123; /** * Computes a result, or throws an exception if unable to do so. * * @return computed result * @throws Exception if unable to compute a result */ V call() throws Exception;&#125; å¯ä»¥çœ‹å‡º Callable æœ€å¤§åŒºåˆ«å°±æ˜¯è¿”å›èŒƒå‹ V ç»“æœã€‚ é‚£ä¹ˆä¸‹ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚ä½•æŠŠå­çº¿ç¨‹çš„ç»“æœå›ä¼ å›æ¥å‘¢ï¼Ÿåœ¨ Java é‡Œï¼Œæœ‰ä¸€ä¸ªç±»æ˜¯é…åˆ Callable ä½¿ç”¨çš„ï¼šFutureTaskï¼Œä¸è¿‡æ³¨æ„ï¼Œå®ƒè·å–ç»“æœçš„ get æ–¹æ³•ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚ ä¸¾ä¾‹ï¼Œæˆ‘ä»¬æƒ³è®©å­çº¿ç¨‹å»è®¡ç®—ä» 1 åŠ åˆ° 100ï¼Œå¹¶æŠŠç®—å‡ºçš„ç»“æœè¿”å›åˆ°ä¸»çº¿ç¨‹ã€‚ 1234567891011121314151617181920212223242526272829private static void doTaskWithResultInWorker() &#123; Callable&lt;Integer&gt; callable = new Callable&lt;Integer&gt;() &#123; @Override public Integer call() throws Exception &#123; System.out.println("Task starts"); Thread.sleep(1000); int result = 0; for (int i=0; i&lt;=100; i++) &#123; result += i; &#125; System.out.println("Task finished and return result"); return result; &#125; &#125;; FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;&gt;(callable); new Thread(futureTask).start(); try &#123; System.out.println("Before futureTask.get()"); System.out.println("Result: " + futureTask.get()); System.out.println("After futureTask.get()"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125;&#125; æ‰“å°ç»“æœå¦‚ä¸‹ï¼š Before futureTask.get() Task startsTask finished and return result Result: 5050After futureTask.get() å¯ä»¥çœ‹åˆ°ï¼Œä¸»çº¿ç¨‹è°ƒç”¨ futureTask.get() æ–¹æ³•æ—¶é˜»å¡ä¸»çº¿ç¨‹ï¼›ç„¶å Callable å†…éƒ¨å¼€å§‹æ‰§è¡Œï¼Œå¹¶è¿”å›è¿ç®—ç»“æœï¼›æ­¤æ—¶ futureTask.get() å¾—åˆ°ç»“æœï¼Œä¸»çº¿ç¨‹æ¢å¤è¿è¡Œã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥å­¦åˆ°ï¼Œé€šè¿‡ FutureTask å’Œ Callable å¯ä»¥ç›´æ¥åœ¨ä¸»çº¿ç¨‹è·å¾—å­çº¿ç¨‹çš„è¿ç®—ç»“æœï¼Œåªä¸è¿‡éœ€è¦é˜»å¡ä¸»çº¿ç¨‹ã€‚å½“ç„¶ï¼Œå¦‚æœä¸å¸Œæœ›é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯ä»¥è€ƒè™‘åˆ©ç”¨ ExecutorServiceï¼ŒæŠŠ FutureTask æ”¾åˆ°çº¿ç¨‹æ± å»ç®¡ç†æ‰§è¡Œã€‚ å°ç»“å¤šçº¿ç¨‹æ˜¯ç°ä»£è¯­è¨€çš„å…±åŒç‰¹æ€§ï¼Œè€Œçº¿ç¨‹é—´é€šä¿¡ã€çº¿ç¨‹åŒæ­¥ã€çº¿ç¨‹å®‰å…¨æ˜¯å¾ˆé‡è¦çš„è¯é¢˜ã€‚æœ¬æ–‡é’ˆå¯¹ Java çš„çº¿ç¨‹é—´é€šä¿¡è¿›è¡Œäº†å¤§è‡´çš„è®²è§£ï¼Œåç»­è¿˜ä¼šå¯¹çº¿ç¨‹åŒæ­¥ã€çº¿ç¨‹å®‰å…¨è¿›è¡Œè®²è§£ã€‚]]></content>
      <categories>
        <category>Java åŸºç¡€</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>çº¿ç¨‹é€šä¿¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java ä¸­çš„é”]]></title>
    <url>%2F2019%2F02%2F13%2FJava%20%E4%B8%AD%E7%9A%84%E9%94%81%2F</url>
    <content type="text"><![CDATA[Javaä¸­çš„é”åˆ†ç±»åœ¨è¯»å¾ˆå¤šå¹¶å‘æ–‡ç« ä¸­ï¼Œä¼šæåŠå„ç§å„æ ·é”å¦‚å…¬å¹³é”ï¼Œä¹è§‚é”ç­‰ç­‰ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»å„ç§é”çš„åˆ†ç±»ã€‚ä»‹ç»çš„å†…å®¹å¦‚ä¸‹ï¼š å…¬å¹³é”/éå…¬å¹³é” å¯é‡å…¥é” ç‹¬äº«é”/å…±äº«é” äº’æ–¥é”/è¯»å†™é” ä¹è§‚é”/æ‚²è§‚é” åˆ†æ®µé” åå‘é”/è½»é‡çº§é”/é‡é‡çº§é” è‡ªæ—‹é” ä¸Šé¢æ˜¯å¾ˆå¤šé”çš„åè¯ï¼Œè¿™äº›åˆ†ç±»å¹¶ä¸æ˜¯å…¨æ˜¯æŒ‡é”çš„çŠ¶æ€ï¼Œæœ‰çš„æŒ‡é”çš„ç‰¹æ€§ï¼Œæœ‰çš„æŒ‡é”çš„è®¾è®¡ï¼Œä¸‹é¢æ€»ç»“çš„å†…å®¹æ˜¯å¯¹æ¯ä¸ªé”çš„åè¯è¿›è¡Œä¸€å®šçš„è§£é‡Šã€‚ å…¬å¹³é”/éå…¬å¹³é”å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ã€‚éå…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚æœ‰å¯èƒ½ï¼Œä¼šé€ æˆä¼˜å…ˆçº§åè½¬æˆ–è€…é¥¥é¥¿ç°è±¡ã€‚å¯¹äºJava ReentrantLockè€Œè¨€ï¼Œé€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šè¯¥é”æ˜¯å¦æ˜¯å…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹åœ¨äºååé‡æ¯”å…¬å¹³é”å¤§ã€‚å¯¹äºSynchronizedè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§éå…¬å¹³é”ã€‚ç”±äºå…¶å¹¶ä¸åƒReentrantLockæ˜¯é€šè¿‡AQSçš„æ¥å®ç°çº¿ç¨‹è°ƒåº¦ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä»»ä½•åŠæ³•ä½¿å…¶å˜æˆå…¬å¹³é”ã€‚ å¯é‡å…¥é”/ä¸å¯é‡å…¥é”æœ€è¿‘æ­£åœ¨é˜…è¯»Java ReentrantLockæºç ï¼Œå§‹ç»ˆå¯¹å¯é‡å…¥å’Œä¸å¯é‡å…¥æ¦‚å¿µç†è§£ä¸é€å½»ï¼Œè¿›è¡Œå­¦ä¹ åè®°å½•åœ¨è¿™é‡Œã€‚ åŸºç¡€çŸ¥è¯†Javaå¤šçº¿ç¨‹çš„ wait() æ–¹æ³•å’Œ notify() æ–¹æ³•ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯æˆå¯¹å‡ºç°å’Œä½¿ç”¨çš„ï¼Œè¦æ‰§è¡Œè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæœ‰ä¸€ä¸ªå‰æå°±æ˜¯ï¼Œå½“å‰çº¿ç¨‹å¿…é¡»è·å…¶å¯¹è±¡çš„monitorï¼ˆä¿—ç§°â€œé”â€ï¼‰ï¼Œå¦åˆ™ä¼šæŠ›å‡º IllegalMonitorStateException å¼‚å¸¸ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ–¹æ³•å¿…é¡»åœ¨åŒæ­¥å—ä»£ç é‡Œé¢è°ƒç”¨ã€‚ wait()ï¼šé˜»å¡å½“å‰çº¿ç¨‹ notify()ï¼šå”¤èµ·è¢«wait()é˜»å¡çš„çº¿ç¨‹ ä¸å¯é‡å…¥é”æ‰€è°“ä¸å¯é‡å…¥é”ï¼Œå³è‹¥å½“å‰çº¿ç¨‹æ‰§è¡ŒæŸä¸ªæ–¹æ³•å·²ç»è·å–äº†è¯¥é”ï¼Œé‚£ä¹ˆåœ¨æ–¹æ³•ä¸­å°è¯•å†æ¬¡è·å–é”æ—¶ï¼Œå°±ä¼šè·å–ä¸åˆ°è¢«é˜»å¡ã€‚æˆ‘ä»¬å°è¯•è®¾è®¡ä¸€ä¸ªä¸å¯é‡å…¥é”ï¼š 12345678910111213public class Lock&#123; private boolean isLocked = false; public synchronized void lock() throws InterruptedException &#123; while(isLocked)&#123; wait(); &#125; isLocked = true; &#125; public synchronized void unlock()&#123; isLocked = false; notify(); &#125;&#125; ä½¿ç”¨è¯¥é”ï¼š 12345678910111213public class Count&#123; Lock lock = new Lock(); public void print()&#123; lock.lock(); doAdd(); lock.unlock(); &#125; public void doAdd()&#123; lock.lock(); //do something lock.unlock(); &#125;&#125; å½“å‰çº¿ç¨‹æ‰§è¡Œprint()æ–¹æ³•é¦–å…ˆè·å–lockï¼Œæ¥ä¸‹æ¥æ‰§è¡ŒdoAdd()æ–¹æ³•å°±æ— æ³•æ‰§è¡ŒdoAdd()ä¸­çš„é€»è¾‘ï¼Œå¿…é¡»å…ˆé‡Šæ”¾é”ã€‚è¿™ä¸ªä¾‹å­å¾ˆå¥½çš„è¯´æ˜äº†ä¸å¯é‡å…¥é”ã€‚ å¯é‡å…¥é”æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ç§å¯é‡å…¥é” 123456789101112131415161718192021222324public class Lock&#123; boolean isLocked = false; Thread lockedBy = null; int lockedCount = 0; public synchronized void lock() throws InterruptedException&#123; Thread thread = Thread.currentThread(); while(isLocked &amp;&amp; lockedBy != thread)&#123; wait(); &#125; isLocked = true; lockedCount++; lockedBy = thread; &#125; public synchronized void unlock()&#123; if(Thread.currentThread() == this.lockedBy)&#123; lockedCount--; if(lockedCount == 0)&#123; isLocked = false; notify(); &#125; &#125; &#125;&#125; æ‰€è°“å¯é‡å…¥ï¼Œæ„å‘³ç€çº¿ç¨‹å¯ä»¥è¿›å…¥å®ƒå·²ç»æ‹¥æœ‰çš„é”çš„åŒæ­¥ä»£ç å—å„¿ã€‚ æˆ‘ä»¬è®¾è®¡ä¸¤ä¸ªçº¿ç¨‹è°ƒç”¨ print() æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ print() æ–¹æ³•è·å–é”ï¼Œè¿›å…¥ lock() æ–¹æ³•ï¼Œç”±äºåˆå§‹ lockedBy æ˜¯ nullï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ while è€ŒæŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œè€Œæ˜¯æ˜¯å¢é‡ lockedCount å¹¶è®°å½• lockBy ä¸ºç¬¬ä¸€ä¸ªçº¿ç¨‹ã€‚æ¥ç€ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ doAdd() æ–¹æ³•ï¼Œç”±äºåŒä¸€è¿›ç¨‹ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ while è€ŒæŒ‚èµ·ï¼Œæ¥ç€å¢é‡ lockedCountï¼Œå½“ç¬¬äºŒä¸ªçº¿ç¨‹å°è¯•lockï¼Œç”±äº isLocked=trueï¼Œæ‰€ä»¥ä»–ä¸ä¼šè·å–è¯¥é”ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ä¸¤æ¬¡ unlock() å°† lockCount é€’å‡ä¸º0ï¼Œæ‰å°†æ ‡è®°ä¸º isLocked è®¾ç½®ä¸º falseã€‚ å¯é‡å…¥é”çš„æ¦‚å¿µå’Œè®¾è®¡æ€æƒ³å¤§ä½“å¦‚æ­¤ï¼ŒJava ä¸­çš„å¯é‡å…¥é” ReentrantLock è®¾è®¡æ€è·¯ä¹Ÿæ˜¯è¿™æ ·ã€‚ ç‹¬äº«é”/å…±äº«é”ç‹¬äº«é”æ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å…±äº«é”æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚ å¯¹äºJava ReentrantLockè€Œè¨€ï¼Œå…¶æ˜¯ç‹¬äº«é”ã€‚ä½†æ˜¯å¯¹äºLockçš„å¦ä¸€ä¸ªå®ç°ç±»ReadWriteLockï¼Œå…¶è¯»é”æ˜¯å…±äº«é”ï¼Œå…¶å†™é”æ˜¯ç‹¬äº«é”ã€‚ è¯»é”çš„å…±äº«é”å¯ä¿è¯å¹¶å‘è¯»æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œè¯»å†™ï¼Œå†™è¯» ï¼Œå†™å†™çš„è¿‡ç¨‹æ˜¯äº’æ–¥çš„ã€‚ ç‹¬äº«é”ä¸å…±äº«é”ä¹Ÿæ˜¯é€šè¿‡AQSæ¥å®ç°çš„ï¼Œé€šè¿‡å®ç°ä¸åŒçš„æ–¹æ³•ï¼Œæ¥å®ç°ç‹¬äº«æˆ–è€…å…±äº«ã€‚ å¯¹äºSynchronizedè€Œè¨€ï¼Œå½“ç„¶æ˜¯ç‹¬äº«é”ã€‚ äº’æ–¥é”/è¯»å†™é”ä¸Šé¢è®²çš„ç‹¬äº«é”/å…±äº«é”å°±æ˜¯ä¸€ç§å¹¿ä¹‰çš„è¯´æ³•ï¼Œäº’æ–¥é”/è¯»å†™é”å°±æ˜¯å…·ä½“çš„å®ç°ã€‚ äº’æ–¥é”åœ¨Javaä¸­çš„å…·ä½“å®ç°å°±æ˜¯ReentrantLock è¯»å†™é”åœ¨Javaä¸­çš„å…·ä½“å®ç°å°±æ˜¯ReadWriteLock ä¹è§‚é”/æ‚²è§‚é”ä¹è§‚é”ä¸æ‚²è§‚é”ä¸æ˜¯æŒ‡å…·ä½“çš„ä»€ä¹ˆç±»å‹çš„é”ï¼Œè€Œæ˜¯æŒ‡çœ‹å¾…å¹¶å‘åŒæ­¥çš„è§’åº¦ã€‚æ‚²è§‚é”è®¤ä¸ºå¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œä¸€å®šæ˜¯ä¼šå‘ç”Ÿä¿®æ”¹çš„ï¼Œå“ªæ€•æ²¡æœ‰ä¿®æ”¹ï¼Œä¹Ÿä¼šè®¤ä¸ºä¿®æ”¹ã€‚å› æ­¤å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ‚²è§‚é”é‡‡å–åŠ é”çš„å½¢å¼ã€‚æ‚²è§‚çš„è®¤ä¸ºï¼Œä¸åŠ é”çš„å¹¶å‘æ“ä½œä¸€å®šä¼šå‡ºé—®é¢˜ã€‚ä¹è§‚é”åˆ™è®¤ä¸ºå¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ˜¯ä¸ä¼šå‘ç”Ÿä¿®æ”¹çš„ã€‚åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¼šé‡‡ç”¨å°è¯•æ›´æ–°ï¼Œä¸æ–­é‡æ–°çš„æ–¹å¼æ›´æ–°æ•°æ®ã€‚ä¹è§‚çš„è®¤ä¸ºï¼Œä¸åŠ é”çš„å¹¶å‘æ“ä½œæ˜¯æ²¡æœ‰äº‹æƒ…çš„ã€‚ ä»ä¸Šé¢çš„æè¿°æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ‚²è§‚é”é€‚åˆå†™æ“ä½œéå¸¸å¤šçš„åœºæ™¯ï¼Œä¹è§‚é”é€‚åˆè¯»æ“ä½œéå¸¸å¤šçš„åœºæ™¯ï¼Œä¸åŠ é”ä¼šå¸¦æ¥å¤§é‡çš„æ€§èƒ½æå‡ã€‚ æ‚²è§‚é”åœ¨Javaä¸­çš„ä½¿ç”¨ï¼Œå°±æ˜¯åˆ©ç”¨å„ç§é”ã€‚ ä¹è§‚é”åœ¨Javaä¸­çš„ä½¿ç”¨ï¼Œæ˜¯æ— é”ç¼–ç¨‹ï¼Œå¸¸å¸¸é‡‡ç”¨çš„æ˜¯CASç®—æ³•ï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯åŸå­ç±»ï¼Œé€šè¿‡CASè‡ªæ—‹å®ç°åŸå­æ“ä½œçš„æ›´æ–°ã€‚ åˆ†æ®µé”åˆ†æ®µé”å…¶å®æ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ï¼Œå¯¹äºConcurrentHashMap è€Œè¨€ï¼Œå…¶å¹¶å‘çš„å®ç°å°±æ˜¯é€šè¿‡åˆ†æ®µé”çš„å½¢å¼æ¥å®ç°é«˜æ•ˆçš„å¹¶å‘æ“ä½œã€‚ æˆ‘ä»¬ä»¥ConcurrentHashMapæ¥è¯´ä¸€ä¸‹åˆ†æ®µé”çš„å«ä¹‰ä»¥åŠè®¾è®¡æ€æƒ³ï¼ŒConcurrentHashMapä¸­çš„åˆ†æ®µé”ç§°ä¸ºSegmentï¼Œå®ƒå³ç±»ä¼¼äºHashMapï¼ˆJDK7ä¸JDK8ä¸­HashMapçš„å®ç°ï¼‰çš„ç»“æ„ï¼Œå³å†…éƒ¨æ‹¥æœ‰ä¸€ä¸ªEntryæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼›åŒæ—¶åˆæ˜¯ä¸€ä¸ªReentrantLockï¼ˆSegmentç»§æ‰¿äº†ReentrantLock)ã€‚å½“éœ€è¦putå…ƒç´ çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å¯¹æ•´ä¸ªhashmapè¿›è¡ŒåŠ é”ï¼Œè€Œæ˜¯å…ˆé€šè¿‡ hashcode æ¥çŸ¥é“ä»–è¦æ”¾åœ¨é‚£ä¸€ä¸ªåˆ†æ®µä¸­ï¼Œç„¶åå¯¹è¿™ä¸ªåˆ†æ®µè¿›è¡ŒåŠ é”ï¼Œæ‰€ä»¥å½“å¤šçº¿ç¨‹putçš„æ—¶å€™ï¼Œåªè¦ä¸æ˜¯æ”¾åœ¨ä¸€ä¸ªåˆ†æ®µä¸­ï¼Œå°±å®ç°äº†çœŸæ­£çš„å¹¶è¡Œçš„æ’å…¥ã€‚ä½†æ˜¯ï¼Œåœ¨ç»Ÿè®¡sizeçš„æ—¶å€™ï¼Œå¯å°±æ˜¯è·å– hashmap å…¨å±€ä¿¡æ¯çš„æ—¶å€™ï¼Œå°±éœ€è¦è·å–æ‰€æœ‰çš„åˆ†æ®µé”æ‰èƒ½ç»Ÿè®¡ã€‚åˆ†æ®µé”çš„è®¾è®¡ç›®çš„æ˜¯ç»†åŒ–é”çš„ç²’åº¦ï¼Œå½“æ“ä½œä¸éœ€è¦æ›´æ–°æ•´ä¸ªæ•°ç»„çš„æ—¶å€™ï¼Œå°±ä»…ä»…é’ˆå¯¹æ•°ç»„ä¸­çš„ä¸€é¡¹è¿›è¡ŒåŠ é”æ“ä½œã€‚ åå‘é”/è½»é‡çº§é”/é‡é‡çº§é”åå‘é”åœ¨æ²¡æœ‰å®é™…ç«äº‰çš„æƒ…å†µä¸‹ï¼Œè¿˜èƒ½å¤Ÿé’ˆå¯¹éƒ¨åˆ†åœºæ™¯ç»§ç»­ä¼˜åŒ–ã€‚å¦‚æœä¸ä»…ä»…æ²¡æœ‰å®é™…ç«äº‰ï¼Œè‡ªå§‹è‡³ç»ˆï¼Œä½¿ç”¨é”çš„çº¿ç¨‹éƒ½åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆï¼Œç»´æŠ¤è½»é‡çº§é”éƒ½æ˜¯æµªè´¹çš„ã€‚åå‘é”çš„ç›®æ ‡æ˜¯ï¼Œå‡å°‘æ— ç«äº‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨é”çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨è½»é‡çº§é”äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ã€‚è½»é‡çº§é”æ¯æ¬¡ç”³è¯·ã€é‡Šæ”¾é”éƒ½è‡³å°‘éœ€è¦ä¸€æ¬¡CASï¼Œä½†åå‘é”åªæœ‰åˆå§‹åŒ–æ—¶éœ€è¦ä¸€æ¬¡CASã€‚ â€œåå‘â€çš„æ„æ€æ˜¯ï¼Œåå‘é”å‡å®šå°†æ¥åªæœ‰ç¬¬ä¸€ä¸ªç”³è¯·é”çš„çº¿ç¨‹ä¼šä½¿ç”¨é”ï¼ˆä¸ä¼šæœ‰ä»»ä½•çº¿ç¨‹å†æ¥ç”³è¯·é”ï¼‰ï¼Œå› æ­¤ï¼Œåªéœ€è¦åœ¨Mark Wordä¸­ CAS è®°å½•ownerï¼ˆæœ¬è´¨ä¸Šä¹Ÿæ˜¯æ›´æ–°ï¼Œä½†åˆå§‹å€¼ä¸ºç©ºï¼‰ï¼Œå¦‚æœè®°å½•æˆåŠŸï¼Œåˆ™åå‘é”è·å–æˆåŠŸï¼Œè®°å½•é”çŠ¶æ€ä¸ºåå‘é”ï¼Œä»¥åå½“å‰çº¿ç¨‹ç­‰äºownerå°±å¯ä»¥é›¶æˆæœ¬çš„ç›´æ¥è·å¾—é”ï¼›å¦åˆ™ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œè†¨èƒ€ä¸ºè½»é‡çº§é”ã€‚ åå‘é”æ— æ³•ä½¿ç”¨è‡ªæ—‹é”ä¼˜åŒ–ï¼Œå› ä¸ºä¸€æ—¦æœ‰å…¶ä»–çº¿ç¨‹ç”³è¯·é”ï¼Œå°±ç ´åäº†åå‘é”çš„å‡å®šã€‚ ç¼ºç‚¹ï¼š åŒæ ·çš„ï¼Œå¦‚æœæ˜æ˜¾å­˜åœ¨å…¶ä»–çº¿ç¨‹ç”³è¯·é”ï¼Œé‚£ä¹ˆåå‘é”å°†å¾ˆå¿«è†¨èƒ€ä¸ºè½»é‡çº§é”ã€‚ ä¸è¿‡è¿™ä¸ªå‰¯ä½œç”¨å·²ç»å°çš„å¤šã€‚ å¦‚æœéœ€è¦ï¼Œä½¿ç”¨å‚æ•°-XX:-UseBiasedLockingç¦æ­¢åå‘é”ä¼˜åŒ–ï¼ˆé»˜è®¤æ‰“å¼€ï¼‰ã€‚ è½»é‡çº§é”è‡ªæ—‹é”çš„ç›®æ ‡æ˜¯é™ä½çº¿ç¨‹åˆ‡æ¢çš„æˆæœ¬ã€‚å¦‚æœé”ç«äº‰æ¿€çƒˆï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä¾èµ–äºé‡é‡çº§é”ï¼Œè®©ç«äº‰å¤±è´¥çš„çº¿ç¨‹é˜»å¡ï¼›å¦‚æœå®Œå…¨æ²¡æœ‰å®é™…çš„é”ç«äº‰ï¼Œé‚£ä¹ˆç”³è¯·é‡é‡çº§é”éƒ½æ˜¯æµªè´¹çš„ã€‚è½»é‡çº§é”çš„ç›®æ ‡æ˜¯ï¼Œå‡å°‘æ— å®é™…ç«äº‰æƒ…å†µä¸‹ï¼Œä½¿ç”¨é‡é‡çº§é”äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ï¼ŒåŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨å¼•èµ·çš„å†…æ ¸æ€ä¸ç”¨æˆ·æ€åˆ‡æ¢ã€çº¿ç¨‹é˜»å¡é€ æˆçš„çº¿ç¨‹åˆ‡æ¢ç­‰ã€‚ é¡¾åæ€ä¹‰ï¼Œè½»é‡çº§é”æ˜¯ç›¸å¯¹äºé‡é‡çº§é”è€Œè¨€çš„ã€‚ä½¿ç”¨è½»é‡çº§é”æ—¶ï¼Œä¸éœ€è¦ç”³è¯·äº’æ–¥é‡ï¼Œä»…ä»…å°† Mark Word ä¸­çš„éƒ¨åˆ†å­—èŠ‚CASæ›´æ–°æŒ‡å‘çº¿ç¨‹æ ˆä¸­çš„Lock Recordï¼Œå¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™è½»é‡çº§é”è·å–æˆåŠŸï¼Œè®°å½•é”çŠ¶æ€ä¸ºè½»é‡çº§é”ï¼›å¦åˆ™ï¼Œè¯´æ˜å·²ç»æœ‰çº¿ç¨‹è·å¾—äº†è½»é‡çº§é”ï¼Œç›®å‰å‘ç”Ÿäº†é”ç«äº‰ï¼ˆä¸é€‚åˆç»§ç»­ä½¿ç”¨è½»é‡çº§é”ï¼‰ï¼Œæ¥ä¸‹æ¥è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚ Mark Wordæ˜¯å¯¹è±¡å¤´çš„ä¸€éƒ¨åˆ†ï¼›æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„çº¿ç¨‹æ ˆï¼ˆè™šæ‹Ÿæœºæ ˆï¼‰ï¼Œè®°å½•çº¿ç¨‹å’Œå‡½æ•°è°ƒç”¨çš„åŸºæœ¬ä¿¡æ¯ã€‚äºŒè€…å±äºJVMçš„åŸºç¡€å†…å®¹ï¼Œæ­¤å¤„ä¸åšä»‹ç»ã€‚ å½“ç„¶ï¼Œç”±äºè½»é‡çº§é”å¤©ç„¶ç„å‡†ä¸å­˜åœ¨é”ç«äº‰çš„åœºæ™¯ï¼Œå¦‚æœå­˜åœ¨é”ç«äº‰ä½†ä¸æ¿€çƒˆï¼Œä»ç„¶å¯ä»¥ç”¨è‡ªæ—‹é”ä¼˜åŒ–ï¼Œè‡ªæ—‹å¤±è´¥åå†è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚ é‡é‡çº§é”å†…ç½®é”åœ¨Javaä¸­è¢«æŠ½è±¡ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰ã€‚åœ¨JDK 1.6ä¹‹å‰ï¼Œç›‘è§†å™¨é”å¯ä»¥è®¤ä¸ºç›´æ¥å¯¹åº”åº•å±‚æ“ä½œç³»ç»Ÿä¸­çš„äº’æ–¥é‡ï¼ˆmutexï¼‰ã€‚è¿™ç§åŒæ­¥æ–¹å¼çš„æˆæœ¬éå¸¸é«˜ï¼ŒåŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨å¼•èµ·çš„å†…æ ¸æ€ä¸ç”¨æˆ·æ€åˆ‡æ¢ã€çº¿ç¨‹é˜»å¡é€ æˆçš„çº¿ç¨‹åˆ‡æ¢ç­‰ã€‚å› æ­¤ï¼Œåæ¥ç§°è¿™ç§é”ä¸ºâ€œé‡é‡çº§é”â€ã€‚ å°ç»“ åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”åˆ†é…å’Œè†¨èƒ€çš„è¯¦ç»†è¿‡ç¨‹è§åã€‚ä¼šæ¶‰åŠä¸€äº›Mark Wordä¸CASçš„çŸ¥è¯†ã€‚ åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”é€‚ç”¨äºä¸åŒçš„å¹¶å‘åœºæ™¯ï¼š åå‘é”ï¼šæ— å®é™…ç«äº‰ï¼Œä¸”å°†æ¥åªæœ‰ç¬¬ä¸€ä¸ªç”³è¯·é”çš„çº¿ç¨‹ä¼šä½¿ç”¨é”ã€‚ è½»é‡çº§é”ï¼šæ— å®é™…ç«äº‰ï¼Œå¤šä¸ªçº¿ç¨‹äº¤æ›¿ä½¿ç”¨é”ï¼›å…è®¸çŸ­æ—¶é—´çš„é”ç«äº‰ã€‚ é‡é‡çº§é”ï¼šæœ‰å®é™…ç«äº‰ï¼Œä¸”é”ç«äº‰æ—¶é—´é•¿ã€‚ å¦å¤–ï¼Œå¦‚æœé”ç«äº‰æ—¶é—´çŸ­ï¼Œå¯ä»¥ä½¿ç”¨è‡ªæ—‹é”è¿›ä¸€æ­¥ä¼˜åŒ–è½»é‡çº§é”ã€é‡é‡çº§é”çš„æ€§èƒ½ï¼Œå‡å°‘çº¿ç¨‹åˆ‡æ¢ã€‚ å¦‚æœé”ç«äº‰ç¨‹åº¦é€æ¸æé«˜ï¼ˆç¼“æ…¢ï¼‰ï¼Œé‚£ä¹ˆä»åå‘é”é€æ­¥è†¨èƒ€åˆ°é‡é‡é”ï¼Œèƒ½å¤Ÿæé«˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚ è‡ªæ—‹é”é¦–å…ˆï¼Œå†…æ ¸æ€ä¸ç”¨æˆ·æ€çš„åˆ‡æ¢ä¸Šä¸å®¹æ˜“ä¼˜åŒ–ã€‚ä½†é€šè¿‡è‡ªæ—‹é”ï¼Œå¯ä»¥å‡å°‘çº¿ç¨‹é˜»å¡é€ æˆçš„çº¿ç¨‹åˆ‡æ¢ï¼ˆåŒ…æ‹¬æŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹ï¼‰ã€‚ å¦‚æœé”çš„ç²’åº¦å°ï¼Œé‚£ä¹ˆé”çš„æŒæœ‰æ—¶é—´æ¯”è¾ƒçŸ­ï¼ˆå°½ç®¡å…·ä½“çš„æŒæœ‰æ—¶é—´æ— æ³•å¾—çŸ¥ï¼Œä½†å¯ä»¥è®¤ä¸ºï¼Œé€šå¸¸æœ‰ä¸€éƒ¨åˆ†é”èƒ½æ»¡è¶³ä¸Šè¿°æ€§è´¨ï¼‰ã€‚é‚£ä¹ˆï¼Œå¯¹äºç«äº‰è¿™äº›é”çš„è€Œè¨€ï¼Œå› ä¸ºé”é˜»å¡é€ æˆçº¿ç¨‹åˆ‡æ¢çš„æ—¶é—´ä¸é”æŒæœ‰çš„æ—¶é—´ç›¸å½“ï¼Œå‡å°‘çº¿ç¨‹é˜»å¡é€ æˆçš„çº¿ç¨‹åˆ‡æ¢ï¼Œèƒ½å¾—åˆ°è¾ƒå¤§çš„æ€§èƒ½æå‡ã€‚å…·ä½“å¦‚ä¸‹ï¼š å½“å‰çº¿ç¨‹ç«äº‰é”å¤±è´¥æ—¶ï¼Œæ‰“ç®—é˜»å¡è‡ªå·± ä¸ç›´æ¥é˜»å¡è‡ªå·±ï¼Œè€Œæ˜¯è‡ªæ—‹ï¼ˆç©ºç­‰å¾…ï¼Œæ¯”å¦‚ä¸€ä¸ªç©ºçš„æœ‰é™forå¾ªç¯ï¼‰ä¸€ä¼š åœ¨è‡ªæ—‹çš„åŒæ—¶é‡æ–°ç«äº‰é” å¦‚æœè‡ªæ—‹ç»“æŸå‰è·å¾—äº†é”ï¼Œé‚£ä¹ˆé”è·å–æˆåŠŸï¼›å¦åˆ™ï¼Œè‡ªæ—‹ç»“æŸåé˜»å¡è‡ªå·± å¦‚æœåœ¨è‡ªæ—‹çš„æ—¶é—´å†…ï¼Œé”å°±è¢«æ—§owneré‡Šæ”¾äº†ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±ä¸éœ€è¦é˜»å¡è‡ªå·±ï¼ˆä¹Ÿä¸éœ€è¦åœ¨æœªæ¥é”é‡Šæ”¾æ—¶æ¢å¤ï¼‰ï¼Œå‡å°‘äº†ä¸€æ¬¡çº¿ç¨‹åˆ‡æ¢ã€‚ â€œé”çš„æŒæœ‰æ—¶é—´æ¯”è¾ƒçŸ­â€œè¿™ä¸€æ¡ä»¶å¯ä»¥æ”¾å®½ã€‚å®é™…ä¸Šï¼Œåªè¦é”ç«äº‰çš„æ—¶é—´æ¯”è¾ƒçŸ­ï¼ˆæ¯”å¦‚çº¿ç¨‹1å¿«é‡Šæ”¾é”çš„æ—¶å€™ï¼Œçº¿ç¨‹2æ‰ä¼šæ¥ç«äº‰é”ï¼‰ï¼Œå°±èƒ½å¤Ÿæé«˜è‡ªæ—‹è·å¾—é”çš„æ¦‚ç‡ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨é”æŒæœ‰æ—¶é—´é•¿ï¼Œä½†ç«äº‰ä¸æ¿€çƒˆçš„åœºæ™¯ä¸­ã€‚ å…¸å‹çš„è‡ªæ—‹é”å®ç°çš„ä¾‹å­ï¼Œå¯ä»¥å‚è€ƒè‡ªæ—‹é”çš„å®ç° é”åˆ†é…å’Œè†¨èƒ€è¿‡ç¨‹ å‚è€ƒé“¾æ¥ Javaä¸­çš„é”åˆ†ç±» Javaä¸å¯é‡å…¥é”å’Œå¯é‡å…¥é”ç†è§£ æµ…è°ˆåå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”]]></content>
      <categories>
        <category>Java åŸºç¡€</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
        <tag>é”</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java åå°„]]></title>
    <url>%2F2019%2F02%2F11%2FJava%20%E5%8F%8D%E5%B0%84%2F</url>
    <content type="text"><![CDATA[ç±»åŠ è½½å™¨å½“ç¨‹åºæœ‰ä½¿ç”¨æŸä¸ªç±»æ—¶ï¼Œå¦‚æœè¯¥ç±»è¿˜æ²¡æœ‰è¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåˆ™ç³»ç»Ÿä¼šé€šè¿‡åŠ è½½ï¼Œè¿æ¥ï¼Œåˆå§‹åŒ–ä¸‰æ­¥æ¥å®ç°å¯¹è¿™ä¸ªç±»è¿›è¡Œåˆå§‹åŒ– åŠ è½½å°±æ˜¯æŒ‡å°†classæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œå¹¶ä¸ºä¹‹åˆ›å»ºä¸€ä¸ªClasså¯¹è±¡ï¼Œä»»ä½•ç±»è¢«ä½¿ç”¨æ—¶ç³»ç»Ÿéƒ½ä¼šå»ºç«‹ä¸€ä¸ªClasså¯¹è±¡ è¿æ¥éªŒè¯ æ˜¯å¦æœ‰æ­£ç¡®çš„å†…éƒ¨ç»“æ„ï¼Œå¹¶å’Œå…¶ä»–ç±»åè°ƒä¸€è‡´å‡†å¤‡ è´Ÿè´£ä¸ºç±»çš„é™æ€æˆå‘˜åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹åŒ–å€¼è§£æ å°†ç±»çš„äºŒè¿›åˆ¶æ•°æ®ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ åˆå§‹åŒ–å¯¹ç±»çš„é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–æ“ä½œç±»åˆå§‹åŒ–æ—¶æœº åˆ›å»ºç±»çš„å®ä¾‹ ç±»çš„é™æ€å˜é‡ï¼Œæˆ–è€…ä¸ºé™æ€å˜é‡èµ‹å€¼ ç±»çš„é™æ€æ–¹æ³• ä½¿ç”¨åå°„æ–¹å¼æ¥å¼ºåˆ¶åˆ›å»ºæŸä¸ªç±»æˆ–æ¥å£å¯¹åº”çš„java.lang.Classå¯¹è±¡ åˆå§‹åŒ–æŸä¸ªç±»çš„å­ç±» ç›´æ¥ä½¿ç”¨java.exeå‘½ä»¤æ¥è¿è¡ŒæŸä¸ªä¸»ç±»ç±»åŠ è½½å™¨ è´Ÿè´£å°†.classæ–‡ä»¶åŠ è½½åˆ°å†…åœ¨ä¸­ï¼Œå¹¶ä¸ºä¹‹ç”Ÿæˆå¯¹åº”çš„Classå¯¹è±¡ è™½ç„¶æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒç±»åŠ è½½æœºåˆ¶ï¼Œä½†æ˜¯äº†è§£è¿™ä¸ªæœºåˆ¶æˆ‘ä»¬å°±èƒ½æ›´å¥½çš„ç†è§£ç¨‹åºçš„è¿è¡Œç±»åŠ è½½å™¨çš„ç»„æˆ Bootstrap ClassLoader æ ¹ç±»åŠ è½½å™¨ä¹Ÿè¢«ç§°ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£Javaæ ¸å¿ƒç±»çš„åŠ è½½æ¯”å¦‚Systemï¼ŒStringç­‰ã€‚åœ¨ JDK ä¸­ JRE çš„ lib ç›®å½•ä¸‹ rt.jar æ–‡ä»¶ä¸­ Extension ClassLoaderæ‰©å±•ç±»åŠ è½½å™¨è´Ÿè´£ JRE çš„æ‰©å±•ç›®å½•ä¸­ jar åŒ…çš„åŠ è½½ã€‚åœ¨ JDK ä¸­ JRE çš„ lib ç›®å½•ä¸‹ ext ç›®å½• System ClassLoaderç³»ç»Ÿç±»åŠ è½½å™¨è´Ÿè´£åœ¨JVMå¯åŠ¨æ—¶åŠ è½½æ¥è‡ªjavaå‘½ä»¤çš„classæ–‡ä»¶ï¼Œä»¥åŠclasspathç¯å¢ƒå˜é‡æ‰€æŒ‡å®šçš„jaråŒ…å’Œç±»è·¯å¾„ é€šè¿‡è¿™äº›æè¿°å°±å¯ä»¥çŸ¥é“æˆ‘ä»¬å¸¸ç”¨çš„ç±»ï¼Œéƒ½æ˜¯ç”±è°æ¥åŠ è½½å®Œæˆçš„ã€‚ åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»çŸ¥é“æŠŠclassæ–‡ä»¶åŠ è½½åˆ°å†…å­˜äº†ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬ä»…ä»…ç«™åœ¨è¿™äº›classæ–‡ä»¶çš„è§’åº¦ï¼Œæˆ‘ä»¬å¦‚ä½•æ¥ä½¿ç”¨è¿™äº›classæ–‡ä»¶ä¸­çš„å†…å®¹å‘¢? è¿™å°±æ˜¯æˆ‘ä»¬åå°„è¦ç ”ç©¶çš„å†…å®¹ åå°„JAVAåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºjavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚è¦æƒ³è§£å‰–ä¸€ä¸ªç±»,å¿…é¡»å…ˆè¦è·å–åˆ°è¯¥ç±»çš„å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡ã€‚è€Œè§£å‰–ä½¿ç”¨çš„å°±æ˜¯Classç±»ä¸­çš„æ–¹æ³•.æ‰€ä»¥å…ˆè¦è·å–åˆ°æ¯ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶å¯¹åº”çš„Classç±»å‹çš„å¯¹è±¡ Classç±»é˜…è¯»APIçš„Classç±»å¾—çŸ¥ï¼ŒClass æ²¡æœ‰å…¬å…±æ„é€ æ–¹æ³•ã€‚Class å¯¹è±¡æ˜¯åœ¨åŠ è½½ç±»æ—¶ç”± Java è™šæ‹Ÿæœºä»¥åŠé€šè¿‡è°ƒç”¨ç±»åŠ è½½å™¨ä¸­çš„ defineClass æ–¹æ³•è‡ªåŠ¨æ„é€ çš„ è·å–Classå¯¹è±¡çš„ä¸‰ç§æ–¹å¼æ–¹å¼ä¸€: é€šè¿‡Objectç±»ä¸­çš„getObject()æ–¹æ³•12Person p = new Person();Class c = p.getClass(); æ–¹å¼äºŒ: é€šè¿‡ ç±»å.class è·å–åˆ°å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡ï¼ˆä»»æ„æ•°æ®ç±»å‹éƒ½å…·å¤‡ä¸€ä¸ªclassé™æ€å±æ€§,çœ‹ä¸Šå»è¦æ¯”ç¬¬ä¸€ç§æ–¹å¼ç®€å•ï¼‰1Class c2 = Person.class; æ–¹å¼ä¸‰: é€šè¿‡Classç±»ä¸­çš„æ–¹æ³•ï¼ˆå°†ç±»åä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ç»™Classç±»ä¸­çš„é™æ€æ–¹æ³•forNameå³å¯ï¼‰1Class c3 = Class.forName("cn.cuzz.Person"); æ³¨æ„ï¼šç¬¬ä¸‰ç§å’Œå‰ä¸¤ç§çš„åŒºåˆ« å‰ä¸¤ç§ä½ å¿…é¡»æ˜ç¡®Personç±»å‹ åé¢æ˜¯æŒ‡å®šè¿™ç§ç±»å‹çš„å­—ç¬¦ä¸²å°±è¡Œ(è¦åŒ…å«åŒ…å)ï¼Œè¿™ç§æ‰©å±•æ›´å¼ºï¼Œæˆ‘ä¸éœ€è¦çŸ¥é“ä½ çš„ç±»ï¼Œæˆ‘åªæä¾›å­—ç¬¦ä¸²ï¼ŒæŒ‰ç…§é…ç½®æ–‡ä»¶åŠ è½½å°±å¯ä»¥äº† Personç±»12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class Person &#123; // æˆå‘˜å˜é‡ public String name; public int age; private String address; // æ„é€ æ–¹æ³• public Person() &#123; System.out.println("ç©ºå‚æ•°æ„é€ æ–¹æ³•"); &#125; public Person(String name) &#123; this.name = name; System.out.println("å¸¦æœ‰Stringçš„æ„é€ æ–¹æ³•"); &#125; // ç§æœ‰çš„æ„é€ æ–¹æ³• private Person(String name, int age)&#123; this.name = name; this.age = age; System.out.println("å¸¦æœ‰Stringï¼Œintçš„æ„é€ æ–¹æ³•"); &#125; public Person(String name, int age, String address)&#123; this.name = name; this.age = age; this.address = address; System.out.println("å¸¦æœ‰String, int, Stringçš„æ„é€ æ–¹æ³•"); &#125; // æˆå‘˜æ–¹æ³• // æ²¡æœ‰è¿”å›å€¼æ²¡æœ‰å‚æ•°çš„æ–¹æ³• public void method1()&#123; System.out.println("æ²¡æœ‰è¿”å›å€¼æ²¡æœ‰å‚æ•°çš„æ–¹æ³•"); &#125; // æ²¡æœ‰è¿”å›å€¼ï¼Œæœ‰å‚æ•°çš„æ–¹æ³• public void method2(String name)&#123; System.out.println("æ²¡æœ‰è¿”å›å€¼ï¼Œæœ‰å‚æ•°çš„æ–¹æ³• name= "+ name); &#125; // æœ‰è¿”å›å€¼ï¼Œæ²¡æœ‰å‚æ•° public int method3()&#123; System.out.println("æœ‰è¿”å›å€¼ï¼Œæ²¡æœ‰å‚æ•°çš„æ–¹æ³•"); return 123; &#125; // æœ‰è¿”å›å€¼ï¼Œæœ‰å‚æ•°çš„æ–¹æ³• public String method4(String name)&#123; System.out.println("æœ‰è¿”å›å€¼ï¼Œæœ‰å‚æ•°çš„æ–¹æ³•"); return "å“ˆå“ˆ" + name; &#125; // ç§æœ‰æ–¹æ³• private void method5()&#123; System.out.println("ç§æœ‰æ–¹æ³•"); &#125; @Override public String toString() &#123; return "Person [name=" + name + ", age=" + age + ", address=" + address+ "]"; &#125;&#125; é€šè¿‡åå°„è·å–æ„é€ æ–¹æ³•å¹¶ä½¿ç”¨åœ¨åå°„æœºåˆ¶ä¸­ï¼ŒæŠŠç±»ä¸­çš„æˆå‘˜ï¼ˆæ„é€ æ–¹æ³•ã€æˆå‘˜æ–¹æ³•ã€æˆå‘˜å˜é‡ï¼‰éƒ½å°è£…æˆäº†å¯¹åº”çš„ç±»è¿›è¡Œè¡¨ç¤ºã€‚å…¶ä¸­ï¼Œæ„é€ æ–¹æ³•ä½¿ç”¨ç±»Constructorè¡¨ç¤ºã€‚å¯é€šè¿‡Classç±»ä¸­æä¾›çš„æ–¹æ³•è·å–æ„é€ æ–¹æ³•ï¼š è¿”å›ä¸€ä¸ªæ„é€ æ–¹æ³• public Constructor&lt;T&gt; getConstructor(Class&lt;?&gt;... parameterTypes) è·å–publicä¿®é¥°, æŒ‡å®šå‚æ•°ç±»å‹æ‰€å¯¹åº”çš„æ„é€ æ–¹æ³• public Constructor&lt;T&gt; getDeclaredConstructor(Class&lt;?&gt;... parameterTypes) è·å–æŒ‡å®šå‚æ•°ç±»å‹æ‰€å¯¹åº”çš„æ„é€ æ–¹æ³•(åŒ…å«ç§æœ‰çš„) è¿”å›å¤šä¸ªæ„é€ æ–¹æ³• public Constructor&lt;?&gt;[] getConstructors()è·å–æ‰€æœ‰çš„public ä¿®é¥°çš„æ„é€ æ–¹æ³• public Constructor&lt;?&gt;[] getDeclaredConstructors() è·å–æ‰€æœ‰çš„æ„é€ æ–¹æ³•(åŒ…å«ç§æœ‰çš„)123456789101112131415161718192021222324252627282930313233package cn.cuzz;import java.lang.reflect.Constructor;public class Test &#123; public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, SecurityException &#123; // è·å–Classå¯¹è±¡ åŒ…å.ç±» Class c = Class.forName("cn.cuzz.Person"); // è·å–æ‰€æœ‰æ„é€ æ–¹æ³• // åªåŒ…æ‹¬public Constructor[] cons = c.getConstructors(); // å³åŒ…æ‹¬publicä¹ŸåŒ…æ‹¬private Constructor[] conss = c.getDeclaredConstructors(); // è·å–ä¸€ä¸ªæ„é€ æ–¹æ³• // public Person() Constructor con1 = c.getConstructor(null); System.out.println(con1); // public Person(String name) Constructor con2 = c.getConstructor(String.class); System.out.println(con2); // private Person(String name, int age) Constructor con3 = c.getDeclaredConstructor(String.class, int.class); System.out.println(con3); // public Person(String name, int age, String address) Constructor con4 = c.getDeclaredConstructor(String.class, int.class, String.class); System.out.println(con4); &#125;&#125; é€šè¿‡åå°„æ–¹å¼ï¼Œè·å–æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡è·å–æ„é€ æ–¹æ³•ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š è·å–åˆ°Classå¯¹è±¡ è·å–æŒ‡å®šçš„æ„é€ æ–¹æ³• é€šè¿‡æ„é€ æ–¹æ³•ç±»Constructorä¸­çš„æ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡public T newInstance(Object... initargs)123456789101112131415161718package cn.cuzz;import java.lang.reflect.Constructor;public class Test2 &#123; public static void main(String[] args) throws Exception &#123; // è·å–Classå¯¹è±¡ Class c = Class.forName("cn.cuzz.Person"); // è·å–æŒ‡å®šæ„é€ å™¨ Constructor con = c.getConstructor(String.class, int.class, String.class); // é€šè¿‡æ„é€ æ–¹æ³•ä¸­çš„Constructorçš„æ–¹æ³• åˆ›å»ºå¯¹è±¡ Object obj = con.newInstance("cuzz", 18, "æ­¦æ±‰"); System.out.println(obj); // Person [name=cuzz, age=18, address=æ­¦æ±‰] &#125;&#125; é€šè¿‡åå°„è·å–æˆå‘˜å˜é‡å¹¶ä½¿ç”¨åœ¨åå°„æœºåˆ¶ä¸­ï¼ŒæŠŠç±»ä¸­çš„æˆå‘˜å˜é‡ä½¿ç”¨ç±»Fieldè¡¨ç¤ºã€‚å¯é€šè¿‡Classç±»ä¸­æä¾›çš„æ–¹æ³•è·å–æˆå‘˜å˜é‡ï¼š è¿”å›ä¸€ä¸ªæˆå‘˜å˜é‡ public Field getField(String name) è·å–æŒ‡å®šçš„publicä¿®é¥°çš„å˜é‡ public Field getDeclaredField(String name) è·å–æŒ‡å®šçš„ä»»æ„å˜é‡ è¿”å›å¤šä¸ªæˆå‘˜å˜é‡ public Field[] getFields() è·å–æ‰€æœ‰public ä¿®é¥°çš„å˜é‡ public Field[] getDeclaredFields() è·å–æ‰€æœ‰çš„ å˜é‡ (åŒ…å«ç§æœ‰)1234567891011121314151617181920212223package cn.cuzz;import java.lang.reflect.Field;public class Test3 &#123; public static void main(String[] args) throws Exception &#123; // è·å–Classå¯¹è±¡ Class c = Class.forName("cn.cuzz.Person"); // è·å–å¤šä¸ªæˆå‘˜å˜é‡ Field[] fields = c.getFields(); Field[] fieldss = c.getDeclaredFields(); // ä¸€ä¸ªå˜é‡ // public int age Field ageField = c.getField("age"); System.out.println(ageField); // public int cn.cuzz.Person.age // private String address Field addressField = c.getDeclaredField("address"); System.out.println(addressField); // private java.lang.String cn.cuzz.Person.address &#125;&#125; é€šè¿‡åå°„ï¼Œåˆ›å»ºå¯¹è±¡ï¼Œè·å–æŒ‡å®šçš„æˆå‘˜å˜é‡ï¼Œè¿›è¡Œèµ‹å€¼ä¸è·å–å€¼æ“ä½œè·å–æˆå‘˜å˜é‡ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š è·å–Classå¯¹è±¡ è·å–æ„é€ æ–¹æ³• é€šè¿‡æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡ è·å–æŒ‡å®šçš„æˆå‘˜å˜é‡ï¼ˆç§æœ‰æˆå‘˜å˜é‡ï¼Œé€šè¿‡setAccessible(boolean flag)æ–¹æ³•æš´åŠ›è®¿é—®ï¼‰ é€šè¿‡æ–¹æ³•ï¼Œç»™æŒ‡å®šå¯¹è±¡çš„æŒ‡å®šæˆå‘˜å˜é‡èµ‹å€¼æˆ–è€…è·å–å€¼public void set(Object obj, Object value)åœ¨æŒ‡å®šå¯¹è±¡objä¸­ï¼Œå°†æ­¤ Field å¯¹è±¡è¡¨ç¤ºçš„æˆå‘˜å˜é‡è®¾ç½®ä¸ºæŒ‡å®šçš„æ–°å€¼public Object get(Object obj)è¿”å›æŒ‡å®šå¯¹è±¡objä¸­ï¼Œæ­¤ Field å¯¹è±¡è¡¨ç¤ºçš„æˆå‘˜å˜é‡çš„å€¼123456789101112131415161718192021222324252627282930package cn.cuzz;import java.lang.reflect.Constructor;import java.lang.reflect.Field;public class Test4 &#123; public static void main(String[] args) throws IllegalAccessException, Exception &#123; // è·å–Classå¯¹è±¡ Class c = Class.forName("cn.cuzz.Person"); // è·å–æ„é€ æ–¹æ³• Constructor con = c.getConstructor(String.class); // é€šè¿‡æ„é€ æ–¹æ³• åˆ›å»ºå¯¹è±¡ Object obj = con.newInstance("cuzz"); // è·å–æŒ‡å®šæˆå‘˜å˜é‡ // public String name Field nameField = c.getField("name"); // public int age Field ageField = c.getField("age"); // èµ‹å€¼ nameField.set(obj, "Cuzz"); ageField.set(obj, 23); System.out.println("name = "+ nameField.get(obj)); // name = Cuzz System.out.println("age = "+ ageField.get(obj)); // age = 23 &#125;&#125; é€šè¿‡åå°„è·å–æˆå‘˜æ–¹æ³•å¹¶ä½¿ç”¨åœ¨åå°„æœºåˆ¶ä¸­ï¼ŒæŠŠç±»ä¸­çš„æˆå‘˜æ–¹æ³•ä½¿ç”¨ç±»Methodè¡¨ç¤ºã€‚å¯é€šè¿‡Classç±»ä¸­æä¾›çš„æ–¹æ³•è·å–æˆå‘˜æ–¹æ³•ï¼š è¿”å›è·å–ä¸€ä¸ªæ–¹æ³•ï¼š public Method getMethod(String name, Class&lt;?&gt;... parameterTypes) è·å– public ä¿®é¥°çš„æ–¹æ³• public Method getDeclaredMethod(String name, Class&lt;?&gt;... parameterTypes) è·å–ä»»æ„çš„æ–¹æ³•ï¼ŒåŒ…å«ç§æœ‰çš„ å‚æ•°1: name è¦æŸ¥æ‰¾çš„æ–¹æ³•åç§°ï¼› å‚æ•°2ï¼š parameterTypes è¯¥æ–¹æ³•çš„å‚æ•°ç±»å‹ è¿”å›è·å–å¤šä¸ªæ–¹æ³•ï¼š public Method[] getMethods() è·å–æœ¬ç±»ä¸çˆ¶ç±»ä¸­æ‰€æœ‰public ä¿®é¥°çš„æ–¹æ³• public Method[] getDeclaredMethods() è·å–æœ¬ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•(åŒ…å«ç§æœ‰çš„)12345678910111213141516171819202122232425262728package cn.cuzz;import java.lang.reflect.Method;public class Test5 &#123; public static void main(String[] args) throws Exception &#123; // è·å–Classå¯¹è±¡ Class c = Class.forName("cn.cuzz.Person"); // è·å–å¤šä¸ªæ–¹æ³• Method[] methods = c.getMethods(); Method[] methodss = c.getDeclaredMethods(); // è·å–ä¸€ä¸ªæ–¹æ³•ï¼š // public void method1() Method method = c.getMethod("method1", null); System.out.println(method); // public String method4(String name)&#123; method = c.getMethod("method4", String.class); System.out.println(method); // ç§æœ‰æ–¹æ³• // private void method5() method = c.getDeclaredMethod("method5", null); System.out.println(method); &#125;&#125; é€šè¿‡åå°„ï¼Œåˆ›å»ºå¯¹è±¡ï¼Œè°ƒç”¨æŒ‡å®šçš„æ–¹æ³•è·å–æˆå‘˜æ–¹æ³•ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š è·å–Classå¯¹è±¡ è·å–æ„é€ æ–¹æ³• é€šè¿‡æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡ è·å–æŒ‡å®šçš„æ–¹æ³• æ‰§è¡Œæ‰¾åˆ°çš„æ–¹æ³•(å¦‚æœè·å–çš„æ˜¯ç§æœ‰æ–¹æ³•åˆ™è¦å¼€å¯æš´åŠ›è®¿é—®m5.setAccessible(true))public Object invoke(Object obj, Object... args) æ‰§è¡ŒæŒ‡å®šå¯¹è±¡objä¸­ï¼Œå½“å‰Methodå¯¹è±¡æ‰€ä»£è¡¨çš„æ–¹æ³•ï¼Œæ–¹æ³•è¦ä¼ å…¥çš„å‚æ•°é€šè¿‡argsæŒ‡å®š12345678910111213141516171819202122232425package cn.cuzz;import java.lang.reflect.Constructor;import java.lang.reflect.Method;public class Test6 &#123; public static void main(String[] args) throws Exception &#123; // è·å–Classå¯¹è±¡ Class c = Class.forName("cn.cuzz.Person"); // è·å–æŒ‡å®šæ„é€ å™¨ Constructor con = c.getConstructor(String.class, int.class, String.class); // é€šè¿‡æ„é€ æ–¹æ³•ä¸­çš„Constructorçš„æ–¹æ³• åˆ›å»ºå¯¹è±¡ Object obj = con.newInstance("cuzz", 18, "æ­¦æ±‰"); // è·å–æŒ‡å®šçš„æ–¹æ³• Method m4 = c.getMethod("method4", String.class); // æ‰§è¡Œæ‰¾åˆ°çš„æ–¹æ³• Object result = m4.invoke(obj, "2018/03/19"); System.out.println("result = " + result); // result = å“ˆå“ˆ2018/03/19 &#125;&#125; åå°„ç»ƒä¹ ä¸‹é¢å±•ç¤ºä¸€ä¸‹åå°„çš„åˆ©ç”¨åœºæ™¯ã€‚ æ³›å‹æ“¦é™¤æ€è€ƒï¼Œå°†å·²å­˜åœ¨çš„ArrayList&lt;Integer&gt;é›†åˆä¸­æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°æ®ï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿ æˆ‘æ¥å‘Šè¯‰å¤§å®¶ï¼Œå…¶å®ç¨‹åºç¼–è¯‘åäº§ç”Ÿçš„.classæ–‡ä»¶ä¸­æ˜¯æ²¡æœ‰æ³›å‹çº¦æŸçš„ï¼Œè¿™ç§ç°è±¡æˆ‘ä»¬ç§°ä¸ºæ³›å‹çš„æ“¦é™¤ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„æŠ€æœ¯ï¼Œæ¥å®Œæˆå‘æœ‰æ³›å‹çº¦æŸçš„é›†åˆä¸­ï¼Œæ·»åŠ ä»»æ„ç±»å‹çš„å…ƒç´ 123456789101112131415161718192021222324252627package cn.cuzz;import java.lang.reflect.Method;import java.util.ArrayList;public class Test7 &#123; public static void main(String[] args) throws Exception, SecurityException &#123; ArrayList&lt;String&gt; list = new ArrayList&lt;String&gt;(); // æ·»åŠ å…ƒç´  list.add("cuzz"); // list.add(23); æŠ¥é”™ // é€šè¿‡åå°„æŠ€æœ¯ï¼Œå®ç°æ·»åŠ ä»»æ„ç±»å‹çš„å…ƒç´  // è·å–å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡ Class c = Class.forName("java.util.ArrayList"); // æ‰¾åˆ°add()æ–¹æ³• Method addMethod = c.getMethod("add", Object.class); // æ‰§è¡Œadd()æ–¹æ³• addMethod.invoke(list, 23); System.out.println(list); //[cuzz, 23] &#125;&#125; åå°„é…ç½®æ–‡ä»¶é€šè¿‡é…ç½®æ–‡ä»¶å¾—åˆ°ç±»åå’Œè¦è¿è¡Œçš„æ–¹æ³•å,ç”¨åå°„çš„æ“ä½œç±»åå¾—åˆ°å¯¹è±¡å’Œè°ƒç”¨æ–¹æ³• å®ç°æ­¥éª¤: å‡†å¤‡é…ç½®æ–‡ä»¶,é”®å€¼å¯¹ IOæµè¯»å–é…ç½®æ–‡ä»¶ Reader æ–‡ä»¶ä¸­çš„é”®å€¼å¯¹å­˜å‚¨åˆ°é›†åˆä¸­ Propertiesé›†åˆä¿å­˜çš„é”®å€¼å¯¹,å°±æ˜¯ç±»åå’Œæ–¹æ³•å åå°„è·å–æŒ‡å®šç±»çš„classæ–‡ä»¶å¯¹è±¡ classæ–‡ä»¶å¯¹è±¡,è·å–æŒ‡å®šçš„æ–¹æ³• è¿è¡Œæ–¹æ³•1234567891011121314151617181920public class Test8 &#123; public static void main(String[] args) throws Exception&#123; // IOæµè¯»å–é…ç½®æ–‡ä»¶ FileReader r = new FileReader("config.properties"); // åˆ›å»ºé›†åˆå¯¹è±¡ Properties pro = new Properties(); // è°ƒç”¨é›†åˆæ–¹æ³•load,ä¼ é€’æµå¯¹è±¡ pro.load(r); r.close(); // é€šè¿‡é”®è·å–å€¼ String className = pro.getProperty("className"); String methodName = pro.getProperty("methodName"); // åå°„è·å–æŒ‡å®šç±»çš„classæ–‡ä»¶å¯¹è±¡ Class c = Class.forName(className); Object obj = c.newInstance(); // è·å–æŒ‡å®šçš„æ–¹æ³•å Method method = c.getMethod(methodName); method.invoke(obj); &#125;&#125; é…ç½®æ–‡ä»¶123456# className=cn.cuzz.Student# methodName=studyclassName=cn.cuzz.TeachermethodName=teach# className=cn.cuzz.Worker# methodName=work]]></content>
      <categories>
        <category>Java åŸºç¡€</category>
      </categories>
      <tags>
        <tag>åå°„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæ³¨è§£é©±åŠ¨å¼€å‘ï¼ˆå››ï¼‰]]></title>
    <url>%2F2019%2F02%2F10%2FSpring%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%EF%BC%88%E5%9B%9B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[AOPé¢å‘åˆ‡é¢ç¼–ç¨‹AOPï¼ˆAspect Oriented Programmingï¼‰ï¼Œå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå¯ä»¥è¯´æ˜¯OOPï¼ˆObject Oriented Programmingï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰çš„è¡¥å……å’Œå®Œå–„ã€‚OOPå¼•å…¥å°è£…ã€ç»§æ‰¿ã€å¤šæ€ç­‰æ¦‚å¿µæ¥å»ºç«‹ä¸€ç§å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œç”¨äºæ¨¡æ‹Ÿå…¬å…±è¡Œä¸ºçš„ä¸€ä¸ªé›†åˆã€‚ä¸è¿‡OOPå…è®¸å¼€å‘è€…å®šä¹‰çºµå‘çš„å…³ç³»ï¼Œä½†å¹¶ä¸é€‚åˆå®šä¹‰æ¨ªå‘çš„å…³ç³»ï¼Œä¾‹å¦‚æ—¥å¿—åŠŸèƒ½ã€‚æ—¥å¿—ä»£ç å¾€å¾€æ¨ªå‘åœ°æ•£å¸ƒåœ¨æ‰€æœ‰å¯¹è±¡å±‚æ¬¡ä¸­ï¼Œè€Œä¸å®ƒå¯¹åº”çš„å¯¹è±¡çš„æ ¸å¿ƒåŠŸèƒ½æ¯«æ— å…³ç³»å¯¹äºå…¶ä»–ç±»å‹çš„ä»£ç ï¼Œå¦‚å®‰å…¨æ€§ã€å¼‚å¸¸å¤„ç†å’Œé€æ˜çš„æŒç»­æ€§ä¹Ÿéƒ½æ˜¯å¦‚æ­¤ï¼Œè¿™ç§æ•£å¸ƒåœ¨å„å¤„çš„æ— å…³çš„ä»£ç è¢«ç§°ä¸ºæ¨ªåˆ‡ï¼ˆcross cuttingï¼‰ï¼Œåœ¨OOPè®¾è®¡ä¸­ï¼Œå®ƒå¯¼è‡´äº†å¤§é‡ä»£ç çš„é‡å¤ï¼Œè€Œä¸åˆ©äºå„ä¸ªæ¨¡å—çš„é‡ç”¨ã€‚ åº•å±‚å®ç°Spring çš„ AOP çš„åº•å±‚ç”¨åˆ°ä¸¤ç§ä»£ç†æœºåˆ¶ï¼š JDK çš„åŠ¨æ€ä»£ç† ï¼šç±»å¿…é¡»å®ç°æ¥å£ï¼Œæ‰€ä»¥æ˜¯é’ˆå¯¹å®ç°äº†æ¥å£çš„ç±»äº§ç”Ÿä»£ç†. Cglib çš„åŠ¨æ€ä»£ç†ï¼šé’ˆå¯¹æ²¡æœ‰å®ç°æ¥å£çš„ç±»äº§ç”Ÿä»£ç†ï¼Œåº”ç”¨çš„æ˜¯åº•å±‚çš„å­—èŠ‚ç å¢å¼ºçš„æŠ€æœ¯ç”Ÿæˆå½“å‰ç±»çš„å­ç±»å¯¹è±¡ JDK çš„åŠ¨æ€ä»£ç† UserServiceæ¥å£ï¼Œå®ç°å¢åˆ æ”¹æŸ¥çš„åŠŸèƒ½ 12345678package com.cuzz.service;public interface UserService &#123; void add(); void delete(); void update(); void get();&#125; UserServiceæ¥å£çš„å®ç°çš„ç±» 12345678910111213141516171819202122public class UserServiceImpl implements UserService &#123; @Override public void add() &#123; System.out.println("æ·»åŠ ä¸€ä¸ªuser"); &#125; @Override public void delete() &#123; System.out.println("åˆ é™¤ä¸€ä¸ªuser"); &#125; @Override public void update() &#123; System.out.println("æ›´æ–°ä¸€ä¸ªuser"); &#125; @Override public void get() &#123; System.out.println("æŸ¥è¯¢ä¸€ä¸ªuser"); &#125;&#125; å®ç°åŠ¨æ€ä»£ç† 123456789101112131415161718192021222324252627282930313233package com.cuzz.service;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;public class UserServiceProxyFactory implements InvocationHandler&#123; private UserService us; public UserServiceProxyFactory(UserService us) &#123; super(); this.us = us; &#125; // è·å¾—åŠ¨æ€ä»£ç† public UserService getUserServiceProxy() &#123; // ç”ŸæˆåŠ¨æ€ä»£ç† UserService usProxy = (UserService) Proxy.newProxyInstance(UserServiceProxyFactory.class.getClassLoader(), UserServiceImpl.class.getInterfaces(), this); // è¿™ä¸ª this å°±æ˜¯å®ç° InvocationHandler çš„å¯¹è±¡ return usProxy; &#125; @Override public Object invoke(Object arg0, Method method, Object[] arg2) throws Throwable &#123; System.out.println("æ‰“å¼€äº‹åŠ¡!"); Object invoke = method.invoke(us, arg2); System.out.println("æäº¤äº‹åŠ¡!"); return invoke; &#125;&#125; æµ‹è¯• 123456789public class TestDemo &#123; @Test public void test01()&#123; UserService us = new UserServiceImpl(); UserServiceProxyFactory factory = new UserServiceProxyFactory(us); UserService usProxy = factory.getUserServiceProxy(); usProxy.add(); &#125;&#125; è¾“å‡º 123æ‰“å¼€äº‹åŠ¡!æ·»åŠ ä¸€ä¸ªuseræäº¤äº‹åŠ¡! Cglib çš„åŠ¨æ€ä»£ç† Cglib çš„åŠ¨æ€ä»£ç†çš„ä»£ç å®ç° 123456789101112131415161718192021222324252627282930313233package com.cuzz.service;import java.lang.reflect.Method;import org.springframework.cglib.proxy.Enhancer;import org.springframework.cglib.proxy.MethodInterceptor;import org.springframework.cglib.proxy.MethodProxy;public class UserServiceProxyFactory2 implements MethodInterceptor &#123; public UserService getUserServiceProxy()&#123; // å¸®æˆ‘ä»¬ç”Ÿæˆä»£ç†å¯¹è±¡ Enhancer en = new Enhancer(); // è®¾ç½®å¯¹è°è¿›è¡Œä»£ç† en.setSuperclass(UserServiceImpl.class); // ä»£ç†è¦åšä»€ä¹ˆ en.setCallback(this); // åˆ›å»ºä»£ç†å¯¹è±¡ UserService us = (UserService) en.create(); return us; &#125; @Override public Object intercept(Object prxoyobj, Method method, Object[] arg, MethodProxy methodProxy) throws Throwable &#123; // æ‰“å¼€äº‹åŠ¡ System.out.println("æ‰“å¼€äº‹åŠ¡!"); // è°ƒç”¨åŸæœ‰æ–¹æ³• Object returnValue = methodProxy.invokeSuper(prxoyobj, arg); // æäº¤äº‹åŠ¡ System.out.println("æäº¤äº‹åŠ¡!"); return returnValue; &#125;&#125; æµ‹è¯• 123456@Testpublic void test02() &#123; UserServiceProxyFactory2 factory = new UserServiceProxyFactory2(); UserService usProxy = factory.getUserServiceProxy(); usProxy.add();&#125; Springçš„AOPå¼€å‘(åŸºäºAspectJ)AOPçš„å¼€å‘ä¸­çš„ç›¸å…³æœ¯è¯­ï¼š Joinpoint(è¿æ¥ç‚¹)ï¼šæ‰€è°“è¿æ¥ç‚¹æ˜¯æŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ï¼Œåœ¨ spring ä¸­è¿™äº›ç‚¹æŒ‡çš„æ˜¯æ–¹æ³•ï¼Œå› ä¸º spring åªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ Pointcut(åˆ‡å…¥ç‚¹)ï¼šæ‰€è°“åˆ‡å…¥ç‚¹æ˜¯æŒ‡æˆ‘ä»¬è¦å¯¹å“ªäº› Joinpoint è¿›è¡Œæ‹¦æˆªçš„å®šä¹‰ Advice(é€šçŸ¥/å¢å¼º)ï¼šæ‰€è°“é€šçŸ¥æ˜¯æŒ‡æ‹¦æˆªåˆ° Joinpoint ä¹‹åæ‰€è¦åšçš„äº‹æƒ…å°±æ˜¯é€šçŸ¥.é€šçŸ¥åˆ†ä¸ºå‰ç½®é€šçŸ¥,åç½®é€šçŸ¥,å¼‚å¸¸é€šçŸ¥,æœ€ç»ˆé€šçŸ¥,ç¯ç»•é€šçŸ¥(åˆ‡é¢è¦å®Œæˆçš„åŠŸèƒ½) Introduction(å¼•ä»‹)ï¼šå¼•ä»‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„é€šçŸ¥åœ¨ä¸ä¿®æ”¹ç±»ä»£ç çš„å‰æä¸‹, Introduction å¯ä»¥åœ¨è¿è¡ŒæœŸä¸ºç±»åŠ¨æ€åœ°æ·»åŠ ä¸€äº›æ–¹æ³•æˆ– Field Target(ç›®æ ‡å¯¹è±¡)ï¼šä»£ç†çš„ç›®æ ‡å¯¹è±¡ Weaving(ç»‡å…¥)ï¼šæ˜¯æŒ‡æŠŠå¢å¼ºåº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ï¼Œspring é‡‡ç”¨åŠ¨æ€ä»£ç†ç»‡å…¥ï¼Œè€Œ AspectJ é‡‡ç”¨ç¼–è¯‘æœŸç»‡å…¥å’Œç±»è£…åœ¨æœŸç»‡å…¥ Proxyï¼ˆä»£ç†ï¼‰ï¼šä¸€ä¸ªç±»è¢« AOP ç»‡å…¥å¢å¼ºåï¼Œå°±äº§ç”Ÿä¸€ä¸ªç»“æœä»£ç†ç±» Aspect(åˆ‡é¢)ï¼šæ˜¯åˆ‡å…¥ç‚¹å’Œé€šçŸ¥ï¼ˆå¼•ä»‹ï¼‰çš„ç»“åˆ é€šçŸ¥ç±»å‹ å‰ç½®é€šçŸ¥ ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ åç½®é€šçŸ¥ ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œ ç¯ç»•é€šçŸ¥ ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰å’Œæ‰§è¡Œåæ‰§è¡Œ å¼‚å¸¸æŠ›å‡ºé€šçŸ¥ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‡ºç°å¼‚å¸¸çš„æ—¶å€™æ‰§è¡Œ æœ€ç»ˆé€šçŸ¥ ï¼šæ— è®ºç›®æ ‡æ–¹æ³•æ˜¯å¦å‡ºç°å¼‚å¸¸ æœ€ç»ˆé€šçŸ¥éƒ½ä¼šæ‰§è¡Œ ä»£ç æ¼”ç¤ºé€šçŸ¥ç±»ï¼Œç»™åˆ‡é¢çš„ç›®æ ‡æ–¹æ³•æ ‡æ³¨ä½•æ—¶åœ°è¿è¡Œï¼Œå¿…é¡»å‘Šè¯‰ Spring å“ªä¸ªç±»æ˜¯åˆ‡é¢ç±»ï¼Œæ·»åŠ æ³¨è§£ @Aspect 12345678910111213141516171819202122232425262728293031323334@Aspect // è¡¨ç¤ºè¯¥ç±»æ˜¯ä¸€ä¸ªé€šçŸ¥ç±»public class MyAdvice &#123; // å‰ç½®é€šçŸ¥ @Before("execution(* com.cuzz.service..*ServiceImpl.*(..))") public void before()&#123; System.out.println("è¿™æ˜¯å‰ç½®é€šçŸ¥!!"); &#125; // åç½®é€šçŸ¥ @AfterReturning("execution(* com.cuzz.service..*ServiceImpl.*(..))") public void afterReturning()&#123; System.out.println("è¿™æ˜¯åç½®é€šçŸ¥(å¦‚æœå‡ºç°å¼‚å¸¸ä¸ä¼šè°ƒç”¨)!!"); &#125; // ç¯ç»•é€šçŸ¥ @Around("execution(* com.cuzz.service..*ServiceImpl.*(..))") public Object around(ProceedingJoinPoint pjp) throws Throwable &#123; System.out.println("è¿™æ˜¯ç¯ç»•é€šçŸ¥ä¹‹å‰çš„éƒ¨åˆ†!!"); // è°ƒç”¨ç›®æ ‡æ–¹æ³• Object proceed = pjp.proceed(); System.out.println("è¿™æ˜¯ç¯ç»•é€šçŸ¥ä¹‹åçš„éƒ¨åˆ†!!"); return proceed; &#125; // å¼‚å¸¸é€šçŸ¥ @AfterThrowing("execution(* com.cuzz.service..*ServiceImpl.*(..))") public void afterException()&#123; System.out.println("å‡ºäº‹å•¦!å‡ºç°å¼‚å¸¸äº†!!"); &#125; // åç½®é€šçŸ¥ @After("execution(* com.cuzz.service..*ServiceImpl.*(..))") public void after()&#123; System.out.println("è¿™æ˜¯åç½®é€šçŸ¥(å‡ºç°å¼‚å¸¸ä¹Ÿä¼šè°ƒç”¨)!!"); &#125;&#125; é…ç½®ç±»ï¼Œå°†åˆ‡é¢ç±»å’Œä¸šåŠ¡é€»è¾‘ç±»éƒ½åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼Œç»™é…ç½®ç±»åŠ  @EnableAspectJAutoProxy æ³¨è§£ 12345678910111213141516171819/** * @Author: cuzz * @Date: 2019/2/10 20:43 * @Description: */@Configuration@EnableAspectJAutoProxypublic class MainConfigOfAOP &#123; @Bean public UserService userService() &#123; return new UserServiceImpl(); &#125; @Bean public MyAdvice myAdvice() &#123; return new MyAdvice(); &#125;&#125; æµ‹è¯• 12345678910@Testpublic void test03() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(MainConfigOfAOP.class); UserService userService = (UserService) applicationContext.getBean("userService"); userService.add(); userService.delete(); userService.update(); userService.get();&#125; å¦‚æœæŠ¥é”™æ·»åŠ ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.aspectj&lt;/groupId&gt; &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt; &lt;version&gt;1.8.4&lt;/version&gt; &lt;/dependency&gt;]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>æºç </tag>
        <tag>Spring</tag>
        <tag>æ³¨è§£</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆä¸‰ï¼‰]]></title>
    <url>%2F2019%2F02%2F06%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Java å­—èŠ‚ç ä»£ç ç¼–è¯‘ç»“æœä»æœ¬åœ°æœºå™¨ç è½¬å˜ä¸ºå­—èŠ‚ç ï¼Œæ˜¯å­˜å‚¨æ ¼å¼å‘å±•çš„ä¸€å°æ­¥ï¼Œç¡®æ˜¯ç¼–ç¨‹è¯­è¨€å‘å±•çš„ä¸€å¤§æ­¥ã€‚ å­—èŠ‚ç æ–‡ä»¶å‰–ææˆ‘ä»¬ä»ä¸€æ®µç®€å•çš„ä»£ç æ¥å…¥æ‰‹ 123456789101112public class MyTest01 &#123; private int a = 0; public int getA() &#123; return a; &#125; public void setA(int a) &#123; this.a = a; &#125;&#125; æˆ‘è¦è¦çœ‹ä¸€ä¸‹ java æ–‡ä»¶å¯¹åº”çš„ class æ–‡ä»¶çš„ç»“æ„ï¼Œå®šä½åˆ°å·¥ç¨‹çš„ out\production\classes ä¸‹è¾¹æ‰§è¡Œï¼š javap -c com.cuzz.jvm.bytecode.Mytest01 12345678910111213141516171819202122232425è­¦å‘Š: äºŒè¿›åˆ¶æ–‡ä»¶com.cuzz.jvm.bytecode.Mytest01åŒ…å«com.cuzz.jvm.bytecode.MyTest01Compiled from &quot;MyTest01.java&quot;public class com.cuzz.jvm.bytecode.MyTest01 &#123; public com.cuzz.jvm.bytecode.MyTest01(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: aload_0 5: iconst_0 6: putfield #2 // Field a:I 9: return public int getA(); Code: 0: aload_0 1: getfield #2 // Field a:I 4: ireturn public void setA(int); Code: 0: aload_0 1: iload_1 2: putfield #2 // Field a:I 5: return&#125; æˆ‘ä»¬å¦‚æœéœ€è¦è·å¾—æ›´å¤šä¿¡æ¯å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š javap -verbose com.cuzz.jvm.bytecode.Mytest01 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384è­¦å‘Š: äºŒè¿›åˆ¶æ–‡ä»¶com.cuzz.jvm.bytecode.Mytest01åŒ…å«com.cuzz.jvm.bytecode.MyTest01Classfile /E:/project/learn-demo/demo-10-jvm-lecture/out/production/classes/com/cuzz/jvm/bytecode/Mytest01.class Last modified 2019-2-3; size 492 bytes MD5 checksum cceeac51ae7b6fc46c60faf834de5932 Compiled from &quot;MyTest01.java&quot;public class com.cuzz.jvm.bytecode.MyTest01 minor version: 0 major version: 52 flags: ACC_PUBLIC, ACC_SUPERConstant pool: #1 = Methodref #4.#20 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = Fieldref #3.#21 // com/cuzz/jvm/bytecode/MyTest01.a:I #3 = Class #22 // com/cuzz/jvm/bytecode/MyTest01 #4 = Class #23 // java/lang/Object #5 = Utf8 a #6 = Utf8 I #7 = Utf8 &lt;init&gt; #8 = Utf8 ()V #9 = Utf8 Code #10 = Utf8 LineNumberTable #11 = Utf8 LocalVariableTable #12 = Utf8 this #13 = Utf8 Lcom/cuzz/jvm/bytecode/MyTest01; #14 = Utf8 getA #15 = Utf8 ()I #16 = Utf8 setA #17 = Utf8 (I)V #18 = Utf8 SourceFile #19 = Utf8 MyTest01.java #20 = NameAndType #7:#8 // &quot;&lt;init&gt;&quot;:()V #21 = NameAndType #5:#6 // a:I #22 = Utf8 com/cuzz/jvm/bytecode/MyTest01 #23 = Utf8 java/lang/Object&#123; public com.cuzz.jvm.bytecode.MyTest01(); descriptor: ()V flags: ACC_PUBLIC Code: stack=2, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: aload_0 5: iconst_0 6: putfield #2 // Field a:I 9: return LineNumberTable: line 8: 0 line 10: 4 LocalVariableTable: Start Length Slot Name Signature 0 10 0 this Lcom/cuzz/jvm/bytecode/MyTest01; public int getA(); descriptor: ()I flags: ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: getfield #2 // Field a:I 4: ireturn LineNumberTable: line 13: 0 LocalVariableTable: Start Length Slot Name Signature 0 5 0 this Lcom/cuzz/jvm/bytecode/MyTest01; public void setA(int); descriptor: (I)V flags: ACC_PUBLIC Code: stack=2, locals=2, args_size=2 0: aload_0 1: iload_1 2: putfield #2 // Field a:I 5: return LineNumberTable: line 17: 0 line 18: 5 LocalVariableTable: Start Length Slot Name Signature 0 6 0 this Lcom/cuzz/jvm/bytecode/MyTest01; 0 6 1 a I&#125;SourceFile: &quot;MyTest01.java&quot; æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶æŸ¥çœ‹å™¨æŸ¥çœ‹classæ–‡ä»¶çš„16è¿›åˆ¶ä¿¡æ¯ï¼ˆwinhexä¸‹è½½ï¼‰ï¼š 16æ–‡ä»¶æŸ¥çœ‹å™¨é‡Œè¾¹ç¬¬ä¸€è¡Œçš„CA å°±æ˜¯ä¸€ä¸ªå­—èŠ‚çš„å®¹é‡ï¼ˆ8ä½bitï¼‰: ä½¿ç”¨ javap -verbos å‘½ä»¤åˆ†æä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶æ—¶ï¼Œå°†ä¼šåˆ†æè¯¥å­—èŠ‚ç æ–‡ä»¶çš„é­”æ•°ã€ç‰ˆæœ¬å·ã€å¸¸é‡æ± ã€ç±»ä¿¡æ¯ã€ç±»çš„æ„é€ æ–¹æ³•ä¿¡æ¯ã€ç±»å˜é‡ä¸æˆå‘˜å˜é‡ç­‰ä¿¡æ¯ã€‚ é­”æ•°ï¼šæ‰€æœ‰çš„.classå­—èŠ‚ç æ–‡ä»¶çš„å‰4ä¸ªå­—èŠ‚éƒ½æ˜¯é­”æ•°ï¼Œé­”æ•°å€¼ä¸ºå›ºå®šå€¼ï¼š0xCAFEBABE (è©¹å§†æ–¯.é«˜æ–¯æ—è®¾è®¡çš„ï¼Œè•´æ„ï¼šå’–å•¡å®è´ï¼Œjava çš„å›¾æ ‡æ˜¯å’–å•¡ã€‚ é­”æ•°ä¹‹åçš„4ä¸ªå­—èŠ‚ä¸ºç‰ˆæœ¬ä¿¡æ¯ï¼Œå‰2ä¸ªå­—èŠ‚è¡¨ç¤º minor versioï¼ˆæ¬¡ç‰ˆæœ¬å·ï¼‰ï¼Œåä¸¤ä¸ªå­—èŠ‚è¡¨ç¤º major versionï¼ˆä¸»ç‰ˆæœ¬å·ï¼‰ã€‚ è¿™é‡Œçš„ç‰ˆæœ¬å·ä¸º 00 00 00 34ï¼Œæ¢ç®—æˆåè¿›åˆ¶ï¼Œè¡¨ç¤ºæ¬¡ç‰ˆæœ¬å·ä¸º0ï¼Œä¸»ç‰ˆæœ¬å·ä¸º52ã€‚ å­—èŠ‚å¸¸é‡æ± å‰–æå¸¸é‡æ± ï¼ˆconstant poolï¼‰ï¼šç´§æ¥ç€ä¸»ç‰ˆæœ¬å·ä¹‹åçš„å°±æ˜¯å¸¸é‡æ± å…¥å£ã€‚ä¸€ä¸ª Java ç±»ä¸­å®šä¹‰çš„å¾ˆå¤šä¿¡æ¯éƒ½æ˜¯ç”±å¸¸é‡æ± æ¥ç»´æŠ¤å’Œæè¿°çš„ï¼Œå¯ä»¥å°†å¸¸é‡æ± çœ‹ä½œæ˜¯ Class æ–‡ä»¶çš„èµ„æºä»“åº“ï¼Œæ¯”å¦‚è¯´ Java ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ä¸å˜é‡ä¿¡æ¯ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚å¸¸é‡æ± ä¸­çš„ä¸»è¦å‚¨å­˜ä¸¤ç±»å¸¸é‡ï¼šå­—é¢é‡ä¸ç¬¦å·å¼•ç”¨ã€‚å­—é¢é‡å¦‚æ–‡æœ¬å­—ç¬¦ä¸²ï¼ŒJava ä¸­å£°æ˜ä¸º final çš„å¸¸é‡å€¼ç­‰ï¼Œè€Œç¬¦å·å¼•ç”¨å¦‚ç±»å’Œæ¥å£çš„å…¨å±€é™å®šåï¼Œå­—æ®µçš„åç§°å’Œæè¿°ç¬¦ï¼Œæ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ç­‰ã€‚ å¸¸é‡æ± çš„æ€»ä½“ç»“æ„ï¼šJava ç±»æ‰€å¯¹åº”çš„å¸¸é‡æ± ä¸»è¦ç”±å¸¸é‡æ± æ•°é‡ä¸å¸¸é‡æ± æ•°ç»„ï¼ˆå¸¸é‡è¡¨ï¼‰è¿™ä¸¤éƒ¨åˆ†å…±åŒæ„æˆã€‚å¸¸é‡æ± æ•°é‡ç´§è·Ÿåœ¨ä¸»ç‰ˆæœ¬å·åé¢ï¼Œå æ® 2 ä¸ªå­—èŠ‚ï¼›å¸¸é‡æ± æ•°ç»„ç´§è·Ÿåœ¨å¸¸é‡æ± æ•°é‡ä¹‹åã€‚å¸¸é‡æ± æ•°ç»„ä¸ä¸€èˆ¬çš„æ•°ç»„ä¸åŒçš„æ˜¯ï¼Œå¸¸é‡æ± æ•°ç»„ä¸­ä¸åŒçš„å…ƒç´ ç±»å‹ã€ç»“æ„éƒ½æ˜¯ä¸åŒçš„ï¼Œé•¿åº¦å½“ç„¶ä¹Ÿå°±ä¸åŒï¼›ä½†æ˜¯ï¼Œæ¯ä¸€ç§å…ƒç´ çš„ç¬¬ä¸€ä¸ªæ•°æ®éƒ½æ˜¯ä¸€ä¸ª u1 ç±»å‹ï¼Œè¯¥å­—èŠ‚æ˜¯ä¸€ä¸ªæ ‡å¿—ä½ï¼Œå æ® 1 ä¸ªå­—èŠ‚ã€‚JVM åœ¨è§£æå¸¸é‡æ± æ—¶ï¼Œä¼šæ ¹æ®è¿™ä¸ª u1 ç±»å‹æ¥è·å–å…ƒç´ çš„å…·ä½“ç±»å‹ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¸¸é‡æ± æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•° = å¸¸é‡æ± æ•° - 1 ï¼ˆå…¶ä¸­0æš‚æ—¶ä¸ä½¿ç”¨ï¼‰ã€‚å¯¹åº”çš„æ˜¯ 00 18 è½¬åŒ–ä¸ºåè¿›åˆ¶ä¸º24ä¸ªå¸¸é‡ï¼Œè€Œæˆ‘ä»¬çœ‹åˆ°åªæœ‰23ä¸ªã€‚ç›®çš„æ˜¯æ»¡è¶³æŸäº›å¸¸é‡æ± ç´¢å¼•å€¼çš„æ•°æ®åœ¨ç‰¹å®šæƒ…å†µä¸‹éœ€è¦è¡¨è¾¾â€œä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡â€çš„å«ä¹‰ï¼›æ ¹æœ¬åŸå› åœ¨äºï¼Œç´¢å¼• 0 ä¹Ÿæ˜¯ä¸€ä¸ªå¸¸é‡ï¼ˆä¿ç•™å¸¸é‡ï¼‰ï¼Œåªä¸è¿‡å®ƒä¸ä½äºå¸¸é‡è¡¨ä¸­ï¼Œè¿™ä¸ªå¸¸é‡å°±å¯¹åº” null å€¼ï¼Œæ‰€ä»¥ï¼Œå¸¸é‡æ± çš„ç´¢å¼•ä» 1 å¼€å§‹è€Œä¸æ˜¯ 0 ã€‚ 123456789101112131415161718192021222324Constant pool: #1 = Methodref #4.#20 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = Fieldref #3.#21 // com/cuzz/jvm/bytecode/MyTest01.a:I #3 = Class #22 // com/cuzz/jvm/bytecode/MyTest01 #4 = Class #23 // java/lang/Object #5 = Utf8 a #6 = Utf8 I #7 = Utf8 &lt;init&gt; #8 = Utf8 ()V #9 = Utf8 Code #10 = Utf8 LineNumberTable #11 = Utf8 LocalVariableTable #12 = Utf8 this #13 = Utf8 Lcom/cuzz/jvm/bytecode/MyTest01; #14 = Utf8 getA #15 = Utf8 ()I #16 = Utf8 setA #17 = Utf8 (I)V #18 = Utf8 SourceFile #19 = Utf8 MyTest01.java #20 = NameAndType #7:#8 // &quot;&lt;init&gt;&quot;:()V #21 = NameAndType #5:#6 // a:I #22 = Utf8 com/cuzz/jvm/bytecode/MyTest01 #23 = Utf8 java/lang/Object Class æ–‡ä»¶ç»“æ„ä¸­å¸¸é‡æ± æ•°æ®ç±»å‹çš„ç»“æ„è¡¨ åœ¨ JVM è§„èŒƒä¸­ï¼Œæ¯ä¸€ä¸ªå˜é‡/å­—æ®µéƒ½æœ‰æè¿°ä¿¡æ¯ï¼Œæè¿°ä¿¡æ¯ä¸»è¦çš„ä½œç”¨æ˜¯æè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼ˆåŒ…æ‹¬æ•°é‡ã€ç±»å‹ä¸é¡ºåºï¼‰ä¸è¿”å›å€¼ã€‚æ ¹æ®æè¿°ç¬¦è§„åˆ™ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹å’Œä»£è¡¨æ— è¿”å›çš„ void ç±»å‹éƒ½æ˜¯ç”¨ä¸€ä¸ªå¤§å†™å­—ç¬¦æ¥è¡¨ç¤ºï¼Œå¯¹è±¡ç±»å‹åˆ™ä½¿ç”¨å­—ç¬¦ L åŠ å¯¹è±¡çš„å…¨é™å®šåç§°æ¥è¡¨ç¤ºã€‚ä¸ºäº†å‹ç¼©å­—èŠ‚ç æ–‡ä»¶çš„ä½“ç§¯ï¼Œå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼ŒJVM éƒ½åªä½¿ç”¨ä¸€ä¸ªå¤§å†™å­—æ¯æ¥è¡¨ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šB - byteï¼ŒC - charï¼ŒD - doubleï¼ŒF - floatï¼ŒI - intï¼ŒJ - longï¼ŒS - shortï¼ŒZ - booleanï¼ŒV - voidï¼ŒL - å¯¹è±¡ç±»å‹ï¼Œå¦‚ Ljava/lang/String;ã€‚ å¯¹äºæ•°ç»„ç±»å‹æ¥è¯´ï¼Œæ²¡ä¸€ä¸ªç»´åº¦ä½¿ç”¨å‰ç½® [ æ¥è¡¨ç¤ºï¼Œå¦‚ int [] è¢«è®°å½•ä¸º [I ï¼ŒString[][] è¢«è®°å½•ä¸º [[Ljava/lang/String;ã€‚ ç”¨æè¿°ç¬¦æè¿°æ–¹æ³•æ—¶ï¼ŒæŒ‰ç…§å…ˆå‚æ•°åˆ—è¡¨ï¼Œåè¿”å›å€¼çš„é¡ºåºæ¥æè¿°ã€‚å‚æ•°åˆ—è¡¨æŒ‰ç…§å‚æ•°çš„ä¸¥æ ¼é¡ºåºæ”¾åœ¨ä¸€ç»„æ‹¬å·å†…ï¼Œå¦‚æ–¹æ³•ï¼šString getRealNameByIdAndNickName(int id, String name) çš„æè¿°ç¬¦ä¸ºï¼š(I, Ljava/lang/String;) Ljava/lang/String; æˆ‘ä»¬æ¥åˆ†æå‰é¢å‡ ä¸ªå¸¸é‡ï¼Œå¦‚å›¾ï¼š æˆ‘åç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶å¯¹æ¯”ï¼š 123456789101112131415161718192021222324Constant pool: #1 = Methodref #4.#20 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = Fieldref #3.#21 // com/cuzz/jvm/bytecode/MyTest01.a:I #3 = Class #22 // com/cuzz/jvm/bytecode/MyTest01 #4 = Class #23 // java/lang/Object #5 = Utf8 a #6 = Utf8 I #7 = Utf8 &lt;init&gt; #8 = Utf8 ()V #9 = Utf8 Code#10 = Utf8 LineNumberTable#11 = Utf8 LocalVariableTable#12 = Utf8 this#13 = Utf8 Lcom/cuzz/jvm/bytecode/MyTest01;#14 = Utf8 getA#15 = Utf8 ()I#16 = Utf8 setA#17 = Utf8 (I)V#18 = Utf8 SourceFile#19 = Utf8 MyTest01.java#20 = NameAndType #7:#8 // &quot;&lt;init&gt;&quot;:()V#21 = NameAndType #5:#6 // a:I#22 = Utf8 com/cuzz/jvm/bytecode/MyTest01#23 = Utf8 java/lang/Object 0A 00 04 00 14ï¼Œå¦‚å›¾ä¸­çš„æ ‡æ³¨å‡ºæ¥ï¼Œ0A å¯¹åº”å€¼ä¸º10ï¼Œåœ¨ä¸Šè¡¨çš„å¸¸é‡ä¸­ CONSTANT_Methodref_info ä¸­ï¼Œé‚£ä¹ˆåè¾¹çš„2ä¸ªå­—èŠ‚ 00 04 ï¼ˆåè¿›åˆ¶4ï¼‰å°±æ˜¯ U2ï¼ˆç¬¬ä¸€ä¸ªindexï¼‰ï¼Œå³æŒ‡å‘å£°æ˜æ–¹æ³•çš„ç±»æè¿°ç¬¦ CONSTANT_Class_info çš„ç´¢å¼•é¡¹ï¼Œè€Œç¬¬äºŒä¸ªç´¢å¼•ï¼ˆç¬¬äºŒä¸ªindexï¼‰00 14ï¼ˆåè¿›åˆ¶20ï¼‰ æŒ‡å‘åç§°åŠç±»å‹æè¿°ç¬¦ CONSTANT_NameAndType_info çš„ç´¢å¼•é¡¹ã€‚ç±»æè¿°æŒ‡å‘ #4 ï¼Œ#4 åˆæŒ‡å‘ #23ï¼Œæ‰€ä»¥æè¿°ä¸º java/lang/Objectï¼Œè€Œåç§°ä»¥åŠç±»å‹æè¿°ç¬¦æŒ‡å‘ #20ï¼Œ#20 æœ‰æŒ‡å‘ #7 å’Œ #8ï¼Œ&quot;&lt;init&gt;&quot;:()V è¡¨ç¤ºä¸ºæ„é€ æ–¹æ³•ã€‚ 09 00 03 00 15 ï¼Œ09 æ˜¯æ ‡å¿—ä½å¯¹ç”¨çš„æ˜¯ CONSTANT_Fieldref_infoï¼Œç¬¬ä¸€ä¸ªç´¢å¼•æŒ‡å‘çš„æ˜¯å£°æ˜å­—æ®µçš„ç±»æˆ–æ¥å£æè¿°ç¬¦ï¼ŒCONSTANT_Class_info çš„ç´¢å¼•é¡¹ï¼Œæ ¹ä¸Šé¢ä¸€æ ·åˆ†æã€‚ 07 00 16 ï¼Œ 00 16 åè¿›åˆ¶æ˜¯22 ï¼Œ07æ˜¯å¸¸é‡ CONSTANT_CLass_infoï¼Œåªæœ‰ä¸€ä¸ªindexï¼ŒæŒ‡å‘çš„æ˜¯æŒ‡å®šæƒé™å®šåå¸¸é‡é¡¹çš„ç´¢å¼•ï¼Œ 00 16 æ˜¯åè¿›åˆ¶22ã€‚ 07 00 17 ï¼Œ07æ˜¯å¸¸é‡ CONSTANT_CLass_infoï¼Œåªæœ‰ä¸€ä¸ªindexï¼ŒæŒ‡å‘çš„æ˜¯æŒ‡å®šæƒé™å®šåå¸¸é‡é¡¹çš„ç´¢å¼•ï¼Œ00 17 åè¿›åˆ¶æ˜¯23ã€‚ 01 00 01 61ï¼Œ01 æ˜¯ CONSTANT_Utf8_infoï¼Œåé¢ 00 01 è¿™ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºé•¿åº¦ï¼Œæœ€å 61 ï¼ˆåè¿›åˆ¶ä¸º97ï¼‰çš„è¡¨ç¤º ASCII ä¸­å¸¦ç´¢å¼•ï¼Œåœ¨ ASCII ä¸­ä¸ºå­—æ¯ aã€‚ 01 00 01 ä¸º Iã€‚ ç­‰ç­‰ Java å­—èŠ‚ç ç»“æ„ Class å­—èŠ‚ç ä¸­æœ‰ä¸¤ç§æ•°æ®ç±»å‹ å­—èŠ‚æ•°æ®ç›´æ¥é‡ï¼šè¿™æ˜¯åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå…±ç»†åˆ†ä¸º u1ã€u2ã€u4ã€u8 è¿™å››ç§ï¼Œåˆ†åˆ«ä»£è¡¨è¿ç»­çš„ 1 ä¸ªå­—èŠ‚ã€2 ä¸ªå­—èŠ‚ã€4 ä¸ªå­—èŠ‚å’Œ8 ä¸ªå­—èŠ‚ã€‚ è¡¨ï¼ˆæ•°ç»„ï¼‰ï¼šè¡¨ç¤ºæœ‰å¤šä¸ªåŸºæœ¬æ•°æ®æˆ–å…¶ä»–è¡¨ï¼ŒæŒ‰ç…§æ—¢å®šé¡ºåºç»„æˆçš„å¤§çš„æ•°æ®é›†åˆã€‚è¡¨ç¤ºæœ‰ç»“æ„çš„ï¼Œå®ƒçš„ç»“æ„ä½“ç°åœ¨ï¼Œç»„æˆè¡¨çš„æˆåˆ†æ‰€åœ¨çš„ä½ç½®å’Œé¡ºåºéƒ½å·²ç»ä¸¥æ ¼å®šä¹‰å¥½çš„ã€‚ è®¿é—®æ ‡å¿—è®¿é—®æ ‡å¿—ï¼ˆAccess_Flagï¼‰ä¿¡æ¯åŒ…æ‹¬è¯¥ Class æ–‡ä»¶æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Œæ˜¯å¦è¢«å®šä¹‰æˆ publicï¼Œæ˜¯å¦æ˜¯ abstractï¼Œå¦‚æœæ˜¯ç±»ï¼Œæ˜¯å¦è¢«å£°æ˜æˆ finalã€‚é€šè¿‡ä¸Šé¢çš„æºä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¯¥æ–‡ä»¶æ˜¯ç±»å¹¶ä¸”æ˜¯ publicã€‚ å¸¸é‡æ± ä¹‹åä¸¤ä¸ªå­—èŠ‚å°±æ˜¯è®¿é—®æ ‡å¿—ï¼Œæˆ‘ä»¬è¿™ä¸ªç±»ä¸­æ˜¯ 0x 00 21 ï¼Œä»ä¸Šé¢æ¥çœ‹å¹¶æ²¡æœ‰ï¼ŒåŸæ¥å®ƒæ˜¯ 0x 00 20 å’Œ 0x 00 01 çš„å¹¶é›†ï¼Œè¡¨ç¤º ACC_PUBLIC ä¸ ACC_SUPERã€‚ ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ä¸æ¥å£ç´¢å¼• 00 03 æ˜¯ç±»ç´¢å¼•ï¼ŒæŒ‡å‘ #3 è¡¨ç¤ºæ˜¯ä¸€ä¸ªç±»ï¼Œå…¶åå­—ä¸º com/cuzz/jvm/bytecode/MyTest01 00 04 æ˜¯çˆ¶äº²ç´¢å¼•ï¼ŒæŒ‡å‘ #4 è¡¨ç¤ºæ˜¯ä¸€ä¸ªç±»ï¼Œå…¶åå­—æ˜¯ java/lang/Object 00 00 æ˜¯æ¥å£ï¼Œè¡¨ç¤ºæ²¡æœ‰æ¥å£ å­—æ®µè¡¨é›†åˆå­—æ®µè¡¨ç”¨äºæè¿°ç±»å’Œæ¥å£ä¸­å£°æ˜çš„å˜é‡ã€‚è¿™é‡Œçš„å­—æ®µåŒ…å«äº†ç±»çº§åˆ«å˜é‡ä»¥åŠå®ä¾‹å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬æ–¹æ³•å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚ å¦‚ä¸‹å›¾ 00 01 æ˜¯æˆå‘˜å˜é‡çš„æ•°é‡ï¼Œåé¢æ¥ç€å°±æ˜¯ field_info æˆå‘˜å˜é‡ä¿¡æ¯ 1234567field_info &#123; u2 access_flags; // 0002 è¡¨ç¤ºç§æœ‰ private u2 name_index; // 0005 è¡¨ç¤º a u2 descriptor_index; // 0006 è¡¨ç¤º I u2 attributes_count; // 0000 æ²¡æœ‰ attribute_info attributes[attributes_count];&#125; æ–¹æ³•è¡¨åˆšå¼€å§‹çš„ 00 03 è¡¨ç¤ºæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œé™¤äº†getter/setter è¿˜æœ‰é»˜è®¤æ„é€ æ–¹æ³• 1234567methods_count &#123; u2 access_flags; // 0001 è¡¨ç¤º public u2 name_index; // 0007 æŒ‡å‘å¸¸é‡æ± ä¸­ #7 çš„å¸¸é‡ä¸º &lt;init&gt; u2 descriptor_index; // 0008 æŒ‡å‘å¸¸é‡æ± ä¸­ #8 çš„å¸¸é‡ä¸º ()V u2 attributes_count; // 0001 è¡¨ç¤ºä¸€ä¸ªå±æ€§ attribute_info attributes[attributes_count];&#125; æ–¹æ³•ä¸­çš„å±æ€§ç»“æ„ 12345attribute_info &#123; u2 attribute_name_index; // 0009 æŒ‡å‘å¸¸é‡æ± ä¸­ #9 ä¸º Code u4 attribute_length; // 0000 0038 è¡¨ç¤ºé•¿åº¦ä¸º 0x38 ä¸º 56 é•¿åº¦çš„å­—èŠ‚ u1 info[attribute_length];&#125; Code ç»“æ„Code attribute çš„ä½œç”¨æ˜¯ä¿å­˜è¯¥æ–¹æ³•çš„ç»“æ„ï¼Œå¦‚æ‰€å¯¹åº”çš„å­—èŠ‚ç  1234567891011121314151617Code_attribute &#123; u2 attribute_name_index; u4 attribute_length; u2 max_stack; u2 max_locals; u4 code_length; u1 code[code_length]; u2 exception_table_length; &#123; u2 start_pc; u2 end_pc; u2 handler_pc; u2 catch_type; &#125; exception_table[exception_table_length]; u2 attributes_count; attribute_info attributes[attributes_count];&#125; attribute_length è¡¨ç¤º attribute æ‰€åŒ…å«çš„å­—èŠ‚æ•°ï¼Œä¸åŒ…å« attribute_name_index å’Œ attribute_length å­—æ®µ max_stack è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•è¿è¡Œçš„ä»»ä½•æ—¶åˆ»æ‰€èƒ½è¾¾åˆ°çš„æ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦ max_locals è¡¨ç¤ºæ–¹æ³•æ‰§è¡ŒæœŸé—´åˆ›å»ºçš„å±€éƒ¨å˜é‡çš„æ•°ç›®ï¼ŒåŒ…å«ç”¨æ¥è¡¨ç¤ºä¼ å…¥çš„å‚æ•°çš„å±€éƒ¨å˜é‡ code_length è¡¨ç¤ºè¯¥æ–¹æ³•æ‰€åŒ…å«çš„å­—èŠ‚ç çš„å­—èŠ‚æ•°ä»¥åŠå…·ä½“çš„æŒ‡ä»¤ç ï¼Œå…·ä½“å­—èŠ‚ç å³æ˜¯è¯¥æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œè™šæ‹Ÿæœºæ‰€æ‰§è¡Œçš„å­—èŠ‚ç  exception_table è¡¨ç¤ºå­˜æ”¾çš„æ˜¯å¤„ç†å¼‚å¸¸çš„ä¿¡æ¯ æ¯ä¸ª exception_table è¡¨ç”± start_pcï¼Œend_pcï¼Œhandler_pcï¼Œcatch_type ç»„æˆ start_pc å’Œ end_pc è¡¨ç¤ºåœ¨ code æ•°ç»„ä¸­çš„ä» start_pc åˆ° end_pc å¤„ï¼ˆåŒ…å« start_pcï¼Œä¸åŒ…å« end_pcï¼‰çš„æŒ‡ä»¤æŠ›å‡ºçš„å¼‚å¸¸ä¼šç”±è¿™ä¸ªè¡¨é¡¹æ¥å¤„ç† handler_pc è¡¨ç¤ºå¤„ç†å¼‚å¸¸çš„ä»£ç çš„å¼€å§‹å¤„ï¼Œcatch_type è¡¨ç¤ºä¼šè¢«å¤„ç†çš„å¼‚å¸¸ç±»å‹ï¼Œå®ƒæŒ‡å‘å¸¸é‡æ± ä¸­çš„ä¸€ä¸ªå¼‚å¸¸ç±»ï¼Œå½“ catch_type ä¸º 0 æ—¶ï¼Œè¡¨ç¤ºå¤„ç†æ‰€æœ‰çš„å¼‚å¸¸ å­—èŠ‚ç æŸ¥çœ‹å·¥å…·https://github.com/ingokegel/jclasslib]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆäºŒï¼‰]]></title>
    <url>%2F2019%2F01%2F29%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ClassLoaderæ–‡æ¡£ï¼šhttps://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html public abstract class ClassLoader extends Object A class loader is an object that is responsible for loading classes. The class ClassLoader is an abstract class. Given the binary name of a class, a class loader should attempt to locate or generate data that constitutes a definition for the class. A typical strategy is to transform the name into a file name and then read a â€œclass fileâ€ of that name from a file system. Every Class object contains a reference) to the ClassLoader that defined it. Class objects for array classes are not created by class loaders, but are created automatically as required by the Java runtime. The class loader for an array class, as returned by Class.getClassLoader()) is the same as the class loader for its element type; if the element type is a primitive type, then the array class has no class loader. Applications implement subclasses of ClassLoader in order to extend the manner in which the Java virtual machine dynamically loads classes. Class loaders may typically be used by security managers to indicate security domains. The ClassLoader class uses a delegation model to search for classes and resources. Each instance of ClassLoader has an associated parent class loader. When requested to find a class or resource, a ClassLoader instance will delegate the search for the class or resource to its parent class loader before attempting to find the class or resource itself. The virtual machineâ€™s built-in class loader, called the â€œbootstrap class loaderâ€, does not itself have a parent but may serve as the parent of a ClassLoader instance. Class loaders that support concurrent loading of classes are known as parallel capable class loaders and are required to register themselves at their class initialization time by invoking the ClassLoader.registerAsParallelCapable) method. Note that the ClassLoader class is registered as parallel capable by default. However, its subclasses still need to register themselves if they are parallel capable. In environments in which the delegation model is not strictly hierarchical, class loaders need to be parallel capable, otherwise class loading can lead to deadlocks because the loader lock is held for the duration of the class loading process (see loadClass) methods). Normally, the Java virtual machine loads classes from the local file system in a platform-dependent manner. For example, on UNIX systems, the virtual machine loads classes from the directory defined by the CLASSPATH environment variable. However, some classes may not originate from a file; they may originate from other sources, such as the network, or they could be constructed by an application. The method defineClass) converts an array of bytes into an instance of class Class. Instances of this newly defined class can be created using Class.newInstance). The methods and constructors of objects created by a class loader may reference other classes. To determine the class(es) referred to, the Java virtual machine invokes the loadClass) method of the class loader that originally created the class. For example, an application could create a network class loader to download class files from a server. Sample code might look like: 1234&gt; ClassLoader loader = new NetworkClassLoader(host, port);&gt; Object main = loader.loadClass(&quot;Main&quot;, true).newInstance();&gt; . . .&gt; &gt; The network class loader subclass must define the methods findClass) and loadClassData to load a class from the network. Once it has downloaded the bytes that make up the class, it should use the method defineClass) to create a class instance. A sample implementation is: 123456789101112131415&gt; class NetworkClassLoader extends ClassLoader &#123;&gt; String host;&gt; int port;&gt; &gt; public Class findClass(String name) &#123;&gt; byte[] b = loadClassData(name);&gt; return defineClass(name, b, 0, b.length);&gt; &#125;&gt; &gt; private byte[] loadClassData(String name) &#123;&gt; // load the class data from the connection&gt; . . .&gt; &#125;&gt; &#125;&gt; &gt; Binary names Any class name provided as a String parameter to methods in ClassLoader must be a binary name as defined by The Javaâ„¢ Language Specification. Examples of valid class names include: 12345&gt; &quot;java.lang.String&quot; // ä¸€ä¸ªç±»&gt; &quot;javax.swing.JSpinner$DefaultEditor&quot; // ä¸€ä¸ªå†…éƒ¨ç±»&gt; &quot;java.security.KeyStore$Builder$FileBuilder$1&quot; // å†…éƒ¨ç±»çš„åŒ¿åç±»&gt; &quot;java.net.URLClassLoader$3$1&quot; // åŒ¿åç±»çš„åŒ¿åç±»&gt; æˆ‘ä»¬çŸ¥é“ç±»çš„åŠ è½½æ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ 12345678910public class MyTest15 &#123; public static void main(String[] args) &#123; ClassLoader loader = MyTest15.class.getClassLoader(); System.out.println(loader); ClassLoader loader1 = loader.getParent(); System.out.println(loader1); ClassLoader loader2 = loader1.getParent(); System.out.println(loader2); &#125;&#125; è¾“å‡º 123sun.misc.Launcher$AppClassLoader@dad5dcsun.misc.Launcher$ExtClassLoader@16d3586null å½“ä¸ºæ ¹åŠ è½½å™¨æ—¶ï¼Œè¿”å›null çœ‹äº†æ–‡æ¡£ï¼Œå†™ä¸€ä¸ªè‡ªå®šä¹‰ ClassLoader 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061/** * @Author: cuzz * @Date: 2019/1/28 12:39 * @Description: */public class MyClassLoader extends ClassLoader&#123; private String classLoaderName; private final String fileExtension = ".class"; public MyClassLoader(String classLoaderName) &#123; super(); // å°†ç³»ç»Ÿç±»åŠ è½½å½“åšè¯¥ç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨ this.classLoaderName = classLoaderName; &#125; public MyClassLoader(ClassLoader parent, String classLoaderName) &#123; super(parent); // æ˜¾ç¤ºæŒ‡å®šè¯¥ç±»åŠ è½½çš„çˆ¶åŠ è½½å™¨ this.classLoaderName = classLoaderName; &#125; @Override protected Class&lt;?&gt; findClass(String className) throws ClassNotFoundException &#123; byte[] data = loadClassData(className); return defineClass(className, data,0, data.length); &#125; private byte[] loadClassData(String name) &#123; InputStream is = null; byte[] data = null; ByteArrayOutputStream baos = null; try &#123; this.classLoaderName = this.classLoaderName.replace(".", "/"); is = new FileInputStream(new File(name, this.fileExtension)); baos = new ByteArrayOutputStream(); int ch; while (-1 != (ch = is.read())) &#123; baos.write(ch); &#125; data = baos.toByteArray(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; is.close(); baos.close(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; return data; &#125; public static void main(String[] args) throws Exception&#123; MyClassLoader myClassLoader = new MyClassLoader("myLoader"); Class&lt;?&gt; clazz = myClassLoader.loadClass("com.cuzz.jvm.classloader.MyTest01"); Object o = clazz.newInstance(); // è·å–å®ä¾‹å¯¹è±¡ System.out.println("ç±»åŠ è½½å™¨ï¼š" + clazz.getClassLoader()); System.out.println(o); &#125;&#125; è¾“å‡º 12ç±»åŠ è½½å™¨ï¼šsun.misc.Launcher$AppClassLoader@dad5dccom.cuzz.jvm.classloader.MyTest01@16d3586 æˆ‘ä»¬ç¼–å†™çš„ç±»åŠ è½½å™¨ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºåŒäº²å§”æ´¾æœºåˆ¶ï¼Œå½“æˆ‘ä»¬å°è¯•ä½¿ç”¨è‡ªå·±ç¼–å†™çš„ç±»åŠ è½½å™¨å»åŠ è½½æ—¶ï¼Œå®ƒä¼šå§”æ´¾è‡ªå·±çš„åŒäº²å»åŠ è½½ï¼Œåˆšå¥½ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆåº”ç”¨ç±»åŠ è½½å™¨ï¼‰å°±èƒ½åŠ è½½ï¼Œæ‰€ä»¥ä¸ä¼šä½¿ç”¨æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ç±»åŠ è½½å™¨ï¼Œè€Œä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ å¦‚æœæˆ‘ä»¬æŠŠè·¯å¾„æ¢ä¸€ä¸‹ï¼ŒæŠŠé¡¹ç›®è·¯å¾„ä¸‹ classes ä¸­çš„ MyTest01.class æ–‡ä»¶ç§»åŠ¨åœ¨åˆ«çš„åœ°æ–¹ï¼Œè®©ç³»ç»Ÿç±»åŠ è½½å™¨æ‰¾ä¸åˆ°ï¼Œç„¶åå®ƒå°±ä¼šè°ƒç”¨æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ç±»åŠ è½½å™¨åŠ è½½ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465public class MyClassLoader extends ClassLoader&#123; private String classLoaderName; private final String fileExtension = ".class"; private String path; public MyClassLoader(String classLoaderName) &#123; super(); // å°†ç³»ç»Ÿç±»åŠ è½½å½“åšè¯¥ç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨ this.classLoaderName = classLoaderName; &#125; public MyClassLoader(ClassLoader parent, String classLoaderName) &#123; super(parent); // æ˜¾ç¤ºæŒ‡å®šè¯¥ç±»åŠ è½½çš„çˆ¶åŠ è½½å™¨ this.classLoaderName = classLoaderName; &#125; public void setPath(String path) &#123; this.path = path; &#125; @Override protected Class&lt;?&gt; findClass(String className) throws ClassNotFoundException &#123; byte[] data = loadClassData(className); return defineClass(className, data,0, data.length); &#125; private byte[] loadClassData(String name) &#123; InputStream is = null; byte[] data = null; ByteArrayOutputStream baos = null; name = name.replace(".", "\\"); try &#123; is = new FileInputStream(new File(this.path + name + this.fileExtension)); baos = new ByteArrayOutputStream(); int ch; while (-1 != (ch = is.read())) &#123; baos.write(ch); &#125; data = baos.toByteArray(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; is.close(); baos.close(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; return data; &#125; public static void main(String[] args) throws Exception&#123; MyClassLoader myClassLoader = new MyClassLoader("myLoader"); // Class&lt;?&gt; clazz = myClassLoader.loadClass("com.cuzz.jvm.classloader.MyTest01"); String path = "C:/Users/my/Desktop/"; myClassLoader.setPath(path); Class&lt;?&gt; clazz = myClassLoader.loadClass("com.cuzz.jvm.classloader.MyTest01"); Object o = clazz.newInstance(); // è·å–å®ä¾‹å¯¹è±¡ System.out.println("ç±»åŠ è½½å™¨ï¼š" + clazz.getClassLoader()); System.out.println("çˆ¶ç±»åŠ è½½å™¨ï¼š" + myClassLoader.getParent()); System.out.println(o); &#125;&#125; è¾“å‡º 123ç±»åŠ è½½å™¨ï¼šcom.cuzz.jvm.classloader.MyClassLoader@16d3586çˆ¶ç±»åŠ è½½å™¨ï¼šsun.misc.Launcher$AppClassLoader@dad5dccom.cuzz.jvm.classloader.MyTest01@a14482 defineClasjava.lang.ClassLoader#defineClass(java.lang.String, byte[], int, int) 123protected final Class&lt;?&gt; defineClass(String name, byte[] b, int off, int len) throws ClassFormatError &#123; return defineClass(name, b, off, len, null);&#125; é€šè¿‡ä¸€ä¸ªå­—èŠ‚æ•°ç»„è¿”å›ä¸€ä¸ª Class çš„å®ä¾‹ loadClassjava.lang.ClassLoader#loadClass(java.lang.String, boolean) æ–‡æ¡£ï¼š java.lang.ClassLoaderprotected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundExceptionLoads the class with the specified binary name. The default implementation of this method searches for classes in the following order: Invoke findLoadedClass(String) to check if the class has already been loaded. Invoke the loadClass method on the parent class loader. If the parent is null the class loader built-in to the virtual machine is used, instead. Invoke the findClass(String) method to find the class. If the class was found using the above steps, and the resolve flag is true, this method will then invoke the resolveClass(Class) method on the resulting Class object.Subclasses of ClassLoader are encouraged to override findClass(String), rather than this method.Unless overridden, this method synchronizes on the result of getClassLoadingLock method during the entire class loading process.Parameters: name - The binary name of the class resolve - If true then resolve the class 12345678910111213141516171819202122232425262728293031323334353637protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException&#123; synchronized (getClassLoadingLock(name)) &#123; // First, check if the class has already been loaded Class&lt;?&gt; c = findLoadedClass(name); if (c == null) &#123; long t0 = System.nanoTime(); try &#123; if (parent != null) &#123; c = parent.loadClass(name, false); &#125; else &#123; c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; if (c == null) &#123; // If still not found, then invoke findClass in order // to find the class. long t1 = System.nanoTime(); c = findClass(name); // æˆ‘ä»¬åªéœ€è¦é‡å†™è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥ // this is the defining class loader; record the stats sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; if (resolve) &#123; resolveClass(c); &#125; return c; &#125;&#125; å‘½åç©ºé—´æ¯ä¸€ä¸ªç±»åŠ è½½å™¨æ–—é±¼è‡ªå·±çš„å‘½åç©ºé—´ï¼Œå‘½åç©ºé—´ç”±è¯¥åŠ è½½å™¨åŠæ‰€æœ‰çˆ¶ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ç»„æˆï¼Œåœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸­ï¼Œä¸ä¼šå‡ºç°ç±»çš„å®Œæ•´åå­—ï¼ˆåŒ…æ‹¬ç±»çš„åŒ…åï¼‰ç›¸åŒçš„ä¸¤ä¸ªç±»ï¼Œåœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ç±»çš„å®Œæ•´åå­—ï¼ˆåŒ…æ‹¬ç±»çš„åŒ…åï¼‰ç›¸åŒçš„ä¸¤ä¸ªç±» 1234567891011public static void main(String[] args) throws Exception&#123; MyClassLoader myClassLoader = new MyClassLoader("myLoader"); MyClassLoader myClassLoader1 = new MyClassLoader("myLoader1"); String path = "C:/Users/my/Desktop/"; myClassLoader.setPath(path); myClassLoader1.setPath(path); Class&lt;?&gt; clazz = myClassLoader.loadClass("com.cuzz.jvm.classloader.MyTest01"); Class&lt;?&gt; clazz1 = myClassLoader1.loadClass("com.cuzz.jvm.classloader.MyTest01"); System.out.println("clazz: " + clazz.hashCode()); System.out.println("clazz1: " + clazz1.hashCode());&#125; è¾“å‡º 12clazz: 24324022clazz1: 21685669 è¯´æ˜ç±»è¢«åŠ è½½äº†ä¸¤æ¬¡ï¼Œè¿™å°±æ˜¯ç”±ä¸åŒçš„å‘½åç©ºé—´å¯¼è‡´çš„ å¦‚æœæˆ‘ä»¬ç»™ myClassLoader1 æ·»åŠ ä¸€ä¸ªçˆ¶åŠ è½½å™¨ 123456789101112public static void main(String[] args) throws Exception&#123; MyClassLoader myClassLoader = new MyClassLoader("myLoader"); // æŠŠ myClassLoader å½“åšçˆ¶åŠ è½½å™¨ MyClassLoader myClassLoader1 = new MyClassLoader(myClassLoader,"myLoader1"); String path = "C:/Users/my/Desktop/"; myClassLoader.setPath(path); myClassLoader1.setPath(path); Class&lt;?&gt; clazz = myClassLoader.loadClass("com.cuzz.jvm.classloader.MyTest01"); Class&lt;?&gt; clazz1 = myClassLoader1.loadClass("com.cuzz.jvm.classloader.MyTest01"); System.out.println("clazz: " + clazz.hashCode()); System.out.println("clazz1: " + clazz1.hashCode());&#125; è¾“å‡º 12clazz: 10568834clazz1: 10568834 ç”±äºçˆ¶åŠ è½½å™¨å·²ç»åŠ è½½è¿‡äº†ï¼Œæ‰€ä»¥å°±ä¸ä¼šåŠ è½½äº† ç±»çš„å¸è½½ç”± Java è™šæ‹Ÿæœºè‡ªå¸¦çš„ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ï¼Œåœ¨è™šæ‹Ÿæœºçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå§‹ç»ˆä¸ä¼šè¢«å¸è½½ã€‚å‰é¢å·²ç»ä»‹ç»è¿‡ï¼ŒJava è™šæ‹Ÿæœºè‡ªå¸¦çš„ç±»åŠ è½½å™¨åŒ…æ‹¬æ ¹ç±»åŠ è½½å™¨ã€æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨ã€‚Java è™šæ‹Ÿæœºæœ¬èº«ä¼šå§‹ç»ˆå¼•ç”¨è¿™äº›ç±»åŠ è½½å™¨ï¼Œè€Œè¿™äº›ç±»åŠ è½½å™¨åˆ™ä¼šå§‹ç»ˆå¼•ç”¨å®ƒä»¬æ‰€åŠ è½½ç±»çš„ Class å¯¹è±¡ï¼Œå› æ­¤è¿™äº› Class å¯¹è±¡å§‹ç»ˆæ˜¯å¯è§¦åŠçš„ è€Œç”±ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»æ˜¯å¯ä»¥è¢«å¸è½½çš„ ç±»åŠ è½½å™¨å‘½åç©ºé—´æ·±åº¦è§£æé€šè¿‡ä¸€ä¸ªä¾‹å­æ¥åˆ†æ MyCat 12345public class MyCat &#123; public MyCat() &#123; System.out.println("MyCat is loaded by: " + this.getClass().getClassLoader()); &#125;&#125; MySample 123456public class MySample &#123; public MySample () &#123; System.out.println("MySample is loaded by:" + this.getClass().getClassLoader()); new MyCat (); &#125;&#125; MyClassLoader 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061public class MyClassLoader extends ClassLoader&#123; private String classLoaderName; private final String fileExtension = ".class"; private String path; public MyClassLoader(String classLoaderName) &#123; super(); // å°†ç³»ç»Ÿç±»åŠ è½½å½“åšè¯¥ç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨ this.classLoaderName = classLoaderName; &#125; public MyClassLoader(ClassLoader parent, String classLoaderName) &#123; super(parent); // æ˜¾ç¤ºæŒ‡å®šè¯¥ç±»åŠ è½½çš„çˆ¶åŠ è½½å™¨ this.classLoaderName = classLoaderName; &#125; public void setPath(String path) &#123; this.path = path; &#125; @Override protected Class&lt;?&gt; findClass(String className) throws ClassNotFoundException &#123; byte[] data = loadClassData(className); return defineClass(className, data,0, data.length); &#125; private byte[] loadClassData(String name) &#123; InputStream is = null; byte[] data = null; ByteArrayOutputStream baos = null; name = name.replace(".", "\\"); try &#123; is = new FileInputStream(new File(this.path + name + this.fileExtension)); baos = new ByteArrayOutputStream(); int ch; while (-1 != (ch = is.read())) &#123; baos.write(ch); &#125; data = baos.toByteArray(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; is.close(); baos.close(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; return data; &#125; public static void main(String[] args) throws Exception&#123; MyClassLoader myClassLoader = new MyClassLoader("myLoader"); String path = "C:/Users/my/Desktop/"; myClassLoader.setPath(path); Class&lt;?&gt; clazz = myClassLoader.loadClass("com.cuzz.jvm.classloader.MySample"); Object object = clazz.newInstance(); &#125;&#125; è¾“å‡º 12MySample is loaded by: sun.misc.Launcher$AppClassLoader@dad5dcMyCat is loaded by: sun.misc.Launcher$AppClassLoader@dad5dc æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬è‡ªå·±å†™çš„ ClassLoader ä¸å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½ï¼Œæ‰€ä»¥æ˜¯ç³»ç»ŸåŠ è½½å™¨åŠ è½½çš„ ç°åœ¨æˆ‘ä»¬æŠŠé¡¹ç›®ä¸‹ classes è·¯å¾„ä¸­çš„ MySample.class å’Œ MyCat.class åˆ é™¤ï¼Œå¹¶å¤åˆ¶ä¸€ä»½åˆ°æ¡Œé¢ åˆ™è¾“å‡º 12MySample is loaded by: com.cuzz.jvm.classloader.MyClassLoader@16d3586MyCat is loaded by: com.cuzz.jvm.classloader.MyClassLoader@16d3586 ç”±äºå§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ä¸åˆ°å°±ç”¨è‡ªå·±åŠ è½½å™¨åŠ è½½ å¦‚æœæˆ‘ä»¬åªæŠŠå½“å‰ç±»è·¯å¾„ä¸‹ MySample.class è¿™ç»™æ–‡ä»¶åˆ æ‰ï¼Œä¿ç•™ MyCat.class æ–‡ä»¶ï¼Œåˆ™è¾“å‡º 12MySample is loaded by: com.cuzz.jvm.classloader.MyClassLoader@16d3586MyCat is loaded by: sun.misc.Launcher$AppClassLoader@dad5dc æˆ‘ä»¬çŸ¥é“ MySample æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰ç±»åŠ è½½åŠ è½½å‡ºæ¥çš„ï¼ŒMyCat æ˜¯æœ‰ç³»ç»Ÿç±»åŠ è½½åŠ è½½çš„ 1234567public class MySample &#123; public MySample () &#123; System.out.println(&quot;MySample is loaded by: &quot; + this.getClass().getClassLoader()); new MyCat (); System.out.println(MyCat.class); &#125;&#125; è¾“å‡º 123MySample is loaded by: com.cuzz.jvm.classloader.MyClassLoader@16d3586MyCat is loaded by: sun.misc.Launcher$AppClassLoader@dad5dcclass com.cuzz.jvm.classloader.MyCat è¯´æ˜è‡ªå®šä¹‰ç±»åŠ è½½åŠ è½½çš„ç±»ï¼Œå¯ä»¥è®¿é—®ç³»ç»Ÿç±»åŠ è½½åŠ è½½çš„ç±» å¦‚æœæˆ‘ä»¬åœ¨ç³»ç»Ÿç±»åŠ è½½çš„ç±»ä¸­è®¿é—®è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½çš„ç±» 123456public class MyCat &#123; public MyCat() &#123; System.out.println(&quot;MyCat is loaded by: &quot; + this.getClass().getClassLoader()); System.out.println(MySample.class); &#125;&#125; è¾“å‡º 1234567891011121314151617MySample is loaded by: com.cuzz.jvm.classloader.MyClassLoader@16d3586MyCat is loaded by: sun.misc.Launcher$AppClassLoader@dad5dcException in thread &quot;main&quot; java.lang.NoClassDefFoundError: com/cuzz/jvm/classloader/MySample at com.cuzz.jvm.classloader.MyCat.&lt;init&gt;(MyCat.java:6) at com.cuzz.jvm.classloader.MySample.&lt;init&gt;(MySample.java:6) at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) at java.lang.reflect.Constructor.newInstance(Constructor.java:422) at java.lang.Class.newInstance(Class.java:442) at com.cuzz.jvm.classloader.MyClassLoader.main(MyClassLoader.java:68)Caused by: java.lang.ClassNotFoundException: com.cuzz.jvm.classloader.MySample at java.net.URLClassLoader.findClass(URLClassLoader.java:381) at java.lang.ClassLoader.loadClass(ClassLoader.java:424) at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331) at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ... 8 more æŠ¥é”™ï¼Œè¯´æ˜ç³»ç»ŸåŠ è½½å™¨åŠ è½½çš„ç±»ä¸èƒ½è®¿é—®è‡ªå®šä¹‰åŠ è½½å™¨åŠ è½½çš„ç±» è¯´æ˜å½“æˆ‘ç°åœ¨åŠ è½½ MySample è¿™ä¸ªç±»æ—¶ï¼Œä½¿ç”¨çš„æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œç„¶ååˆå§‹å®ä¾‹åŒ–è¿™ä¸ªç±»æ—¶ï¼Œéœ€è¦åˆå§‹åŒ– MyCat è¿™ä¸ªç±»ï¼Œæ‰€ä»¥ä¼šå…ˆå§”æ‰˜çˆ¶åŠ è½½å™¨ï¼ˆç³»ç»ŸåŠ è½½å™¨ï¼‰å»åŠ è½½ ä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠå½“å‰è·¯å¾„ä¸‹çš„ MyCat.class æ–‡ä»¶åˆ æ‰ï¼Œä¿ç•™ MySample.class æ–‡ä»¶ï¼Œåˆ™æŠ¥é”™ 123456789101112131415Exception in thread &quot;main&quot; MySample is loaded by: sun.misc.Launcher$AppClassLoader@dad5dcjava.lang.NoClassDefFoundError: com/cuzz/jvm/classloader/MyCat at com.cuzz.jvm.classloader.MySample.&lt;init&gt;(MySample.java:6) at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) at java.lang.reflect.Constructor.newInstance(Constructor.java:422) at java.lang.Class.newInstance(Class.java:442) at com.cuzz.jvm.classloader.MyClassLoader.main(MyClassLoader.java:68)Caused by: java.lang.ClassNotFoundException: com.cuzz.jvm.classloader.MyCat at java.net.URLClassLoader.findClass(URLClassLoader.java:381) at java.lang.ClassLoader.loadClass(ClassLoader.java:424) at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331) at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ... 7 more æˆ‘è¦åŠ è½½ MySample å…ˆå§”æ‰˜ç³»ç»Ÿç±»åŠ è½½åŠ è½½ï¼Œå‘ç°èƒ½åŠ è½½åˆ°ï¼Œç„¶åå†æƒ³åŠ è½½ MyCat è¿™ä¸ªç±»ï¼Œæ­¤æ—¶å®ƒä¼šè°ƒç”¨ç³»ç»ŸåŠ è½½å™¨çš„çˆ¶ç±»å»åŠ è½½ï¼Œå‘ç°åŠ è½½ä¸åˆ°ï¼Œè‡ªå·±ä¹Ÿä¸èƒ½åŠ è½½ï¼Œå°±æŠ¥é”™äº†ã€‚ é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š å­ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»èƒ½å¤Ÿè®¿é—®åˆ°çˆ¶åŠ è½½å™¨æ‰€åŠ è½½çš„ç±» çˆ¶ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»æ— æ³•è®¿é—®åˆ°å­åŠ è½½å™¨æ‰€åŠ è½½çš„ç±» ç±»åŠ è½½å™¨çš„åŒäº²å§”æ‰˜æ¨¡å‹çš„å¥½å¤„å¯ä»¥ç¡®ä¿ Java æ ¸å¿ƒåº“çš„ç±»å‹å®‰å…¨ï¼šæ‰€æœ‰çš„ Java åº”ç”¨éƒ½è‡³å°‘ä¼šå¼•ç”¨ java.lang.Object ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡ŒæœŸï¼Œjava.lang.Object è¿™ä¸ªç±»ä¼šè¢«åŠ è½½åˆ° Java è™šæ‹Ÿæœºä¸­ï¼›å¦‚æœè¿™ä¸ªåŠ è½½è¿‡ç¨‹æ˜¯ç”± Java åº”ç”¨è‡ªå·±çš„ç±»åŠ è½½æ‰€å®Œæˆçš„ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½å°±ä¼šåœ¨ JVM ä¸­å­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„ java.lang.Object äº†ï¼Œè€Œè¿™äº›ç±»ä¹‹é—´è¿˜æ˜¯ä¸å…¼å®¹çš„ï¼Œç›¸äº’ä¸å¯è§ï¼ˆæ­£æ˜¯å‘½åç©ºé—´å‘æŒ¥ç€ä½œç”¨ï¼‰ã€‚å¯ä»¥ç¡®ä¿ Java æ ¸å¿ƒç±»åº“æ‰€æä¾›çš„ç±»ä¸ä¼šè¢«è‡ªå®šä¹‰çš„ç±»æ‰€å–ä»£ã€‚ä¸åŒçš„ç±»åŠ è½½å™¨å¯ä»¥ä¸ºç›¸åŒçš„åç§°ï¼ˆbinary nameï¼‰çš„ç±»åˆ›å»ºé¢å¤–çš„å‘½åç©ºé—´ã€‚ç›¸åŒçš„åç§°çš„ç±»å¯ä»¥å¹¶å­˜åœ¨ Java è™šæ‹Ÿæœºä¸­ï¼Œåªè¦ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨æ¥åŠ è½½å®ƒä»¬å³å¯ï¼ˆå¯æ˜¯æ˜¯ä¸åŒçš„ç±»åŠ è½½å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸åŒç±»åŠ è½½å™¨çš„ä¸åŒå®ä¾‹ï¼‰ã€‚ä¸åŒçš„ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ä¹‹é—´æ˜¯ä¸å…¼å®¹çš„ï¼Œå°±ç›¸åŒäºåœ¨ Java è™šæ‹Ÿæœºå†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªåˆä¸€ä¸ªç›¸äº’éš”ç¦»çš„ Java ç±»ç©ºé—´ï¼Œè¿™ç±»æŠ€æœ¯åœ¨å¾ˆå¤šæ¡†æ¶ä¸­éƒ½å¾—åˆ°äº†å®é™…çš„åº”ç”¨ã€‚ å†…å»ºäº JVM ä¸­çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¼šåŠ è½½ java.lang.ClassLoader ä»¥åŠå…¶ä»–çš„ Java å¹³å°ç±»ï¼Œå½“ JVM å¯åŠ¨æ—¶ï¼Œä¸€å—ç‰¹æ®Šçš„æœºå™¨ç ä¼šè¿è¡Œï¼Œå®ƒä¼šåŠ è½½æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œè¿™å—ç‰¹æ®Šçš„æœºå™¨ç å«åšå¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrapï¼‰ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨å¹¶ä¸æ˜¯ Java ç±»ï¼Œè€Œå…¶å®ƒåŠ è½½å™¨åˆ™éƒ½æ˜¯ Java ç±»ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨æ˜¯ç‰¹å®šäºå¹³å°çš„æœºå™¨æŒ‡ä»¤ï¼Œå®ƒè´Ÿè´£å¼€å¯æ•´ä¸ªåŠ è½½è¿‡ç¨‹ã€‚å¯åŠ¨ç±»åŠ è½½å™¨è¿˜ä¼šè´Ÿè´£åŠ è½½ JRE æ­£å¸¸è¿è¡Œæ‰€éœ€è¦çš„åŸºæœ¬ç»„ä»¶ï¼Œè¿™åŒ…æ‹¬ java.util ä¸ java.lang åŒ…ä¸­çš„ç±»ç­‰ç­‰ã€‚ Launcher ç±»æºç åˆ†æå‰é¢æˆ‘ä»¬åˆ†æç±» ClassLoaderï¼Œé‡Œé¢æœ‰ä¸€ä¸ªé™æ€æ–¹æ³• getSystemClassLoaderï¼Œå‘ç° ClassLoader æ˜¯ Launcher ä¸­ä¸€ä¸ªæˆå‘˜å˜é‡ 12345678910111213141516171819202122232425262728293031323334353637 @CallerSensitive public static ClassLoader getSystemClassLoader() &#123; initSystemClassLoader(); // åˆå§‹åŒ– if (scl == null) &#123; return null; &#125; SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; checkClassLoaderPermission(scl, Reflection.getCallerClass()); &#125; return scl; &#125; private static synchronized void initSystemClassLoader() &#123; if (!sclSet) &#123; if (scl != null) throw new IllegalStateException(&quot;recursive invocation&quot;); // è·å–ä¸€ä¸ª Launcher ç±» sun.misc.Launcher l = sun.misc.Launcher.getLauncher(); if (l != null) &#123; Throwable oops = null; // scl è¡¨ç¤º SystemClassLoader scl = l.getClassLoader(); try &#123; scl = AccessController.doPrivileged( new SystemClassLoaderAction(scl)); &#125; catch (PrivilegedActionException pae) &#123; oops = pae.getCause(); if (oops instanceof InvocationTargetException) &#123; oops = oops.getCause(); &#125; &#125; ... &#125; &#125; &#125;&#125; æˆ‘ä»¬åœ¨ideaé‡Œè¾¹çœ‹åˆ°çš„ sun.misc.Launcher.getLauncher() çš„å®ç°æ˜¯åç¼–è¯‘å·¥å…·ç»™å‡ºçš„ï¼Œoracleå¹¶æ²¡æœ‰ç»™å‡ºæºç ï¼Œå¯ä»¥åˆ°ç½‘ä¸ŠæŸ¥æ‰¾ç›¸å…³ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041private static Launcher launcher = new Launcher();private static String bootClassPath = System.getProperty("sun.boot.class.path"); public static Launcher getLauncher() &#123; return launcher; &#125; private ClassLoader loader; public Launcher() &#123; // Create the extension class loader ClassLoader extcl; try &#123; extcl = ExtClassLoader.getExtClassLoader(); &#125; catch (IOException e) &#123; throw new InternalError( "Could not create extension class loader"); &#125; // Now create the class loader to use to launch the application try &#123; loader = AppClassLoader.getAppClassLoader(extcl); &#125; catch (IOException e) &#123; throw new InternalError( "Could not create application class loader"); &#125; // Also set the context class loader for the primordial thread. Thread.currentThread().setContextClassLoader(loader); // Finally, install a security manager if requested String s = System.getProperty("java.security.manager"); ...... &#125; /* * Returns the class loader used to launch the main application. */ public ClassLoader getClassLoader() &#123; return loader; &#125; å¯ä»¥çœ‹åˆ° Launcher ç±»åˆå§‹åŒ–æ—¶ï¼Œå…ˆåˆå§‹åŒ–äº†ä¸ª ExtClassLoaderï¼Œç„¶ååˆåˆå§‹åŒ–äº†ä¸ª AppClassLoaderï¼Œç„¶åæŠŠExtClassLoader ä½œä¸º AppClassLoaderçš„çˆ¶ loaderï¼ŒExtClassLoader æ²¡æœ‰æŒ‡å®šçˆ¶ç±»ï¼Œå³è¡¨æ˜ï¼Œçˆ¶ç±»æ˜¯BootstrapClassLoaderã€‚æŠŠåˆå§‹åŒ– çš„AppClassLoader ä½œä¸ºå…¨å±€å˜é‡ä¿å­˜èµ·æ¥ï¼Œå¹¶è®¾ç½®åˆ°å½“å‰çº¿ç¨‹contextClassLoaderï¼Œæ¯ä¸ªçº¿ç¨‹å®ä¾‹å¯ä»¥è®¾ç½®ä¸€ä¸ª contextClassLoader ã€‚ å…ˆå›åˆ° initSystemClassLoader æ–¹æ³•ä¸­ï¼Œæœ‰è¿™ä¸€æ®µä»£ç  123456789try &#123; scl = AccessController.doPrivileged( new SystemClassLoaderAction(scl));&#125; catch (PrivilegedActionException pae) &#123; oops = pae.getCause(); if (oops instanceof InvocationTargetException) &#123; oops = oops.getCause(); &#125;&#125; æˆ‘ä»¬æŠŠç³»ç»ŸåŠ è½½ä¼ å…¥åˆ° doPrivileged ä¸­çš„ SystemClassLoaderAction ä¸­åˆè¿”å›äº†ç³»ç»ŸåŠ è½½å™¨ï¼Œæˆ‘ä»¬çœ‹çœ‹ SystemClassLoaderAction è¿™ä¸ªç±» 12345678910111213141516171819202122class SystemClassLoaderAction implements PrivilegedExceptionAction&lt;ClassLoader&gt; &#123; private ClassLoader parent; SystemClassLoaderAction(ClassLoader parent) &#123; this.parent = parent; &#125; public ClassLoader run() throws Exception &#123; String cls = System.getProperty("java.system.class.loader"); if (cls == null) &#123; return parent; &#125; Constructor&lt;?&gt; ctor = Class.forName(cls, true, parent) .getDeclaredConstructor(new Class&lt;?&gt;[] &#123; ClassLoader.class &#125;); ClassLoader sys = (ClassLoader) ctor.newInstance( new Object[] &#123; parent &#125;); Thread.currentThread().setContextClassLoader(sys); return sys; &#125;&#125; è¿™å—é€»è¾‘çš„ä½œç”¨æ˜¯çœ‹çœ‹æ˜¯å¦è®¾ç½®äº†ç³»ç»Ÿå±æ€§ java.system.class.loaderï¼Œå³è‡ªå®šä¹‰çš„ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œå¦‚æœè®¾ç½®äº†é‚£ä¹ˆå®ä¾‹åŒ–è‡ªå®šä¹‰çš„ç³»ç»Ÿç±»åŠ è½½å™¨è¿”å›ï¼Œæ›¿ä»£ä¹‹å‰è·å–çš„ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ç›´æ¥è¿”å›é»˜è®¤çš„ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ Class.forName()java.lang.Class#forName(java.lang.String, boolean, java.lang.ClassLoader) æ–‡æ¡£ï¼š java.lang.Classpublic static Class&lt;?&gt; forName(@NonNls String name, boolean initialize, ClassLoader loader) throws ClassNotFoundExceptionReturns the Class object associated with the class or interface with the given string name, using the given class loader. Given the fully qualified name for a class or interface (in the same format returned by getName) this method attempts to locate, load, and link the class or interface. The specified class loader is used to load the class or interface. If the parameter loader is null, the class is loaded through the bootstrap class loader. The class is initialized only if the initialize parameter is true and if it has not been initialized earlier.If name denotes a primitive type or void, an attempt will be made to locate a user-defined class in the unnamed package whose name is name. Therefore, this method cannot be used to obtain any of the Class objects representing primitive types or void.If name denotes an array class, the component type of the array class is loaded but not initialized.For example, in an instance method the expression:Class.forName(â€œFooâ€)is equivalent to:Class.forName(â€œFooâ€, true, this.getClass().getClassLoader())Note that this method throws errors related to loading, linking or initializing as specified in Sections 12.2, 12.3 and 12.4 of The Java Language Specification. Note that this method does not check whether the requested class is accessible to its caller.If the loader is null, and a security manager is present, and the callerâ€™s class loader is not null, then this method calls the security managerâ€™s checkPermission method with a RuntimePermission(â€œgetClassLoaderâ€) permission to ensure itâ€™s ok to access the bootstrap class loader.Parameters: name - fully qualified name of the desired class initialize - if true the class will be initialized. See Section 12.4 of The Java Language Specification. loader - class loader from which the class must be loaded ä»£ç ï¼š 123456789101112131415161718192021public static Class&lt;?&gt; forName(String name, boolean initialize, ClassLoader loader) throws ClassNotFoundException&#123; Class&lt;?&gt; caller = null; SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; // Reflective call to get caller class is only needed if a security manager // is present. Avoid the overhead of making this call otherwise. // è·å–è°ƒç”¨ forName æ–¹æ³•çš„çš„é‚£ä¸ªç±» caller = Reflection.getCallerClass(); if (sun.misc.VM.isSystemDomainLoader(loader)) &#123; ClassLoader ccl = ClassLoader.getClassLoader(caller); if (!sun.misc.VM.isSystemDomainLoader(ccl)) &#123; sm.checkPermission( SecurityConstants.GET_CLASSLOADER_PERMISSION); &#125; &#125; &#125; return forName0(name, initialize, loader, caller);&#125; çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åˆ†æä¸å®ç°æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½çš„ä½œç”¨ å‰è¨€çœ‹ä¸€ä¸ªç¨‹åºæ¥ä¸€ä¸‹æ„Ÿæ€§çš„è®¤è¯†ï¼š 123456public class MyTest24 &#123; public static void main(String[] args) System.out.println(Thread.currentThread().getContextClassLoader()); System.out.println(Thread.class.getClassLoader()); &#125;&#125; è¿™ä¸ªç¨‹åºçš„è¾“å‡ºæ˜¯ï¼š 12sun.misc.Launcher$AppClassLoader@18b4aac2null è§£æï¼šç¬¬ä¸€è¡Œå½“å‰çš„çº¿ç¨‹æ˜¯è¿è¡ŒMyTest24 çš„çº¿ç¨‹ï¼Œè€ŒMyTest24 æ˜¯ç”±ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½ï¼Œæ‰€ä»¥æ‰“å°çš„æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ç¬¬äºŒè¡ŒThreadç±»æ˜¯javaæ ¸å¿ƒåº“çš„ç±»ï¼Œæ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œæ‰€ä»¥ä¸æ‰“å° null å½“å‰ç±»åŠ è½½å™¨(Current ClassLoader) æ¯ä¸ªç±»éƒ½ä¼šä½¿ç”¨è‡ªå·±çš„ç±»åŠ è½½å™¨(å³åŠ è½½è‡ªèº«çš„ç±»åŠ è½½å™¨) æ¥å»åŠ è½½å…¶ä»–ç±»(æŒ‡çš„æ˜¯æ‰€ä¾èµ–çš„ç±») ï¼Œå¦‚æœClassAå¼•ç”¨äº†ClassYï¼Œé‚£ä¹ˆClassXçš„ç±»åŠ è½½å™¨å°±ä¼šåŠ è½½ClassYï¼ˆå‰ææ˜¯ClassYå°šæœªè¢«åŠ è½½ï¼‰ çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼ˆContext ClassLoaderï¼‰çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯ä»jdk1.2å¼€å§‹å¼•å…¥çš„ï¼Œç±»Threadä¸­çš„ getContextCLassLoader() ä¸setContextClassLoader(ClassLoader classloader) åˆ†åˆ«ç”¨æ¥è·å–å’Œè®¾ç½®ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡ä¸setContextClassLoader(ClassLoader classloader)è¿›è¡Œè®¾ç½®çš„è¯ï¼Œçº¿ç¨‹å°†ç»§æ‰¿å…¶çˆ¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚ Javaåº”ç”¨è¿è¡Œæ—¶çš„åˆå§‹çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åŠ è½½å™¨æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œåœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç å¯ä»¥é€šè¿‡è¯¥ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»ä¸èµ„æºã€‚ æˆ‘ä»¬åœ¨ä½¿ç”¨jdbcçš„æ—¶å€™ï¼Œä¸åŒçš„æ•°æ®åº“çš„é©±åŠ¨éƒ½æ˜¯ç”±æ¯ä¸ªå‚å•†è‡ªå·±å»å®ç°ï¼Œå¼€å‘è€…åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠé©±åŠ¨jaråŒ… ï¼Œæ”¾åˆ°å½“å‰pathä¸‹è¾¹å°±å¯ä»¥äº†ï¼Œè¿™äº›é©±åŠ¨æ˜¯ç”±ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œ java.sql ä¸‹è¾¹çš„ä¸€äº›Classåœ¨ä½¿ç”¨çš„æ—¶å€™ä¸å¯é¿å…çš„ ï¼Œè¦å»ä½¿ç”¨å‚å•†è‡ªå®šä¹‰çš„å®ç°çš„é€»è¾‘ï¼Œä½†æ˜¯è¿™äº› java.sql ä¸‹çš„ç±»çš„åŠ è½½å™¨æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨å®Œæˆçš„åŠ è½½ï¼Œç”±äºçˆ¶åŠ è½½å™¨(å¯åŠ¨ç±»åŠ è½½å™¨)åŠ è½½çš„ç±»æ— æ³•è®¿é—®å­åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨æˆ–è€…åº”ç”¨ç±»åŠ è½½å™¨ï¼‰åŠ è½½çš„ç±»ï¼Œæ‰€ä»¥å°±æ— æ³•åœ¨æœ‰äº› java.sql çš„ç±»å»è®¿é—®å…·ä½“çš„å‚å•†å®ç°ï¼Œè¿™ä¸ªæ˜¯åŒäº²å§”æ‰˜æ¨¡å‹å°´å°¬çš„ä¸€ä¸ªå±€é¢ã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨çš„é‡è¦æ€§ï¼š SPI (Service Provider Interface) çˆ¶ ClassLoader å¯ä»¥ä½¿ç”¨å½“å‰çº¿ç¨‹ Thread.currentThread().getContextClassLoader() æ‰€æŒ‡å®šçš„ classloader åŠ è½½çš„ç±»ã€‚ è¿™å°±æ”¹å˜äº†çˆ¶ ClassLoader ä¸èƒ½ä½¿ç”¨å­ ClassLoader æˆ–æ˜¯å…¶ä»–æ²¡æœ‰ç›´æ¥çˆ¶å­å…³ç³»çš„ CLassLoader åŠ è½½çš„ç±»çš„æƒ…å†µï¼Œå³æ”¹å˜äº†åŒäº²å§”æ‰˜æ¨¡å‹ã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨å°±æ˜¯å½“å‰çº¿ç¨‹çš„ Current ClassLoader åœ¨åŒäº²å§”æ‰˜æ¨¡å‹ä¸‹ï¼Œç±»åŠ è½½å™¨ç”±ä¸‹è‡³ä¸Šçš„ï¼Œå³ä¸‹å±‚çš„ç±»åŠ è½½å™¨ä¼šå§”æ‰˜ä¸Šå±‚è¿›è¡ŒåŠ è½½ã€‚ä½†æ˜¯å¯¹äº SPI æ¥è¯´ï¼Œæœ‰äº›æ¥å£æ˜¯ java æ ¸å¿ƒåº“æ‰€æä¾›çš„ï¼Œè€Œjavaæ ¸å¿ƒåº“æ˜¯ç”±å¯åŠ¨ç±»åŠ å™¨æ¥åŠ è½½çš„ï¼Œè€Œè¿™äº›æ¥å£çš„å®ç°æ¥è‡ªäºä¸åŒçš„jaråŒ…ï¼ˆå‚å•†æä¾›ï¼‰ï¼Œjava çš„å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯ä¸ä¼šåŠ è½½å…¶ä»–æ¥æºçš„jaråŒ…ï¼Œè¿™æ ·ä¼ ç»Ÿçš„åŒäº²å§”æ‰˜æ¨¡å‹å°±æ— æ³•æ»¡è¶³SPIçš„è¦æ±‚ï¼Œè€Œé€šè¿‡ç»™å½“å‰çº¿ç¨‹è®¾ç½®ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼Œå°±å¯ä»¥è®¾ç½®ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥å®ç°å¯¹äºæ¥å£å®ç°ç±»çš„åŠ è½½ã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ä¸€èˆ¬ä½¿ç”¨æ¨¡å¼çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ä¸€èˆ¬ä½¿ç”¨æ¨¡å¼åˆ†ä¸º3æ­¥ï¼Œè·å–ã€ä½¿ç”¨å’Œè¿˜åŸï¼Œä¸‹é¢æ˜¯ä¼ªä»£ç  12345678910// è·å–ClassLoader classLoader = Thread.currentThread().getContextClassLoader();try &#123; // ä½¿ç”¨ Thread.currentThread().setContextClassLoader(targetClassLoader); method();&#125; finally &#123; // è¿˜åŸ Thread.currentThread().setContextClassLoader(classLoader);&#125; method é‡Œé¢è°ƒç”¨äº† Thread.currentThread().getContextClassLoader()ï¼Œè·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åšæŸäº›äº‹æƒ…ã€‚å¦‚æœä¸€ä¸ªç±»ç”±ç±»åŠ è½½å™¨ A åŠ è½½ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»çš„ä¾èµ–ä¹Ÿæ˜¯æœ‰ç›¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½çš„ï¼ˆå¦‚æœè¯¥ä¾èµ–ç±»ä¹‹å‰æ²¡æœ‰åŠ è½½è¿‡çš„è¯ï¼‰ï¼ŒContextClassLoader çš„ä½œç”¨å°±æ˜¯ä¸ºäº†ç ´å Java çš„ç±»åŠ è½½å§”æ‰˜æœºåˆ¶ã€‚ å½“é«˜å±‚æä¾›äº†ç»Ÿä¸€çš„æ¥å£è®©åº•å±‚å»å®ç°ï¼ŒåŒæ—¶åˆè¦åœ¨é«˜å±‚åŠ è½½ï¼ˆæˆ–å®ä¾‹åŒ–ï¼‰åº•å±‚ç±»æ—¶ï¼Œå°±å¿…é¡»è¦é€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥å¸®åŠ©é«˜å±‚çš„ ClassLoader æ‰¾åˆ°å¹¶åŠ è½½è¯¥ç±»ã€‚ ServiceLoaderæˆ‘ä»¬å…ˆå¼•å…¥é©±åŠ¨ä¾èµ– 12345678910111213141516group &apos;com.cuzz.jvm&apos;version &apos;1.0&apos;apply plugin: &apos;java&apos;sourceCompatibility = 1.8repositories &#123; mavenCentral()&#125;dependencies &#123; compile ( &quot;mysql:mysql-connector-java:5.1.34&quot; )&#125; æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ 123456789101112131415161718192021/** * @Author: cuzz * @Date: 2019/2/1 14:46 * @Description: */public class MyTest26 &#123; public static void main(String[] args) &#123; ServiceLoader&lt;Driver&gt; serviceLoader = ServiceLoader.load(Driver.class); Iterator&lt;Driver&gt; iterator = serviceLoader.iterator(); while(iterator.hasNext())&#123; Driver driver = iterator.next(); System.out.println("driver: "+driver.getClass() + "loader: "+ driver.getClass().getClassLoader() ); &#125; System.out.println("å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨: " + Thread.currentThread().getContextClassLoader()); System.out.println("ServiceLoaderçš„ç±»åŠ è½½å™¨: "+ServiceLoader.class.getClassLoader()); &#125;&#125; è¾“å‡º 1234driver: class com.mysql.jdbc.Driverloader: sun.misc.Launcher$AppClassLoader@dad5dcdriver: class com.mysql.fabric.jdbc.FabricMySQLDriverloader: sun.misc.Launcher$AppClassLoader@dad5dcå½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨: sun.misc.Launcher$AppClassLoader@dad5dcServiceLoaderçš„ç±»åŠ è½½å™¨: null æˆ‘ä»¬å¯ä»¥çœ‹åˆ° ServiceLoader æ‰¾åˆ°äº† mysql çš„ä¸¤ä¸ªé©±åŠ¨ï¼Œè¿™ä¸¤ä¸ªé©±åŠ¨éƒ½æ˜¯ç”±ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œå½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åŠ è½½å™¨é»˜è®¤ä¹Ÿæ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒServiceLoaderæ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œä½†æ˜¯ç¨‹åºæ˜¯æ€æ ·æ‰¾åˆ° mysql çš„ä¸¤ä¸ªé©±åŠ¨çš„å‘¢ï¼Ÿæˆ‘ä»¬æ²¡æœ‰åœ¨ç¨‹åºé‡Œè¾¹è®¾ç½®ä»»ä½•çš„å±æ€§æˆ–è€…è·¯å¾„ä¹‹ç±»çš„ä¸œè¥¿è®©ç¨‹åºèƒ½æ‰¾åˆ° mysql çš„é©±åŠ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªèƒ½ç ”ç©¶ä¸€ä¸‹ ServiceLoader çš„æºç å’Œæ–‡æ¡£çœ‹ä¸€ä¸‹ä»–ä»¬çš„åŸç†ï¼š 1234&gt; public final class ServiceLoader&lt;S&gt;&gt; extends Object&gt; implements Iterable&lt;S&gt;&gt; &gt; A simple service-provider loading facility.A service is a well-known set of interfaces and (usually abstract) classes. A service provider is a specific implementation of a service. The classes in a provider typically implement the interfaces and subclass the classes defined in the service itself. Service providers can be installed in an implementation of the Java platform in the form of extensions, that is, jar files placed into any of the usual extension directories. Providers can also be made available by adding them to the applicationâ€™s class path or by some other platform-specific means.For the purpose of loading, a service is represented by a single type, that is, a single interface or abstract class. (A concrete class can be used, but this is not recommended.) A provider of a given service contains one or more concrete classes that extend this service type with data and code specific to the provider. The provider class is typically not the entire provider itself but rather a proxy which contains enough information to decide whether the provider is able to satisfy a particular request together with code that can create the actual provider on demand. The details of provider classes tend to be highly service-specific; no single class or interface could possibly unify them, so no such type is defined here. The only requirement enforced by this facility is that provider classes must have a zero-argument constructor so that they can be instantiated during loading.A service provider is identified by placing a provider-configuration file in the resource directory META-INF/services. The fileâ€™s name is the fully-qualified binary name of the serviceâ€™s type. The file contains a list of fully-qualified binary names of concrete provider classes, one per line. Space and tab characters surrounding each name, as well as blank lines, are ignored. The comment character is â€˜#â€™ (â€˜\u0023â€™, NUMBER SIGN); on each line all characters following the first comment character are ignored. The file must be encoded in UTF-8.If a particular concrete provider class is named in more than one configuration file, or is named in the same configuration file more than once, then the duplicates are ignored. The configuration file naming a particular provider need not be in the same jar file or other distribution unit as the provider itself. The provider must be accessible from the same class loader that was initially queried to locate the configuration file; note that this is not necessarily the class loader from which the file was actually loaded.Providers are located and instantiated lazily, that is, on demand. A service loader maintains a cache of the providers that have been loaded so far. Each invocation of the iterator method returns an iterator that first yields all of the elements of the cache, in instantiation order, and then lazily locates and instantiates any remaining providers, adding each one to the cache in turn. The cache can be cleared via the reload method.Service loaders always execute in the security context of the caller. Trusted system code should typically invoke the methods in this class, and the methods of the iterators which they return, from within a privileged security context.Instances of this class are not safe for use by multiple concurrent threads.Unless otherwise specified, passing a null argument to any method in this class will cause a NullPointerException to be thrown.Example Suppose we have a service type com.example.CodecSet which is intended to represent sets of encoder/decoder pairs for some protocol. In this case it is an abstract class with two abstract methods: public abstract Encoder getEncoder(String encodingName); public abstract Decoder getDecoder(String encodingName);Each method returns an appropriate object or null if the provider does not support the given encoding. Typical providers support more than one encoding.If com.example.impl.StandardCodecs is an implementation of the CodecSet service then its jar file also contains a file named META-INF/services/com.example.CodecSetThis file contains the single line: com.example.impl.StandardCodecs # Standard codecsThe CodecSet class creates and saves a single service instance at initialization:` 12&gt; private static ServiceLoader&lt;CodecSet&gt; codecSetLoader = ServiceLoader.load(CodecSet.class);&gt; &gt; To locate an encoder for a given encoding name it defines a static factory method which iterates through the known and available providers, returning only when it has located a suitable encoder or has run out of providers. 123456789&gt; public static Encoder getEncoder(String encodingName) &#123;&gt; for (CodecSet cp : codecSetLoader) &gt; Encoder enc = cp.getEncoder(encodingName);&gt; if (enc != null)&gt; return enc;&gt; &#125;&gt; return null;&gt; &#125;&gt; &gt; A getDecoder method is defined similarly.Usage Note If the class path of a class loader that is used for provider loading includes remote network URLs then those URLs will be dereferenced in the process of searching for provider-configuration files.This activity is normal, although it may cause puzzling entries to be created in web-server logs. If a web server is not configured correctly, however, then this activity may cause the provider-loading algorithm to fail spuriously.A web server should return an HTTP 404 (Not Found) response when a requested resource does not exist. Sometimes, however, web servers are erroneously configured to return an HTTP 200 (OK) response along with a helpful HTML error page in such cases. This will cause a ServiceConfigurationError to be thrown when this class attempts to parse the HTML page as a provider-configuration file. The best solution to this problem is to fix the misconfigured web server to return the correct response code (HTTP 404) along with the HTML error page. æˆ‘ä»¬å…ˆçœ‹æºç  1234567891011121314151617181920public final class ServiceLoader&lt;S&gt; implements Iterable&lt;S&gt; &#123; // å‰ç¼€ private static final String PREFIX = "META-INF/services/"; // The class or interface representing the service being loaded private final Class&lt;S&gt; service; // The class loader used to locate, load, and instantiate providers private final ClassLoader loader; // The access control context taken when the ServiceLoader is created private final AccessControlContext acc; // Cached providers, in instantiation order private LinkedHashMap&lt;String,S&gt; providers = new LinkedHashMap&lt;&gt;(); // The current lazy-lookup iterator private LazyIterator lookupIterator; ...&#125; è¯¥ç±»ä¸­æœ‰ä¸ªå¸¸é‡ PREFIX ï¼Œæ ¹æ®æ–‡æ¡£æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ªç›®å½•ï¼Œæˆ‘ä»¬çœ‹çœ‹ mysql-connnector-java ä¸­ä¹Ÿæœ‰ å…¶ä¸‹çš„æ–‡ä»¶åå­—å°±æ˜¯æœåŠ¡çš„åå­—ï¼Œæ¯”å¦‚æ•°æ®åº“é©±åŠ¨çš„æœåŠ¡æ˜¯java.sql.Driveï¼Œæˆ‘ä»¬åœ¨mysqlçš„jaråŒ…ä¸‹å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œè¾¹çš„å†…å®¹æ˜¯å…·ä½“çš„å®ç°ç±»çš„å…¨é™å®šåï¼š 12com.mysql.jdbc.Drivercom.mysql.fabric.jdbc.FabricMySQLDriver ä¸å‰é¢æ‰“å°å‡ºæ¥çš„é©±åŠ¨æ˜¯ä¸€æ ·çš„ ServiceLoader æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œä¸ºä»€ä¹ˆ mysql çš„é©±åŠ¨æ˜¯ç”±ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½å‘¢ï¼Ÿ å‰é¢ä»£ç ä¸­ ServiceLoader serviceLoader = ServiceLoader.load(Driver.class); è¿™æ®µä»£ç æ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„å‘¢ï¼Œè·Ÿè¿›æºç  12345678910public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) &#123; // è·å–å½“å‰ä¸Šä¸‹æ–‡ç±»åŠ è½½ï¼Œå¹¶ä½¿ç”¨ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å»åŠ è½½ ClassLoader cl = Thread.currentThread().getContextClassLoader(); return ServiceLoader.load(service, cl);&#125;public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service, ClassLoader loader) &#123; // è°ƒç”¨ä¸€ä¸ªæ„é€ æ–¹æ³• return new ServiceLoader&lt;&gt;(service, loader);&#125; æ—¢ç„¶ ServiceLoader æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œé‚£ä¹ˆ ServiceLoader é‡Œè¾¹çš„ç±»éƒ½ä¼šç”¨å¯åŠ¨ç±»åŠ è½½å™¨å»åŠ è½½ï¼Œä½†æ˜¯å‘¢æˆ‘ä»¬çš„ mysql é©±åŠ¨ä¸åœ¨å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç›®å½•ä¸‹è¾¹ï¼Œæˆ‘ä»¬çš„ mysql é©±åŠ¨ä½äº classpath ä¸‹è¾¹ï¼Œæ— æ³•ç”¨å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° load æ–¹æ³•ä½¿ç”¨äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨é»˜è®¤æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ„é€ æ–¹æ³• 12345678910111213 private ServiceLoader(Class&lt;S&gt; svc, ClassLoader cl) &#123; service = Objects.requireNonNull(svc, "Service interface cannot be null"); loader = (cl == null) ? ClassLoader.getSystemClassLoader() : cl; acc = (System.getSecurityManager() != null) ? AccessController.getContext() : null; reload(); &#125;// è°ƒç”¨reload() æ–¹æ³• public void reload() &#123; // æ¸…ç©ºç¼“å­˜ providers = new LinkedHashMap&lt;&gt;(); providers.clear(); // æ‡’åŠ è½½ lookupIterator = new LazyIterator(service, loader); &#125; LazyIterator ç±» java.util.ServiceLoader.LazyIterator 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091private class LazyIterator implements Iterator&lt;S&gt; &#123; Class&lt;S&gt; service; ClassLoader loader; Enumeration&lt;URL&gt; configs = null; Iterator&lt;String&gt; pending = null; String nextName = null; private LazyIterator(Class&lt;S&gt; service, ClassLoader loader) &#123; this.service = service; this.loader = loader; &#125; private boolean hasNextService() &#123; if (nextName != null) &#123; return true; &#125; if (configs == null) &#123; try &#123; String fullName = PREFIX + service.getName(); if (loader == null) configs = ClassLoader.getSystemResources(fullName); else configs = loader.getResources(fullName); &#125; catch (IOException x) &#123; fail(service, "Error locating configuration files", x); &#125; &#125; while ((pending == null) || !pending.hasNext()) &#123; if (!configs.hasMoreElements()) &#123; return false; &#125; pending = parse(service, configs.nextElement()); &#125; nextName = pending.next(); return true; &#125; private S nextService() &#123; if (!hasNextService()) throw new NoSuchElementException(); String cn = nextName; nextName = null; Class&lt;?&gt; c = null; try &#123; c = Class.forName(cn, false, loader); &#125; catch (ClassNotFoundException x) &#123; fail(service, "Provider " + cn + " not found"); &#125; if (!service.isAssignableFrom(c)) &#123; fail(service, "Provider " + cn + " not a subtype"); &#125; try &#123; S p = service.cast(c.newInstance()); providers.put(cn, p); return p; &#125; catch (Throwable x) &#123; fail(service, "Provider " + cn + " could not be instantiated", x); &#125; throw new Error(); // This cannot happen &#125; public boolean hasNext() &#123; if (acc == null) &#123; return hasNextService(); &#125; else &#123; PrivilegedAction&lt;Boolean&gt; action = new PrivilegedAction&lt;Boolean&gt;() &#123; public Boolean run() &#123; return hasNextService(); &#125; &#125;; return AccessController.doPrivileged(action, acc); &#125; &#125; public S next() &#123; if (acc == null) &#123; return nextService(); &#125; else &#123; PrivilegedAction&lt;S&gt; action = new PrivilegedAction&lt;S&gt;() &#123; public S run() &#123; return nextService(); &#125; &#125;; return AccessController.doPrivileged(action, acc); &#125; &#125; public void remove() &#123; throw new UnsupportedOperationException(); &#125;&#125; è¿™æ ·å°±æŠŠé©±åŠ¨åŠ è½½å‡ºæ¥äº†ï¼Œåˆ™å‰é¢ä»£ç è¾“å‡º 1234driver: class com.mysql.jdbc.Driverloader: sun.misc.Launcher$AppClassLoader@dad5dcdriver: class com.mysql.fabric.jdbc.FabricMySQLDriverloader: sun.misc.Launcher$AppClassLoader@dad5dcå½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨: sun.misc.Launcher$AppClassLoader@dad5dcServiceLoaderçš„ç±»åŠ è½½å™¨: null å¦‚æœæˆ‘ä»¬æŠŠå‰é¢ä»£ç æ”¹ä¸€ä¸‹ï¼Œè®¾ç½®å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä¸ºæ‰©å±•ç±»åŠ è½½å™¨ 1234567891011121314151617public class MyTest26 &#123; public static void main(String[] args) &#123; // æŠŠå½“å‰çº¿ç¨‹è®¾ç½®ä¸ºæ‰©å±•ç±»åŠ è½½å™¨ Thread.currentThread().setContextClassLoader(MyTest26.class.getClassLoader().getParent()); ServiceLoader&lt;Driver&gt; serviceLoader = ServiceLoader.load(Driver.class); Iterator&lt;Driver&gt; iterator = serviceLoader.iterator(); while(iterator.hasNext())&#123; Driver driver = iterator.next(); System.out.println("driver: "+driver.getClass() + "loader: "+ driver.getClass().getClassLoader() ); &#125; System.out.println("å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨: " + Thread.currentThread().getContextClassLoader()); System.out.println("ServiceLoaderçš„ç±»åŠ è½½å™¨: "+ServiceLoader.class.getClassLoader()); &#125;&#125; åˆ™è¾“å‡º 12å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨: sun.misc.Launcher$ExtClassLoader@a14482ServiceLoaderçš„ç±»åŠ è½½å™¨: null å¯ä»¥çœ‹åˆ°å¾ªç¯æ²¡æœ‰å»æ‰§è¡Œï¼Œä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯æ‰©å±•ç±»åŠ è½½å™¨æ²¡å•¥é—®é¢˜ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨çš„ä¸Šçº§æ˜¯æ‰©å±•ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå¾ªç¯æ˜¯ç©ºçš„å‘¢ï¼ŸåŸå› å°±æ˜¯æ‰©å±•ç±»åŠ è½½å™¨æ— æ³•åŠ è½½ classpathä¸‹è¾¹çš„ç±»ï¼Œmysql çš„ jar åŒ…æ˜¯æ”¾åœ¨ classpathä¸‹è¾¹çš„ã€‚ ##]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2019%2F01%2F27%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ç±»åŠ è½½æœºåˆ¶åœ¨ Java ä»£ç ä¸­ï¼Œç±»å‹ï¼ˆç±»ï¼Œæ¥å£ï¼Œæšä¸¾ï¼‰çš„åŠ è½½ã€è¿æ¥ï¼ˆéªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æï¼‰ä¸åˆå§‹åŒ–è¿‡ç¨‹éƒ½æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å®Œæˆçš„ï¼Œæä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œå¢åŠ äº†æ›´å¤šçš„å¯èƒ½æ€§ ç±»åŠ è½½å™¨æ·±å…¥å‰–æJava è™šæ‹Ÿæœºä¸ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ åœ¨å¦‚ä¸‹å‡ ç§æƒ…å†µä¸‹ï¼ŒJava è™šæ‹Ÿæœºå°†ç»“æŸç”Ÿå‘½å‘¨æœŸ æ‰§è¡Œäº† System.exit() æ–¹æ³• ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ ç¨‹åºåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–åˆ™é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢ ç”±äºæ“ä½œç³»ç»Ÿå‡ºç°äº†é”™è¯¯ï¼Œå¯¼è‡´ Java è™šæ‹Ÿæœºè¿›ç¨‹ç»“æŸ ç±»çš„åŠ è½½ã€è¿æ¥ä¸åˆå§‹åŒ– åŠ è½½ï¼šæŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ® è¿æ¥ éªŒè¯ï¼šç¡®ä¿è¢«åŠ è½½çš„ç±»çš„æ­£ç¡®æ€§ å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ åˆå§‹åŒ–ï¼šä¸ºé™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ ä½¿ç”¨ï¼ˆç±»çš„å®ä¾‹åŒ–ï¼‰ï¼š ä¸ºæ–°çš„å¯¹è±¡åˆ†é…å†…å­˜ ä¸ºå®ä¾‹å˜é‡èµ‹é»˜è®¤å€¼ ä¸ºå®ä¾‹å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ Java ç¼–è¯‘å™¨ä¸ºå®ƒç¼–è¯‘çš„æ¯ä¸€ä¸ªç±»éƒ½è‡³å°‘ç”Ÿæˆä¸€ä¸ªå®ä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼Œåœ¨ Java çš„ class æ–‡ä»¶ä¸­ï¼Œè¿™è¿™å®ä¾‹åˆå§‹æ–¹æ³•è¢«ç§°ä¸º &lt;init&gt; ï¼Œå¯¹æºä»£ç ä¸­çš„æ¯ä¸€ä¸ªç±»çš„æ„é€ æ–¹æ³•ï¼Œjava ç¼–è¯‘å™¨éƒ½äº§ç”Ÿä¸€ä¸ª &lt;init&gt; æ–¹æ³• Java ç¨‹åºå¯¹ç±»çš„ä½¿ç”¨æ–¹å¼å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š ä¸»åŠ¨ä½¿ç”¨ åˆ›å»ºç±»çš„å®ä¾‹ è®¿é—®æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡ï¼Œæˆ–åˆ™å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼ è°ƒç”¨ç±»çš„é™æ€æ–¹æ³• åå°„ï¼ˆå¦‚ Class.forName(&quot;com.cuzz.Test&quot;)ï¼‰ åˆå§‹åŒ–ä¸€ä¸ªå­ç±» Java è™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±» è¢«åŠ¨ä½¿ç”¨ æ‰€æœ‰çš„ Java è™šæ‹Ÿæœºå®ç°å¿…é¡»åœ¨æ¯ä¸ªç±»æˆ–æ¥å£è¢« Java ç¨‹åºé¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨æ—¶æ‰åˆå§‹åŒ–ä»–ä»¬ æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç  12345678910111213141516171819public class MyTest01 &#123; public static void main(String[] args) &#123; System.out.println(Child1.str); &#125;&#125;class Parent1 &#123; public static String str = "hello world"; static &#123; System.out.println("Parent1 static block"); &#125;&#125;class Child1 extends Parent1 &#123; static &#123; System.out.println("Child1 static block"); &#125;&#125; è¾“å‡º 12Parent1 static blockhello world å¯¹äºé™æ€ä»£ç å—ï¼Œåªæœ‰å®šä¹‰è¯¥å­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œè¿™ä¸ª Child1.str æ˜¯å­ç±»è°ƒç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œæ‰€ä»¥å­ç±»ä¸ä¼šè¢«åˆå§‹åŒ–ï¼Œçˆ¶ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œè¿™æ˜¯å¯¹ Parent1 çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œå¯¹äºè¿™ä¸ªä¾‹å­åªæ˜¯ç”¨äº† Child1 çš„åå­—ï¼Œå¹¶æ²¡æœ‰ä¸»åŠ¨ä½¿ç”¨ Child1 è¿™ä¸ªç±» æˆ‘ä»¬åœ¨æ¥çœ‹çœ‹æœ‰æ²¡æœ‰è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ï¼Œåœ¨ VM options : -XX:+TraceClassLoading åœ¨è¿è¡Œ 1234567...[Loaded com.cuzz.jvm.classloader.Parent1 from file:/E:/project/learn-demo/demo-10-jvm-lecture/out/production/classes/][Loaded com.cuzz.jvm.classloader.Child1 from file:/E:/project/learn-demo/demo-10-jvm-lecture/out/production/classes/]Parent1 static blockhello world[Loaded java.lang.Shutdown from E:\deployer\jdk8\jre\lib\rt.jar][Loaded java.lang.Shutdown$Lock from E:\deployer\jdk8\jre\lib\rt.jar] å‘ç°è¿™ä¸¤ä¸ªç±»å·²ç»è¢«åŠ è½½åˆ°è™šæ‹Ÿä¸­ å†çœ‹ä¸€ä¸ªä¾‹å­ 1234567891011121314151617181920public class MyTest01 &#123; public static void main(String[] args) &#123; System.out.println(Child1.str2); &#125;&#125;class Parent1 &#123; public static String str = "hello world"; static &#123; System.out.println("Parent1 static block"); &#125;&#125;class Child1 extends Parent1 &#123; public static String str2 = "welcome"; static &#123; System.out.println("Child1 static block"); &#125;&#125; è¾“å‡º 123Parent1 static blockChild1 static blockwelcome å½“æˆ‘ä»¬åˆå§‹ä¸€ä¸ªå­ç±»ï¼Œæˆ‘ä»¬ä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±»ï¼Œæ‰€ä»¥ä¼šçº¿è¾“å‡ºçˆ¶ç±»çš„é™æ€ä»£ç å— å¦‚æœæˆ‘ä»¬åŠ ä¸Š final å˜ä¸ºå¸¸é‡ 12345678910111213141516/** * @Author: cuzz * @Date: 2019/1/25 19:16 * @Description: */public class MyTest02 &#123; public static void main(String[] args) &#123; System.out.println(Parent2.str); &#125;&#125;class Parent2 &#123; public static final String str = "hello world"; static &#123; System.out.println("Parent2 static block"); &#125;&#125; è¾“å‡º 1hello world å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥åˆ°è°ƒç”¨è¿™ä¸ªå¸¸é‡çš„æ–¹æ³•æ‰€åœ¨çš„ç±»çš„å¸¸é‡æ± ä¸­ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¼šå­˜å…¥MyTest02è¿™ä¸ªç±»ä¸­ï¼‰ï¼Œæœ¬è´¨ä¸Šï¼Œè°ƒç”¨ç±»å¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤å¹¶ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ– æ³¨æ„ï¼šè¿™é‡ŒæŒ‡çš„æ˜¯å°†å¸¸é‡å­˜æ”¾åˆ°äº† MyTest02 çš„å¸¸é‡æ± ä¸­ï¼Œä¹‹å MyTest02 ä¸ Parent2 å°±æ²¡æœ‰ä»»ä½•å…³ç³»äº†ï¼Œç”šè‡³æˆ‘ä»¬å¯ä»¥å°† Parent çš„ class æ–‡ä»¶åˆ é™¤ æˆ‘ä»¬è¿›å…¥ classes ç›®å½•ä¸‹ä½¿ç”¨ï¼šjavap -c com.cuzz.jvm.classloader.MyTest02 å‘½ä»¤åç¼–è¯‘ä¸€ä¸‹ 123456789101112131415Compiled from &quot;MyTest02.java&quot;public class com.cuzz.jvm.classloader.MyTest02 &#123; public com.cuzz.jvm.classloader.MyTest02();// (1) Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return public static void main(java.lang.String[]); Code: 0: getstatic #2 // Field java/lang/System.out:Ljava/io/PrintStream; 3: ldc #4 (2) // String hello world (3) 5: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 8: return&#125; æ˜¯æ„é€ æ–¹æ³• ldc åŠ©è®°ç¬¦è¡¨ç¤ºå°† intï¼Œfloat æˆ– String ç±»å‹çš„å€¼ä»å¸¸é‡æ± ä¸­æ¨é€è‡³æ ˆé¡¶ å¯ä»¥çœ‹å‡ºParent2.str å·²ç»è½¬åŒ–ä¸º hello world æ³¨ï¼šå½“ int å–å€¼-1~5é‡‡ç”¨iconstæŒ‡ä»¤ï¼Œå–å€¼-128~127é‡‡ç”¨ bipush æŒ‡ä»¤ï¼Œå–å€¼-32768~32767é‡‡ç”¨ sipush æŒ‡ä»¤ï¼Œå–å€¼-2147483648~2147483647é‡‡ç”¨ ldc æŒ‡ä»¤ æˆ‘ä»¬åœ¨çœ‹ä¸€ä¸ªä¾‹å­ 1234567891011public class MyTest03 &#123; public static void main(String[] args) &#123; System.out.println(Parent3.str); &#125;&#125;class Parent3 &#123; public static final String str = UUID.randomUUID().toString(); static &#123; System.out.println("Parent3 static block"); &#125;&#125; è¾“å‡º 12Parent3 static blockbee2f54d-8960-46d0-b5d7-02666fcf4a14 ç›¸æ¯”äºä¸Šä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å‘ç°è¾“å‡ºäº†é™æ€ä»£ç å—ï¼Œè¯´æ˜ Parent3 è¿™ä¸ªç±»è¢«åˆå§‹åŒ–äº†ï¼Œå½“ä¸€ä¸ªå¸¸é‡çš„å€¼å¹¶éç¼–è¯‘æœŸé—´å¯ä»¥ç¡®å®šçš„ï¼Œé‚£ä¹ˆå™¨å€¼å°±ä¸ä¼šæ”¾åˆ°è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œè¿™æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œä¼šå¯¼è‡´ä¸»åŠ¨ä½¿ç”¨è¿™ä¸ªå¸¸é‡æ‰€åœ¨çš„ç±»ï¼Œä¼šå¯¼è‡´è¿™ç»™ç±»åˆå§‹åŒ– å†çœ‹ä¸€ä¸ªä¾‹å­ 123456789101112131415161718public class MyTest04 &#123; public static void main(String[] args) &#123; Parent4[] parent4s = new Parent4[1]; System.out.println("---------"); System.out.println(parent4s.getClass()); System.out.println(parent4s.getClass().getSuperclass()); System.out.println("---------"); int[] ints = new int[1]; System.out.println(ints.getClass()); System.out.println(ints.getClass().getSuperclass()); &#125;&#125;class Parent4 &#123; static &#123; System.out.println("Parent4 static block"); &#125;&#125; è¾“å‡º 12345678---------class [Lcom.cuzz.jvm.classloader.Parent4;class java.lang.Object---------class [Iclass java.lang.ObjectProcess finished with exit code 0 å¯¹äºæ•°ç»„å®ä¾‹æ¥è¯´ï¼Œå…¶ç±»å‹æ˜¯ç”± JVM åœ¨è¿è¡ŒæœŸåŠ¨æ€ç”Ÿæˆçš„ï¼Œè¡¨ç¤ºä¸º [Lcom.cuzz.jvm.classloader.Parent4 è¿™ç§å½¢å¼ï¼ŒåŠ¨æ€ç”Ÿæˆçš„ç±»å‹ï¼Œå…¶çˆ¶ç±»å‹å°±æ˜¯ Object å¯¹äºæ•°ç»„æ¥è¯´ï¼ŒJavaDoc ç»å¸¸å°†æ„æˆçš„æ•°ç»„å…ƒç´ ç§°ä¸º Componentï¼Œå®é™…ä¸Šå°±æ˜¯å°†æ•°ç»„é™ä½ä¸€ä¸ªç»´åº¦çš„ç±»å‹ æˆ‘ä»¬ä½¿ç”¨ javap -c com.cuzz.jvm.classloader.MyTest04 è¿›è¡Œåç¼–è¯‘ 1234567891011121314151617181920212223242526272829303132333435363738394041public class com.cuzz.jvm.classloader.MyTest04 &#123; public com.cuzz.jvm.classloader.MyTest04(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return public static void main(java.lang.String[]); Code: 0: iconst_1 1: anewarray #2 // class com/cuzz/jvm/classloader/Parent4 4: astore_1 5: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 8: ldc #4 // String --------- 10: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 13: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 16: aload_1 17: invokevirtual #6 // Method java/lang/Object.getClass:()Ljava/lang/Class; 20: invokevirtual #7 // Method java/io/PrintStream.println:(Ljava/lang/Object;)V 23: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 26: aload_1 27: invokevirtual #6 // Method java/lang/Object.getClass:()Ljava/lang/Class; 30: invokevirtual #8 // Method java/lang/Class.getSuperclass:()Ljava/lang/Class; 33: invokevirtual #7 // Method java/io/PrintStream.println:(Ljava/lang/Object;)V 36: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 39: ldc #4 // String --------- 41: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 44: iconst_1 45: newarray int 47: astore_2 48: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 51: aload_2 52: invokevirtual #6 // Method java/lang/Object.getClass:()Ljava/lang/Class; 55: invokevirtual #7 // Method java/io/PrintStream.println:(Ljava/lang/Object;)V 58: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 61: aload_2 62: invokevirtual #6 // Method java/lang/Object.getClass:()Ljava/lang/Class; 65: invokevirtual #8 // Method java/lang/Class.getSuperclass:()Ljava/lang/Class; 68: invokevirtual #7 // Method java/io/PrintStream.println:(Ljava/lang/Object;)V 71: return&#125; é‡Œé¢æœ‰ä¸¤ä¸ªåŠ©è®°ç¬¦ anewarray ï¼šè¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå¼•ç”¨ç±»å‹çš„ï¼ˆå¦‚ç±»ã€æ¥å£ã€æ•°ç»„ï¼‰æ•°ç»„ï¼Œå¹¶å°†å…¶å€¼å‹å…¥æ ˆé¡¶ newarrayï¼šè¡¨ç¤ºåˆ›å»ºä¸€ä¸ªæŒ‡å®šçš„åŸå§‹ç±»å‹ï¼ˆå¦‚intã€floatã€charç­‰ï¼‰æ•°ç»„ï¼Œå¹¶å°†å…¶å¼•ç”¨å€¼å‹å…¥æ ˆé¡¶ ä¸‹ä¸€ä¸ªä¾‹å­ 123456789101112public class MyTest05 &#123; public static void main(String[] args) &#123; System.out.println(Child5.j); &#125;&#125;interface Parent5 &#123; int i = 5;&#125;interface Child5 extends Parent5 &#123; int j = 55;&#125; ç¼–è¯‘ä¹‹åæˆ‘ä»¬æŠŠ Parent5.class æ–‡ä»¶åˆ æ‰ï¼Œè¿˜èƒ½æ‰“å°å‡º 55ï¼Œè¯´æ˜å½“ä¸€ä¸ªæ¥å£åœ¨åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸è¦æ±‚å…¶çˆ¶æ¥å£éƒ½å®Œæˆåˆå§‹åŒ–ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ Child5.class æ–‡ä»¶ä¹Ÿåˆ æ‰ï¼Œä¹Ÿèƒ½æ‰“å°å‡º 55ï¼ŒåŸæ¥æ¥å£ä¸­çš„ä¿®é¥°ç¬¦é»˜è®¤ä¸º public static final è¯´æ˜æ¥å£ä¸­çš„å€¼æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¸éœ€è¦åŠ è½½åˆ° JVM ä¸­ï¼Œä¹Ÿå°±æ²¡æœ‰åˆå§‹åŒ–ã€‚ 12345678910111213141516public class MyTest05 &#123; public static void main(String[] args) &#123; System.out.println(Child5.j); &#125;&#125;interface Parent5 &#123; public static Thread thread = new Thread() &#123; &#123; System.out.println("Parent5 static block"); &#125; &#125;;&#125;class Child5 implements Parent5 &#123; public static int j = 55;&#125; æ­¤æ—¶ä¹Ÿä¹Ÿæ˜¯è¾“å‡º 55 ï¼Œä¹Ÿæ²¡æœ‰åˆå§‹åŒ– Child5 æ¥å£ Parent5 ä¸‹ä¸€ä¾‹å­ 12345678910111213141516171819202122232425public class MyTest06 &#123; public static void main(String[] args) &#123; Singleton singleton = Singleton.newSingleton(); System.out.println(Singleton.counter1); System.out.println(Singleton.counter2); &#125;&#125;class Singleton &#123; public static int counter1; private static Singleton singleton = new Singleton(); private Singleton() &#123; counter1++; // counter1 = 1 counter2++; // counter2 = 1 &#125; public static int counter2 = 0; // æ­¤æ—¶åˆæŠŠå€¼èµ‹å€¼ä¸º 0 public static Singleton newSingleton() &#123; return singleton; &#125;&#125; æ­¤æ—¶è¾“å‡º 1210 ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Œå‡†å¤‡é˜¶æ®µ counter1 å’Œ counter2 çš„åˆå§‹å€¼éƒ½æ˜¯ 0 ï¼Œåˆå§‹åŒ–é˜¶æ®µä»ä¸Šå¾€ä¸‹èµ‹å€¼ï¼Œåé¢ counter2 åˆèµ‹å€¼ä¸º 0 æˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹ 12345678910111213141516171819202122public class MyTest09 &#123; static &#123; System.out.println("MyTest09 static block"); &#125; public static void main(String[] args) &#123; System.out.println(Child9.j); &#125;&#125;class Parent9 &#123; public static int i = 9; static &#123; System.out.println("Parent9 static block"); &#125;&#125;class Child9 extends Parent9 &#123; public static int j = 99; static &#123; System.out.println("Child9 static block"); &#125;&#125; è¾“å‡º 1234MyTest09 static blockParent9 static blockChild9 static block99 æˆ‘ä»¬å¤šè¾“å‡ºç‚¹ä¿¡æ¯ 1234567891011121314151617181920212223242526272829public class MyTest09 &#123; static &#123; System.out.println("MyTest09 static block"); &#125; public static void main(String[] args) &#123; Parent9 parent9; // ä¸ä¼šåˆå§‹åŒ– System.out.println("-------------"); parent9 = new Parent9(); System.out.println("-------------"); System.out.println(Parent9.i); System.out.println("-------------"); System.out.println(Child9.j); &#125;&#125;class Parent9 &#123; public static int i = 9; static &#123; System.out.println("Parent9 static block"); &#125;&#125;class Child9 extends Parent9 &#123; public static int j = 99; static &#123; System.out.println("Child9 static block"); &#125;&#125; è¾“å‡ºç»“æœ 12345678MyTest09 static block-------------Parent9 static block-------------9-------------Child9 static block99 åœ¨çœ‹ä¸€ä¸ªä¾‹å­ 1234567891011121314public class MyTest12 &#123; public static void main(String[] args) throws Exception&#123; ClassLoader classLoader = ClassLoader.getSystemClassLoader(); Class&lt;?&gt; clazz = classLoader.loadClass("com.cuzz.jvm.classloader.CL"); System.out.println("--------------"); clazz = Class.forName("com.cuzz.jvm.classloader.CL"); &#125;&#125;class CL &#123; static &#123; System.out.println("CL static block"); &#125;&#125; è¾“å‡º 12--------------CL static block è¯´æ˜è°ƒç”¨ ClassLoader ç±»çš„ loadClass æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ï¼Œè€Œé€šè¿‡ Class.forName æ–¹æ³•æ˜¯é€šè¿‡åå°„æœºåˆ¶ï¼Œä¼šå¯¹ç±»åˆå§‹åŒ– ç±»çš„åŠ è½½ç±»çš„åŠ è½½æ˜¯æŒ‡å°†ç±»çš„ .class æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œå°†å…¶è¿è¡Œæ—¶æ•°æ®åŒºçš„æ–¹æ³•åŒºå†…ï¼Œç„¶ååœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ª java.lang.Class å¯¹è±¡ï¼ˆè§„èŒƒä¸­å¹¶æœªè¯´æ˜Classå¯¹è±¡ä½äºå“ªé‡Œï¼ŒHotSpot è™šæ‹Ÿæœºå°†å…¶æ”¾åœ¨äº†æ–¹æ³•åŒºä¸­ï¼‰ç”¨æ¥å°è£…ç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ åŠ è½½ .class æ–‡ä»¶çš„æ–¹å¼ ä»æœ¬åœ°ç³»ç»Ÿä¸­ç›´æ¥åŠ è½½ .class æ–‡ä»¶ é€šè¿‡ç½‘ç»œä¸‹è½½çš„ .class æ–‡ä»¶ ä» zipï¼Œjar ç­‰å½’æ¡£æ–‡ä»¶ä¸­åŠ è½½ .class æ–‡ä»¶ ä»ä¸“æœ‰æ•°æ®åº“ä¸­æå– .class æ–‡ä»¶ å°† Java æºæ–‡ä»¶åŠ¨æ€ç¼–è¯‘ä¸º .class æ–‡ä»¶ ç±»çš„åŠ è½½å™¨ ç±»çš„åŠ è½½å™¨åˆ†ç±»ï¼š Java è™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨ æ ¹åŠ è½½å™¨ï¼ˆBootstrapï¼‰ æ‹“å±•ç±»åŠ è½½å™¨ï¼ˆExtensionï¼‰ åº”ç”¨åŠ è½½å™¨ï¼ˆApplicationï¼‰ ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ java.lang.ClassLoader çš„å­ç±» ç”¨æˆ·å®šåˆ¶ç±»çš„åŠ è½½æ–¹æ³• æ³¨æ„ï¼šç±»çš„åŠ è½½å¹¶ä¸éœ€è¦ç­‰åˆ°æŸä¸ªç±»è¢«é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨æ—¶å†åŠ è½½å®ƒï¼›JVM è§„èŒƒå…è®¸ç±»åŠ è½½å™¨åœ¨é¢„æ–™æŸä¸ªç±»å°†è¦è¢«ä½¿ç”¨æ—¶å°±é¢„å…ˆåŠ è½½å®ƒï¼Œå¦‚æœåœ¨é¢„å…ˆåŠ è½½è¿‡ç¨‹ä¸­é‡åˆ°äº† .class æ–‡ä»¶ç¼ºå¤±æˆ–å­˜åœ¨é”™è¯¯ï¼Œç±»åŠ è½½å™¨å¿…é¡»åœ¨ç¨‹åºé¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨è¯¥ç±»æ‰æŠ¥å‘Šé”™è¯¯ï¼Œå¦‚æœè¿™ä¸ªç±»ä¸€ç›´æ²¡æœ‰è¢«ç¨‹åºä¸»åŠ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆç±»åŠ è½½å™¨å°±ä¸ä¼šæŠ¥å‘Šé”™è¯¯ çœ‹ä¸€ä¸ªä¾‹å­ 12345678910111213public class MyTest07 &#123; public static void main(String[] args) throws Exception &#123; Class&lt;?&gt; clazz = Class.forName("java.lang.String"); System.out.println(clazz.getClassLoader()); Class&lt;?&gt; clazz1 = Class.forName("com.cuzz.jvm.classloader.C"); System.out.println(clazz1.getClassLoader()); &#125;&#125;class C &#123; &#125; è¾“å‡º 12nullsun.misc.Launcher$AppClassLoader@dad5dc çœ‹çœ‹ getClassLoader çš„æ–‡æ¡£ Returns the class loader for the class. Some implementations may use null to represent the bootstrap class loader. This method will return null in such implementations if this class was loaded by the bootstrap class loader. è¯´æ˜è¾“å‡º null è¯´æ˜ java.lang.String æ˜¯æ ¹åŠ è½½å™¨åŠ è½½çš„ è·å– ClassLoader çš„é€”å¾„ è·å¾—å½“å‰ç±» ClassLoader clazz.getClassLoader() è·å¾—å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ ClassLoader Thread.currentThread().getContextClassLoader() è·å–ç³»ç»Ÿçš„ ClassLoader ClassLoader.getSystemClassLoader() è·å–è°ƒç”¨è€…çš„ ClassLoader DriverManger.getCallerClassLoader() ç±»çš„éªŒè¯ç±»çš„éªŒè¯çš„å†…å®¹ï¼š ç±»æ–‡ä»¶çš„ç»“æ„æ£€æŸ¥ è¯­ä¹‰æ£€æŸ¥ å­—èŠ‚ç éªŒè¯ äºŒè¿›åˆ¶å…¼å®¹æ€§çš„éªŒè¯ ç±»çš„åˆå§‹åŒ–æ—¶æœºå½“ Java è™šæ‹Ÿæœºåœ¨åˆå§‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œè¦æ±‚å®ƒçš„æ‰€æœ‰çˆ¶ç±»éƒ½å·²ç»è¢«åˆå§‹åŒ–ï¼Œä½†æ˜¯è¿™æ¡è§„åˆ™å¹¶ä¸é€‚ç”¨äºæ¥å£ åœ¨åˆå§‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒæ‰€å®ç°çš„æ¥å£ åœ¨åˆå§‹åŒ–ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ å› æ­¤ï¼Œä¸€ä¸ªçˆ¶æ¥å£å¹¶ä¸ä¼šå› ä¸ºå®ƒçš„å­æ¥å£æˆ–è€…å®ç°ç±»çš„åˆå§‹åŒ–è€Œåˆå§‹åŒ–ï¼Œåªæœ‰å½“ç¨‹åºé¦–æ¬¡ä½¿ç”¨ç‰¹å®šæ¥å£çš„é™æ€å˜é‡æ—¶ï¼Œæ‰ä¼šå¯¼è‡´è¯¥æ¥å£çš„åˆå§‹åŒ– JVMå‚æ•°è®¾ç½®éç¨³æ€é€‰é¡¹ä½¿ç”¨è¯´æ˜: -XX:+&lt;option&gt; å¯ç”¨ option -XX:-&lt;option&gt; ä¸å¯ç”¨ option -XX:&lt;option&gt;=&lt;number&gt; è®¾å®šoptionçš„å€¼ä¸ºæ•°å­—ç±»å‹ï¼Œå¯è·Ÿå•ä½ï¼Œä¾‹å¦‚ 32k, 1024m, 2g -XX:&lt;option&gt;=&lt;string&gt; è®¾å®šoptionçš„å€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚-XX:HeapDumpPath=./dump.core]]></content>
      <categories>
        <category>æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Brief History of HTTP]]></title>
    <url>%2F2019%2F01%2F26%2FBrief%20History%20of%20HTTP%2F</url>
    <content type="text"><![CDATA[åŸæ–‡ï¼šhttps://hpbn.co/brief-history-of-http/ The Hypertext Transfer Protocol (HTTP) is one of the most ubiquitous and widely adopted application protocols on the Internet: it is the common language between clients and servers, enabling the modern web. From its simple beginnings as a single keyword and document path, it has become the protocol of choice not just for browsers, but for virtually every Internet-connected software and hardware application. In this chapter, we will take a brief historical tour of the evolution of the HTTP protocol. A full discussion of the varying HTTP semantics is outside the scope of this book, but an understanding of the key design changes of HTTP, and the motivations behind each, will give us the necessary background for our discussions on HTTP performance, especially in the context of the many upcoming improvements in HTTP/2. Â§HTTP 0.9: The One-Line ProtocolThe original HTTP proposal by Tim Berners-Lee was designed with simplicity in mind as to help with the adoption of his other nascent idea: the World Wide Web. The strategy appears to have worked: aspiring protocol designers, take note. In 1991, Berners-Lee outlined the motivation for the new protocol and listed several high-level design goals: file transfer functionality, ability to request an index search of a hypertext archive, format negotiation, and an ability to refer the client to another server. To prove the theory in action, a simple prototype was built, which implemented a small subset of the proposed functionality: Client request is a single ASCII character string. Client request is terminated by a carriage return (CRLF). Server response is an ASCII character stream. Server response is a hypertext markup language (HTML). Connection is terminated after the document transfer is complete. However, even that sounds a lot more complicated than it really is. What these rules enable is an extremely simple, Telnet-friendly protocol, which some web servers support to this very day: 12345678$&gt; telnet google.com 80Connected to 74.125.xxx.xxxGET /about/(hypertext response)(connection closed) The request consists of a single line: GET method and the path of the requested document. The response is a single hypertext documentâ€”no headers or any other metadata, just the HTML. It really couldnâ€™t get any simpler. Further, since the previous interaction is a subset of the intended protocol, it unofficially acquired the HTTP 0.9 label. The rest, as they say, is history. From these humble beginnings in 1991, HTTP took on a life of its own and evolved rapidly over the coming years. Let us quickly recap the features of HTTP 0.9: Client-server, request-response protocol. ASCII protocol, running over a TCP/IP link. Designed to transfer hypertext documents (HTML). The connection between server and client is closed after every request. Note : Popular web servers, such as Apache and Nginx, still support the HTTP 0.9 protocolâ€”in part, because there is not much to it! If you are curious, open up a Telnet session and try accessing google.com, or your own favorite site, via HTTP 0.9 and inspect the behavior and the limitations of this early protocol. Â§HTTP/1.0: Rapid Growth and Informational RFCThe period from 1991 to 1995 is one of rapid coevolution of the HTML specification, a new breed of software known as a â€œweb browser,â€ and the emergence and quick growth of the consumer-oriented public Internet infrastructure. Â§The Perfect Storm: Internet Boom of the Early 1990s Building on Tim Berner-Leeâ€™s initial browser prototype, a team at the National Center of Supercomputing Applications (NCSA) decided to implement their own version. With that, the first popular browser was born: NCSA Mosaic. One of the programmers on the NCSA team, Marc Andreessen, partnered with Jim Clark to found Mosaic Communications in October 1994. The company was later renamed Netscape, and it shipped Netscape Navigator 1.0 in December 1994. By this point, it was already clear that the World Wide Web was bound to be much more than just an academic curiosity. In fact, that same year the first World Wide Web conference was organized in Geneva, Switzerland, which led to the creation of the World Wide Web Consortium (W3C) to help guide the evolution of HTML. Similarly, a parallel HTTP Working Group (HTTP-WG) was established within the IETF to focus on improving the HTTP protocol. Both of these groups continue to be instrumental to the evolution of the Web. Finally, to create the perfect storm, CompuServe, AOL, and Prodigy began providing dial-up Internet access to the public within the same 1994â€“1995 time frame. Riding on this wave of rapid adoption, Netscape made history with a wildly successful IPO on August 9, 1995â€”the Internet boom had arrived, and everyone wanted a piece of it! The growing list of desired capabilities of the nascent Web and their use cases on the public Web quickly exposed many of the fundamental limitations of HTTP 0.9: we needed a protocol that could serve more than just hypertext documents, provide richer metadata about the request and the response, enable content negotiation, and more. In turn, the nascent community of web developers responded by producing a large number of experimental HTTP server and client implementations through an ad hoc process: implement, deploy, and see if other people adopt it. From this period of rapid experimentation, a set of best practices and common patterns began to emerge, and in May 1996 the HTTP Working Group (HTTP-WG) published RFC 1945, which documented the â€œcommon usageâ€ of the many HTTP/1.0 implementations found in the wild. Note that this was only an informational RFC: HTTP/1.0 as we know it is not a formal specification or an Internet standard! Having said that, an example HTTP/1.0 request should look very familiar: 1234567891011121314151617$&gt; telnet website.org 80Connected to xxx.xxx.xxx.xxxGET /rfc/rfc1945.txt HTTP/1.0 (1)User-Agent: CERN-LineMode/2.15 libwww/2.17b3Accept: */*HTTP/1.0 200 OK (2)Content-Type: text/plainContent-Length: 137582Expires: Thu, 01 Dec 1997 16:00:00 GMTLast-Modified: Wed, 1 May 1996 12:45:26 GMTServer: Apache 0.84(plain-text response)(connection closed) Request line with HTTP version number, followed by request headers Response status, followed by response headers The preceding exchange is not an exhaustive list of HTTP/1.0 capabilities, but it does illustrate some of the key protocol changes: Request may consist of multiple newline separated header fields. Response object is prefixed with a response status line. Response object has its own set of newline separated header fields. Response object is not limited to hypertext. The connection between server and client is closed after every request. Both the request and response headers were kept as ASCII encoded, but the response object itself could be of any type: an HTML file, a plain text file, an image, or any other content type. Hence, the â€œhypertext transferâ€ part of HTTP became a misnomer not long after its introduction. In reality, HTTP has quickly evolved to become a hypermedia transport, but the original name stuck. In addition to media type negotiation, the RFC also documented a number of other commonly implemented capabilities: content encoding, character set support, multi-part types, authorization, caching, proxy behaviors, date formats, and more. Note : Almost every server on the Web today can and will still speak HTTP/1.0. Except that, by now, you should know better! Requiring a new TCP connection per request imposes a significant performance penalty on HTTP/1.0; see Three-Way Handshake, followed by Slow-Start. Â§HTTP/1.1: Internet StandardThe work on turning HTTP into an official IETF Internet standard proceeded in parallel with the documentation effort around HTTP/1.0 and happened over a period of roughly four years: between 1995 and 1999. In fact, the first official HTTP/1.1 standard is defined in RFC 2068, which was officially released in January 1997, roughly six months after the publication of HTTP/1.0. Then, two and a half years later, in June of 1999, a number of improvements and updates were incorporated into the standard and were released as RFC 2616. The HTTP/1.1 standard resolved a lot of the protocol ambiguities found in earlier versions and introduced a number of critical performance optimizations: keepalive connections, chunked encoding transfers, byte-range requests, additional caching mechanisms, transfer encodings, and request pipelining. With these capabilities in place, we can now inspect a typical HTTP/1.1 session as performed by any modern HTTP browser and client: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657$&gt; telnet website.org 80Connected to xxx.xxx.xxx.xxxGET /index.html HTTP/1.1 (1)Host: website.orgUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4)... (snip)Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Encoding: gzip,deflate,sdchAccept-Language: en-US,en;q=0.8Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3Cookie: __qca=P0-800083390... (snip)HTTP/1.1 200 OK (2)Server: nginx/1.0.11Connection: keep-aliveContent-Type: text/html; charset=utf-8Via: HTTP/1.1 GWADate: Wed, 25 Jul 2012 20:23:35 GMTExpires: Wed, 25 Jul 2012 20:23:35 GMTCache-Control: max-age=0, no-cacheTransfer-Encoding: chunked100 (3)&lt;!doctype html&gt;(snip)100(snip)0 (4)GET /favicon.ico HTTP/1.1 (5)Host: www.website.orgUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4)... (snip)Accept: */*Referer: http://website.org/Connection: close (6)Accept-Encoding: gzip,deflate,sdchAccept-Language: en-US,en;q=0.8Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3Cookie: __qca=P0-800083390... (snip)HTTP/1.1 200 OK (7)Server: nginx/1.0.11Content-Type: image/x-iconContent-Length: 3638Connection: closeLast-Modified: Thu, 19 Jul 2012 17:51:44 GMTCache-Control: max-age=315360000Accept-Ranges: bytesVia: HTTP/1.1 GWADate: Sat, 21 Jul 2012 21:35:22 GMTExpires: Thu, 31 Dec 2037 23:55:55 GMTEtag: W/PSA-GAu26oXbDi(icon data)(connection closed) Request for HTML file, with encoding, charset, and cookie metadata Chunked response for original HTML request Number of octets in the chunk expressed as an ASCII hexadecimal number (256 bytes) End of chunked stream response Request for an icon file made on same TCP connection Inform server that the connection will not be reused Icon response, followed by connection close Phew, there is a lot going on in there! The first and most obvious difference is that we have two object requests, one for an HTML page and one for an image, both delivered over a single connection. This is connection keepalive in action, which allows us to reuse the existing TCP connection for multiple requests to the same host and deliver a much faster end-user experience; see Optimizing for TCP. To terminate the persistent connection, notice that the second client request sends an explicit close token to the server via the Connection header. Similarly, the server can notify the client of the intent to close the current TCP connection once the response is transferred. Technically, either side can terminate the TCP connection without such signal at any point, but clients and servers should provide it whenever possible to enable better connection reuse strategies on both sides. Note : HTTP/1.1 changed the semantics of the HTTP protocol to use connection keepalive by default. Meaning, unless told otherwise (via Connection: close header), the server should keep the connection open by default. However, this same functionality was also backported to HTTP/1.0 and enabled via the Connection: Keep-Alive header. Hence, if you are using HTTP/1.1, technically you donâ€™t need the Connection: Keep-Alive header, but many clients choose to provide it nonetheless. Additionally, the HTTP/1.1 protocol added content, encoding, character set, and even language negotiation, transfer encoding, caching directives, client cookies, plus a dozen other capabilities that can be negotiated on each request. We are not going to dwell on the semantics of every HTTP/1.1 feature. This is a subject for a dedicated book, and many great ones have been written already. Instead, the previous example serves as a good illustration of both the quick progress and evolution of HTTP, as well as the intricate and complicated dance of every client-server exchange. There is a lot going on in there! Note : For a good reference on all the inner workings of the HTTP protocol, check out Oâ€™Reillyâ€™s HTTP: The Definitive Guide by David Gourley and Brian Totty. Â§HTTP/2: Improving Transport PerformanceSince its publication, RFC 2616 has served as a foundation for the unprecedented growth of the Internet: billions of devices of all shapes and sizes, from desktop computers to the tiny web devices in our pockets, speak HTTP every day to deliver news, video, and millions of other web applications we have all come to depend on in our lives. What began as a simple, one-line protocol for retrieving hypertext quickly evolved into a generic hypermedia transport, and now a decade later can be used to power just about any use case you can imagine. Both the ubiquity of servers that can speak the protocol and the wide availability of clients to consume it means that many applications are now designed and deployed exclusively on top of HTTP. Need a protocol to control your coffee pot? RFC 2324 has you covered with the Hyper Text Coffee Pot Control Protocol (HTCPCP/1.0)â€”originally an April Foolsâ€™ Day joke by IETF, and increasingly anything but a joke in our new hyper-connected world. The Hypertext Transfer Protocol (HTTP) is an application-level protocol for distributed, collaborative, hypermedia information systems. It is a generic, stateless, protocol that can be used for many tasks beyond its use for hypertext, such as name servers and distributed object management systems, through extension of its request methods, error codes and headers. A feature of HTTP is the typing and negotiation of data representation, allowing systems to be built independently of the data being transferred. RFC 2616: HTTP/1.1, June 1999 The simplicity of the HTTP protocol is what enabled its original adoption and rapid growth. In fact, it is now not unusual to find embedded devicesâ€”sensors, actuators, and coffee pots alikeâ€”using HTTP as their primary control and data protocols. But under the weight of its own success and as we increasingly continue to migrate our everyday interactions to the Webâ€”social, email, news, and video, and increasingly our entire personal and job workspacesâ€”it has also begun to show signs of stress. Users and web developers alike are now demanding near real-time responsiveness and protocol performance from HTTP/1.1, which it simply cannot meet without some modifications. To meet these new challenges, HTTP must continue to evolve, and hence the HTTPbis working group announced a new initiative for HTTP/2 in early 2012: There is emerging implementation experience and interest in a protocol that retains the semantics of HTTP without the legacy of HTTP/1.x message framing and syntax, which have been identified as hampering performance and encouraging misuse of the underlying transport. The working group will produce a specification of a new expression of HTTPâ€™s current semantics in ordered, bi-directional streams. As with HTTP/1.x, the primary target transport is TCP, but it should be possible to use other transports. HTTP/2 charter, January 2012 The primary focus of HTTP/2 is on improving transport performance and enabling both lower latency and higher throughput. The major version increment sounds like a big step, which it is and will be as far as performance is concerned, but it is important to note that none of the high-level protocol semantics are affected: all HTTP headers, values, and use cases are the same. Any existing website or application can and will be delivered over HTTP/2 without modification: you do not need to modify your application markup to take advantage of HTTP/2. The HTTP servers will have to speak HTTP/2, but that should be a transparent upgrade for the majority of users. The only difference if the working group meets its goal, should be that our applications are delivered with lower latency and better utilization of the network link! Having said that, letâ€™s not get ahead of ourselves. Before we get to the new HTTP/2 protocol features, it is worth taking a step back and examining our existing deployment and performance best practices for HTTP/1.1. The HTTP/2 working group is making fast progress on the new specification, but even if the final standard was already done and ready, we would still have to support older HTTP/1.1 clients for the foreseeable futureâ€”realistically, a decade or more.]]></content>
      <categories>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>è‹±æ–‡</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Netty æºç åˆ†æï¼ˆäº”ï¼‰]]></title>
    <url>%2F2019%2F01%2F22%2FNetty%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%BA%94%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ç‰ˆæœ¬ 4.1.15 å®˜ç½‘ï¼šhttps://netty.io/ Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients. ReferenceCountedio.netty.util.ReferenceCounted å¼•ç”¨è®¡æ•°æ–‡æ¡£ public interface ReferenceCountedA reference-counted object that requires explicit deallocation.When a new ReferenceCounted is instantiated, it starts with the reference count of 1. retain() increases the reference count, and release() decreases the reference count. If the reference count is decreased to 0, the object will be deallocated explicitly, and accessing the deallocated object will usually result in an access violation.If an object that implements ReferenceCounted is a container of other objects that implement ReferenceCounted, the contained objects will also be released via release() when the containerâ€™s reference count becomes 0. æˆ‘ä»¬çœ‹çœ‹å…¶ä¸­çš„æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public interface ReferenceCounted &#123; /** * Returns the reference count of this object. If &#123;@code 0&#125;, it means this object has been deallocated. */ int refCnt(); /** * Increases the reference count by &#123;@code 1&#125;. */ ReferenceCounted retain(); /** * Increases the reference count by the specified &#123;@code increment&#125;. */ ReferenceCounted retain(int increment); /** * Records the current access location of this object for debugging purposes. * If this object is determined to be leaked, the information recorded by this operation will be provided to you * via &#123;@link ResourceLeakDetector&#125;. This method is a shortcut to &#123;@link #touch(Object) touch(null)&#125;. */ ReferenceCounted touch(); /** * Records the current access location of this object with an additional arbitrary information for debugging * purposes. If this object is determined to be leaked, the information recorded by this operation will be * provided to you via &#123;@link ResourceLeakDetector&#125;. */ ReferenceCounted touch(Object hint); /** * Decreases the reference count by &#123;@code 1&#125; and deallocates this object if the reference count reaches at * &#123;@code 0&#125;. * * @return &#123;@code true&#125; if and only if the reference count became &#123;@code 0&#125; and this object has been deallocated */ boolean release(); /** * Decreases the reference count by the specified &#123;@code decrement&#125; and deallocates this object if the reference * count reaches at &#123;@code 0&#125;. * * @return &#123;@code true&#125; if and only if the reference count became &#123;@code 0&#125; and this object has been deallocated */ boolean release(int decrement);&#125; AbstractReferenceCountedByteBufio.netty.buffer.AbstractReferenceCountedByteBuf æˆ‘ä»¬å…ˆæ¥çœ‹ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ï¼Œretain() å’Œ release() æ–¹æ³• retain()io.netty.buffer.AbstractReferenceCountedByteBuf#retain() retain() æ–¹æ³•å¯ä»¥ä½¿å¼•ç”¨è®¡æ•°åŠ ä¸€ 1234567891011121314151617181920212223242526@Overridepublic ByteBuf retain() &#123; return retain0(1);&#125;@Overridepublic ByteBuf retain(int increment) &#123; return retain0(checkPositive(increment, "increment"));&#125;private ByteBuf retain0(int increment) &#123; for (;;) &#123; int refCnt = this.refCnt; final int nextCnt = refCnt + increment; // å¦‚æœ refCnt = 0 çš„æ—¶å€™ nextCont = incrementï¼Œå°±å°±åº”è¯¥è¢«å›æ”¶ // Ensure we not resurrect (which means the refCnt was 0) and also that we encountered an overflow. if (nextCnt &lt;= increment) &#123; throw new IllegalReferenceCountException(refCnt, increment); &#125; // è¿™é‡Œä½¿ç”¨åˆ°äº†è‡ªæ—‹é” if (refCntUpdater.compareAndSet(this, refCnt, nextCnt)) &#123; break; &#125; &#125; return this;&#125; java.util.concurrent.atomic.AtomicIntegerFieldUpdater public abstract class AtomicIntegerFieldUpdaterextends ObjectA reflection-based utility that enables atomic updates to designated volatile int fields of designated classes. This class is designed for use in atomic data structures in which several fields of the same node are independently subject to atomic updates.Note that the guarantees of the compareAndSet method in this class are weaker than in other atomic classes. Because this class cannot ensure that all uses of the field are appropriate for purposes of atomic access, it can guarantee atomicity only with respect to other invocations of compareAndSet and set on the same updater. AtomicIntegerFieldUpdaterè¦ç‚¹çš„æ€»ç»“ï¼š æ›´æ–°å™¨å¿…é¡»æ˜¯intç±»å‹çš„å˜é‡ï¼Œä¸èƒ½æ˜¯å…¶ä»–åŒ…è£…ç±»å‹ æ›´æ–°å™¨çš„æ›´æ–°å¿…é¡»æ˜¯volatileç±»å‹çš„å˜é‡ï¼Œç¡®ä¿çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡æ—¶çš„ç«‹å³å¯è§æ€§ å˜é‡ä¸èƒ½æ˜¯staticçš„ï¼Œå¿…é¡»æ˜¯å®ä¾‹å˜é‡ï¼Œå› ä¸ºUnsafe.objectFieldOffset() æ–¹æ³•ä¸æ”¯æŒé™æ€å˜é‡ï¼ˆCASæ“ä½œæœ¬è´¨æ˜¯é€šè¿‡å¯¹è±¡å®ä¾‹çš„åç§»æ¥ç›´æ¥è¿›è¡Œèµ‹å€¼ï¼‰ æ›´æ–°å™¨åªèƒ½ä¿®æ”¹å®ƒå¯è§èŒƒå›´å†…çš„å˜é‡ï¼Œå› ä¸ºæ›´æ–°å™¨æ˜¯é€šè¿‡åå°„æ¥å¾—åˆ°è¿™ä¸ªå˜é‡ï¼Œå¦‚æœå˜é‡ä¸å¯è§å°±ä¼šæŠ¥é”™ å¦‚æœæ›´æ–°çš„å˜é‡æ—¶åŒ…è£…ç±»å‹ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨AtomicReferenceFieldUpdateræ¥è¿›è¡Œæ›´æ–° java.util.concurrent.atomic.AtomicIntegerFieldUpdater#compareAndSet public abstract boolean compareAndSet(T obj, int expect, int update)Atomically sets the field of the given object managed by this updater to the given updated value if the current value == the expected value. This method is guaranteed to be atomic with respect to other calls to compareAndSet and set, but not necessarily with respect to other changes in the field.Parameters:obj - An object whose field to conditionally setexpect - the expected valueupdate - the new value ä¸€ä¸ªä¸å®‰å…¨çš„æ›´æ–° 123456789101112131415161718192021222324/** * @Author: cuzz * @Date: 2019/1/19 15:40 * @Description: */public class AtomicUpdateTest &#123; public static void main(String[] args) &#123; Person person = new Person(); for (int i = 0; i &lt; 10; i++) &#123; new Thread(() -&gt; &#123; try &#123; Thread.sleep(20); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.print(person.age++ + " "); // 1 6 7 5 4 2 3 1 8 9 &#125;).start(); &#125; &#125;&#125;class Person&#123; int age = 1;&#125; ä½¿ç”¨AtomicIntegerFieldUpdater 123456789101112131415161718192021222324/** * @Author: cuzz * @Date: 2019/1/19 15:40 * @Description: */public class AtomicUpdateTest &#123; public static void main(String[] args) &#123; AtomicIntegerFieldUpdater&lt;Person&gt; fieldUpdater = AtomicIntegerFieldUpdater.newUpdater(Person.class, "age"); Person person = new Person(); for (int i = 0; i &lt; 10; i++) &#123; new Thread(() -&gt; &#123; try &#123; Thread.sleep(20); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.print(fieldUpdater.getAndIncrement(person) + " "); // 1 4 3 2 5 6 7 10 9 8 &#125;).start(); &#125; &#125;&#125;class Person&#123; volatile int age = 1;&#125; å¤§æ¦‚æœ‰ä»¥ä¸‹ä¸¤ç§å­—æ®µé€‚åˆç”¨Atomic*FieldUpdater: å¤§å¤šæ•°ç”¨åˆ°è¿™ä¸ªå­—æ®µçš„ä»£ç æ˜¯åœ¨è¯»å–å­—æ®µçš„å€¼, ä½†ä»ç„¶æœ‰é€šè¿‡CASæ›´æ–°å­—æ®µå€¼çš„éœ€æ±‚. è¿™ä¸ªæ—¶å€™ç”¨AtomicIntegerçš„è¯æ¯ä¸ªç›´æ¥è¯»å–è¿™ä¸ªå­—æ®µçš„åœ°æ–¹éƒ½è¦å¤šä¸€æ¬¡.get()è°ƒç”¨, ç”¨volatileåˆæ»¡è¶³ä¸äº†éœ€æ±‚, æ‰€ä»¥å°±ç”¨åˆ°äº†AtomicIntegerFieldUpdater è¿™ä¸ªå­—æ®µæ‰€å±çš„ç±»ä¼šè¢«åˆ›å»ºå¤§é‡çš„å®ä¾‹å¯¹è±¡, å¦‚æœç”¨AtomicInteger, æ¯ä¸ªå®ä¾‹é‡Œé¢éƒ½è¦åˆ›å»ºAtomicIntegerå¯¹è±¡, ä»è€Œå¤šå‡ºå†…å­˜æ¶ˆè€—. æ¯”å¦‚ä¸€ä¸ªé“¾è¡¨ç±»çš„Node, ç”¨AtomicReferenceä¿å­˜nextæ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„. åŸæ–‡ï¼šhttps://blog.csdn.net/u012415542/article/details/80646605 12private static final AtomicIntegerFieldUpdater&lt;AbstractReferenceCountedByteBuf&gt; refCntUpdater = AtomicIntegerFieldUpdater.newUpdater(AbstractReferenceCountedByteBuf.class, "refCnt"); Reference counted objectså¼•ç”¨è®¡æ•°æ–‡æ¡£ï¼šReference counted objects Netty å¤„ç†å™¨é‡è¦æ¦‚å¿µ Netty çš„å¤„ç†å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šå…¥ç«™å¤„ç†å™¨å’Œå‡ºç«™å¤„ç†å™¨ å…¥ç«™å¤„ç†å™¨çš„é¡¶å±‚æ˜¯ ChannelnboundHandlerï¼Œå‡ºç«™å¤„ç†å™¨çš„é¡¶å±‚æ˜¯ ChannelOutboundHandler æ•°æ®å¤„ç†æ—¶å¸¸ç”¨çš„å„ç§è§£ç å™¨æœ¬è´¨ä¸Šéƒ½æ˜¯å¤„ç†å™¨ ç¼–è§£ç å™¨ï¼šæ— è®ºæˆ‘ä»¬å‘ç½‘ç»œä¸­å†™å…¥çš„æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹ï¼Œæ•°æ®åœ¨ç½‘ç»œä¸­ä¼ é€’æ—¶ï¼Œå…¶éƒ½æ˜¯ä»¥å­—èŠ‚æµçš„å½¢å¼å‘ˆç°ï¼Œå°†æ•°æ®æœ‰åŸæœ¬çš„å­—èŠ‚æµçš„æ“ä½œæˆä¸ºç¼–ç ï¼ˆencodeï¼‰ï¼Œå°†æ•°æ®æœ‰å­—èŠ‚è½¬åŒ–ä¸ºå®ƒåŸæœ¬çš„æ ¼å¼æˆ–æ˜¯å…¶å®ƒçš„æ“ä½œæˆä¸ºè§£ç ï¼ˆdecodeï¼‰ï¼Œç¼–ç ç»Ÿä¸€ç§°ä¸ºï¼ˆcodecï¼‰ ç¼–ç ï¼šæœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‡ºç«™å¤„ç†å™¨ï¼Œå› æ­¤ï¼Œç¼–ç ä¸€å®šæ˜¯ä¸€ç§ ChannelOutboundHandler è§£ç ï¼šæœ¬è´¨ä¸Šæ˜¯ä¸€ç§å…¥ç«™å¤„ç†å™¨ï¼Œå› æ­¤ï¼Œè§£ç ä¸€å®šæ˜¯ä¸€ç§ ChannelInboundHandler åœ¨ Netty ä¸­ï¼Œç¼–ç å™¨é€šå¸¸ä»¥ xxxEncoderå‘½åï¼›è§£ç å™¨é€šå¸¸ä»¥xxxDecoderå‘½å ç¼–å†™ä¸€ä¸ªLongç±»å‹çš„è§£ç å™¨ç¼–å†™ä¸€ä¸ªè§£ç å™¨åœ¨å®¢æœç«¯ä¸æœåŠ¡ç«¯ä¼ è¾“ä¸€ä¸ª Long å‹çš„æ•°æ®ï¼ŒNetty ä¸ºæˆ‘ä»¬æä¾›äº† ByteToMessageDecoder io.netty.handler.codec.ByteToMessageDecoder io.netty.handler.codecpublic abstract class ByteToMessageDecoderextends ChannelInboundHandlerAdapterChannelInboundHandlerAdapter which decodes bytes in a stream-like fashion from one ByteBuf to an other Message type. For example here is an implementation which reads all readable bytes from the input ByteBuf and create a new ByteBuf. public class SquareDecoder extends ByteToMessageDecoder { @Override public void decode(ChannelHandlerContext ctx, ByteBuf in, List out) throws Exception { out.add(in.readBytes(in.readableBytes())); } } Frame detectionGenerally frame detection should be handled earlier in the pipeline by adding a DelimiterBasedFrameDecoder, FixedLengthFrameDecoder, LengthFieldBasedFrameDecoder, or LineBasedFrameDecoder.If a custom frame decoder is required, then one needs to be careful when implementing one with ByteToMessageDecoder. Ensure there are enough bytes in the buffer for a complete frame by checking ByteBuf.readableBytes(). If there are not enough bytes for a complete frame, return without modifying the reader index to allow more bytes to arrive.To check for complete frames without modifying the reader index, use methods like ByteBuf.getInt(int). One MUST use the reader index when using methods like ByteBuf.getInt(int). For example calling in.getInt(0) is assuming the frame starts at the beginning of the buffer, which is not always the case. Use in.getInt(in.readerIndex()) instead.PitfallsBe aware that sub-classes of ByteToMessageDecoder MUST NOT annotated with @Sharable.Some methods such as ByteBuf.readBytes(int) will cause a memory leak if the returned buffer is not released or added to the out List. Use derived buffers like ByteBuf.readSlice(int) to avoid leaking memory. MyByteToLongDecoder 123456789101112131415/** * @Author: cuzz * @Date: 2019/1/22 12:16 * @Description: */public class MyByteToLongDecoder extends ByteToMessageDecoder&#123; @Override protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123; System.out.println("decode invoked!"); System.out.println(in.readableBytes()); if (in.readableBytes() &gt;= 8) &#123; out.add(in.readLong()); &#125; &#125;&#125; MyLongToByteEncoder 12345678910111213/** * @Author: cuzz * @Date: 2019/1/22 12:23 * @Description: */public class MyLongToByteEncoder extends MessageToByteEncoder&lt;Long&gt;&#123; @Override protected void encode(ChannelHandlerContext ctx, Long msg, ByteBuf out) throws Exception &#123; System.out.println("encoder invoked!"); System.out.println(msg); out.writeLong(msg); &#125;&#125; é‡è¦ç»“è®ºï¼š æ— è®ºæ˜¯ç¼–ç å™¨è¿˜æ˜¯è§£ç å™¨ï¼Œå…¶æ‰€æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹å¿…é¡»è¦ä¸å¾…å¤„ç†çš„å‚æ•°ä¿æŒä¸€è‡´ï¼Œå¦åˆ™è¯¥ç¼–ç å™¨æˆ–åˆ™è§£ç å™¨ä¸ä¼šè¢«æ‰§è¡Œ åœ¨è§£ç å™¨è¿›è¡Œæ•°æ®è§£ç æ—¶ï¼Œä¸€å®šè¦è®°å¾—åˆ¤æ–­ç¼“å†²ï¼ˆByteBufï¼‰ä¸­çš„æ•°æ®æ˜¯å¦è¶³å¤Ÿï¼Œå¦åˆ™å°†ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ ReplayingDecoderæ–‡æ¡£ï¼šhttps://netty.io/4.1/api/io/netty/handler/codec/ReplayingDecoder.html å¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç»§æ‰¿è¿™ä¸ªç¼–ç å™¨ï¼Œä»–ä¼šè‡ªåŠ¨å¸®æˆ‘åˆ¤æ–­æ˜¯å¦å¯è¯»ï¼Œä»£ç ä¹Ÿç®€å•ï¼Œç®€åŒ–äº†æˆ‘ä»¬çš„åˆ¤æ–­ 12345678public class MyByteToLongDecoder2 extends ReplayingDecoder&lt;Void&gt; &#123; @Override protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123; System.out.println("MyByteToLongDecoder2 decode invoked!"); out.add(in.readLong()); &#125;&#125; LengthFieldBasedFrameDecoderio.netty.handler.codec.LengthFieldBasedFrameDecoder æ–‡æ¡£ï¼šhttps://netty.io/4.1/api/io/netty/handler/codec/LengthFieldBasedFrameDecoder.html è¿™æ˜¯ä¸€ä¸ªå¸¸ç”¨è¯­è‡ªå®šä¹‰åè®®çš„è§£ç å™¨ TCP ç²˜åŒ…æ‹†åŒ…å¦‚æœæˆ‘å†™çš„è‡ªå®šä¹‰åè®®æ²¡æœ‰å¯¹ç²˜åŒ…å’Œæ‹†åŒ…åšç‰¹æ®Šå¤„ç†çš„è¯å°±ä¼šäº§ç”Ÿç²˜åŒ…å’Œæ‹†åŒ…ç°è±¡ ç²˜åŒ…ã€æ‹†åŒ…å‘ç”ŸåŸå› å‘ç”ŸTCPç²˜åŒ…æˆ–æ‹†åŒ…æœ‰å¾ˆå¤šåŸå› ï¼Œç°åˆ—å‡ºå¸¸è§çš„å‡ ç‚¹ï¼Œå¯èƒ½ä¸å…¨é¢ï¼Œæ¬¢è¿è¡¥å……ï¼Œ1ã€è¦å‘é€çš„æ•°æ®å¤§äºTCPå‘é€ç¼“å†²åŒºå‰©ä½™ç©ºé—´å¤§å°ï¼Œå°†ä¼šå‘ç”Ÿæ‹†åŒ…ã€‚2ã€å¾…å‘é€æ•°æ®å¤§äºMSSï¼ˆæœ€å¤§æŠ¥æ–‡é•¿åº¦ï¼‰ï¼ŒTCPåœ¨ä¼ è¾“å‰å°†è¿›è¡Œæ‹†åŒ…ã€‚3ã€è¦å‘é€çš„æ•°æ®å°äºTCPå‘é€ç¼“å†²åŒºçš„å¤§å°ï¼ŒTCPå°†å¤šæ¬¡å†™å…¥ç¼“å†²åŒºçš„æ•°æ®ä¸€æ¬¡å‘é€å‡ºå»ï¼Œå°†ä¼šå‘ç”Ÿç²˜åŒ…ã€‚4ã€æ¥æ”¶æ•°æ®ç«¯çš„åº”ç”¨å±‚æ²¡æœ‰åŠæ—¶è¯»å–æ¥æ”¶ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œå°†å‘ç”Ÿç²˜åŒ…ã€‚ç²˜åŒ…ã€æ‹†åŒ…è§£å†³åŠæ³•é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬æ¸…æ¥šäº†ç²˜åŒ…æˆ–æ‹†åŒ…å‘ç”Ÿçš„åŸå› ï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿè§£å†³é—®é¢˜çš„å…³é”®åœ¨äºå¦‚ä½•ç»™æ¯ä¸ªæ•°æ®åŒ…æ·»åŠ è¾¹ç•Œä¿¡æ¯ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š1ã€å‘é€ç«¯ç»™æ¯ä¸ªæ•°æ®åŒ…æ·»åŠ åŒ…é¦–éƒ¨ï¼Œé¦–éƒ¨ä¸­åº”è¯¥è‡³å°‘åŒ…å«æ•°æ®åŒ…çš„é•¿åº¦ï¼Œè¿™æ ·æ¥æ”¶ç«¯åœ¨æ¥æ”¶åˆ°æ•°æ®åï¼Œé€šè¿‡è¯»å–åŒ…é¦–éƒ¨çš„é•¿åº¦å­—æ®µï¼Œä¾¿çŸ¥é“æ¯ä¸€ä¸ªæ•°æ®åŒ…çš„å®é™…é•¿åº¦äº†ã€‚2ã€å‘é€ç«¯å°†æ¯ä¸ªæ•°æ®åŒ…å°è£…ä¸ºå›ºå®šé•¿åº¦ï¼ˆä¸å¤Ÿçš„å¯ä»¥é€šè¿‡è¡¥0å¡«å……ï¼‰ï¼Œè¿™æ ·æ¥æ”¶ç«¯æ¯æ¬¡ä»æ¥æ”¶ç¼“å†²åŒºä¸­è¯»å–å›ºå®šé•¿åº¦çš„æ•°æ®å°±è‡ªç„¶è€Œç„¶çš„æŠŠæ¯ä¸ªæ•°æ®åŒ…æ‹†åˆ†å¼€æ¥ã€‚3ã€å¯ä»¥åœ¨æ•°æ®åŒ…ä¹‹é—´è®¾ç½®è¾¹ç•Œï¼Œå¦‚æ·»åŠ ç‰¹æ®Šç¬¦å·ï¼Œè¿™æ ·ï¼Œæ¥æ”¶ç«¯é€šè¿‡è¿™ä¸ªè¾¹ç•Œå°±å¯ä»¥å°†ä¸åŒçš„æ•°æ®åŒ…æ‹†åˆ†å¼€ã€‚ ä½œè€…ï¼šwxy941011æ¥æºï¼šCSDNåŸæ–‡ï¼šhttps://blog.csdn.net/wxy941011/article/details/80428470ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·é™„ä¸Šåšæ–‡é“¾æ¥ï¼ è‡ªå®šä¹‰åè®®è§£å†³ç²˜åŒ…å’Œæ‹†åŒ…ä¸€ä¸ª Person åè®®ç±» 123456789101112131415161718192021222324252627/** * @Author: cuzz * @Date: 2019/1/22 16:00 * @Description: è¿™æ˜¯ä¸€ä¸ªå…³äº Person çš„åè®® */public class PersonProtocol &#123; private int length; private byte[] content; public int getLength() &#123; return length; &#125; public void setLength(int length) &#123; this.length = length; &#125; public byte[] getContent() &#123; return content; &#125; public void setContent(byte[] content) &#123; this.content = content; &#125;&#125; è§£ç å¤„ç†å™¨ 1234567891011121314151617181920212223242526/** * @Author: cuzz * @Date: 2019/1/22 16:04 * @Description: */public class MyPersonDecoder extends ReplayingDecoder&lt;Void&gt;&#123; @Override protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123; System.out.println("MyPersonDecoder decode invoked!"); // Gets a 32-bit integer at the current &#123;@code readerIndex&#125; // and increases the &#123;@code readerIndex&#125; by &#123;@code 4&#125; in this buffer. int length = in.readInt(); byte[] content = new byte[length]; // Transfers this buffer's data to the specified destination starting at // the current &#123;@code readerIndex&#125; and increases the &#123;@code readerIndex&#125; // by the number of the transferred bytes (= &#123;@code dst.length&#125; in.readBytes(content); // æŠŠå†…å®¹æ·»åŠ åˆ°åè®®ä¸­ PersonProtocol personProtocol = new PersonProtocol(); personProtocol.setLength(length); personProtocol.setContent(content); out.add(personProtocol); &#125;&#125; ç¼–ç å¤„ç†å™¨ 12345678910111213141516/** * @Author: cuzz * @Date: 2019/1/22 16:12 * @Description: */public class MyPersonEncoder extends MessageToByteEncoder&lt;PersonProtocol&gt;&#123; @Override protected void encode(ChannelHandlerContext ctx, PersonProtocol msg, ByteBuf out) throws Exception &#123; System.out.println("MyPersonEncoder encoder invoked!"); // æ¶ˆæ¯å¤´ out.writeInt(msg.getLength()); // æ¶ˆæ¯ä½“ out.writeBytes(msg.getContent()); &#125;&#125; æœåŠ¡ç«¯ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758/** * @Author: cuzz * @Date: 2019/1/22 16:39 * @Description: */public class MyServer &#123; public static void main(String[] args) throws Exception&#123; EventLoopGroup bossGroup = new NioEventLoopGroup(1); EventLoopGroup workGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup, workGroup) .channel(NioServerSocketChannel.class) .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new MyPersonDecoder()); pipeline.addLast(new MyPersonEncoder()); pipeline.addLast(new MyServerHandler()); &#125; &#125;); ChannelFuture channelFuture = serverBootstrap.bind(8899).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; bossGroup.shutdownGracefully(); workGroup.shutdownGracefully(); &#125; &#125;&#125;/** * @Author: cuzz * @Date: 2019/1/22 16:16 * @Description: */public class MyServerHandler extends SimpleChannelInboundHandler&lt;PersonProtocol&gt;&#123; private int count; @Override protected void channelRead0(ChannelHandlerContext ctx, PersonProtocol msg) throws Exception &#123; int length = msg.getLength(); byte[] content = msg.getContent(); System.out.println("æœåŠ¡ç«¯æ¥æ”¶åˆ°çš„æ•°æ®ï¼š"); System.out.println("é•¿åº¦ï¼š" + length); System.out.println("å†…å®¹ï¼š" + new String(content, Charset.forName("utf-8"))); System.out.println("æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ•°é‡ï¼š" + (++this.count)); PersonProtocol personProtocol = new PersonProtocol(); String resp = "hello, world"; personProtocol.setLength(resp.getBytes("utf-8").length); personProtocol.setContent(resp.getBytes("utf-8")); ctx.writeAndFlush(personProtocol); &#125;&#125; å®¢æœç«¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162public class MyClient &#123; public static void main(String[] args) throws Exception &#123; EventLoopGroup eventLoopGroup = new NioEventLoopGroup(); try &#123; Bootstrap bootstrap = new Bootstrap(); bootstrap.group(eventLoopGroup) .channel(NioSocketChannel.class) .handler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new MyPersonDecoder()); pipeline.addLast(new MyPersonEncoder()); pipeline.addLast(new MyClientHandler()); &#125; &#125;); ChannelFuture channelFuture = bootstrap.connect("localhost",8899).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; eventLoopGroup.shutdownGracefully(); &#125; &#125;&#125;/** * @Author: cuzz * @Date: 2019/1/22 16:25 * @Description: */public class MyClientHandler extends SimpleChannelInboundHandler&lt;PersonProtocol&gt;&#123; private int count; @Override protected void channelRead0(ChannelHandlerContext ctx, PersonProtocol msg) throws Exception &#123; int length = msg.getLength(); byte[] content = msg.getContent(); System.out.println("å®¢æˆ·ç«¯æ¥æ”¶çš„æ¶ˆæ¯ï¼š"); System.out.println("æ¶ˆæ¯çš„é•¿åº¦ï¼š" + length); System.out.println("æ¶ˆæ¯çš„å†…å®¹ï¼š" + new String(content, Charset.forName("utf-8"))); System.out.println("å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ•°é‡ï¼š" + (++count)); &#125; @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; for (int i = 0; i &lt; 10; i++) &#123; String messageToBeSend = "send form client"; PersonProtocol personProtocol = new PersonProtocol(); personProtocol.setLength(messageToBeSend.getBytes("utf-8").length); personProtocol.setContent(messageToBeSend.getBytes("utf-8")); ctx.writeAndFlush(personProtocol); &#125; &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; æ€»ç»“è¿™é‡Œå…³äº Netty çš„è¿™äº”ç¯‡åˆ†æéƒ½æ˜¯çœ‹çš„åœ£æ€å›­å¼ é¾™è€å¸ˆçš„è¯¾ç¨‹è‡ªå·±æ‰€å†™ä¸‹çš„ç¬”è®°ï¼Œè‡ªå·±å¯¹ Netty æœ‰äº†ç®€å•çš„è®¤è¯†ï¼Œä¹Ÿå¯¹ NIO æœ‰äº†æ›´æ·±çš„äº†è§£ï¼Œæœ€ä¸»è¦çš„å­¦ä¼šçœ‹è‹±æ–‡æ–‡æ¡£ï¼Œçœ‹å®˜æ–¹æ–‡æ¡£å¾ˆé‡è¦ï¼Œä¸è¦æƒ§æ€•ï¼Œæ…¢æ…¢çš„å°±æ„Ÿè§‰è¿˜æ˜¯æ–‡æ¡£å†™çš„æœ€æ¸…æ¥šï¼Œæœ€æœ‰ä»·å€¼ã€‚è€å¸ˆè¿˜æåˆ°éœ€è¦å¤šè®°å½•ï¼Œå› æ­¤æˆ‘ä¹ŸæŠŠä¸€äº›é‡è¦çš„çŸ¥è¯†ç‚¹è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿ä»¥åæŸ¥æ‰¾ã€‚å½“ç„¶ä»¥åè¿˜è¦åŠ å¼ºå­¦ä¹ ï¼Œå¤šçœ‹çœ‹ Netty å®˜æ–¹æ–‡æ¡£å’Œä¾‹å­ï¼ŒåŠ å¼ºç»ƒä¹ ã€‚]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Netty æºç åˆ†æï¼ˆå››ï¼‰]]></title>
    <url>%2F2019%2F01%2F19%2FNetty%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E5%9B%9B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ç‰ˆæœ¬ 4.1.15 å®˜ç½‘ï¼šhttps://netty.io/ Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients. ChannelPromiseio.netty.channel.ChannelPromise å‰é¢æˆ‘ä»¬åˆ†æäº† ChannelFuture ï¼Œçœ‹çœ‹ChannelPromise çš„ä½œç”¨ 1234/** * Special &#123;@link ChannelFuture&#125; which is writable. */public interface ChannelPromise extends ChannelFuture, Promise&lt;Void&gt; &#123; ... &#125; è¿™æ˜¯ä¸€ä¸ªå¯ä»¥å†™å…¥çš„ ChannelFuture ï¼Œæˆ‘å…ˆçœ‹çœ‹ Promise è¿™ä¸ªç±» Promiseio.netty.util.concurrent.Promise 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public interface Promise&lt;V&gt; extends Future&lt;V&gt; &#123; /** * Marks this future as a success and notifies all * listeners. * * If it is success or failed already it will throw an &#123;@link IllegalStateException&#125;. */ Promise&lt;V&gt; setSuccess(V result); /** * Marks this future as a success and notifies all * listeners. * * @return &#123;@code true&#125; if and only if successfully marked this future as * a success. Otherwise &#123;@code false&#125; because this future is * already marked as either a success or a failure. */ boolean trySuccess(V result); /** * Marks this future as a failure and notifies all * listeners. * * If it is success or failed already it will throw an &#123;@link IllegalStateException&#125;. */ Promise&lt;V&gt; setFailure(Throwable cause); /** * Marks this future as a failure and notifies all * listeners. * * @return &#123;@code true&#125; if and only if successfully marked this future as * a failure. Otherwise &#123;@code false&#125; because this future is * already marked as either a success or a failure. */ boolean tryFailure(Throwable cause); /** * Make this future impossible to cancel. * * @return &#123;@code true&#125; if and only if successfully marked this future as uncancellable or it is already done * without being cancelled. &#123;@code false&#125; if this future has been cancelled already. */ boolean setUncancellable(); @Override Promise&lt;V&gt; addListener(GenericFutureListener&lt;? extends Future&lt;? super V&gt;&gt; listener); @Override Promise&lt;V&gt; addListeners(GenericFutureListener&lt;? extends Future&lt;? super V&gt;&gt;... listeners); @Override Promise&lt;V&gt; removeListener(GenericFutureListener&lt;? extends Future&lt;? super V&gt;&gt; listener); @Override Promise&lt;V&gt; removeListeners(GenericFutureListener&lt;? extends Future&lt;? super V&gt;&gt;... listeners); @Override Promise&lt;V&gt; await() throws InterruptedException; @Override Promise&lt;V&gt; awaitUninterruptibly(); @Override Promise&lt;V&gt; sync() throws InterruptedException; @Override Promise&lt;V&gt; syncUninterruptibly();&#125; JDK æ‰€æä¾›çš„çš„ Future åªèƒ½é€šè¿‡æ‰‹å·¥çš„æ–¹å¼æ£€æŸ¥æ‰§è¡Œç»“æœï¼Œè€Œè¿™ä¸ªæ“ä½œæ˜¯ä¼šé˜»å¡çš„ï¼›Netty åˆ™å¯¹ ChannelFutre è¿›è¡Œäº†å¢å¼ºï¼Œé€šè¿‡ ChannelFutureListener ä»¥å›è°ƒçš„æ–¹å¼æ¥è·å–æ‰§è¡Œç»“æœï¼Œå»é™¤äº†æ‰‹å·¥æ£€æŸ¥é˜»å¡çš„æ“ä½œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒChannelFutrureListener çš„ operationComplete æ–¹æ³•æ˜¯ç”±I/Oçº¿ç¨‹æ‰§è¡Œçš„ï¼Œå› æ­¤è¦æ³¨æ„çš„æ˜¯ä¸è¦åœ¨è¿™é‡Œæ‰§è¡Œè€—æ—¶æ“ä½œï¼Œå¦åˆ™éœ€è¦é€šè¿‡å¦å¤–çš„çº¿ç¨‹æˆ–çº¿ç¨‹æ± æ¥æ‰§è¡Œ ChannelInboundHandlerAdapterio.netty.channel.ChannelInboundHandlerAdapter io.netty.channelpublic class ChannelInboundHandlerAdapterextends ChannelHandlerAdapter implements ChannelInboundHandlerAbstract base class for ChannelInboundHandler implementations which provide implementations of all of their methods. This implementation just forward the operation to the next ChannelHandler in the ChannelPipeline. Sub-classes may override a method implementation to change this. Be aware that messages are not released after the channelRead(ChannelHandlerContext, Object) method returns automatically. If you are looking for a ChannelInboundHandler implementation that releases the received messages automatically, please see SimpleChannelInboundHandler. è¿™é‡Œä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ ChannelInboundHandlerio.netty.channel.ChannelInboundHandler 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758/** * &#123;@link ChannelHandler&#125; which adds callbacks for state changes. This allows the user * to hook in to state changes easily. */public interface ChannelInboundHandler extends ChannelHandler &#123; /** * The &#123;@link Channel&#125; of the &#123;@link ChannelHandlerContext&#125; was registered with its &#123;@link EventLoop&#125; */ void channelRegistered(ChannelHandlerContext ctx) throws Exception; /** * The &#123;@link Channel&#125; of the &#123;@link ChannelHandlerContext&#125; was unregistered from its &#123;@link EventLoop&#125; */ void channelUnregistered(ChannelHandlerContext ctx) throws Exception; /** * The &#123;@link Channel&#125; of the &#123;@link ChannelHandlerContext&#125; is now active */ void channelActive(ChannelHandlerContext ctx) throws Exception; /** * The &#123;@link Channel&#125; of the &#123;@link ChannelHandlerContext&#125; was registered is now inactive and reached its * end of lifetime. */ void channelInactive(ChannelHandlerContext ctx) throws Exception; /** * Invoked when the current &#123;@link Channel&#125; has read a message from the peer. */ void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception; /** * Invoked when the last message read by the current read operation has been consumed by * &#123;@link #channelRead(ChannelHandlerContext, Object)&#125;. If &#123;@link ChannelOption#AUTO_READ&#125; is off, no further * attempt to read an inbound data from the current &#123;@link Channel&#125; will be made until * &#123;@link ChannelHandlerContext#read()&#125; is called. */ void channelReadComplete(ChannelHandlerContext ctx) throws Exception; /** * Gets called if an user event was triggered. */ void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception; /** * Gets called once the writable state of a &#123;@link Channel&#125; changed. You can check the state with * &#123;@link Channel#isWritable()&#125;. */ void channelWritabilityChanged(ChannelHandlerContext ctx) throws Exception; /** * Gets called if a &#123;@link Throwable&#125; was thrown. */ @Override @SuppressWarnings("deprecation") void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception;&#125; SimpleChannelInboundHandlerio.netty.channel.SimpleChannelInboundHandler æˆ‘ä»¬åœ¨å†™è‡ªå·±çš„ Handler çš„æ—¶å€™é•¿ä¼šç»§æ‰¿è¿™ä¸ª SimpleChannelInboundHandler 12345678910111213141516171819public class MyServerHandler extends SimpleChannelInboundHandler&lt;String&gt;&#123; @Override protected void channelRead0(ChannelHandlerContext ctx, String msg) throws Exception &#123; System.out.println(ctx.channel().remoteAddress() + ": " + msg); ctx.channel().writeAndFlush("from server: " + UUID.randomUUID()); &#125; /** * å‡ºç°å¼‚å¸¸å…³é—­è¿æ¥ * @param ctx * @param cause * @throws Exception */ @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ–‡æ¡£ io.netty.channelpublic abstract class SimpleChannelInboundHandlerextends ChannelInboundHandlerAdapterChannelInboundHandlerAdapter which allows to explicit only handle a specific type of messages. For example here is an implementation which only handle String messages. 12345678910&gt; public class StringHandler extends&gt; SimpleChannelInboundHandler&lt;String&gt; &#123;&gt; &gt; @Override&gt; protected void channelRead0(ChannelHandlerContext ctx, String message)&gt; throws Exception &#123;&gt; System.out.println(message);&gt; &#125;&gt; &#125;&gt; &gt; Be aware that depending of the constructor parameters it will release all handled messages by passing them to ReferenceCountUtil.release(Object). In this case you may need to use ReferenceCountUtil.retain(Object) if you pass the object to the next handler in the ChannelPipeline.Forward compatibility notice æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³›å‹æŒ‡å®šæ¶ˆæ¯ç±»å‹ 1234567891011121314151617181920212223242526272829303132@Overridepublic void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123; boolean release = true; try &#123; if (acceptInboundMessage(msg)) &#123; @SuppressWarnings("unchecked") I imsg = (I) msg; channelRead0(ctx, imsg); &#125; else &#123; release = false; ctx.fireChannelRead(msg); &#125; &#125; finally &#123; if (autoRelease &amp;&amp; release) &#123; // æŠŠè¿™ä¸ªæ¶ˆæ¯è®¡æ•°å‡ä¸€ï¼Œå½“å‡ä¸º0å°±ä¸¢å¼ƒ ReferenceCountUtil.release(msg); &#125; &#125;&#125;/** * &lt;strong&gt;Please keep in mind that this method will be renamed to * &#123;@code messageReceived(ChannelHandlerContext, I)&#125; in 5.0.&lt;/strong&gt; * * Is called for each message of type &#123;@link I&#125;. * * @param ctx the &#123;@link ChannelHandlerContext&#125; which this &#123;@link SimpleChannelInboundHandler&#125; * belongs to * @param msg the message to handle * @throws Exception is thrown if an error occurred */protected abstract void channelRead0(ChannelHandlerContext ctx, I msg) throws Exception; ç»™æˆ‘ä»¬å¼ºåˆ¶è½¬æ¢ä¸ºç‰¹å®šçš„ç±»å‹ï¼Œå†è°ƒç”¨ channelRead0 æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å»å®ç° ReferenceCountedio.netty.util.ReferenceCounted io.netty.utilpublic interface ReferenceCountedA reference-counted object that requires explicit deallocation.When a new ReferenceCounted is instantiated, it starts with the reference count of 1. retain() increases the reference count, and release() decreases the reference count. If the reference count is decreased to 0, the object will be deallocated explicitly, and accessing the deallocated object will usually result in an access violation.If an object that implements ReferenceCounted is a container of other objects that implement ReferenceCounted, the contained objects will also be released via release() when the containerâ€™s reference count becomes 0. ctx.channel().write()å’Œctx.write()çš„åŒºåˆ«åœ¨ Netty ä¸­æœ‰ä¸¤ç§å‘æ¶ˆæ¯çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥å†™åˆ° Channel ä¸­ï¼Œä¹Ÿå¯ä»¥å†™åˆ°ä¸ ChannelHandler æ‰€å…³è”çš„é‚£ä¸ª ChannelHandlerContext ä¸­ï¼Œå¯¹äº ctx.channel().write() æ–¹å¼æ¥è¯´ï¼Œæ¶ˆæ¯ä¼šä» ChannelPipeline çš„æœ«å°¾å¼€å§‹æµåŠ¨ï¼Œå¯¹äº ctx.write() æ¥è¯´ï¼Œæ¶ˆæ¯å°†ä» ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandler å¼€å§‹æµåŠ¨ è¿™ç¯‡åšå®¢ä¸ªè§£é‡Šäº† https://blog.csdn.net/FishSeeker/article/details/78447684 ç»“è®ºï¼š ChannelHandlerContext ä¸ ChannelHandler ä¹‹é—´çš„å…³è”ç»‘å®šå…³ç³»æ˜¯æ°¸è¿œä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ï¼Œå› æ­¤å¯¹å…¶è¿›è¡Œç¼“å­˜æ—¶æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ å¯¹äºä¸ Channel çš„åŒåæ–¹æ³•æ¥è¯´ï¼Œ ChannelHandlerContext çš„æ–¹æ³•å°†ä¼šäº§ç”Ÿæ›´çŸ­çš„äº‹ä»¶æµï¼Œæ‰€ä»¥æˆ‘ä»¬å› è¯¥åœ¨å¯èƒ½çš„æƒ…å†µä¸‹åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥æå‡æ€§èƒ½ Java NIONIO æ€»ç»“ä½¿ç”¨ NIO è¿›è¡Œæ–‡ä»¶è¯»å–æ‰€æ¶‰åŠçš„æ­¥éª¤ï¼š ä» FileInputStream å¯¹è±¡è·å–åˆ° Channel å¯¹è±¡ åˆ›å»º Buffer å°†æ•°æ®ä» Channel ä¸­è¯»å–åˆ°Bufferä¸­ 0 &lt;= mark &lt;= position &lt;= limit &lt;= capacity flip() æ–¹æ³•ï¼š å°† limit å€¼è®¾ç½®ä¸ºå½“å‰çš„ position å°† position è®¾ç½® 0 clear() æ–¹æ³•ï¼š å°† limit è®¾ç½®ä¸ºcapacity å°† position è®¾ç½®ä¸º0 compact() æ–¹æ³•ï¼š å°†æ‰€æœ‰æœªè¯»çš„æ•°æ®å¤åˆ¶åˆ° buffer èµ·å§‹çš„ä½ç½®å¤„ å°† position è®¾ç½®ä¸ºæœ€åä¸€ä¸ªæœªè¯»å…ƒç´ çš„åé¢ å°† limit è®¾ç½®ä¸º capacity ç°åœ¨buffer å°±å‡†å¤‡å¥½äº†ï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–æœªè¯»çš„æ•°æ® Java NIOä¸­ï¼Œå…³äºDirectBufferï¼ŒHeapBufferçš„ç–‘é—®ï¼Ÿ DirectBuffer å±äºå †å¤–å­˜ï¼Œé‚£åº”è¯¥è¿˜æ˜¯å±äºç”¨æˆ·å†…å­˜ï¼Œè€Œä¸æ˜¯å†…æ ¸å†…å­˜ï¼Ÿ FileChannel çš„read(ByteBuffer dst)å‡½æ•°,write(ByteBuffer src)å‡½æ•°ä¸­ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯HeapBufferç±»å‹,åˆ™ä¼šä¸´æ—¶ç”³è¯·ä¸€å—DirectBuffer,è¿›è¡Œæ•°æ®æ‹·è´ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè¿™æ˜¯å‡ºäºä»€ä¹ˆåŸå› ï¼Ÿ ç­”æ¡ˆï¼š https://www.zhihu.com/question/57374068/answer/152691891 Java NIOä¸­çš„direct bufferï¼ˆä¸»è¦æ˜¯DirectByteBufferï¼‰å…¶å®æ˜¯åˆ†ä¸¤éƒ¨åˆ†çš„ï¼š 12345 Java | native |DirectByteBuffer | malloc&apos;d[ address ] -+-&gt; [ data ] | å…¶ä¸­ DirectByteBuffer è‡ªèº«æ˜¯ä¸€ä¸ªJavaå¯¹è±¡ï¼Œåœ¨Javaå †ä¸­ï¼›è€Œè¿™ä¸ªå¯¹è±¡ä¸­æœ‰ä¸ªlongç±»å‹å­—æ®µaddressï¼Œè®°å½•ç€ä¸€å—è°ƒç”¨ malloc() ç”³è¯·åˆ°çš„native memoryã€‚ æ‰€ä»¥å›åˆ°é¢˜ä¸»çš„é—®é¢˜ï¼š \1. DirectBuffer å±äºå †å¤–å­˜ï¼Œé‚£åº”è¯¥è¿˜æ˜¯å±äºç”¨æˆ·å†…å­˜ï¼Œè€Œä¸æ˜¯å†…æ ¸å†…å­˜ï¼Ÿ DirectByteBuffer è‡ªèº«æ˜¯ï¼ˆJavaï¼‰å †å†…çš„ï¼Œå®ƒèƒŒåçœŸæ­£æ‰¿è½½æ•°æ®çš„bufferæ˜¯åœ¨ï¼ˆJavaï¼‰å †å¤–â€”â€”native memoryä¸­çš„ã€‚è¿™æ˜¯ malloc() åˆ†é…å‡ºæ¥çš„å†…å­˜ï¼Œæ˜¯ç”¨æˆ·æ€çš„ã€‚ \2. FileChannel çš„read(ByteBuffer dst)å‡½æ•°,write(ByteBuffer src)å‡½æ•°ä¸­ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯HeapBufferç±»å‹,åˆ™ä¼šä¸´æ—¶ç”³è¯·ä¸€å—DirectBuffer,è¿›è¡Œæ•°æ®æ‹·è´ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè¿™æ˜¯å‡ºäºä»€ä¹ˆåŸå› ï¼Ÿ é¢˜ä¸»çœ‹çš„æ˜¯OpenJDKçš„ sun.nio.ch.IOUtil.write(FileDescriptor fd, ByteBuffer src, long position, NativeDispatcher nd) çš„å®ç°å¯¹ä¸å¯¹ï¼š 1234567891011121314151617181920212223242526272829static int write(FileDescriptor fd, ByteBuffer src, long position, NativeDispatcher nd) throws IOException&#123; if (src instanceof DirectBuffer) return writeFromNativeBuffer(fd, src, position, nd); // Substitute a native buffer int pos = src.position(); int lim = src.limit(); assert (pos &lt;= lim); int rem = (pos &lt;= lim ? lim - pos : 0); ByteBuffer bb = Util.getTemporaryDirectBuffer(rem); try &#123; bb.put(src); bb.flip(); // Do not update src until we see how many bytes were written src.position(pos); int n = writeFromNativeBuffer(fd, bb, position, nd); if (n &gt; 0) &#123; // now update src src.position(pos + n); &#125; return n; &#125; finally &#123; Util.offerFirstTemporaryDirectBuffer(bb); &#125;&#125; è¿™é‡Œå…¶å®æ˜¯åœ¨è¿å°±OpenJDKé‡Œçš„HotSpot VMçš„ä¸€ç‚¹å®ç°ç»†èŠ‚ã€‚ HotSpot VMé‡Œçš„GCé™¤äº†CMSä¹‹å¤–éƒ½æ˜¯è¦ç§»åŠ¨å¯¹è±¡çš„ï¼Œæ˜¯æ‰€è°“â€œcompacting GCâ€ã€‚ å¦‚æœè¦æŠŠä¸€ä¸ªJavaé‡Œçš„ byte[] å¯¹è±¡çš„å¼•ç”¨ä¼ ç»™nativeä»£ç ï¼Œè®©nativeä»£ç ç›´æ¥è®¿é—®æ•°ç»„çš„å†…å®¹çš„è¯ï¼Œå°±å¿…é¡»è¦ä¿è¯nativeä»£ç åœ¨è®¿é—®çš„æ—¶å€™è¿™ä¸ª byte[] å¯¹è±¡ä¸èƒ½è¢«ç§»åŠ¨ï¼Œä¹Ÿå°±æ˜¯è¦è¢«â€œpinâ€ï¼ˆé’‰ï¼‰ä½ã€‚ å¯æƒœHotSpot VMå‡ºäºä¸€äº›å–èˆè€Œå†³å®šä¸å®ç°å•ä¸ªå¯¹è±¡å±‚é¢çš„object pinningï¼Œè¦pinçš„è¯å°±å¾—æš‚æ—¶ç¦ç”¨GCâ€”â€”ä¹Ÿå°±ç­‰äºæŠŠæ•´ä¸ªJavaå †éƒ½ç»™pinä½ã€‚HotSpot VMå¯¹JNIçš„Criticalç³»APIå°±æ˜¯è¿™æ ·å®ç°çš„ã€‚è¿™ç”¨èµ·æ¥å°±ä¸é‚£ä¹ˆé¡ºæ‰‹ã€‚ æ‰€ä»¥ Oracle/Sun JDK / OpenJDK çš„è¿™ä¸ªåœ°æ–¹å°±ç”¨äº†ç‚¹ç»•å¼¯çš„åšæ³•ã€‚å®ƒå‡è®¾æŠŠ HeapByteBuffer èƒŒåçš„ byte[] é‡Œçš„å†…å®¹æ‹·è´ä¸€æ¬¡æ˜¯ä¸€ä¸ªæ—¶é—´å¼€é”€å¯ä»¥æ¥å—çš„æ“ä½œï¼ŒåŒæ—¶å‡è®¾çœŸæ­£çš„I/Oå¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆæ…¢çš„æ“ä½œã€‚ äºæ˜¯å®ƒå°±å…ˆæŠŠ HeapByteBuffer èƒŒåçš„ byte[] çš„å†…å®¹æ‹·è´åˆ°ä¸€ä¸ª DirectByteBuffer èƒŒåçš„native memoryå»ï¼Œè¿™ä¸ªæ‹·è´ä¼šæ¶‰åŠ sun.misc.Unsafe.copyMemory() çš„è°ƒç”¨ï¼ŒèƒŒåæ˜¯ç±»ä¼¼ memcpy() çš„å®ç°ã€‚è¿™ä¸ªæ“ä½œæœ¬è´¨ä¸Šæ˜¯ä¼šåœ¨æ•´ä¸ªæ‹·è´è¿‡ç¨‹ä¸­æš‚æ—¶ä¸å…è®¸å‘ç”ŸGCçš„ï¼Œè™½ç„¶å®ç°æ–¹å¼è·ŸJNIçš„Criticalç³»APIä¸å¤ªä¸€æ ·ã€‚ï¼ˆå…·ä½“æ¥è¯´æ˜¯ Unsafe.copyMemory() æ˜¯HotSpot VMçš„ä¸€ä¸ªintrinsicæ–¹æ³•ï¼Œä¸­é—´æ²¡æœ‰safepointæ‰€ä»¥GCæ— æ³•å‘ç”Ÿï¼‰ã€‚ ç„¶åæ•°æ®è¢«æ‹·è´åˆ°native memoryä¹‹åå°±å¥½åŠäº†ï¼Œå°±å»åšçœŸæ­£çš„I/Oï¼ŒæŠŠ DirectByteBuffer èƒŒåçš„native memoryåœ°å€ä¼ ç»™çœŸæ­£åšI/Oçš„å‡½æ•°ã€‚è¿™è¾¹å°±ä¸éœ€è¦å†å»è®¿é—®Javaå¯¹è±¡å»è¯»å†™è¦åšI/Oçš„æ•°æ®äº†ã€‚ ByteBufæ–‡æ¡£ï¼šhttps://netty.io/4.1/api/index.html æˆ‘ä»¬çœ‹ç¬¬ä¸€ä¸ªä¾‹å­ 1234567891011121314public class ByteBufTest01 &#123; public static void main(String[] args) &#123; final ByteBuf buffer = Unpooled.buffer(10); for (int i = 0, index = 120; i &lt; 10; i++) &#123; buffer.writeByte(index + i); &#125; for (int i = 0; i &lt; 10; i++) &#123; System.out.println(buffer.getByte(i)); &#125; &#125;&#125; è¾“å‡ºï¼š 12345678910120121122123124125126127-128-127 æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„æ–‡æ¡£ 123456789/** * Sets the specified byte at the current &#123;@code writerIndex&#125; * and increases the &#123;@code writerIndex&#125; by &#123;@code 1&#125; in this buffer. * The 24 high-order bits of the specified value are ignored. * * @throws IndexOutOfBoundsException * if &#123;@code this.writableBytes&#125; is less than &#123;@code 1&#125; */public abstract ByteBuf writeByte(int value); è™½ç„¶ä¼ å…¥çš„ä¸€ä¸ª int å€¼ï¼Œå¯æ˜¯å®ƒä¼šä¸¢å¼ƒé«˜ä½çš„ 24 bitï¼Œæˆ‘ä»¬çŸ¥é“ int æ˜¯ 4 å­—èŠ‚ï¼ˆ32 bitï¼‰ï¼Œä¸¢å¼ƒ 3 å­—èŠ‚ ï¼ˆ24 bitï¼‰ï¼Œå°±ä¿ç•™åˆ° 1 å­—èŠ‚ï¼ˆ8 bitï¼‰ æˆ‘ä»¬è¦çœ‹ä¸‹ä¸€ä¸ªä¾‹å­ 1234567891011121314151617public class ByteBufTest02 &#123; public static void main(String[] args) &#123; ByteBuf byteBuf = Unpooled.copiedBuffer("hello world", Charset.forName("utf-8")); // åˆ¤æ–­æ˜¯å¦ä¸ºå †ç¼“å­˜ï¼Œå¦‚æœæ˜¯å †ç¼“å­˜ï¼Œè¿”å›true if (byteBuf.hasArray()) &#123; byte[] bytes = byteBuf.array(); System.out.println(new String(bytes, Charset.forName("utf-8"))); System.out.println(byteBuf); System.out.println(byteBuf.arrayOffset()); // å¯è¯»å­—èŠ‚ç¬¬ä¸€åç§»é‡ System.out.println(byteBuf.readerIndex()); System.out.println(byteBuf.writerIndex()); System.out.println(byteBuf.capacity()); &#125; &#125;&#125; è¾“å‡ºï¼š 123456hello world UnpooledByteBufAllocator$InstrumentedUnpooledUnsafeHeapByteBuf(ridx: 0, widx: 11, cap: 33)001133 ridx è¡¨ç¤ºè¯»çš„ indexï¼Œwidx è¡¨ç¤ºå†™çš„ index æˆ‘ä»¬æ¥çœ‹çœ‹å¤åˆ Buffer 1234567891011121314151617public class ByteBufTest03 &#123; public static void main(String[] args) &#123; // æ–°å»ºä¸€ä¸ªå¤åˆ buffer CompositeByteBuf compositeByteBuf = Unpooled.compositeBuffer(); ByteBuf heapBuf = Unpooled.buffer(10); ByteBuf directBuf = Unpooled.directBuffer(8); compositeByteBuf.addComponent(heapBuf); compositeByteBuf.addComponent(directBuf); compositeByteBuf.forEach(System.out::println); // è¾“å‡º // UnpooledSlicedByteBuf(ridx: 0, widx: 0, cap: 0/0, unwrapped: UnpooledByteBufAllocator$InstrumentedUnpooledUnsafeHeapByteBuf(ridx: 0, widx: 0, cap: 10)) // UnpooledSlicedByteBuf(ridx: 0, widx: 0, cap: 0/0, unwrapped: UnpooledByteBufAllocator$InstrumentedUnpooledUnsafeNoCleanerDirectByteBuf(ridx: 0, widx: 0, cap: 8)) &#125;&#125; Netty æä¾›çš„ 3 ç§ç¼“å†²åŒºheap bufferï¼ˆå †ç¼“å†²åŒºï¼‰ï¼š è¿™æ˜¯æœ€å¸¸è§çš„ç±»å‹ï¼ŒByteBuf å°†æ•°æ®å­˜å‚¨åˆ° JVM çš„å †ç©ºé—´ä¸­ï¼Œå¹¶ä¸”å°†å®é™…çš„æ•°æ®æ”¾åˆ° byte æ•°ç»„ä¸­æ¥å®ç°çš„ ä¼˜ç‚¹ï¼šç”±äºæ•°æ®æ˜¯å­˜å‚¨åœ¨ JVM çš„å †ä¸­ï¼Œå› æ­¤å¯ä»¥å¿«é€Ÿçš„åˆ›å»ºå’Œå¿«é€Ÿçš„é‡Šæ”¾ï¼Œå¹¶ä¸”å®ƒæä¾›äº† ç›´æ¥è®¿é—®å†…éƒ¨å­—èŠ‚æ•°ç»„çš„æ–¹æ³• ç¼ºç‚¹ï¼šæ¯æ¬¡è¯»å†™æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦å…ˆå°†æ•°æ®å¤åˆ¶åˆ°ç›´æ¥ç¼“å†²ä¸­å†è¿›è¡Œç½‘ç»œä¼ è¾“ direct bufferï¼ˆç›´æ¥ç¼“å†²åŒºï¼‰ï¼š åœ¨å †ä¹‹å¤–ç›´æ¥åˆ†é…å†…å­˜ç©ºé—´ï¼Œç›´æ¥ç¼“å†²åŒºå¹¶ä¸ä¼šå ç”¨å †çš„å®¹é‡ç©ºé—´ï¼Œå› ä¸ºä»–æ˜¯æœ‰æ“ä½œç³»ç»Ÿåœ¨æœ¬åœ°å†…å­˜è¿›è¡Œçš„æ•°æ®åˆ†é… ä¼˜ç‚¹ï¼šåœ¨ä½¿ç”¨ Socket è¿›è¡Œæ•°æ®ä¼ è¾“æ—¶ï¼Œæ€§èƒ½éå¸¸å¥½ï¼Œå› ä¸ºæ•°æ®ç›´æ¥ä½äºæ“ä½œç³»ç»Ÿçš„æœ¬åœ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¸éœ€è¦ä» JVM å°†æ•°æ®å¤åˆ¶åˆ°ç›´æ¥ç¼“å†²åŒº ç¼ºç‚¹ï¼šå› ä¸º Direct Buffer æ˜¯ç›´æ¥åœ¨æ“ä½œç³»ç»Ÿå†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥å†…å­˜ç©ºé—´åˆ†é…ä¸é‡Šæ”¾è¦æ¯”å †ç©ºé—´æ›´åŠ å¤æ‚ï¼Œè€Œä¸”é€Ÿåº¦è¦æ…¢ä¸€äº› Netty é€šè¿‡æä¾›å†…å­˜æ± æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç›´æ¥ç¼“å†²åŒºå¹¶ä¸æ”¯æŒé€šè¿‡å­—èŠ‚æ•°ç»„çš„æ–¹å¼æ¥è®¿é—®æ•°æ® é‡ç‚¹ï¼šå¯¹äºåç«¯çš„ä¸šåŠ¡æ¶ˆæ¯çš„ç¼–è§£ç æ¥è¯´ï¼Œæ¨èä½¿ç”¨ HeapByteBufï¼›å¯¹äº I/O é€šä¿¡çš„è¯»å†™ç¼“å†²åŒºï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ DirectBytebuf composite bufferï¼ˆç¬¦åˆç¼“å†²åŒºï¼‰ï¼š å¤åˆç¼“å†²åŒºå®é™…ä¸Šæ˜¯å°†å¤šä¸ªç¼“å†²åŒºå®ä¾‹ç»„åˆèµ·æ¥ï¼Œå¹¶å‘å¤–æä¾›ä¸€ä¸ªç»Ÿä¸€è§†å›¾ã€‚åƒæ˜¯ä¸€ä¸ªç¼“å†²åŒºçš„ List JDK çš„ ByteBuffer ä¸ Netty çš„ ByteBuf ä¹‹é—´çš„å·®å¼‚æ¯”å¯¹ Netty çš„ ByteBuf é‡‡ç”¨äº†è¯»å†™åˆ†ç¦»çš„ç­–ç•¥ï¼ˆreaderIndex å’Œ writeerIndexï¼‰ï¼Œä¸€ä¸ªåˆå§‹åŒ–ï¼ˆé‡Œé¢å°šæœªæœ‰ä»»ä½•æ•°æ®ï¼‰çš„ ByteBuf çš„ readerIndex ä¸ writerIndex çš„å€¼éƒ½ä¸º0 å½“æ•°ç´¢å¼•ä¸å†™ç´¢å¼•å¤„äºåŒä¸€ä¸ªä½ç½®æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ç»§ç»­è¯»å–ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º IndexOutOfBoundsException å¯¹äºByteBuf çš„ä»»ä½•è¯»å†™æ“ä½œéƒ½ä¼šåˆ†åˆ«å•ç‹¬ç»´æŠ¤è¯»ç´¢å¼•å’Œå†™ç´¢å¼•ï¼ŒMaxCapacity æœ€å¤§çš„å®¹é‡é»˜è®¤ä¸ºInteger.MAX_VALUE JDK çš„ ByteBufferçš„ç¼ºç‚¹ï¼š final byte[] hb; è¿™æ˜¯JDKçš„ByteBufferå¯¹è±¡ä¸­ç”¨äºå‚¨å­˜çš„å¯¹è±¡å£°æ˜ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå…¶å­—èŠ‚æ•°ç»„å¸ƒå°”å£°æ˜ä¸ºfinalçš„ï¼Œä¹Ÿå°±æ˜¯é•¿åº¦æ˜¯å›ºå®šä¸å˜çš„ï¼Œä¸€æ—¦åˆ†é…å¥½åå°±ä¸èƒ½åŠ¨æ€æ‰©å®¹ä¸æ”¶ç¼©ï¼Œè€Œä¸”å½“å‚¨å­˜çš„æ•°æ®å­—èŠ‚å¾ˆå¤§æ—¶å°±å¾ˆæœ‰å¯èƒ½å‡ºç°IndexOutOfBoundsExceptionï¼Œå¦‚æœè¦é¢„é˜²ç€ä¸ªå¼‚å¸¸ï¼Œé‚£å°±éœ€è¦å†å‚¨å­˜ä¹‹å‰å®Œå…¨ç¡®å®šå¥½å¾…å‚¨å­˜çš„å­—èŠ‚çš„å¤§å°ï¼Œå¦‚æœByteBufferçš„ç©ºé—´ä¸è¶³ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯åˆ›å»ºæ–°çš„ByteBufferå¯¹è±¡ï¼Œç„¶åå†å°†ä¹‹å‰çš„ByteBufferä¸­çš„æ•°æ®å¤åˆ¶è¿‡å»ï¼Œè¿™ä¸€åˆ‡æ“ä½œéƒ½éœ€è¦ç”±å¼€å‘è€…è‡ªå·±æ¥æ‰‹åŠ¨å®Œæˆçš„ ByteBuffer åªä½¿ç”¨ä¸€ä¸ªposition æŒ‡é’ˆæ¥æ ‡è¯†ä½ç½®ä¿¡æ¯ï¼Œåœ¨è¿›è¡Œè¯»å†™åˆ‡æ¢æ—¶å°±éœ€è¦è°ƒç”¨flipæ–¹æ³•æˆ–åˆ™æ˜¯rewind æ–¹æ³•ï¼Œä½¿ç”¨å¾ˆä¸æ–¹ä¾¿ Netty çš„ ByteBuf çš„ä¼˜ç‚¹ï¼š å‚¨å­˜å­—èŠ‚çš„æ•°ç»„æ˜¯åŠ¨æ€çš„ï¼Œå…¶æœ€å¤§å€¼é»˜è®¤æ˜¯Integer.MAX_VALUEï¼Œè¿™é‡Œçš„åŠ¨æ€æ€§æ˜¯ä½“ç°åœ¨writeæ–¹æ³•ä¸­çš„ï¼Œwriteæ–¹æ³•æ‰§è¡Œä¼šåˆ¤æ–­bufferå®¹é‡ï¼Œå¦‚æœä¸è¶³åˆ™ä¼šè‡ªåŠ¨æ‰©å®¹ ByteBufçš„è¯»å†™ç´¢å¼•æ˜¯å®Œæˆåˆ†å¼€çš„ï¼Œä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ 12345678910111213141516171819202122232425262728// io.netty.buffer.AbstractByteBuf#writeByte @Override public ByteBuf writeByte(int value) &#123; ensureWritable0(1); // ä¼šå…ˆåˆ¤æ–­æ˜¯å¦å¤Ÿå†™å…¥ä¸€ä¸ªå­—èŠ‚ _setByte(writerIndex++, value); return this; &#125;// io.netty.buffer.AbstractByteBuf#ensureWritable0// ä¼šè‡ªåŠ¨æ‰©å®¹ final void ensureWritable0(int minWritableBytes) &#123; ensureAccessible(); if (minWritableBytes &lt;= writableBytes()) &#123; return; &#125; if (minWritableBytes &gt; maxCapacity - writerIndex) &#123; throw new IndexOutOfBoundsException(String.format( "writerIndex(%d) + minWritableBytes(%d) exceeds maxCapacity(%d): %s", writerIndex, minWritableBytes, maxCapacity, this)); &#125; // Normalize the current capacity to the power of 2. int newCapacity = alloc().calculateNewCapacity(writerIndex + minWritableBytes, maxCapacity); // Adjust to the new capacity. capacity(newCapacity); &#125;]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Netty æºç åˆ†æï¼ˆä¸‰ï¼‰]]></title>
    <url>%2F2019%2F01%2F16%2FNetty%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ç‰ˆæœ¬ 4.1.15 å®˜ç½‘ï¼šhttps://netty.io/ Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients. addLast æ–¹æ³•io.netty.channel.DefaultChannelPipeline#addLast 12345678910111213141516171819202122232425262728293031323334@Overridepublic final ChannelPipeline addLast(EventExecutorGroup group, String name, ChannelHandler handler) &#123; final AbstractChannelHandlerContext newCtx; synchronized (this) &#123; checkMultiplicity(handler); newCtx = newContext(group, filterName(name, handler), handler); addLast0(newCtx); // æ˜¯æŠŠ ChannelHandlerContext æ·»åŠ è¿›å» // If the registered is false it means that the channel was not registered on an eventloop yet. // In this case we add the context to the pipeline and add a task that will call // ChannelHandler.handlerAdded(...) once the channel is registered. if (!registered) &#123; newCtx.setAddPending(); callHandlerCallbackLater(newCtx, true); return this; &#125; EventExecutor executor = newCtx.executor(); if (!executor.inEventLoop()) &#123; newCtx.setAddPending(); executor.execute(new Runnable() &#123; @Override public void run() &#123; callHandlerAdded0(newCtx); &#125; &#125;); return this; &#125; &#125; callHandlerAdded0(newCtx); return this;&#125; AbstractChannelHandlerContext å®šä¹‰äº†ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œæ‰¾åˆ°å®ç°çš„ä¸€ä¸ªæ¥å£ ChannelHandlerContext io.netty.channel.ChannelHandlerContext æ–‡æ¡£ï¼šhttps://netty.io/5.0/api/io/netty/channel/ChannelHandlerContext.html æ¥ä¸‹æ¥æˆ‘åˆ†æä¸€ä¸‹ ChannelHandlerContext ï¼ŒPipeLineï¼ŒHandler è¿™ä¸‰è€…çš„å…³ç³» è¿™ç¯‡æ–‡ç« å†™çš„å¾ˆæ¸…æ¥š https://blog.csdn.net/u010853261/article/details/54574440 ChannelHandlerContextæ¯ä¸ªChannelHandlerè¢«æ·»åŠ åˆ°ChannelPipelineåï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªChannelHandlerContextå¹¶ä¸ä¹‹åˆ›å»ºçš„ChannelHandlerå…³è”ç»‘å®šã€‚ChannelHandlerContextå…è®¸ChannelHandlerä¸å…¶ä»–çš„ChannelHandlerå®ç°è¿›è¡Œäº¤äº’ã€‚ChannelHandlerContextä¸ä¼šæ”¹å˜æ·»åŠ åˆ°å…¶ä¸­çš„ChannelHandlerï¼Œå› æ­¤å®ƒæ˜¯å®‰å…¨çš„ ä¸‹å›¾æ˜¾ç¤ºäº†ChannelHandlerContextã€ChannelHandlerã€ChannelPipelineçš„å…³ç³»ï¼š æœ€åæˆ‘ä»¬çœ‹åˆ° 1234567private void addLast0(AbstractChannelHandlerContext newCtx) &#123; AbstractChannelHandlerContext prev = tail.prev; newCtx.prev = prev; newCtx.next = tail; prev.next = newCtx; tail.prev = newCtx;&#125; æˆ‘ä»¬çš„åŒå‘é“¾è¡¨é“¾è¡¨ç»´æŠ¤çš„æ˜¯ ChannelHandlerContext å¯¹è±¡ï¼Œè€ŒChannelHandlerContext åŒ…è£…äº† ChannelHandler æˆ‘ä»¬å›åˆ° addLast æ–¹æ³•ä¸Š 123456789101112131415161718p.addLast(new ChannelInitializer&lt;Channel&gt;() &#123; @Override public void initChannel(final Channel ch) throws Exception &#123; final ChannelPipeline pipeline = ch.pipeline(); ChannelHandler handler = config.handler(); if (handler != null) &#123; pipeline.addLast(handler); &#125; ch.eventLoop().execute(new Runnable() &#123; @Override public void run() &#123; pipeline.addLast(new ServerBootstrapAcceptor( ch, currentChildGroup, currentChildHandler, currentChildOptions, currentChildAttrs)); &#125; &#125;); &#125;&#125;); è¿›å…¥ ChannelInitializer ç±»ä¸­ï¼Œæˆ‘ä»¬çœ‹ #initChannel æ–¹æ³•ï¼Œè¯´è¿™ä¸ªæ–¹æ³•å½“ Channel æ³¨å†Œæ—¶ä¼šè¢«è°ƒç”¨ï¼Œä¸€æ—¦æ‰ç”¨å®Œå°±ä¼šè¢«ç§»é™¤ ChannelPipelineï¼Œè¿™æ˜¯å› ä¸ºåªéœ€è¦æŠŠé‡Œé¢å°è£…çš„ Handler æ·»åŠ åˆ° ChannelPipelineï¼Œå› ä¸ºä»–æœ¬èº«å°±ä¸ä¸€ä¸ª Handler io.netty.channel.ChannelInitializerprotected abstract void initChannel(C ch) This method will be called once the Channel was registered. After the method returns this instance will be removed from the ChannelPipeline of the Channel. ä¸‹é¢æ˜¯ç§»é™¤ä»£ç  1234567891011121314151617181920212223242526private boolean initChannel(ChannelHandlerContext ctx) throws Exception &#123; if (initMap.putIfAbsent(ctx, Boolean.TRUE) == null) &#123; // Guard against re-entrance. try &#123; initChannel((C) ctx.channel()); &#125; catch (Throwable cause) &#123; // Explicitly call exceptionCaught(...) as we removed the handler before calling initChannel(...). // We do so to prevent multiple calls to initChannel(...). exceptionCaught(ctx, cause); &#125; finally &#123; remove(ctx); &#125; return true; &#125; return false;&#125;private void remove(ChannelHandlerContext ctx) &#123; try &#123; ChannelPipeline pipeline = ctx.pipeline(); if (pipeline.context(this) != null) &#123; pipeline.remove(this); &#125; &#125; finally &#123; initMap.remove(ctx); &#125;&#125; ChannelHandlerContext.attr(..) == Channel.attr(..)https://netty.io/wiki/new-and-noteworthy-in-4.1.html Both Channel and ChannelHandlerContext implement the interface AttributeMap to enable a user to attach one or more user-defined attributes to them. What sometimes made a user confused was that a Channel and a ChannelHandlerContext had its own storage for the user-defined attributes. For example, even if you put an attribute â€˜KEY_Xâ€™ via Channel.attr(KEY_X).set(valueX), you will never find it via ChannelHandlerContext.attr(KEY_X).get() and vice versa. This behavior is not only confusing but also is waste of memory. To address this issue, we decided to keep only one map per Channel internally. AttributeMap always uses AttributeKey as its key. AttributeKey ensures uniqueness between each key, and thus thereâ€™s no point of having more than one attribute map per Channel. As long as a user defines its own AttributeKey as a private static final field of his or her ChannelHandler, there will be no risk of duplicate keys. æ³¨æ„ï¼šç°åœ¨è¿™ä¸¤ä¸ªå…³è”çš„æ˜¯ä¸€ä¸ªMap callHandlerCallbackLater æˆ‘ä»¬å›åˆ° #addLast æ–¹æ³•ä¸Šï¼Œè¿™ä¸ªæ—¶å€™æ˜¯è¿˜æ²¡æœ‰æ³¨å†Œçš„ï¼Œè¿›å…¥è¿™ä¸ª #callHandlerCallbackLater æ–¹æ³•ï¼ŒæŠŠç¨åè°ƒç”¨ Handler å›è°ƒï¼Œå°è£…æˆä¸€ä¸ª task 123456789101112131415private void callHandlerCallbackLater(AbstractChannelHandlerContext ctx, boolean added) &#123; assert !registered; PendingHandlerCallback task = added ? new PendingHandlerAddedTask(ctx) : new PendingHandlerRemovedTask(ctx); PendingHandlerCallback pending = pendingHandlerCallbackHead; if (pending == null) &#123; pendingHandlerCallbackHead = task; &#125; else &#123; // Find the tail of the linked-list. while (pending.next != null) &#123; pending = pending.next; &#125; pending.next = task; &#125;&#125; æ³¨å†Œæˆ‘ä»¬å›åˆ°io.netty.bootstrap.AbstractBootstrap#initAndRegister 12345678910111213141516171819202122final ChannelFuture initAndRegister() &#123; Channel channel = null; try &#123; channel = channelFactory.newChannel(); init(channel); &#125; catch (Throwable t) &#123; if (channel != null) &#123; // channel can be null if newChannel crashed (eg SocketException("too many open files")) channel.unsafe().closeForcibly(); &#125; // as the Channel is not registered yet we need to force the usage of the GlobalEventExecutor return new DefaultChannelPromise(channel, GlobalEventExecutor.INSTANCE).setFailure(t); &#125; ChannelFuture regFuture = config().group().register(channel); if (regFuture.cause() != null) &#123; if (channel.isRegistered()) &#123; channel.close(); &#125; else &#123; channel.unsafe().closeForcibly(); &#125; &#125; å‰é¢çš„åˆå§‹åŒ–åˆå§‹åŒ–å·²ç»æœ‰ä¸€ç‚¹çš„äº†è§£ï¼Œç°åœ¨æˆ‘æ¥çœ‹æ³¨å†Œï¼Œè¿™é‡Œæœ‰#configï¼Œ#group å’Œ #register è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªåˆ†æ 1ChannelFuture regFuture = config().group().register(channel); config æ–¹æ³•12345/** * Returns the &#123;@link AbstractBootstrapConfig&#125; object that can be used to obtain the current config * of the bootstrap. */public abstract AbstractBootstrapConfig&lt;B, C&gt; config(); è¿”å›äº†ä¸€ä¸ª ServerbootstrapConfig å¯¹è±¡ group æ–¹æ³•1234567/** * Returns the configured &#123;@link EventLoopGroup&#125; or &#123;@code null&#125; if non is configured yet. */@SuppressWarnings("deprecation")public final EventLoopGroup group() &#123; return bootstrap.group();&#125; è¿”å›ä¸€ä¸ª NioEventLoopGroup å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™è¿”å›çš„æ˜¯ä¸€ä¸ªè°ƒç”¨çš„æ˜¯ä»–çš„çˆ¶ç±»MultithreadEventLoopGroupçš„ register æ–¹æ³•io.netty.channel.MultithreadEventLoopGroup#register(io.netty.channel.Channel) æœ€ç»ˆä¼šè°ƒç”¨ io.netty.channel.SingleThreadEventLoop#register(io.netty.channel.Channel) çš„æ³¨å†Œæ–¹æ³• æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç±» io.netty.channel.SingleThreadEventLoop io.netty.channelpublic abstract class SingleThreadEventLoopextends SingleThreadEventExecutorimplements EventLoopAbstract base class for EventLoops that execute all its submitted tasks in a single thread. io.netty.channel.AbstractChannel.AbstractUnsafe#register 1234567891011121314151617181920212223242526272829303132333435363738@Overridepublic final void register(EventLoop eventLoop, final ChannelPromise promise) &#123; if (eventLoop == null) &#123; throw new NullPointerException("eventLoop"); &#125; if (isRegistered()) &#123; promise.setFailure(new IllegalStateException("registered to an event loop already")); return; &#125; if (!isCompatible(eventLoop)) &#123; promise.setFailure( new IllegalStateException("incompatible event loop type: " + eventLoop.getClass().getName())); return; &#125; AbstractChannel.this.eventLoop = eventLoop; // å¦‚æœæ˜¯å½“å‰çº¿ç¨‹å°±è®©å®ƒæ‰§è¡Œ if (eventLoop.inEventLoop()) &#123; register0(promise); // å¦‚æœä¸æ˜¯çš„è¯å°±æ”¾åˆ°çº¿ç¨‹æ± ä¸­æ³¨å†Œ &#125; else &#123; try &#123; eventLoop.execute(new Runnable() &#123; @Override public void run() &#123; register0(promise); &#125; &#125;); &#125; catch (Throwable t) &#123; logger.warn( "Force-closing a channel whose registration task was not accepted by an event loop: &#123;&#125;", AbstractChannel.this, t); closeForcibly(); closeFuture.setClosed(); safeSetFailure(promise, t); &#125; &#125;&#125; å…ˆç†è§£ä¸€ä¸‹çº¿ç¨‹ Netty ä¸­çš„çº¿ç¨‹æ¨¡å‹ ä¸€ä¸ª EventLoopGroup å½“ä¸­ä¼šåŒ…å«å¤šä¸ª EventLoop ä¸€ä¸ª EventLoop åœ¨å®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå½“ä¸­éƒ½åªä¼šä¸å”¯ä¸€ä¸€ä¸ª Thread è¿›è¡Œç»‘å®š æ‰€æœ‰ EventLoop æ‰€å¤„ç†çš„å„ç§ I/O äº‹ä»¶éƒ½æ˜¯å°†åœ¨ä»–æ‰€å…³è”çš„é‚£ä¸ª Thread ä¸Šè¿›è¡Œå¤„ç† ä¸€ä¸ª Channel åœ¨å®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åªä¼šæ³¨å†Œåœ¨ä¸€ä¸ª EventLoop ä¸Š ä¸€ä¸ª EventLoop åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè¢«åˆ†é…ç»™ä¸€æˆ–è€…å¤šä¸ª Channel é‡è¦ç»“è®ºï¼š åœ¨Netty ä¸­ Channel çš„å®ç°æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒåŸºäºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨ä¸€ä¸ª Channel çš„å¼•ç”¨ï¼Œå¹¶ä¸”åœ¨éœ€è¦å‘è¿œç¨‹ç«¯ç‚¹å‘é€æ•°æ®æ—¶ï¼Œé€šè¿‡è¿™ä¸ªå¼•ç”¨æ¥è°ƒç”¨ Channel ç›¸åº”çš„æ–¹æ³•ï¼Œå³ä¾¿æ˜¯å½“æ—¶æœ‰å¾ˆå¤šçº¿ç¨‹éƒ½åœ¨ä½¿ç”¨å®ƒä¹Ÿä¸ä¼šå‡ºç°å¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œè€Œä¸”æ¶ˆæ¯ä¸€ç‚¹ä¼šæŒ‰ç…§è¿™ä¸ªé¡ºåºå‘é€å‡ºå» æˆ‘ä»¬åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œä¸è¦å°†æ‰§è¡Œè€—æ—¶çš„ä»»åŠ¡æ”¾å…¥åˆ° EventLoop çš„æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œå› ä¸ºå®ƒä¼šå µå¡è¯¥çº¿ç¨‹çš„æ‰€æœ‰Channel ä¸Šçš„å…¶å®ƒæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è¿›è¡Œé˜»å¡è°ƒç”¨æˆ–åˆ™æ˜¯è€—æ—¶æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„EventExectutor(ä¸šåŠ¡çº¿ç¨‹æ± ) é€šå¸¸ä¼šæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š åœ¨ ChannelHandler çš„å›è°ƒæ–¹æ³•ä¸­ï¼Œä½¿ç”¨è‡ªå·±å®šä¹‰çš„ä¸šåŠ¡çº¿ç¨‹æ± ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å¼‚æ­¥è°ƒç”¨ å€ŸåŠ©äº Netty æä¾›çš„å‘ ChannelPipeline æ·»åŠ ChannelHandleræ˜¯è°ƒç”¨çš„addLastæ–¹æ³•æ¥ä¼ é€’ EventExecutorGroup è¯´æ˜ï¼šå¦‚æœaddLast(handler)çš„æ–¹æ³•æ˜¯ç”±I/Oçº¿ç¨‹æ‰€æ‰§è¡Œçš„ï¼Œå¦‚æœaddLast(eventExectutorGroup, handler)çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æ˜¯ç”±å‚æ•°ä¸­çš„groupçš„çº¿ç¨‹ç»„æ¥æ‰§è¡Œ io.netty.channel.AbstractChannel.AbstractUnsafe#register0 1234567891011121314151617181920212223242526272829303132333435363738private void register0(ChannelPromise promise) &#123; try &#123; // check if the channel is still open as it could be closed in the mean time when the register // call was outside of the eventLoop if (!promise.setUncancellable() || !ensureOpen(promise)) &#123; return; &#125; boolean firstRegistration = neverRegistered; doRegister(); // è¿™ä¸ªæ–¹æ³• neverRegistered = false; registered = true; // Ensure we call handlerAdded(...) before we actually notify the promise. This is needed as the // user may already fire events through the pipeline in the ChannelFutureListener. pipeline.invokeHandlerAddedIfNeeded(); safeSetSuccess(promise); pipeline.fireChannelRegistered(); // Only fire a channelActive if the channel has never been registered. This prevents firing // multiple channel actives if the channel is deregistered and re-registered. if (isActive()) &#123; if (firstRegistration) &#123; pipeline.fireChannelActive(); &#125; else if (config().isAutoRead()) &#123; // This channel was registered before and autoRead() is set. This means we need to begin read // again so that we process inbound data. // // See https://github.com/netty/netty/issues/4805 beginRead(); &#125; &#125; &#125; catch (Throwable t) &#123; // Close the channel directly to avoid FD leak. closeForcibly(); closeFuture.setClosed(); safeSetFailure(promise, t); &#125;&#125; io.netty.channel.nio.AbstractNioChannel#doRegister çœ‹åˆ° doXxx å¼€å¤´çš„æ–¹æ³•å°±çŸ¥é“æ˜¯è®¤çœŸå·¥ä½œçš„ 123456789101112131415161718192021@Overrideprotected void doRegister() throws Exception &#123; boolean selected = false; for (;;) &#123; try &#123; selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), 0, this); return; &#125; catch (CancelledKeyException e) &#123; if (!selected) &#123; // Force the Selector to select now as the "canceled" SelectionKey may still be // cached and not removed because no Select.select(..) operation was called yet. eventLoop().selectNow(); selected = true; &#125; else &#123; // We forced a select operation on the selector before but the SelectionKey is still cached // for whatever reason. JDK bug ? throw e; &#125; &#125; &#125;&#125; ä¸æˆ‘ä»¬å‰é¢å†™çš„ NIO é€»è¾‘æ˜¯ä¸€æ ·çš„ 1serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT); sync1234567891011121314151617181920public class MyServer &#123; public static void main(String[] args) throws InterruptedException &#123; EventLoopGroup bossGroup = new NioEventLoopGroup(); EventLoopGroup workGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap bootstrap = new ServerBootstrap(); bootstrap.group(bossGroup, workGroup) .channel(NioServerSocketChannel.class) .option(ChannelOption.SO_KEEPALIVE, false) .handler(new LoggingHandler(LogLevel.INFO)) .childHandler(new MyServerinitializer()); ChannelFuture channelFuture = bootstrap.bind(8899).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; bossGroup.shutdownGracefully(); bossGroup.shutdownGracefully(); &#125; &#125;&#125; æˆ‘ä»¬å›åˆ°æˆ‘ä»¬ç¼–å†™çš„ Server ä¸­ï¼Œéœ€è¦ç»‘å®šï¼Œä¹‹åéœ€è¦è°ƒç”¨ #sync è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•éœ€è¦åŒæ­¥ï¼Œè¦ä¸ç„¶è¿˜æ²¡ç»‘å®šå®Œæˆå°±è¿”å›äº† ChannelFuture ï¼Œé‡Œé¢çš„ç»“æœæˆ–è€…çŠ¶æ€æ˜¯è¿˜æ²¡æœ‰å®Œæˆçš„ï¼ŒåŠ äº† #sync å°±èƒ½ä¿è¯å®Œæˆ 1ChannelFuture channelFuture = bootstrap.bind(8899).sync(); åœ¨æˆ‘ä»¬æ­£å¸¸å¼€å‘æ˜¯æµç¨‹å°±ä¼šåœåœ¨ä¸‹é¢ï¼Œå°±å¡ä½äº† 1channelFuture.channel().closeFuture().sync(); å½“æˆ‘ä»¬è°ƒç”¨å…³é—­å°±ä¼šåˆ° finally ä¸­ï¼Œä¼šæ‰§è¡Œä¼˜é›…å…³é—­ åˆ°æ­¤æˆ‘ä»¬å¯åŠ¨è¿‡ç¨‹åŸºæœ¬åˆ†æå®Œäº†]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Netty æºç åˆ†æï¼ˆäºŒï¼‰]]></title>
    <url>%2F2019%2F01%2F15%2FNetty%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ç‰ˆæœ¬ 4.1.15 å®˜ç½‘ï¼šhttps://netty.io/ Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients. å…ˆæ¥çœ‹ä¸€ä¸ªNIOç½‘ç»œç¼–ç¨‹æœåŠ¡ç«¯12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879/** * @Author: cuzz * @Date: 2019/1/7 15:39 * @Description: */public class NioServer &#123; // å‚¨å­˜å®¢æˆ·ç«¯è¿æ¥ private static Map&lt;String, SocketChannel&gt; clientMap = new HashMap&lt;&gt;(); public static void main(String[] args) throws IOException &#123; ServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); serverSocketChannel.configureBlocking(false); ServerSocket serverSocket = serverSocketChannel.socket(); serverSocket.bind(new InetSocketAddress(8899)); Selector selector = Selector.open(); serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT); while (true) &#123; try &#123; selector.select(); Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); selectionKeys.forEach(selectionKey -&gt; &#123; try &#123; if (selectionKey.isAcceptable()) &#123; // å¯ä»¥è¯» read(selector, selectionKey); &#125; else if (selectionKey.isReadable()) &#123; // å¯ä»¥å†™ write(selector, selectionKey); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;); selectionKeys.clear(); // åˆ«å¿˜äº†æ¸…ç©º &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; private static void write(Selector selector, SelectionKey selectionKey) throws IOException&#123; SocketChannel client = (SocketChannel) selectionKey.channel(); ByteBuffer byteBuffer = ByteBuffer.allocate(512); int read = client.read(byteBuffer); if (read &gt; 0) &#123; byteBuffer.flip(); Charset charset = Charset.forName("utf-8"); String receiveMessage = String.valueOf(charset.decode(byteBuffer).array()); System.out.println(client + ": " + receiveMessage); String key = null; for (Map.Entry&lt;String, SocketChannel&gt; entry : clientMap.entrySet()) &#123; if (entry.getValue() == client) &#123; key = entry.getKey(); break; &#125; &#125; for (Map.Entry&lt;String, SocketChannel&gt; entry : clientMap.entrySet()) &#123; SocketChannel value = entry.getValue(); ByteBuffer writeBuffer = ByteBuffer.allocate(1024); writeBuffer.put((key + " :" + receiveMessage).getBytes()); writeBuffer.flip(); value.write(writeBuffer); &#125; &#125; &#125; private static void read(Selector selector, SelectionKey selectionKey) throws IOException&#123; ServerSocketChannel server = (ServerSocketChannel) selectionKey.channel(); System.out.println(server); SocketChannel client = server.accept(); client.configureBlocking(false); client.register(selector, SelectionKey.OP_READ); String key = UUID.randomUUID().toString(); // ä¿å­˜å®¢æˆ·ç«¯ clientMap.put(key, client); &#125;&#125; å®¢æœç«¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * @Author: cuzz * @Date: 2019/1/8 17:10 * @Description: */public class NioClient &#123; public static void main(String[] args)&#123; try &#123; SocketChannel socketChannel = SocketChannel.open(); socketChannel.configureBlocking(false); Selector selector = Selector.open(); socketChannel.register(selector, SelectionKey.OP_CONNECT); socketChannel.connect(new InetSocketAddress("127.0.0.1",8899)); while (true) &#123; selector.select(); Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); for (SelectionKey selectionKey : selectionKeys ) &#123; if (selectionKey.isConnectable()) &#123; SocketChannel client = (SocketChannel) selectionKey.channel(); if (client.isConnectionPending()) &#123; client.finishConnect(); System.out.println(client); ByteBuffer writeBuffer = ByteBuffer.allocate(512); writeBuffer.put((LocalDateTime.now() + " è¿æ¥æˆåŠŸ").getBytes()); writeBuffer.flip(); client.write(writeBuffer); ExecutorService executorService = Executors.newSingleThreadExecutor(); executorService.submit(() -&gt; &#123; while (true) &#123; InputStreamReader inputStreamReader = new InputStreamReader(System.in); BufferedReader bf = new BufferedReader(inputStreamReader); String message = bf.readLine(); ByteBuffer buffer = ByteBuffer.allocate(512); buffer.put(message.getBytes()); buffer.flip(); client.write(buffer); &#125; &#125;); &#125; client.register(selector, SelectionKey.OP_READ); &#125; else if (selectionKey.isReadable()) &#123; SocketChannel client = (SocketChannel) selectionKey.channel(); ByteBuffer byteBuffer = ByteBuffer.allocate(1024); int read = client.read(byteBuffer); if (read &gt; 0) &#123; String message = new String(byteBuffer.array()); System.out.println(message); &#125; &#125; &#125; selectionKeys.clear(); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; ä»£ç è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼ŒNetty å†…éƒ¨å°±æ˜¯æŠŠè¿™äº›ç»†èŠ‚ç»™å°è£…èµ·æ¥äº† Reactoræ¨¡å¼ç¿»è¯‘è¿‡æ¥ä¸ºååº”å™¨æ¨¡å¼ï¼Œå¯ä»¥å…ˆçœ‹çœ‹ç”± Doug Lea å†™çš„ Scalable IO in Java ï¼Œæ›´å¥½çš„ç†è§£ Netty çš„è®¾è®¡æ¨¡å¼ è¿˜æœ‰ä¸€ç¯‡åšå®¢ä¹Ÿå†™å¾—å¾ˆå¥½ï¼Œä»‹ç»ç›¸å…³ç†è®ºæ¨¡å‹ï¼Œä½¿ç”¨åœºæ™¯ï¼ŒåŸºæœ¬ç»„ä»¶ã€æ•´ä½“æ¶æ„ï¼Œ è¿™å¯èƒ½æ˜¯ç›®å‰æœ€é€å½»çš„NettyåŸç†æ¶æ„è§£æ Netty é‚£äº›äº‹å„¿ â€”â€”â€” Reactoræ¨¡å¼è¯¦è§£ Netty Reactor å·¥ä½œæ¶æ„å›¾ bind() æ–¹æ³•å‰é¢é€šè¿‡ .channel(NioServerSocketChannel.class) æ˜¯ä¸ºäº†é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ª NioServerSocketChannel å¯¹è±¡ NioServerSocketChannelä½¿ç”¨åå°„åˆ›å»º NioServerSocketChannel è‚¯å®šæ˜¯é€šè¿‡æ— å‚æ•°æ„é€ å™¨ï¼Œåœ¨è°ƒç”¨ newSocket(DEFAULT_SELECTOR_PROVIDER) æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª ServerSocketChannel 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * A &#123;@link io.netty.channel.socket.ServerSocketChannel&#125; implementation which uses * NIO selector based implementation to accept new connections. */public class NioServerSocketChannel extends AbstractNioMessageChannel implements io.netty.channel.socket.ServerSocketChannel &#123; private static final ChannelMetadata METADATA = new ChannelMetadata(false, 16); private static final SelectorProvider DEFAULT_SELECTOR_PROVIDER = SelectorProvider.provider(); private static ServerSocketChannel newSocket(SelectorProvider provider) &#123; try &#123; /** * Use the &#123;@link SelectorProvider&#125; to open &#123;@link SocketChannel&#125; and so remove condition in * &#123;@link SelectorProvider#provider()&#125; which is called by each ServerSocketChannel.open() otherwise. * * See &lt;a href="https://github.com/netty/netty/issues/2308"&gt;#2308&lt;/a&gt;. */ return provider.openServerSocketChannel(); &#125; catch (IOException e) &#123; throw new ChannelException( "Failed to open a server socket.", e); &#125; &#125; private final ServerSocketChannelConfig config; /** * Create a new instance */ public NioServerSocketChannel() &#123; this(newSocket(DEFAULT_SELECTOR_PROVIDER)); &#125; /** * Create a new instance using the given &#123;@link SelectorProvider&#125;. */ public NioServerSocketChannel(SelectorProvider provider) &#123; this(newSocket(provider)); &#125; /** * Create a new instance using the given &#123;@link ServerSocketChannel&#125;. */ public NioServerSocketChannel(ServerSocketChannel channel) &#123; super(null, channel, SelectionKey.OP_ACCEPT); config = new NioServerSocketChannelConfig(this, javaChannel().socket()); &#125; ...&#125; AbstractNioChannelæˆ‘ä»¬å›åˆ°è°ƒç”¨çš„è¿™ä¸ªæ„é€ æ–¹æ³•ä¸Š 1234public NioServerSocketChannel(ServerSocketChannel channel) &#123; super(null, channel, SelectionKey.OP_ACCEPT); config = new NioServerSocketChannelConfig(this, javaChannel().socket());&#125; ä¸€ç›´è°ƒç”¨çˆ¶ç±»ï¼ŒæŠŠ SelectionKey.OP_ACCEPT è®¾ç½®ä¸Šï¼Œè¿˜æœ‰è®¾ç½®éå µå¡ï¼Œæ˜¯ä¸å‡ºæ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¿™éƒ½æ˜¯å¯¹ NIO è¿›è¡Œå°è£… io.netty.channel.nio.AbstractNioChannel#AbstractNioChannel 12345678910protected AbstractNioChannel(Channel parent, SelectableChannel ch, int readInterestOp) &#123; super(parent); this.ch = ch; this.readInterestOp = readInterestOp; try &#123; ch.configureBlocking(false); &#125; catch (IOException e) &#123; ... &#125;&#125; å†è°ƒç”¨çˆ¶ç±»ï¼Œå°±æ˜¯è®¾ç½® Id å’Œåˆ›å»ºç®¡é“ io.netty.channel.AbstractChannel 123456protected AbstractChannel(Channel parent) &#123; this.parent = parent; id = newId(); unsafe = newUnsafe(); pipeline = newChannelPipeline();&#125; NioServerSocketChannelConfigæˆ‘ä»¬åœ¨å›åˆ°è¿™ä¸ªæ„é€ æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹çœ‹è¿™ä¸ªï¼Œ NioServerSocketChannelConfig è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼ŒNetty çš„å„ç§å„æ ·çš„ä¿¡æ¯éƒ½æ˜¯ä½“ç°åœ¨è¿™ä¸ªé‡Œé¢ 1234public NioServerSocketChannel(ServerSocketChannel channel) &#123; super(null, channel, SelectionKey.OP_ACCEPT); config = new NioServerSocketChannelConfig(this, javaChannel().socket());&#125; æŠŠè‡ªå·±å’Œåˆšå¼€å§‹åˆ›å»ºçš„ NIOSocketChannel çš„ ServerSocket å¯¹è±¡ä¼ å…¥è¿›å» io.netty.channel.DefaultChannelConfig 123public DefaultChannelConfig(Channel channel) &#123; this(channel, new AdaptiveRecvByteBufAllocator());&#125; ä¼ äº†ä¸€ä¸ª AdaptiveRecvByteBufAllocator ç¿»è¯‘è¿‡æ¥å¯ä»¥å«å¯é€‚é…çš„æ¥å—å­—èŠ‚ç¼“å†²é€‚é…å™¨ AdaptiveRecvByteBufAllocatorio.netty.channel.AdaptiveRecvByteBufAllocator æ–‡æ¡£ï¼š The RecvByteBufAllocator that automatically increases and decreases the predicted buffer size on feed back.It gradually increases the expected number of readable bytes if the previous read fully filled the allocated buffer. It gradually decreases the expected number of readable bytes if the read operation was not able to fill a certain amount of the allocated buffer two times consecutively. Otherwise, it keeps returning the same prediction. æ„é€ æ–¹æ³•ï¼Œé»˜è®¤æ˜¯1024ï¼Œæœ€å°æ˜¯63ï¼Œæœ€å¤§æ˜¯65536 12345678/** * Creates a new predictor with the default parameters. With the default * parameters, the expected buffer size starts from &#123;@code 1024&#125;, does not * go down below &#123;@code 64&#125;, and does not go up above &#123;@code 65536&#125;. */public AdaptiveRecvByteBufAllocator() &#123; this(DEFAULT_MINIMUM, DEFAULT_INITIAL, DEFAULT_MAXIMUM);&#125; æˆ‘ä»¬åœ¨çœ‹çœ‹é‡Œé¢çš„å†…éƒ¨ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041private final class HandleImpl extends MaxMessageHandle &#123; private final int minIndex; private final int maxIndex; private int index; private int nextReceiveBufferSize; private boolean decreaseNow; public HandleImpl(int minIndex, int maxIndex, int initial) &#123; this.minIndex = minIndex; this.maxIndex = maxIndex; index = getSizeTableIndex(initial); nextReceiveBufferSize = SIZE_TABLE[index]; &#125; @Override public int guess() &#123; return nextReceiveBufferSize; &#125; private void record(int actualReadBytes) &#123; if (actualReadBytes &lt;= SIZE_TABLE[Math.max(0, index - INDEX_DECREMENT - 1)]) &#123; if (decreaseNow) &#123; index = Math.max(index - INDEX_DECREMENT, minIndex); nextReceiveBufferSize = SIZE_TABLE[index]; decreaseNow = false; &#125; else &#123; decreaseNow = true; &#125; &#125; else if (actualReadBytes &gt;= nextReceiveBufferSize) &#123; index = Math.min(index + INDEX_INCREMENT, maxIndex); nextReceiveBufferSize = SIZE_TABLE[index]; decreaseNow = false; &#125; &#125; @Override public void readComplete() &#123; record(totalBytesRead()); &#125;&#125; å…¶çˆ¶äº² MaxMessageHandle ä¸­ï¼Œæ ¹æ®è®°å½•ä¸­çš„åˆ†é…ï¼Œè®¡ç®—å‡ºä¸‹ä¸€æ¬¡åˆ†é…çš„å†…å­˜ 1234@Overridepublic ByteBuf allocate(ByteBufAllocator alloc) &#123; return alloc.ioBuffer(guess());&#125; æ ¹æ®ç³»ç»Ÿçš„æ”¯æŒè¿”å›æ˜¯å †å†…å†…å­˜è¿˜æ˜¯å †å¤–å†…å­˜ 1234567@Overridepublic ByteBuf ioBuffer(int initialCapacity) &#123; if (PlatformDependent.hasUnsafe()) &#123; return directBuffer(initialCapacity); &#125; return heapBuffer(initialCapacity);&#125; Pipelineæˆ‘ä»¬å›åˆ°å‰é¢ç®¡é“çš„åˆ›å»º io.netty.channel.AbstractChannel 123456protected AbstractChannel(Channel parent) &#123; this.parent = parent; id = newId(); unsafe = newUnsafe(); pipeline = newChannelPipeline();&#125; io.netty.channel.DefaultChannelPipeline#DefaultChannelPipeline 1234567891011protected DefaultChannelPipeline(Channel channel) &#123; this.channel = ObjectUtil.checkNotNull(channel, "channel"); succeededFuture = new SucceededChannelFuture(channel, null); voidPromise = new VoidChannelPromise(channel, true); tail = new TailContext(this); head = new HeadContext(this); head.next = tail; tail.prev = head;&#125; è¿™é‡Œç»´æŠ¤äº†ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æŠŠ Channel å¯¹è±¡èµ‹å€¼ç»™è‡ªå·±ï¼Œæ‰€ä»¥ Channel å’Œ Pipeline æ˜¯ç›¸äº’å¼•ç”¨çš„ ChannelPipelineio.netty.channel.ChannelPipeline æ–‡æ¡£ï¼š A list of ChannelHandlers which handles or intercepts inbound events and outbound operations of a Channel. ChannelPipeline implements an advanced form of the Intercepting Filter pattern to give a user full control over how an event is handled and how the ChannelHandlers in a pipeline interact with each other. Creation of a pipeline Each channel has its own pipeline and it is created automatically when a new channel is created. How an event flows in a pipeline The following diagram describes how I/O events are processed by ChannelHandlers in a ChannelPipeline typically. An I/O event is handled by either a ChannelInboundHandler or a ChannelOutboundHandler and be forwarded to its closest handler by calling the event propagation methods defined in ChannelHandlerContext, such as ChannelHandlerContext.fireChannelRead(Object) and ChannelHandlerContext.write(Object). 123456789101112131415161718192021222324252627282930313233343536373839&gt; I/O Request&gt; via Channel or&gt; ChannelHandlerContext&gt; |&gt; +---------------------------------------------------+---------------+&gt; | ChannelPipeline | |&gt; | \|/ |&gt; | +---------------------+ +-----------+----------+ |&gt; | | Inbound Handler N | | Outbound Handler 1 | |&gt; | +----------+----------+ +-----------+----------+ |&gt; | /|\ | |&gt; | | \|/ |&gt; | +----------+----------+ +-----------+----------+ |&gt; | | Inbound Handler N-1 | | Outbound Handler 2 | |&gt; | +----------+----------+ +-----------+----------+ |&gt; | /|\ . |&gt; | . . |&gt; | ChannelHandlerContext.fireIN_EVT() ChannelHandlerContext.OUT_EVT()|&gt; | [ method call] [method call] |&gt; | . . |&gt; | . \|/ |&gt; | +----------+----------+ +-----------+----------+ |&gt; | | Inbound Handler 2 | | Outbound Handler M-1 | |&gt; | +----------+----------+ +-----------+----------+ |&gt; | /|\ | |&gt; | | \|/ |&gt; | +----------+----------+ +-----------+----------+ |&gt; | | Inbound Handler 1 | | Outbound Handler M | |&gt; | +----------+----------+ +-----------+----------+ |&gt; | /|\ | |&gt; +---------------+-----------------------------------+---------------+&gt; | \|/&gt; +---------------+-----------------------------------+---------------+&gt; | | | |&gt; | [ Socket.read() ] [ Socket.write() ] |&gt; | |&gt; | Netty Internal I/O Threads (Transport Implementation) |&gt; +-------------------------------------------------------------------+&gt; &gt; An inbound event is handled by the inbound handlers in the bottom-up direction as shown on the left side of the diagram. An inbound handler usually handles the inbound data generated by the I/O thread on the bottom of the diagram. The inbound data is often read from a remote peer via the actual input operation such as SocketChannel.read(ByteBuffer). If an inbound event goes beyond the top inbound handler, it is discarded silently, or logged if it needs your attention. An outbound event is handled by the outbound handler in the top-down direction as shown on the right side of the diagram. An outbound handler usually generates or transforms the outbound traffic such as write requests. If an outbound event goes beyond the bottom outbound handler, it is handled by an I/O thread associated with the Channel. The I/O thread often performs the actual output operation such as SocketChannel.write(ByteBuffer) For example, let us assume that we created the following pipeline: 1234567&gt; ChannelPipeline p = ...;&gt; p.addLast("1", new InboundHandlerA());&gt; p.addLast("2", new InboundHandlerB());&gt; p.addLast("3", new OutboundHandlerA());&gt; p.addLast("4", new OutboundHandlerB());&gt; p.addLast("5", new InboundOutboundHandlerX());&gt; &gt; In the example above, the class whose name starts with Inbound means it is an inbound handler. The class whose name starts with Outbound means it is a outbound handler. In the given example configuration, the handler evaluation order is 1, 2, 3, 4, 5 when an event goes inbound. When an event goes outbound, the order is 5, 4, 3, 2, 1. On top of this principle, ChannelPipeline skips the evaluation of certain handlers to shorten the stack depth: 3 and 4 donâ€™t implement ChannelInboundHandler, and therefore the actual evaluation order of an inbound event will be: 1, 2, and 5. 1 and 2 donâ€™t implement ChannelOutboundHandler, and therefore the actual evaluation order of a outbound event will be: 5, 4, and 3. If 5 implements both ChannelInboundHandler and ChannelOutboundHandler, the evaluation order of an inbound and a outbound event could be 125 and 543 respectively. Forwarding an event to the next handler As you might noticed in the diagram shows, a handler has to invoke the event propagation methods in ChannelHandlerContext to forward an event to its next handler. Those methods include: Inbound event propagation methods ChannelHandlerContext.fireChannelRegistered() hannelHandlerContext.fireChannelActive() ChannelHandlerContext.fireChannelRead(Object) ChannelHandlerContext.fireChannelReadComplete() ChannelHandlerContext.fireExceptionCaught(Throwable) ChannelHandlerContext.fireUserEventTriggered(Object) ChannelHandlerContext.fireChannelWritabilityChanged() ChannelHandlerContext.fireChannelInactive() ChannelHandlerContext.fireChannelUnregistered() Outbound event propagation methods: ChannelHandlerContext.bind(SocketAddress, ChannelPromise) ChannelHandlerContext.connect(SocketAddress, SocketAddress, ChannelPromise) ChannelHandlerContext.write(Object, ChannelPromise) ChannelHandlerContext.flush() ChannelHandlerContext.read() ChannelHandlerContext.disconnect(ChannelPromise) ChannelHandlerContext.close(ChannelPromise) ChannelHandlerContext.deregister(ChannelPromise) and the following example shows how the event propagation is usually done: 12345678910111213141516&gt; public class MyInboundHandler extends ChannelInboundHandlerAdapter &#123;&gt; @Override&gt; public void channelActive(ChannelHandlerContext ctx) &#123;&gt; System.out.println("Connected!");&gt; ctx.fireChannelActive();&gt; &#125;&gt; &#125;&gt; &gt; public class MyOutboundHandler extends ChannelOutboundHandlerAdapter &#123;&gt; @Override&gt; public void close(ChannelHandlerContext ctx, ChannelPromise promise) &#123;&gt; System.out.println("Closing ..");&gt; ctx.close(promise);&gt; &#125;&gt; &#125;&gt; &gt; Building a pipeline (é‡ç‚¹) A user is supposed to have one or more ChannelHandlers in a pipeline to receive I/O events (e.g. read) and to request I/O operations (e.g. write and close). For example, a typical server will have the following handlers in each channelâ€™s pipeline, but your mileage may vary depending on the complexity and characteristics of the protocol and business logic: Protocol Decoder - translates binary data (e.g. ByteBuf) into a Java object. Protocol Encoder - translates a Java object into binary data. Business Logic Handler - performs the actual business logic (e.g. database access). and it could be represented as shown in the following example: 123456789101112131415&gt; static final EventExecutorGroup group = new DefaultEventExecutorGroup(16);&gt; ...&gt; &gt; ChannelPipeline pipeline = ch.pipeline();&gt; &gt; pipeline.addLast("decoder", new MyProtocolDecoder());&gt; pipeline.addLast("encoder", new MyProtocolEncoder());&gt; &gt; // Tell the pipeline to run MyBusinessLogicHandler's event handler methods&gt; // in a different thread than an I/O thread so that the I/O thread is not blocked by&gt; // a time-consuming task.&gt; // If your business logic is fully asynchronous or finished very quickly, you don't&gt; // need to specify a group.&gt; pipeline.addLast(group, "handler", new MyBusinessLogicHandler());&gt; &gt; æ³¨ï¼šå¯ä»¥ä½¿ç”¨é‡è½½è¿™ä¸ªæ–¹æ³•æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»„ group å»æ‰§è¡Œè€—æ—¶çš„ä»»åŠ¡ï¼Œè·å–åœ¨ MyBusinessLogicHandler ä¸­æŠŠè€—æ—¶éƒ¨åˆ†å¼‚æ­¥å¤„ç†ï¼Œè¿™æ ·å°±ä¸ä¼šå µå¡ IO çº¿ç¨‹ Thread safety A ChannelHandler can be added or removed at any time because a ChannelPipeline is thread safe. For example, you can insert an encryption handler when sensitive information is about to be exchanged, and remove it after the exchange. å¯¹äºä¼ ç»Ÿçš„è¿‡æ»¤å™¨å¦‚ SpringMVC æ¯”å¦‚æˆ‘ä»¬é…ç½®äº† Filter1 Filter2 Filter3 è¿‡æ»¤å™¨ï¼Œè¯·æ±‚å’Œè¿”å›éƒ½è¦ç»è¿‡æ»¤å™¨è¿™3ä¸ªè¿‡æ»¤å™¨ï¼Œè€Œç®¡é“å¯ä»¥é€‰æ‹©çš„å…¶ä¸­æŸäº›ä½œä¸ºè¯·æ±‚çš„è¿‡æ»¤å™¨ï¼Œä¸€äº›ä½œä¸ºè¿”å›çš„è¿‡æ»¤å™¨ï¼Œä¸ä¸€å®šè¦ä¸€æ ·ï¼Œå…¥ç«™çš„å¤„ç†å™¨ä¸“é—¨å¤„ç†å…¥ç«™çš„ï¼Œå‡ºç«™çš„å¤„ç†å™¨ä¸“é—¨å¤„ç†å‡ºç«™çš„ init() æ–¹æ³•io.netty.bootstrap.ServerBootstrap#init 1234567891011121314151617@Overridevoid init(Channel channel) throws Exception &#123; final Map&lt;ChannelOption&lt;?&gt;, Object&gt; options = options0(); synchronized (options) &#123; setChannelOptions(channel, options, logger); &#125; final Map&lt;AttributeKey&lt;?&gt;, Object&gt; attrs = attrs0(); synchronized (attrs) &#123; for (Entry&lt;AttributeKey&lt;?&gt;, Object&gt; e: attrs.entrySet()) &#123; @SuppressWarnings("unchecked") AttributeKey&lt;Object&gt; key = (AttributeKey&lt;Object&gt;) e.getKey(); channel.attr(key).set(e.getValue()); &#125; &#125; ...&#125; ChannelOptionç±»å›¾ io.netty.channelpublic class ChannelOptionextends AbstractConstant]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Netty æºç åˆ†æï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2019%2F01%2F03%2FNetty%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ç‰ˆæœ¬ 4.1.15 å®˜ç½‘ï¼šhttps://netty.io/ Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients. å…ˆçœ‹ä¸€ä¸ªä¾‹å­æœåŠ¡ç«¯MyServer ç±» 123456789101112131415161718192021222324/** * @Author: cuzz * @Date: 2019/1/1 19:44 * @Description: */public class MyServer &#123; public static void main(String[] args) throws InterruptedException &#123; EventLoopGroup bossGroup = new NioEventLoopGroup(); EventLoopGroup workGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap bootstrap = new ServerBootstrap(); bootstrap.group(bossGroup, workGroup) .channel(NioServerSocketChannel.class) .handler(new LoggingHandler(LogLevel.INFO)) .childHandler(new MyServerinitializer()); ChannelFuture channelFuture = bootstrap.bind(8899).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; bossGroup.shutdownGracefully(); bossGroup.shutdownGracefully(); &#125; &#125;&#125; MyServerinitializer ç±» 123456789101112131415161718/** * @Author: cuzz * @Date: 2019/1/1 20:06 * @Description: */public class MyServerinitializer extends ChannelInitializer&lt;SocketChannel&gt; &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new LengthFieldBasedFrameDecoder(Integer.MAX_VALUE, 0, 4, 0, 4)); pipeline.addLast(new LengthFieldPrepender(4)); pipeline.addLast(new StringDecoder(CharsetUtil.UTF_8)); pipeline.addLast(new StringEncoder(CharsetUtil.UTF_8)); pipeline.addLast(new MyServerHandler()); &#125;&#125; MyServerHandler ç±» 123456789101112131415161718192021222324/** * @Author: cuzz * @Date: 2019/1/1 20:23 * @Description: */public class MyServerHandler extends SimpleChannelInboundHandler&lt;String&gt;&#123; @Override protected void channelRead0(ChannelHandlerContext ctx, String msg) throws Exception &#123; System.out.println(ctx.channel().remoteAddress() + ": " + msg); ctx.channel().writeAndFlush("from server: " + UUID.randomUUID()); &#125; /** * å‡ºç°å¼‚å¸¸å…³é—­è¿æ¥ * @param ctx * @param cause * @throws Exception */ @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; å®¢æœç«¯MyClient ç±» 12345678910111213141516171819202122/** * @Author: cuzz * @Date: 2019/1/1 20:31 * @Description: */public class MyClient &#123; public static void main(String[] args) throws Exception &#123; EventLoopGroup eventLoopGroup = new NioEventLoopGroup(); try &#123; Bootstrap bootstrap = new Bootstrap(); bootstrap.group(eventLoopGroup) .channel(NioSocketChannel.class) .handler(new MyClientInitializer()); ChannelFuture channelFuture = bootstrap.connect("localhost",8899).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; eventLoopGroup.shutdownGracefully(); &#125; &#125;&#125; MyClientInitializer ç±» 12345678910111213141516/** * @Author: cuzz * @Date: 2019/1/1 20:40 * @Description: */public class MyClientInitializer extends ChannelInitializer&lt;SocketChannel&gt;&#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new LengthFieldBasedFrameDecoder(Integer.MAX_VALUE, 0, 4, 0, 4)); pipeline.addLast(new LengthFieldPrepender(4)); pipeline.addLast(new StringDecoder(CharsetUtil.UTF_8)); pipeline.addLast(new StringEncoder(CharsetUtil.UTF_8)); pipeline.addLast(new MyClientHandler()); &#125;&#125; MyClientHandler ç±» 1234567891011121314151617181920212223/** * @Author: cuzz * @Date: 2019/1/1 20:42 * @Description: */public class MyClientHandler extends SimpleChannelInboundHandler&lt;String&gt;&#123; @Override protected void channelRead0(ChannelHandlerContext ctx, String msg) throws Exception &#123; System.out.println(ctx.channel().remoteAddress() + ": " + msg); ctx.writeAndFlush("from clinet: " + UUID.randomUUID()); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125; @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; ctx.writeAndFlush("æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼ï¼ï¼"); &#125;&#125; åˆå§‹åŒ–EventLoopGroupåˆ›å»ºä¸€ä¸ª bossGroup å’Œ workGroup 12EventLoopGroup bossGroup = new NioEventLoopGroup();EventLoopGroup workGroup = new NioEventLoopGroup(); EventLoopGroup ç¿»è¯‘è¿‡æ¥å«äº‹ä»¶å¾ªç¯ç»„ï¼Œå…¶æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ bossGroup æ˜¯æŠŠæ¥å—è¿æ¥ï¼ŒæŠŠè¿æ¥è½¬å‘ç»™ workGroup ï¼ŒworkGroup æ˜¯çœŸæ­£å®Œæˆç”¨æˆ·è¯·æ±‚å¤„ç†çš„ç±» EventLoopGroup æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåœ¨åé¢å¾ªç¯çš„è¿‡ç¨‹ä¸­å¯ä»¥é€‰æ‹©æŠŠ Channel æ³¨å†Œä¸Š 1234567891011121314/** * Special &#123;@link EventExecutorGroup&#125; which allows registering &#123;@link Channel&#125;s that get * processed for later selection during the event loop. * */public interface EventLoopGroup extends EventExecutorGroup &#123; @Override EventLoop next(); ChannelFuture register(Channel channel); ChannelFuture register(ChannelPromise promise);&#125; NioEventLoopGroup123456789101112131415// ä»–æ˜¯ä¸€ä¸ªåŸºäºNIOçš„é€‰æ‹©å™¨çš„å¯¹è±¡ public class NioEventLoopGroup extends MultithreadEventLoopGroup &#123; // 0 public NioEventLoopGroup() &#123; this(0); &#125; // 1 public NioEventLoopGroup(int nThreads) &#123; this(nThreads, (Executor) null); &#125; // 2 public NioEventLoopGroup(int nThreads, Executor executor) &#123; this(nThreads, executor, SelectorProvider.provider()); &#125;&#125; MultithreadEventExecutorGroupæœ€ç»ˆä¼šè·³åˆ°MultithreadEventExecutorGroup ä¸­çš„ä¸€ä¸ªæ„é€ å™¨ä¸­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960protected MultithreadEventExecutorGroup(int nThreads, Executor executor, EventExecutorChooserFactory chooserFactory, Object... args) &#123; &#125; // 1 if (executor == null) &#123; executor = new ThreadPerTaskExecutor(newDefaultThreadFactory()); &#125; children = new EventExecutor[nThreads]; for (int i = 0; i &lt; nThreads; i ++) &#123; boolean success = false; try &#123; children[i] = newChild(executor, args); success = true; &#125; catch (Exception e) &#123; // TODO: Think about if this is a good exception type throw new IllegalStateException("failed to create a child event loop", e); &#125; finally &#123; if (!success) &#123; for (int j = 0; j &lt; i; j ++) &#123; children[j].shutdownGracefully(); &#125; for (int j = 0; j &lt; i; j ++) &#123; EventExecutor e = children[j]; try &#123; while (!e.isTerminated()) &#123; e.awaitTermination(Integer.MAX_VALUE, TimeUnit.SECONDS); &#125; &#125; catch (InterruptedException interrupted) &#123; // Let the caller handle the interruption. Thread.currentThread().interrupt(); break; &#125; &#125; &#125; &#125; &#125; chooser = chooserFactory.newChooser(children); final FutureListener&lt;Object&gt; terminationListener = new FutureListener&lt;Object&gt;() &#123; @Override public void operationComplete(Future&lt;Object&gt; future) throws Exception &#123; if (terminatedChildren.incrementAndGet() == children.length) &#123; terminationFuture.setSuccess(null); &#125; &#125; &#125;; for (EventExecutor e: children) &#123; e.terminationFuture().addListener(terminationListener); &#125; Set&lt;EventExecutor&gt; childrenSet = new LinkedHashSet&lt;EventExecutor&gt;(children.length); Collections.addAll(childrenSet, children); readonlyChildren = Collections.unmodifiableSet(childrenSet); &#125; ThreadPerTaskExecutorä»£ç 1ä¸­ï¼Œexecutor = new ThreadPerTaskExecutor(newDefaultThreadFactory());ï¼Œè·Ÿè¿›å» 123456789101112131415public final class ThreadPerTaskExecutor implements Executor &#123; private final ThreadFactory threadFactory; public ThreadPerTaskExecutor(ThreadFactory threadFactory) &#123; if (threadFactory == null) &#123; throw new NullPointerException("threadFactory"); &#125; this.threadFactory = threadFactory; &#125; @Override public void execute(Runnable command) &#123; threadFactory.newThread(command).start(); &#125;&#125; è¿™é‡Œç”¨åˆ°äº†å·¥å‚æ–¹æ³•å’Œå‘½ä»¤æ¨¡å¼ï¼Œé€šè¿‡ä¼ å…¥ä¸€ä¸ªcommandè°ƒç”¨å·¥å‚æ–¹æ³• Executor1234567891011121314public interface Executor &#123; /** * Executes the given command at some time in the future. The command * may execute in a new thread, in a pooled thread, or in the calling * thread, at the discretion of the &#123;@code Executor&#125; implementation. * * @param command the runnable task * @throws RejectedExecutionException if this task cannot be * accepted for execution * @throws NullPointerException if command is null */ void execute(Runnable command);&#125; è¿™æ˜¯åœ¨java.util.concurrent ä¸‹çš„ä¸€ä¸ªæ¥å£ï¼Œæœ€ä¸»è¦çš„å®ç°æ–¹å¼æŠŠä¸€ä¸ªtaskä¼ å…¥ï¼Œæ–°å»ºä¸€ä¸ªçº¿ç¨‹è¿è¡Œ 12345class ThreadPerTaskExecutor implements Executor &#123; public void execute(Runnable r) &#123; new Thread(r).start(); &#125;&#125; ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ç³»åˆ—çš„é™åˆ¶ï¼Œæ¯”å¦‚åºåˆ—åŒ–ç­‰ä¸€ä¸‹æ“ä½œ 123456789101112131415161718192021222324252627282930class SerialExecutor implements Executor &#123; final Queue&lt;Runnable&gt; tasks = new ArrayDeque&lt;Runnable&gt;(); final Executor executor; Runnable active; SerialExecutor(Executor executor) &#123; this.executor = executor; &#125; public synchronized void execute(final Runnable r) &#123; tasks.offer(new Runnable() &#123; public void run() &#123; try &#123; r.run(); &#125; finally &#123; scheduleNext(); &#125; &#125; &#125;); if (active == null) &#123; scheduleNext(); &#125; &#125; protected synchronized void scheduleNext() &#123; if ((active = tasks.poll()) != null) &#123; executor.execute(active); &#125; &#125;&#125; å…¶ä¸­éå¸¸å¸¸ç”¨ç”¨çš„å‡ ä¸ªå®ç°å¦‚ï¼šExecutorServiceï¼ŒThreadPoolExecutor ä¸‹é¢æ˜¯å®˜æ–¹æ–‡æ¡£ The Executor implementations provided in this package implement ExecutorService, which is a more extensive interface. The ThreadPoolExecutor class provides an extensible thread pool implementation. The Executors class provides convenient factory methods for these Executors.The Executor implementations provided in this package implement ExecutorService, which is a more extensive interface. The ThreadPoolExecutor class provides an extensible thread pool implementation. The Executors class provides convenient factory methods for these Executors. å›é¡¾ä¸€ä¸‹ MyServer ä¸­å¯åŠ¨çš„ä»£ç  123456789101112try &#123; ServerBootstrap bootstrap = new ServerBootstrap(); bootstrap.group(bossGroup, workGroup) .channel(NioServerSocketChannel.class) .handler(new LoggingHandler(LogLevel.INFO)) .childHandler(new MyServerinitializer()); ChannelFuture channelFuture = bootstrap.bind(8899).sync(); channelFuture.channel().closeFuture().sync();&#125; finally &#123; bossGroup.shutdownGracefully(); bossGroup.shutdownGracefully();&#125; ServerBootstrap1public class ServerBootstrap extends AbstractBootstrap&lt;ServerBootstrap, ServerChannel&gt; &#123; ... &#125; ServerBootstrap æ˜¯ Bootstrapå­ç±»ï¼Œå®¹æ˜“çš„åœ°å¯åŠ¨ä¸€ä¸ª ServerChannel ServerChannelæ¥å—ä¸€ä¸ªå³å°†åˆ°æ¥çš„è¿æ¥ï¼Œåˆ›å»ºå­ Channel 12345678/** * A &#123;@link Channel&#125; that accepts an incoming connection attempt and creates * its child &#123;@link Channel&#125;s by accepting them. &#123;@link ServerSocketChannel&#125; is * a good example. */public interface ServerChannel extends Channel &#123; // This is a tag interface.&#125; å…¶æœ‰å¾ˆå¤šå®ç°çš„å­ç±»ï¼Œå…¶ä¸­ NioServerSocketChannel æ˜¯æˆ‘ä»¬æ¯”è¾ƒå…³æ³¨çš„ æ–¹æ³•é“¾1234bootstrap.group(bossGroup, workGroup) .channel(NioServerSocketChannel.class) .handler(new LoggingHandler(LogLevel.INFO)) .childHandler(new MyServerinitializer()); .group(bossGroup, workGroup) æˆ‘ä»¬æŠŠ bossGroup å’Œ workGroup ä¼ å…¥è¿›å»ï¼Œç”±äºæ˜¯æ–¹æ³•é“¾ï¼Œè‚¯å®šè¿”å›æœ¬èº«ï¼Œè·Ÿè¸ªä¸‹å» 12345678910111213141516/** * Set the &#123;@link EventLoopGroup&#125; for the parent (acceptor) and the child (client). These * &#123;@link EventLoopGroup&#125;'s are used to handle all the events and IO for &#123;@link ServerChannel&#125; and * &#123;@link Channel&#125;'s. */public ServerBootstrap group(EventLoopGroup parentGroup, EventLoopGroup childGroup) &#123; super.group(parentGroup); if (childGroup == null) &#123; throw new NullPointerException("childGroup"); &#125; if (this.childGroup != null) &#123; throw new IllegalStateException("childGroup set already"); &#125; this.childGroup = childGroup; return this;&#125; è¿™ä¸ªæ­¥ï¼Œå°±æ˜¯ç»™ bossGroup å’Œ workGroup èµ‹å€¼ç»™ ServerBootstrap çš„å®ä¾‹ .channel(NioServerSocketChannel.class) æ–¹æ³•ï¼Œæ¥å—çš„æ˜¯ä¸€ä¸ª class å¯¹è±¡ï¼Œä¸€èˆ¬æ¥å— class å¯¹è±¡å¤§å¤šæ•°ä¸åå°„æœ‰å…³ç³» 1234567891011/** * The &#123;@link Class&#125; which is used to create &#123;@link Channel&#125; instances from. * You either use this or &#123;@link #channelFactory(io.netty.channel.ChannelFactory)&#125; if your * &#123;@link Channel&#125; implementation has no no-args constructor. */public B channel(Class&lt;? extends C&gt; channelClass) &#123; if (channelClass == null) &#123; throw new NullPointerException("channelClass"); &#125; return channelFactory(new ReflectiveChannelFactory&lt;C&gt;(channelClass));&#125; è¿›å…¥ channelFactory æ–¹æ³• 1234567891011/** * &#123;@link io.netty.channel.ChannelFactory&#125; which is used to create &#123;@link Channel&#125; instances from * when calling &#123;@link #bind()&#125;. This method is usually only used if &#123;@link #channel(Class)&#125; * is not working for you because of some more complex needs. If your &#123;@link Channel&#125; implementation * has a no-args constructor, its highly recommend to just use &#123;@link #channel(Class)&#125; for * simplify your code. */@SuppressWarnings(&#123; "unchecked", "deprecation" &#125;)public B channelFactory(io.netty.channel.ChannelFactory&lt;? extends C&gt; channelFactory) &#123; return channelFactory((ChannelFactory&lt;C&gt;) channelFactory);&#125; å¦‚æœæœ‰æ— å‚æ•°çš„æ„é€ æ–¹æ³•æ¨èä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–ä»£ç  Qï¼šä¸ºä»€ä¹ˆå¿…é¡»è¦æœ‰æ— å‚æ•°æ„é€ æ–¹æ³•å‘¢ï¼Ÿ A : ä¸€èˆ¬æ¥è¯´ï¼Œè·å–ä¸€ä¸ªå®ä¾‹å¦‚ä¸‹ç”Ÿæˆï¼Œæ‰€ä»¥å¿…é¡»æœ‰æ— å‚æ•°æ„é€ æ–¹æ³• 12Class class = Class.forName(className);Object object = class.newInstance(); // åªèƒ½è°ƒç”¨æ— å‚æ„é€ å‡½æ•° æˆ‘ä»¬åœ¨æ¥çœ‹çœ‹ NioServerSocketChannel A {@link io.netty.channel.socket.ServerSocketChannel} implementation which uses NIO selector based implementation to accept new connections. .childHandler(new MyServerinitializer()); è®¾ç½®ç”¨äºè¯·æ±‚çš„ Handler 12345678910/** * Set the &#123;@link ChannelHandler&#125; which is used to serve the request for the &#123;@link Channel&#125;'s. */public ServerBootstrap childHandler(ChannelHandler childHandler) &#123; if (childHandler == null) &#123; throw new NullPointerException("childHandler"); &#125; this.childHandler = childHandler; return this;&#125; è¿™é‡Œå…¶å®æœ‰ handler å’Œ childHandler ä¸€ä¸ªæ˜¯ç»™ bossGroup ä½¿ç”¨çš„ï¼Œä¸€ä¸ªæ˜¯ç»™ workGroup ä½¿ç”¨çš„ å¯åŠ¨1ChannelFuture channelFuture = bootstrap.bind(8899).sync(); ChannelFutureChannelFuture å…ˆæ˜¯ç»§æ‰¿äº†è‡ªå·±æä¾›çš„ Future ï¼Œè‡ªèº«çš„ Future åˆç»§æ‰¿ java.util.concurrent.Future&lt;V&gt; ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ JUC ä¸­ Future å’Œ FutureTask JUC.Futureçœ‹çœ‹å…¶ä¸­å‡ ä¸ªä¸»è¦çš„æ–¹æ³•ï¼Œä»æ–¹æ³•åä¹ŸçŸ¥é“æ˜¯åšä»€ä¹ˆçš„ 123456789101112public interface Future&lt;V&gt; &#123; boolean cancel(boolean mayInterruptIfRunning); boolean isCancelled(); boolean isDone(); V get() throws InterruptedException, ExecutionException; V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; æ–‡æ¡£ï¼š A Future represents the result of an asynchronous computation. Methods are provided to check if the computation is complete, to wait for its completion, and to retrieve the result of the computation. The result can only be retrieved using method get when the computation has completed, blocking if necessary until it is ready. Cancellation is performed by the cancel method. Additional methods are provided to determine if the task completed normally or was cancelled. Once a computation has completed, the computation cannot be cancelled. If you would like to use a Future for the sake of cancellability but not provide a usable result, you can declare types of the form Future&lt;?&gt; and return null as a result of the underlying task. ä½¿ç”¨ï¼š 1234567891011121314151617181920interface ArchiveSearcher &#123; String search(String target); &#125;class App &#123; ExecutorService executor = ... ArchiveSearcher searcher = ... void showSearch(final String target) throws InterruptedException &#123; Future&lt;String&gt; future = executor.submit(new Callable&lt;String&gt;() &#123; public String call() &#123; return searcher.search(target); &#125; &#125;); displayOtherThings(); // do other things while searching try &#123; displayText(future.get()); // use future &#125; catch (ExecutionException ex) &#123; cleanup(); return; &#125; &#125;&#125; JUC.FutureTask The FutureTask class is an implementation of Future that implements Runnable, and so may be executed by an Executor. For example, the above construction with submit could be replaced by: 12345FutureTask&lt;String&gt; future = new FutureTask&lt;String&gt;(new Callable&lt;String&gt;() &#123; public String call() &#123; return searcher.search(target); &#125;&#125;);executor.execute(future); å¯ä»¥é€šè¿‡ Executor çš„å®ä¾‹å»æ‰§è¡Œï¼Œæœ€åå†ä» future ä¸­è·å– Netty.Future123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263public interface Future&lt;V&gt; extends java.util.concurrent.Future&lt;V&gt; &#123; boolean isSuccess(); boolean isCancellable(); Throwable cause(); /** * Adds the specified listener to this future. The * specified listener is notified when this future is * &#123;@linkplain #isDone() done&#125;. If this future is already * completed, the specified listener is notified immediately. */ Future&lt;V&gt; addListener(GenericFutureListener&lt;? extends Future&lt;? super V&gt;&gt; listener); /** * Adds the specified listeners to this future. The * specified listeners are notified when this future is * &#123;@linkplain #isDone() done&#125;. If this future is already * completed, the specified listeners are notified immediately. */ Future&lt;V&gt; addListeners(GenericFutureListener&lt;? extends Future&lt;? super V&gt;&gt;... listeners); /** * Removes the first occurrence of the specified listener from this future. * The specified listener is no longer notified when this * future is &#123;@linkplain #isDone() done&#125;. If the specified * listener is not associated with this future, this method * does nothing and returns silently. */ Future&lt;V&gt; removeListener(GenericFutureListener&lt;? extends Future&lt;? super V&gt;&gt; listener); /** * Removes the first occurrence for each of the listeners from this future. * The specified listeners are no longer notified when this * future is &#123;@linkplain #isDone() done&#125;. If the specified * listeners are not associated with this future, this method * does nothing and returns silently. */ Future&lt;V&gt; removeListeners(GenericFutureListener&lt;? extends Future&lt;? super V&gt;&gt;... listeners); // ç­‰å¾…Futureå®Œæˆ Future&lt;V&gt; sync() throws InterruptedException; Future&lt;V&gt; syncUninterruptibly(); Future&lt;V&gt; await() throws InterruptedException; Future&lt;V&gt; awaitUninterruptibly(); boolean await(long timeout, TimeUnit unit) throws InterruptedException; boolean await(long timeoutMillis) throws InterruptedException; boolean awaitUninterruptibly(long timeout, TimeUnit unit); boolean awaitUninterruptibly(long timeoutMillis); V getNow(); @Override boolean cancel(boolean mayInterruptIfRunning);&#125; æˆ‘ä»¬ä¸»è¦çœ‹çœ‹ xxListener æ–¹æ³•ï¼Œä¸€åç¼€ä¸º Listener ä½¿ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ å®ƒæ¯” JUC.Future æ›´å‰å®³çš„æ˜¯å°±å› ä¸ºè¿™ä¸ª Listener ï¼Œè™½ç„¶ JUC.Future å¯ä»¥è°ƒç”¨ get() æ–¹æ³•ï¼Œè·å–å¼‚æ­¥ç»“æœï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å»è°ƒç”¨ï¼Œè°ƒç”¨æ—©äº†å°±å µå¡åœ¨é‚£é‡Œï¼›è€Œ Netty.Future ä½¿ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå½“å®Œæˆæ—¶ä¼šè‡ªåŠ¨è§¦å‘ ChannelFutureæˆ‘ä»¬å›åˆ° ChannelFuture ï¼Œéƒ½é‡å†™äº† Netty.Future ä¸­çš„æ–¹æ³•ï¼Œè¿”å›å€¼æ˜¯ Future çš„å­ç±»ï¼Œjava5æˆ–è€…ä»¥å‰ï¼Œå¿…é¡»ä¸€æ ·ï¼Œjava7ä»¥åå¯ä»¥ä¸åŒï¼Œä½†æ˜¯å¿…é¡»æ˜¯çˆ¶ç±»è¿”å›å€¼çš„æ´¾ç”Ÿç±» 12345678910111213141516171819202122232425262728293031public interface ChannelFuture extends Future&lt;Void&gt; &#123; /** * Returns a channel where the I/O operation associated with this * future takes place. */ Channel channel(); @Override ChannelFuture addListener(GenericFutureListener&lt;? extends Future&lt;? super Void&gt;&gt; listener); @Override ChannelFuture addListeners(GenericFutureListener&lt;? extends Future&lt;? super Void&gt;&gt;... listeners); @Override ChannelFuture removeListener(GenericFutureListener&lt;? extends Future&lt;? super Void&gt;&gt; listener); @Override ChannelFuture removeListeners(GenericFutureListener&lt;? extends Future&lt;? super Void&gt;&gt;... listeners); @Override ChannelFuture sync() throws InterruptedException; @Override ChannelFuture syncUninterruptibly(); @Override ChannelFuture await() throws InterruptedException; @Override ChannelFuture awaitUninterruptibly(); æ–‡æ¡£ï¼š io.netty.channelpublic interface ChannelFutureextends Future The result of an asynchronous Channel I/O operation. All I/O operations in Netty are asynchronous. It means any I/O calls will return immediately with no guarantee that the requested I/O operation has been completed at the end of the call. Instead, you will be returned with a ChannelFuture instance which gives you the information about the result or status of the I/O operation. A ChannelFuture is either uncompleted or completed. When an I/O operation begins, a new future object is created. The new future is uncompleted initially - it is neither succeeded, failed, nor cancelled because the I/O operation is not finished yet. If the I/O operation is finished either successfully, with failure, or by cancellation, the future is marked as completed with more specific information, such as the cause of the failure. Please note that even failure and cancellation belong to the completed state.1234567891011121314151617&gt; +---------------------------+&gt; | Completed successfully |&gt; +---------------------------+&gt; +----&gt; isDone() = true |&gt; +--------------------------+ | | isSuccess() = true |&gt; | Uncompleted | | +===========================+&gt; +--------------------------+ | | Completed with failure |&gt; | isDone() = false | | +---------------------------+&gt; | isSuccess() = false |----+----&gt; isDone() = true |&gt; | isCancelled() = false | | | cause() = non-null |&gt; | cause() = null | | +===========================+&gt; +--------------------------+ | | Completed by cancellation |&gt; | +---------------------------+&gt; +----&gt; isDone() = true |&gt; | isCancelled() = true |&gt; +---------------------------+&gt; Various methods are provided to let you check if the I/O operation has been completed, wait for the completion, and retrieve the result of the I/O operation. It also allows you to add ChannelFutureListeners so you can get notified when the I/O operation is completed. æ¨èä½¿ç”¨ç›‘å¬å™¨è€Œä¸æ˜¯ç­‰å¾…çš„æ–¹æ³•1234567891011121314151617181920// BAD - NEVER DO THIS@Overridepublic void channelRead(ChannelHandlerContext ctx, Object msg) &#123; ChannelFuture future = ctx.channel().close(); future.awaitUninterruptibly(); // Perform post-closure operation // ...&#125;// GOOD@Overridepublic void channelRead(ChannelHandlerContext ctx, Object msg) &#123; ChannelFuture future = ctx.channel().close(); future.addListener(new ChannelFutureListener() &#123; public void operationComplete(ChannelFuture future) &#123; // Perform post-closure operation // ... &#125; &#125;);&#125; ä¸è¦æ··æ·†è¿æ¥è¶…æ—¶å’Œç­‰å¾…è¶…æ—¶â€‹12345678910111213141516171819202122232425262728293031// BAD - NEVER DO THISBootstrap b = ...;ChannelFuture f = b.connect(...);f.awaitUninterruptibly(10, TimeUnit.SECONDS);if (f.isCancelled()) &#123; // Connection attempt cancelled by user&#125; else if (!f.isSuccess()) &#123; // You might get a NullPointerException here because the future // might not be completed yet. f.cause().printStackTrace();&#125; else &#123; // Connection established successfully&#125;// GOODBootstrap b = ...;// Configure the connect timeout option.b.option(ChannelOption.CONNECT_TIMEOUT_MILLIS, 10000);ChannelFuture f = b.connect(...);f.awaitUninterruptibly();// Now we are sure the future is completed.assert f.isDone();if (f.isCancelled()) &#123; // Connection attempt cancelled by user&#125; else if (!f.isSuccess()) &#123; f.cause().printStackTrace();&#125; else &#123; // Connection established successfully&#125; bind()æ–¹æ³•å½“æˆ‘ä»¬è°ƒç”¨ bind æ–¹æ³•æ—¶ï¼Œæ‰çœŸæ­£çš„å¯åŠ¨æœåŠ¡å™¨â€‹1ChannelFuture channelFuture = bootstrap.bind(8899).sync(); é€šè¿‡ä¸€äº›åˆ¤æ–­æœ€ç»ˆåˆ° doBind æ–¹æ³•ä¸Š 1234567891011121314151617181920212223242526272829303132333435private ChannelFuture doBind(final SocketAddress localAddress) &#123; final ChannelFuture regFuture = initAndRegister(); final Channel channel = regFuture.channel(); if (regFuture.cause() != null) &#123; return regFuture; &#125; if (regFuture.isDone()) &#123; // At this point we know that the registration was complete and successful. ChannelPromise promise = channel.newPromise(); doBind0(regFuture, channel, localAddress, promise); return promise; &#125; else &#123; // Registration future is almost always fulfilled already, but just in case it's not. final PendingRegistrationPromise promise = new PendingRegistrationPromise(channel); regFuture.addListener(new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture future) throws Exception &#123; Throwable cause = future.cause(); if (cause != null) &#123; // Registration on the EventLoop failed so fail the ChannelPromise directly to not cause an // IllegalStateException once we try to access the EventLoop of the Channel. promise.setFailure(cause); &#125; else &#123; // Registration was successful, so set the correct executor to use. // See https://github.com/netty/netty/issues/2586 promise.registered(); doBind0(regFuture, channel, localAddress, promise); &#125; &#125; &#125;); return promise; &#125;&#125; initAndRegister()æ–¹æ³•è¿™ä¸ªä¸»è¦æ˜¯åˆå§‹åŒ–å’Œæ³¨å†Œï¼Œæ¯”è¾ƒå¤æ‚ï¼Œåç»­åœ¨åˆ†æ åŠ æ²¹ï¼ï¼ï¼]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[201812]]></title>
    <url>%2F2018%2F12%2F30%2F201812%2F</url>
    <content type="text"><![CDATA[æ€»ç»“è¿™ä¸ªæœˆä¸€è¾¹å¿™ç€å®éªŒï¼Œä¸€è¾¹å†™ä»£ç ï¼Œåšè®¡ç®—çš„å¥½å¤„å°±æ˜¯æ—¶é—´æ¯”è¾ƒå……è£•ï¼Œæ—©ä¸Šæ¥åˆ°å®éªŒå®¤ç”¨è„šæœ¬æŠŠä»»åŠ¡ä¸€æäº¤å°±å¯ä»¥å®‰å¿ƒçš„å†™ä»£ç äº† é¢è¯•ä¸Šä¸ªæœˆåˆ°å°ç±³é¢è¯•äº†ï¼Œå¾ˆé—æ†¾æ²¡æœ‰é¢ä¸Šï¼Œä¸è¿‡è¿˜æ˜¯æœ‰ç‚¹æ”¶è·çš„ï¼Œè‡ªå·±å­¦ç€è¿·èŒ«äº†ï¼Œå°±å»é¢è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆè‡ªå·±æ²¡æœ‰æŒæ¡å¥½ï¼Œæ›´å¥½çš„è€ƒéªŒè‡ªå·±ã€‚ è¿™æ¬¡é¢è¯•æˆ‘çš„é¢è¯•å®˜ä¸»è¦é—®çš„å¾ˆå¤šåŸºç¡€çš„é—®é¢˜ è‡ªæˆ‘ä»‹ç» å¯¹æ“ä½œç³»ç»Ÿäº†ä¸äº†è§£ï¼Œè¯´ä¸‹é˜Ÿåˆ— è¯´ä¸‹ Dubbo ç®—æ³• æ ‘çš„æŒ‰å±‚æ‰“å° æŠŠæ•°å€¼è½¬åŒ–ä¸ºä¸­æ–‡å¤§å†™é‡‘é¢ æ²¡æœ‰é—® Java çš„ç›¸å…³å†…å®¹ï¼Œè‡ªå·±ç­”çš„ä¸æ˜¯å¾ˆå¥½ï¼Œåˆæœ‰å­¦ä¹ çš„åŠ¨åŠ›äº†ï¼Œå›æ¥å°±é©¬ä¸Šè¡¥è¿™äº›çŸ¥è¯† å‰‘æŒ‡Offerè¿™ä¸ªæœˆæŠŠé‡Œé¢çš„é¢˜åˆåˆ·äº†ä¸€éï¼Œæ¯”èµ·ç¬¬ä¸€æ¬¡åˆ·ä»£ç æ›´ç®€æ´äº†ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿèƒ½ä¼˜åŒ–æ›´å¥½ï¼Œåˆ·é¢˜è¿˜æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ è§†é¢‘æ±‡ç¼–è¯­è¨€ç¨‹åºè®¾è®¡è¿™æ˜¯æ¸…åå¤§å­¦å…¬å¼€è¯¾ï¼Œè®²å¾—æŒºç®€å•æ˜“æ‡‚ï¼Œè‡ªå·±å¯¹æ±‡ç¼–ç¨‹åºè¿‡äº†ä¸€éï¼Œå¯¹æ±‡ç¼–æœ‰äº†ä¸€ä¸ªç®€å•çš„è®¤è¯†ï¼Œæ±‡ç¼–æ˜¯å¯¹æŒ‡ä»¤çš„ä¸€ç§æŠ½è±¡ï¼Œæ›´è´´è¿‘æœºå™¨ï¼Œå¯¹ä»£ç æœ‰äº†ä¸€ä¸ªæ–°çš„è®¤è¯† æ“ä½œç³»ç»Ÿè¿™ä¹Ÿæ˜¯æ¸…åå¤§å­¦å…¬å¼€è¯¾ï¼Œç”±äºè‡ªå·±å¯¹è¿™äº›åŸºç¡€çŸ¥è¯†æ¯”è¾ƒç¼ºä¹ï¼Œç°åœ¨åœ¨å­¦æ ¡ï¼Œè¿˜æ˜¯è¦è¸è¸å®å®æŠŠè¿™äº›åŸºç¡€çŸ¥è¯†å­¦å¥½ï¼Œæ‰èƒ½èµ°å¾—æ›´è¿œ çœ‹ç‚¹CSAPPæœ€è¿‘ä¹Ÿåœ¨çœ‹ CSAPP è¿™æœ¬ä¹¦ï¼Œè¿™ä¸ªæ˜¯å¯¹è¿™æœ¬ä¸€ä¸ªç®€å•çš„æç‚¼ï¼Œå…ˆæŒæ¡ä¸»å¹²å†æ…¢æ…¢æ¶ˆåŒ–ä¹¦ä¸Šçš„å†…å®¹ï¼Œæ€»ç»“çš„å¾ˆå¥½ ä¸‹æœˆè®¡åˆ’ çœ‹å®Œã€Šç¼–ç ã€‹ Leetcode 50 é“ ç†Ÿæ‚‰ä¸€ä¸‹ Netty]]></content>
      <categories>
        <category>monthly</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[201811]]></title>
    <url>%2F2018%2F11%2F30%2F201811%2F</url>
    <content type="text"><![CDATA[çœ‹åˆ°é˜®ä¸€å³°è€å¸ˆå†™çš„æ¯å‘¨æŠ€æœ¯åˆ†äº«ï¼Œè‡ªå·±æƒ³å†™ä¸€ä¸ªç±»ä¼¼æ¥è®°å½•ä¸€ä¸‹è‡ªå·±ï¼Œæ–¹ä¾¿ä»¥åè‡ªå·±æŸ¥æ‰¾ï¼Œæˆ‘å°±æ¯æœˆæ€»ç»“ä¸€æ¬¡ã€‚ç§‘ç ”ä¸Šæˆ‘éœ€è¦æ¯ä¸ªæœˆè¦å‘ä¸€ä»½æ€»ç»“å¯¼å¸ˆï¼Œè€Œè¿™ä¸ªæ€»ç»“ä¸»è¦æ˜¯æŠ€æœ¯ä¸Šçš„ï¼Œä¹ŸåŒ…æ‹¬è‡ªå·±å¹³æ—¶çš„æ‰€è§æ‰€é—»ï¼Œå¸Œæœ›è‡ªå·±èƒ½åšæŒå†™ä¸‹å» æ€»ç»“springcloud-vue-projectä¸Šä¸€ä¸ªæœˆä¸»è¦å†™äº†ä¸€ä¸ª Vue + SpringCloud çš„é¡¹ç›®ï¼Œé¡¹ç›®å¤§éƒ¨åˆ†å†™å®Œäº†ï¼Œå¯¹å¾®æœåŠ¡çš„çŸ¥è¯†æˆ‘é‚£ä¹ˆä¸€ç‚¹ç‚¹å…¥é—¨ï¼Œä¸»è¦æ¶æ„å›¾å¦‚ä¸‹ é¢è¯•æƒ³å‡ºå»å®ä¹ ï¼ŒæŠ•äº†ä¸¤ä¸ªé¢è¯•ï¼Œä¸€ä¸ªåš OMS ç³»ç»Ÿçš„ç‰©æµå…¬å¸ å…ˆæ˜¯åšäº†ä¸€å¥—å·å­ï¼Œä¸¤é“ç®—æ³•é¢˜æ¯”è¾ƒç®€å•ï¼Œæ•°æ®åº“æ„Ÿè§‰æ²¡ç­”å¥½ï¼Œå¾ˆä¹…æ²¡æœ‰å†™ SQL åŸºç¡€çŸ¥è¯†é—®å¾—æ¯”è¾ƒå°‘ï¼Œå°±é—®äº†ä¸€ä¸ªAtomicIntegeræ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæœ‰é“é¢˜ç›®ä¸­æˆ‘å†™äº†è¿™ä¸ªç±» å› ä¸ºæˆ‘æœ‰å®ä¹ ç»å†ï¼Œå°±é—®äº†ä¸€äº›é¡¹ç›®ç›¸å…³çš„ï¼Œæ€ä¹ˆè§£å†³é¡¹ç›®ä¸­é‡åˆ°çš„å›°éš¾ï¼Œä¸€äº›å¸¸ç”¨çš„ä¸­é—´ä»¶ç†Ÿä¸ç†Ÿï¼Œèƒ½ä¸èƒ½è‡ªå·±éƒ¨ç½²ï¼ŒDockerä¼šä¸ä¼šç”¨ä¹‹ç±»çš„ï¼Œåé¢å°±å’Œäº§å“ç»å†èŠäº†èŠï¼Œå°±å¿«é€Ÿçš„ç»“æŸäº† è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯å°ç±³äº†ï¼Œä¸‹å‘¨é¢è¯•ï¼Œå¸Œæœ›èƒ½æˆåŠŸ Leetcodeæœ€è¿‘æ¯å¤©éƒ½ä¼šåˆ·åˆ· leetcodeï¼Œåˆšå¼€å§‹çš„æ—¶å€™ç—›ä¸æ¬²ç”Ÿï¼Œæ…¢æ…¢çš„è¶Šæ¥è¶Šé¡ºäº†ï¼Œå½“ç„¶æœ‰ä¸€éƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†é¢è¯•ï¼Œä¸è¿‡æˆ‘è§‰å¾—åˆ·é¢˜æœ‰åŠ©äºè‡ªå·±çš„ä»£ç èƒ½é‡ï¼ŒæŒºæœ‰æ„æ€çš„ å·¥å…·SurfingkeysSurfingkeys å’Œç°æœ‰çš„ä¸€äº›æ’ä»¶ä¸€æ ·ï¼Œè®©ä½ å°½å¯èƒ½çš„é€šè¿‡é”®ç›˜æ¥ä½¿ç”¨ Chrome/Firefox æµè§ˆå™¨ï¼Œæ¯”å¦‚è·³è½¬ç½‘é¡µï¼Œä¸Šä¸‹å·¦å³æ»šå±ã€‚ä½†ä¸åªæ˜¯ç»™vimç”¨æˆ·ä½¿ç”¨ï¼ŒSurfingkeysçš„åŸºæœ¬ç‰¹æ€§æ˜¯è®©ä½ è‡ªå·±å†™ä¸€æ®µ Javascript è„šæœ¬ï¼Œç„¶åé€šè¿‡ mapkey æ˜ å°„åˆ°æŸäº›æŒ‰é”®ã€‚ä¹‹åå½“ä½ æŒ‰äº†é‚£å‡ ä¸ªé”®ä»¥åï¼Œå¯¹åº”çš„Javascript è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œã€‚ ç©äº†ä¸€ä¸‹ï¼Œç‰¹åˆ«æ£’ï¼Œè§£æ”¾é¼ æ ‡ è§†é¢‘è®¡ç®—æœºç§‘å­¦é€Ÿæˆè¯¾è¿™æ˜¯ Youtube ä¸Šå¾ˆç«çš„é€Ÿæˆè¯¾ï¼Œå…¶ä¸­è¿™é—¨è®²çš„æ˜¯è®¡ç®—æœºç›¸å…³çš„çŸ¥è¯†ï¼Œä¸€å…±40é›†ï¼Œæ¯é›†å¾ˆçŸ­åªæœ‰10åˆ†é’Ÿï¼Œä½†æ˜¯çŸ¥è¯†é‡å·¨å¤šï¼ŒåŒ…å«è®¡ç®—ç§‘å­¦çš„å„ä¸ªæ–¹é¢ gitbub åœ°å€ ç¬¬ 1 é›†ï¼šè®¡ç®—æœºæ—©æœŸå†å² ç¬¬ 2 é›†ï¼šç”µå­è®¡ç®—æœº ç¬¬ 3 é›†ï¼šå¸ƒå°”é€»è¾‘å’Œé€»è¾‘é—¨ ç¬¬ 4 é›†ï¼šäºŒè¿›åˆ¶ ç¬¬ 5 é›†ï¼šç®—æ•°é€»è¾‘å•å…ƒ - ALU ç¬¬ 6 é›†ï¼šå¯„å­˜å™¨å’Œå†…å­˜ ç¬¬ 7 é›†ï¼šä¸­å¤®å¤„ç†å™¨ï¼ˆCPU) ç¬¬ 8 é›†ï¼šæŒ‡ä»¤å’Œç¨‹åº ç¬¬ 9 é›†ï¼šé«˜çº§ CPU è®¾è®¡ ç¬¬ 10 é›†ï¼šæ—©æœŸçš„ç¼–ç¨‹æ–¹å¼ ç¬¬ 11 é›†ï¼šç¼–ç¨‹è¯­è¨€å‘å±•å² ç¬¬ 12 é›†ï¼šç¼–ç¨‹åŸºç¡€ - è¯­å¥å’Œå‡½æ•° ç¬¬ 13 é›†ï¼šç®—æ³•å…¥é—¨ ç¬¬ 14 é›†ï¼šæ•°æ®ç»“æ„ ç¬¬ 15 é›†ï¼šé˜¿å…°Â·å›¾çµ ç¬¬ 16 é›†ï¼šè½¯ä»¶å·¥ç¨‹ ç¬¬ 17 é›†ï¼šé›†æˆç”µè·¯ä¸æ‘©å°”å®šå¾‹ ç¬¬ 18 é›†ï¼šæ“ä½œç³»ç»Ÿ ç¬¬ 19 é›†ï¼šå†…å­˜&amp;å‚¨å­˜ä»‹è´¨ ç¬¬ 20 é›†ï¼šæ–‡ä»¶ç³»ç»Ÿ ç¬¬ 21 é›†ï¼šå‹ç¼© ç¬¬ 22 é›†ï¼šå‘½ä»¤è¡Œç•Œé¢ ç¬¬ 23 é›†ï¼šå±å¹•ä¸ 2D å›¾å½¢æ˜¾ç¤º ç¬¬ 24 é›†ï¼šå†·æˆ˜å’Œæ¶ˆè´¹ä¸»ä¹‰ ç¬¬ 25 é›†ï¼šä¸ªäººè®¡ç®—æœºé©å‘½ ç¬¬ 26 é›†ï¼šå›¾å½¢ç”¨æˆ·ç•Œé¢ (GUI) ç¬¬ 27 é›†ï¼š3D å›¾å½¢ ç¬¬ 28 é›†ï¼šè®¡ç®—æœºç½‘ç»œ ç¬¬ 29 é›†ï¼šäº’è”ç½‘ ç¬¬ 30 é›†ï¼šä¸‡ç»´ç½‘ ç¬¬ 31 é›†ï¼šè®¡ç®—æœºå®‰å…¨ ç¬¬ 32 é›†ï¼šé»‘å®¢ä¸æ”»å‡» ç¬¬ 33 é›†ï¼šåŠ å¯† ç¬¬ 34 é›†ï¼šæœºå™¨å­¦ä¹ ä¸äººå·¥æ™ºèƒ½ ç¬¬ 35 é›†ï¼šè®¡ç®—æœºè§†è§‰ ç¬¬ 37 é›†ï¼šæœºå™¨äºº ç¬¬ 38 é›†ï¼šè®¡ç®—æœºå¿ƒç†å­¦ ç¬¬ 39 é›†ï¼šæ•™è‚²ç§‘æŠ€ ç¬¬ 40 é›†ï¼šå¥‡ç‚¹ï¼Œå¤©ç½‘ï¼Œè®¡ç®—æœºçš„æœªæ¥ ä¸­å›½é€šå²-å¤ä»£å²ã€Šä¸­å›½é€šå²ã€‹ä»¥å²è¯—èˆ¬çš„å®å¤§å™äº‹æ‰‹æ³•ï¼Œç”ŸåŠ¨å†ç°äº†ä¸­åæ–‡æ˜ä»åŸå§‹ç¤¾ä¼šåˆ°äºŒåä¸€ä¸–çºªåˆçš„å®Œæ•´å‘å±•å†ç¨‹ã€‚å†…å®¹æ¶‰åŠå†å²ã€æ”¿æ²»ã€ç»æµã€å†›äº‹ã€å“²å­¦ã€å®—æ•™ã€æ–‡å­¦ã€ è‰ºæœ¯ã€è¯­è¨€ã€è€ƒå¤ã€å¤©æ–‡ã€åœ°ç†ã€ç§‘æŠ€ã€äººç‰©ã€æ°‘ä¿—ä»¥åŠä¸­å¤–äº¤æµç­‰å„ä¸ªæ–¹é¢ï¼Œç›´è§‚åœ°å†ç°äº†ä¸­åæ°‘æ—äº”åƒå¹´æ–‡æ˜å†å²å…¨æ™¯ï¼Œå…¨é¢å±•ç¤ºäº†åå¤æ–‡æ˜çš„å¤ä»Šä¼ æ‰¿ã€‚ å†™ä»£ç å†™ç´¯äº†çœ‹çœ‹ï¼Œä½œä¸ºä¸€ä¸ªå·¥ç§‘ç”Ÿï¼Œå¯¹å†å²çŸ¥è¯†äº†è§£çš„ä¸å¤šï¼Œè¿™éƒ¨è®°å½•ç¯‡å€¼å¾—çœ‹çœ‹ï¼Œçœ‹çœ‹å¤ä»£ä¸­å›½äººæ°‘çš„èªæ˜æ‰æ™ºï¼Œçœ‹çœ‹ä¸€ä¸ªæœä»£çš„å…´ç››è¡°è´¥ã€‚ çœ‹ç‚¹æŠ€æœ¯åˆ†äº«å‘¨åˆŠè¿™æ˜¯é˜®è€å¸ˆæŠ€æœ¯åˆ†äº«å‘¨åˆŠï¼Œæ¯å‘¨äº”æ›´æ–°ï¼Œé‡Œé¢åˆ†äº«äº†å¾ˆå¤šæœ‰ç”¨çš„å·¥å…·å’Œæ•™ç¨‹ï¼Œéå¸¸å€¼å¾—å…³æ³¨ã€‚æˆ‘æ¯å‘¨éƒ½ä¼šç¬¬ä¸€æ—¶é—´æŸ¥çœ‹ï¼Œç°åœ¨å·²ç»æ›´æ–°åˆ°33æœŸäº†ï¼Œå¦‚æœæœ‰å¥½çš„é“¾æ¥å¯ä»¥ issue Computer Science Learning Notesè¿™æ˜¯ä¸€ä¸ª Java ç›¸å…³çš„çŸ¥è¯†åº“ï¼Œæ€»ç»“çš„å¾ˆå¥½ï¼Œæ’ç‰ˆä¹Ÿéå¸¸æ¼‚äº®ï¼Œä¸ç®¡æ˜¯åº”ä»˜é¢è¯•è¿˜æ˜¯æå‡è‡ªå·±éƒ½å¾ˆæœ‰å¸®åŠ©ï¼Œä¸€å…±åŒ…æ‹¬åä¸ªç‰ˆå—]]></content>
      <categories>
        <category>monthly</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å †æ’åº]]></title>
    <url>%2F2018%2F11%2F23%2F%E5%A0%86%E6%8E%92%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©çœ‹åˆ°ä¸€ç¯‡é¢ç»ï¼Œç®—æ³•é¢˜æ˜¯æ‰‹å†™å †æ’åºï¼Œã€Šç®—æ³•ã€‹æ”¾åœ¨ä¹¦æ¶å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæƒ³è¯•è¯•èƒ½ä¸èƒ½å†™å‡ºæ¥ï¼Œç„¶è€Œå¹¶æ²¡æœ‰ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ è‡ªé¡¶åˆ°åº•æ„é€ å †è¿™æ˜¯ä¸€é“ lintcodeä¸Šé¢çš„é¢˜ç›®å †åŒ– æ„é€ ä¸€ä¸ªå †åªéœ€è¦ä»å·¦åˆ°å³éå†æ•°ç»„ï¼Œæ¯æ¬¡åªè¦ä¿è¯æ‰€éå†åˆ°çš„ä½å­èƒ½æ»¡è¶³å †çš„æ¡ä»¶ 12345678910111213141516171819202122232425public class Solution &#123; /* * @param A: Given an integer array * @return: nothing */ public void heapify(int[] A) &#123; for (int i = 0; i &lt; A.length; i++) &#123; swim(A, i); &#125; &#125; // ä¸Šæµ® private void swim(int[] A, int i) &#123; while(i &gt; 0 &amp;&amp; A[i] &lt; A[(i-1) / 2]) &#123; swap(A, i, (i-1) / 2); i = (i-1) / 2; &#125; &#125; private void swap(int[] A, int i, int j) &#123; int temp = A[i]; A[i] = A[j]; A[j] = temp; &#125;&#125; è‡ªåº•åˆ°é¡¶æ„é€ å †è€Œå †æ’åºé‡‡ç”¨çš„æ˜¯è‡ªåº•åˆ°é¡¶æ„é€ å †ï¼Œæ¯æ¬¡æŠŠç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œäº¤æ¢ä¹‹åæŠŠç¬¬ä¸€ä¸ªå…ƒç´ ä¸‹æ²‰ï¼ŒåŒæ—¶å †æ•°ç»„å‡ä¸€ï¼Œä¸‹é¢æ˜¯ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041public class Heap &#123; private static void heapSort(int[] array) &#123; int len = array.length - 1; for (int i = (len - 1) / 2; i &gt;= 0; i--) &#123; sink(array, i, len); &#125; printArr(array); while (len &gt;= 0) &#123; swap(array, 0, len); sink(array, 0, --len); &#125; &#125; private static void sink(int[] array, int i, int len) &#123; while (i * 2 + 1 &lt;= len) &#123; int j = i * 2 + 1; if (j + 1 &lt;= len &amp;&amp; array[j+1] &gt; array[j]) j++; if (array[i] &gt; array[j]) break; swap(array, i, j); i = j; &#125; &#125; private static void swap(int[] array, int i, int j) &#123; int temp = array[i]; array[i] = array[j]; array[j] = temp; &#125; public static void main(String[] args) &#123; int[] array = &#123;2, 3, 1, 6, 4, 5, 2, 1&#125;; heapSort(array); printArr(array); &#125; private static void printArr(int[] array) &#123; Arrays.stream(array).forEach(a -&gt; System.out.print(a + " ")); System.out.println(); &#125;&#125;]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>å †æ’åº</tag>
        <tag>lintcode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Shellå…¥é—¨]]></title>
    <url>%2F2018%2F10%2F04%2FShell%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[Shellæ˜¯æ“ä½œç³»ç»Ÿï¼ˆå†…æ ¸ï¼‰ä¸ç”¨æˆ·ä¹‹é—´çš„æ¡¥æ¢ Shell æ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå®ƒæ˜¯ç”¨æˆ·ä½¿ç”¨ Linux çš„æ¡¥æ¢ã€‚Shell æ—¢æ˜¯ä¸€ç§å‘½ä»¤è¯­è¨€ï¼Œåˆæ˜¯ä¸€ç§ç¨‹åºè®¾è®¡è¯­è¨€ã€‚ Shell æ˜¯æŒ‡ä¸€ç§åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªç•Œé¢ï¼Œç”¨æˆ·é€šè¿‡è¿™ä¸ªç•Œé¢è®¿é—®æ“ä½œç³»ç»Ÿå†…æ ¸çš„æœåŠ¡ã€‚ Ken Thompson çš„ sh æ˜¯ç¬¬ä¸€ç§ Unix Shellï¼ŒWindows Explorer æ˜¯ä¸€ä¸ªå…¸å‹çš„å›¾å½¢ç•Œé¢ Shell Shellç¼–ç¨‹ä¹‹Hello Worldç¼–å†™ä¸€ä¸ªhello world shellä¸€èˆ¬ä½¿ç”¨.shä½œä¸ºåç¼€ 123456#!/bin/bash # ä½¿ç”¨/bin/shæ¥è§£é‡Šæ‰§è¡Œ # auto echo hello world! # è§£é‡Šè¿™ä¸ªè„šæœ¬æ˜¯å¹²ä»€ä¹ˆçš„# by authors cuzz # ä½œè€…å’Œæ—¶é—´ä¸€äº›ä¿¡æ¯echo "hello world!" ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ 1&gt; chmod +x hello.sh Shellç¼–ç¨‹ä¹‹å˜é‡Shellå˜é‡å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šå±€éƒ¨å˜é‡å’Œç¯å¢ƒå˜é‡ 12345678#!/bin/bash# define path variables# by authors cuzzname=cuzz # ç­‰å·ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼echo "my name is $name" # ä½¿ç”¨$å¼•ç”¨ åŸºæœ¬å˜é‡ 1234567echo $PWD # å½“å‰è·¯å¾„echo $0 # è„šæœ¬åecho $1 # ç¬¬ä¸€ä¸ªå‚æ•°echo $2 # ç¬¬äºŒä¸ªå‚æ•°echo $? # åˆ¤æ–­ä¸Šä¸€ä¸ªå‘½ä»¤æ˜¯å¦æ­£ç¡®echo $* # æ‰€æœ‰å‚æ•°echo $# # å‚æ•°çš„ä¸ªæ•° Shellç¼–ç¨‹ä¹‹ifæ¡ä»¶è¯­å¥æ¯”è¾ƒå¤§å° 12345678910111213#!/bin/bash# if test# by authors cuzznum=100# è®¡ç®—ä½¿ç”¨ä¸¤ä¸ªå°æ‹¬å·if (($num &gt; 10)); then echo "this num greater than 10."else echo "this num littler than 10."fi é€»è¾‘è¿ç®—ç¬¦ è¿ç®—ç¬¦ è¯´æ˜ ä¸¾ä¾‹ -eq æ£€æµ‹ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å› trueã€‚ [ \$a -eq $b ] è¿”å› falseã€‚ -ne æ£€æµ‹ä¸¤ä¸ªæ•°æ˜¯å¦ä¸ç›¸ç­‰ï¼Œä¸ç›¸ç­‰è¿”å› trueã€‚ [ \$a -ne $b ] è¿”å› trueã€‚ -gt æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å¤§äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› trueã€‚ [ \$a -gt $b ] è¿”å› falseã€‚ -lt æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å°äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› trueã€‚ [ \$a -lt $b ] è¿”å› trueã€‚ -ge æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å¤§äºç­‰äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› trueã€‚ [ \$a -ge $b ] è¿”å› falseã€‚ -le æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å°äºç­‰äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› trueã€‚ [ \$a -le $b ] è¿”å› trueã€‚ ç›®å½• æ“ä½œç¬¦ è¯´æ˜ ä¸¾ä¾‹ -d file æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯ç›®å½•ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› trueã€‚ [ -d $file ] è¿”å› falseã€‚ -f file æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯æ™®é€šæ–‡ä»¶ï¼ˆæ—¢ä¸æ˜¯ç›®å½•ï¼Œä¹Ÿä¸æ˜¯è®¾å¤‡æ–‡ä»¶ï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› trueã€‚ [ -f $file ] è¿”å› trueã€‚ -p file æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯æœ‰åç®¡é“ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› trueã€‚ [ -p $file ] è¿”å› falseã€‚ -e file æ£€æµ‹æ–‡ä»¶ï¼ˆåŒ…æ‹¬ç›®å½•ï¼‰æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› trueã€‚ [ -e $file ] è¿”å› trueã€‚ åˆ›å»ºæ–‡ä»¶ 12345678910111213#!/bin/bash# if test# by authors cuzzDIR=cuzzif [ ! -d $DIR ]; then # éƒ½æœ‰ç©ºæ ¼ mkdir $DIR echo "this $DIR create success."else echo "this dir is exit."fi æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨ 123456789101112#!/bin/bash# if test# by authors cuzzfile=test.txtif [ ! -e $file ]; then echo "OK" &gt;&gt; $file # &gt;&gt;æ˜¯è¿½åŠ å†…å®¹ &gt;æ˜¯è¦†ç›–å†…å®¹else cat $filefi mysqlå¤‡ä»½ 12345678910111213141516171819202122232425262728293031323334353637#!/bin/bash# auto backup mysql db# by authors cuzz# define backup pathBAK_DIR=/data/backup/`date +%Y%m%d` # åå¼•å·å¯ä»¥æŠŠé‡Œé¢å½“ä½œå‘½ä»¤æ¥è§£æ # mysqlMYSQLDB=testMYSQLUSER=rootMYSQLPW=123456MYSQLCMD=/usr/bin/mysqldump # å¤‡ä»½å‘½ä»¤# åˆ¤æ–­æ˜¯å¦æ˜¯rootif [ $UID -ne 0 ]; then echo "Only root can execute Shell." exitfiif [ ! -d $BAK_DIR ]; then mkdir -p $BAK_DIR # -p çˆ¶ç›®å½•ä¸å­˜åœ¨å°±åˆ›å»º echo "The $BAK_DIR create success."else echo "This $BAK_DIR is exist."fi# mysql backup command$MYSQLCMD -u$MYSQLUSER -p$MYSQLPW -d $MYSQLDB &gt;$BAK_DIR/$MYSQLDB.sqlif [ $? -eq 0 ]; then echo "backup success."else echo "backup fail."fi Shellç¼–ç¨‹ä¹‹forå¾ªç¯åŸºæœ¬è¯­å¥ 123456#!/bin/bashfor i in `seq 1 15`do echo "the number is $i."done æ±‚å’Œ 12345678910#!/bin/bashsum=0for ((i=1; i&lt;=100; i++)) # åŒæ‹¬å·ç”¨äºè¿ç®—ç›¸å½“ä¸å…¶ä»–è¯­è¨€çš„å•æ‹¬å·do sum=`expr $sum + $i` # exprç”¨äºè®¡ç®—doneecho "$sum" æ‰“åŒ…ï¼Œåªèƒ½æ‰“åŒ…åˆ°æœ€åä¸€ä¸ªï¼Œåé¢çš„ä¼šæŠŠå‰é¢çš„è¦†ç›–äº† 1234567#!/bin/bashfor file in `find ./ -name "*.sh"`do tar -czf all.tgz $filedone Shellç¼–ç¨‹ä¹‹whileå¾ªç¯ä½¿ç”¨ 12345678#!/bin/bashi=0while [[ $i -lt 10 ]] # (( $i &lt; 10))æ˜¯ä¸€æ ·çš„do echo "$i" ((i++))done ç»“åˆreadä½¿ç”¨ 123456#!/bin/bashwhile read line # æŠŠè¯»å–çš„ä¸œè¥¿èµ‹å€¼ç»™linedo echo $linedone &lt;/etc/hosts # ä»å“ªé‡Œè¯»å– Shellç¼–ç¨‹ä¹‹æ•°ç»„Shell æ•°ç»„ç”¨æ‹¬å·æ¥è¡¨ç¤ºï¼Œå…ƒç´ ç”¨â€ç©ºæ ¼â€ç¬¦å·åˆ†å‰²å¼€ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 12345678910111213my_array=(A B "C" D) # å®šä¹‰æ•°ç»„array_name[0]=value0 # ä½¿ç”¨ä¸‹æ ‡æ¥å®šä¹‰array_name[1]=value1array_name[2]=value2$&#123;array_name[0]&#125; # è¯»å–ç¬¬ä¸€ä¸ªå…ƒç´ $&#123;my_array[*]&#125; # è¯»å–æ‰€æœ‰å…ƒç´  $&#123;my_array[@]&#125; # è¯»å–æ‰€æœ‰å…ƒç´ $&#123;#my_array[*]&#125; # è¯»å–æ•°ç»„é•¿åº¦$&#123;#my_array[@]&#125; # è¯»å–æ•°ç»„é•¿åº¦ Shellç¼–ç¨‹ä¹‹å‡½æ•°æ— è¿”å›å€¼å¾—å‡½æ•° 12345678sayHello()&#123; # å®šä¹‰å‡½æ•°ä¸€ echo "hello"&#125;function sayHelloWorld()&#123; # å®šä¹‰å‡½æ•°äºŒ echo "hello world"&#125;sayhell # ä½¿ç”¨å‡½æ•° æœ‰è¿”å›å€¼å¾—ï¼Œä½¿ç”¨returnåªèƒ½è¿”å›0-255 123456789function sum()&#123; returnValue=$(( $1 + $2 )) return $returnValue&#125;sum 22 4echo $? å¯ä»¥ä½¿ç”¨echoæ¥ä¼ é€’å‚æ•° 12345678910111213function length()&#123; str=$1 result=0 if [ "$str" != "" ] ; then result=$&#123;#str&#125; fi echo "$result"&#125;len=$(length "abc123") # è°ƒç”¨echo "The string's length is $len " Shellç¼–ç¨‹ä¹‹sedå‘½ä»¤æŠŠtest.txtä¸­çš„oldä¿®æ”¹ä¸ºnewï¼Œè¦ä½¿ç”¨-iæ‰èƒ½æ’å…¥ 1&gt; sed -i &apos;s/old/new/s&apos; test.txt åœ¨æ¯è¡Œè¡Œå‰é¢æ·»åŠ ä¸€ä¸ªcuzz 1&gt; sed -i sed &apos;s/^/&amp;cuzz/g&apos; test.txt åœ¨æ¯è¡Œçš„æœ«å°¾æ·»åŠ ä¸€ä¸ªcuzz 1&gt; sed -i &apos;s/$/&amp; cuzz/g&apos; test.txt åŒ¹é…æŸä¸€è¡Œï¼Œåœ¨ä¸‹æ–¹æ’å…¥ä¸€è¡Œï¼Œæ‰¾åˆ°cuzzè¿™è¡Œåœ¨ä¸‹æ–¹æ’å…¥#### 1&gt; sed &apos;/cuzz/a #######&apos; test.txt åœ¨ä¹‹å‰æ·»åŠ ä¸€è¡Œï¼Œåªè¦æŠŠaæ”¹æˆi 1&gt; sed &apos;/cuzz/i #######&apos; test.txt æ‰“å° 123&gt; sed -n &apos;/cuzz/p&apos; test.txt # æ‰“å°å«æœ‰cuzzè¿™ä¸€è¡Œ&gt; sed -n &apos;1p&apos; test.txt # æ‰“å°ç¬¬ä¸€è¡Œ&gt; sed -n &apos;1,5p&apos; text.txt # æ‰“å°1åˆ°5è¡Œ æŸ¥æ‰¾æœ€å¤§å’Œæœ€å°å€¼ number.txt 123412 324 56 0034 -23 345345 349- 245 345 345 0989 0459 -25 å‘½ä»¤ 123456cat number.txt | sed 's/ /\n/g' | grep -v "^$" | sort -nr | sed -n '1p;$p'sed 's/ /\n/g' # æŠŠæ‰€æœ‰ç©ºæ ¼æ¢æˆæ¢è¡Œgrep -v "^$" # å»æ‰æ‰€æœ‰ç©ºæ ¼sort -nr # é™åºæ’åˆ—sed -n '1p;$p # æ‰¾å‡ºç¬¬1è¡Œå’Œæœ€åä¸€è¡Œ Shellç¼–ç¨‹ä¹‹grepå‘½ä»¤ -a ï¼šå°† binary æ–‡ä»¶ä»¥ text æ–‡ä»¶çš„æ–¹å¼æœå¯»æ•°æ® -c ï¼šè®¡ç®—æ‰¾åˆ° â€˜æœå¯»å­—ç¬¦ä¸²â€™ çš„æ¬¡æ•° -i ï¼šå¿½ç•¥å¤§å°å†™çš„ä¸åŒï¼Œæ‰€ä»¥å¤§å°å†™è§†ä¸ºç›¸åŒ -n ï¼šé¡ºä¾¿è¾“å‡ºè¡Œå· -v ï¼šåå‘é€‰æ‹©ï¼Œäº¦å³æ˜¾ç¤ºå‡ºæ²¡æœ‰ â€˜æœå¯»å­—ç¬¦ä¸²â€™ å†…å®¹çš„é‚£ä¸€è¡Œ â€“color=auto ï¼šå¯ä»¥å°†æ‰¾åˆ°çš„å…³é”®è¯éƒ¨åˆ†åŠ ä¸Šé¢œè‰²çš„æ˜¾ç¤º egrep å’Œgrep -E ç›¸åŒï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ Shellç¼–ç¨‹ä¹‹awkå‘½ä»¤123456789# æ¯è¡ŒæŒ‰ç©ºæ ¼æˆ–TABåˆ†å‰²cat test.txt | awk '&#123;print $1&#125;' # è¡ŒåŒ¹é…è¯­å¥ awk '' åªèƒ½ç”¨å•å¼•å·# æŒ‡å®šåˆ†å‰²awk -F #-Fç›¸å½“äºå†…ç½®å˜é‡FS, æŒ‡å®šåˆ†å‰²å­—ç¬¦cat test.txt | awk -F: '&#123;print $1&#125;' # ä»¥åˆ†å·åˆ†å‰²# æŒ‡å®šæ·»åŠ æŸäº›å†…å®¹cat test.txt | awk -F: '&#123;print "haha" $1&#125;' # æå‰å‡ºæ¥å†æ·»åŠ haha Shellç¼–ç¨‹ä¹‹findå‘½ä»¤åŸºæœ¬å‘½ä»¤ 123456find /dir -name "test.txt" # åœ¨/dirç›®å½•ä¸‹æŸ¥æ‰¾find . -name "test.txt" # åœ¨å½“å‰ç›®å½•ä¸‹æ‰¾ find . -maxdepth 1 -name "text.txt" # åªéå†ä¸€å±‚find . -type f -name "text" # æŒ‡å®šç±»å‹find . -name "text" -mtime -1 # æŒ‡å®šæ—¶é—´find . -size +20M # æŒ‡å®šå¤§å° æŸ¥æ‰¾å¹¶æ‰§è¡Œå…¶ä»–å‘½ä»¤ 1find . -name "text.txt" -exec rm -rf &#123;&#125; \; # åé¢&#123;&#125; \æ˜¯å›ºå®šæ ¼å¼]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæ³¨è§£é©±åŠ¨å¼€å‘ï¼ˆä¸‰ï¼‰]]></title>
    <url>%2F2018%2F09%2F25%2FSpring%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[æ³¨è§£å¯ä»¥ç®€åŒ–é…ç½®ï¼Œæé«˜æ•ˆç‡ The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. å±æ€§èµ‹å€¼@valueèµ‹å€¼ä½¿ç”¨@Valueèµ‹å€¼ åŸºæœ¬æ•°å€¼ å¯ä»¥å†™SPELè¡¨è¾¾å¼ #{} å¯ä»¥${}è·å–é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼ˆåœ¨è¿è¡Œçš„ç¯å¢ƒå˜é‡ä¸­çš„å€¼ï¼‰ ä½¿ç”¨xmlæ—¶å€™å¯¼å…¥é…ç½®æ–‡ä»¶æ˜¯ 1&lt;context:property-placeholder location="classpath:person.properties"/&gt; ä½¿ç”¨æ³¨è§£å¯ä»¥åœ¨é…ç½®ç±»æ·»åŠ ä¸€ä¸ª@PropertySourceæ³¨è§£æŠŠé…ç½®æ–‡ä»¶ä¸­k/vä¿å­˜åˆ°è¿è¡Œçš„ç¯å¢ƒä¸­ ä½¿ç”¨${key}æ¥è·å– 1234567891011121314/** * @Author: cuzz * @Date: 2018/9/24 18:43 * @Description: */@PropertySource(value = &#123;"classpath:/person.properties"&#125;)@Configurationpublic class MainConfigOfPropertyValue &#123; @Bean public Person person() &#123; return new Person(); &#125;&#125; Person ç±» 123456789101112@Datapublic class Person &#123; @Value("vhuj") private String name; @Value("#&#123;20-2&#125;") private Integer age; @Value("$&#123;person.nickName&#125;") private String nickName;&#125; æµ‹è¯• 1234567891011@Testpublic void test01() &#123; printBean(applicationContext); System.out.println("---------------------------"); Person person = (Person) applicationContext.getBean("person"); System.out.println(person); System.out.println("---------------------------");&#125; è¾“å‡º 123---------------------------Person(name=vhuj, age=18, nickName=ä¸‰ä¸‰)--------------------------- è‡ªåŠ¨è£…é…@Autowired@Qualifier@Primaryè‡ªåŠ¨è½¬é…ï¼š Springåˆ©ç”¨ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ï¼Œå®Œæˆå¯¹IOCå®¹å™¨ä¸­å„ä¸ªç»„ä»¶çš„ä¾èµ–å…³ç³»èµ‹å€¼ @Autowiredè‡ªåŠ¨æ³¨å…¥: a. é»˜è®¤ä¼˜å…ˆæŒ‰ç…§ç±»å‹å»å®¹å™¨ä¸­å¯»æ‰¾å¯¹åº”çš„ç»„ä»¶ï¼Œå¦‚æœæ‰¾åˆ°å»èµ‹å€¼ b. å¦‚æœæ‰¾åˆ°åˆ°ç›¸åŒç±»å‹çš„ç»„ä»¶ï¼Œå†å°†å±æ€§åï¼ˆBookDao bookdaoï¼‰ä½œä¸ºç»„ä»¶çš„idå»å®¹å™¨ä¸­æŸ¥æ‰¾ c. æ¥ä¸‹æ¥è¿˜å¯ä»¥ä½¿ç”¨@Qualifier(&quot;bookdao&quot;)æ˜ç¡®æŒ‡å®šéœ€è¦è£…é…çš„id d. é»˜è®¤æ˜¯å¿…é¡»çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š @Autowired(required=false)ï¼ŒæŒ‡å®šéå¿…é¡» @Primaryè®©Springè‡ªåŠ¨è£…é…æ—¶é¦–å…ˆè£…é… è‡ªåŠ¨è£…é…@Resourceå’Œ@InjectSpringè¿˜æ”¯æŒä½¿ç”¨@Resource (JSR250) å’Œ@Inject (JSR330) æ³¨è§£ï¼Œè¿™ä¸¤ä¸ªæ˜¯javaè§„èŒƒ @Resourceå’Œ@Autowiredä¸€æ ·å®ç°è‡ªåŠ¨è£…é…åŠŸèƒ½ï¼Œé»˜è®¤æ˜¯æŒ‰ç»„ä»¶åç§°è¿›è¡Œè£…é…çš„ æ²¡æœ‰æ”¯æŒ@Primaryå’Œ@Autowird(required=false)çš„åŠŸèƒ½ è‡ªåŠ¨è£…é…å…¶ä»–åœ°æ–¹çš„è‡ªåŠ¨è£…é…@Autowiredï¼šæ„é€ å™¨ã€å‚æ•°ã€æ–¹æ³•å±æ€§ç­‰ æ ‡æ³¨åˆ°æ–¹æ³•ä½å­ä¸Š@Bean+æ–¹æ³•å‚æ•°ï¼Œå‚æ•°ä»å®¹å™¨ä¸­è·å– 12345678910111213141516171819202122232425/** * @Author: cuzz * @Date: 2018/9/24 20:57 * @Description: */public class Boss &#123; // å±æ€§ @Autowired private Car car; // æ„é€ å™¨ å¦‚æœæ„é€ å™¨åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨å¯ä»¥çœç•¥ @Autowired public Boss(@Autowired Car car) &#123; &#125; public Car getCar() &#123; return car; &#125; // setæ–¹æ³• @Autowired // å‚æ•° public void setCar(@Autowired Car car) &#123; this.car = car; &#125;&#125; è‡ªåŠ¨è£…é…Awareæ³¨å…¥Springåº•å±‚æ³¨è§£è‡ªå®šä¹‰ç»„ä»¶æƒ³è¦ä½¿ç”¨Springå®¹å™¨åº•å±‚çš„ä¸€äº›ç»„ä»¶ï¼ˆApplicationContextï¼ŒBeanFactory ç­‰ç­‰ï¼‰ï¼Œè‡ªå®šä¹‰ç»„ä»¶å®ç°xxxAwareï¼Œåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä¼šè°ƒç”¨æ¥å£è§„å®šçš„æ–¹æ³•æ³¨å…¥ç›¸å…³çš„ç»„ä»¶ 1234567891011/** * Marker superinterface indicating that a bean is eligible to be * notified by the Spring container of a particular framework object * through a callback-style method. Actual method signature is * determined by individual subinterfaces, but should typically * consist of just one void-returning method that accepts a single * argument. */public interface Aware &#123;&#125; æˆ‘ä»¬å®ç°å‡ ä¸ªå¸¸è§çš„Awareæ¥å£ 12345678910111213141516171819202122232425/** * @Author: cuzz * @Date: 2018/9/25 10:18 * @Description: */@Componentpublic class Red implements BeanNameAware ,BeanFactoryAware, ApplicationContextAware &#123; private ApplicationContext applicationContext; @Override public void setBeanName(String name) &#123; System.out.println("å½“å‰Beançš„åå­—: " + name); &#125; @Override public void setBeanFactory(BeanFactory beanFactory) throws BeansException &#123; System.out.println("å½“å‰çš„BeanFactory: " + beanFactory); &#125; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext = applicationContext; System.out.println("ä¼ å…¥çš„ioc: " + applicationContext); &#125;&#125; æ³¨å…¥åˆ°é…ç½®ä¸­æµ‹è¯• 12345678910111213/** * @Author: cuzz * @Date: 2018/9/25 10:28 * @Description: */public class IOCTestAware &#123; @Test public void test01() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(MainConfigOfAware.class); &#125;&#125; æµ‹è¯•ç»“æœ 123å½“å‰Beançš„åå­—: redå½“å‰çš„BeanFactory: org.springframework.beans.factory.support.DefaultListableBeanFactory@159c4b8: defining beans [org.springframework.context.annotation.internalConfigurationAnnotationProcessor,org.springframework.context.annotation.internalAutowiredAnnotationProcessor,org.springframework.context.annotation.internalRequiredAnnotationProcessor,org.springframework.context.annotation.internalCommonAnnotationProcessor,org.springframework.context.event.internalEventListenerProcessor,org.springframework.context.event.internalEventListenerFactory,mainConfigOfAware,red]; root of factory hierarchyä¼ å…¥çš„ioc: org.springframework.context.annotation.AnnotationConfigApplicationContext@1e89d68: startup date [Tue Sep 25 10:29:17 CST 2018]; root of context hierarchy æŠŠSpringè‡ªå®šä¹‰ç»„ä»¶æ³¨å…¥åˆ°å®¹å™¨ä¸­ åŸç†ï¼š 1public interface ApplicationContextAware extends Aware &#123;&#125; é€šè¿‡ Debug æ–¹å¼ï¼Œå®šä½åˆ° org.springframework.context.support.ApplicationContextAwareProcessor#postProcessBeforeInitialization 1234567891011121314151617181920212223@Overridepublic Object postProcessBeforeInitialization(final Object bean, String beanName) throws BeansException &#123; AccessControlContext acc = null; if (System.getSecurityManager() != null &amp;&amp; (bean instanceof EnvironmentAware || bean instanceof EmbeddedValueResolverAware || bean instanceof ResourceLoaderAware || bean instanceof ApplicationEventPublisherAware || bean instanceof MessageSourceAware || bean instanceof ApplicationContextAware)) &#123; acc = this.applicationContext.getBeanFactory().getAccessControlContext(); &#125; if (acc != null) &#123; AccessController.doPrivileged(new PrivilegedAction&lt;Object&gt;() &#123; @Override public Object run() &#123; invokeAwareInterfaces(bean); return null; &#125; &#125;, acc); &#125; else &#123; invokeAwareInterfaces(bean); // è°ƒç”¨ &#125; è°ƒç”¨ä¸‹é¢æ–¹æ³•è¿›è¡Œåˆ¤æ–­ï¼Œæ¯ç§ xxxAware æ¥å£ä¸­åªæœ‰ä¸€ç§æ–¹æ³•ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„æ–¹æ³• 12345678910111213141516171819202122private void invokeAwareInterfaces(Object bean) &#123; if (bean instanceof Aware) &#123; if (bean instanceof EnvironmentAware) &#123; ((EnvironmentAware) bean).setEnvironment(this.applicationContext.getEnvironment()); &#125; if (bean instanceof EmbeddedValueResolverAware) &#123; ((EmbeddedValueResolverAware) bean).setEmbeddedValueResolver(this.embeddedValueResolver); &#125; if (bean instanceof ResourceLoaderAware) &#123; ((ResourceLoaderAware) bean).setResourceLoader(this.applicationContext); &#125; if (bean instanceof ApplicationEventPublisherAware) &#123; ((ApplicationEventPublisherAware) bean).setApplicationEventPublisher(this.applicationContext); &#125; if (bean instanceof MessageSourceAware) &#123; ((MessageSourceAware) bean).setMessageSource(this.applicationContext); &#125; if (bean instanceof ApplicationContextAware) &#123; ((ApplicationContextAware) bean).setApplicationContext(this.applicationContext); &#125; &#125;&#125; xxxAwareéƒ½æ˜¯é€šè¿‡xxxProcessoræ¥å¤„ç†çš„ æ¯”å¦‚ï¼šApplicationContextAware å¯¹åº” ApplicationContextAwareProcessor è‡ªåŠ¨è£…é…@Profileç¯å¢ƒæ­å»ºProfileæ˜¯Springä¸ºæˆ‘ä»¬æä¾›å¯ä»¥æ ¹æ®å½“å‰ç¯å¢ƒï¼ŒåŠ¨æ€çš„æ¿€æ´»å’Œåˆ‡æ¢ä¸€ç³»ç»„ä»¶çš„åŠŸèƒ½ a. ä½¿ç”¨å‘½ä»¤åŠ¨æ€å‚æ•°æ¿€æ´»ï¼šè™šæ‹Ÿæœºå‚æ•°ä½å­åŠ è½½ -Dspring.profiles.active=test b. ä½¿ç”¨ä»£ç æ¿€æ´»ç¯å¢ƒ æˆ‘ä»¬æƒ³é…ç½®ç±» 1234567891011121314151617181920212223/** * @Author: cuzz * @Date: 2018/9/25 10:47 * @Description: */@Configurationpublic class MainConfigOfProfile &#123; @Profile(value = "test") @Bean(value = "testDataSource") public DataSource testDataSource() &#123; System.out.println("testDataSource"); return null; &#125; @Profile(value = "dev") @Bean(value = "devDataSource") public DataSource devDataSource() &#123; System.out.println("devDataSource"); return null; &#125;&#125; æµ‹è¯• 12345678910111213141516171819/** * @Author: cuzz * @Date: 2018/9/25 10:59 * @Description: */public class IOCTestProfile &#123; @Test public void test01() &#123; // 1. ä½¿ç”¨æ— å‚æ„é€ å™¨åˆ›å»ºä¸€ä¸ªapplicationContext AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(); // 2. è®¾ç½®è¦æ¿€æ´»çš„ç¯å¢ƒ applicationContext.getEnvironment().setActiveProfiles("test"); // 3. æ³¨å†Œä¸»é…ç½®ç±» applicationContext.register(MainConfigOfProfile.class); // 4. å¯åŠ¨åˆ·æ–°å®¹å™¨ applicationContext.refresh(); &#125;&#125; è¾“å‡º 1testDataSource]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>æ³¨è§£</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæ³¨è§£é©±åŠ¨å¼€å‘ï¼ˆäºŒï¼‰]]></title>
    <url>%2F2018%2F09%2F24%2FSpring%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[æ³¨è§£å¯ä»¥ç®€åŒ–é…ç½®ï¼Œæé«˜æ•ˆç‡ The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. å£°æ˜å‘¨æœŸ@BeanæŒ‡å®šåˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•Beançš„ç”Ÿå‘½å‘¨æœŸBeançš„åˆ›å»ºã€åˆå§‹åŒ–å’Œé”€æ¯æ˜¯ç”±å®¹å™¨å¸®æˆ‘ä»¬ç®¡ç†çš„ æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•ï¼Œå®¹å™¨åœ¨è¿›è¡Œåˆ°å½“å‰ç”Ÿå‘½å‘¨æœŸçš„æ—¶å€™æ¥è°ƒç”¨æˆ‘ä¹°è‡ªå®šä¹‰çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³• æ„é€ ï¼ˆå¯¹è±¡åˆ›å»ºï¼‰ â€‹ å•å®ä¾‹ï¼š åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™åˆ›å»º â€‹ å¤šå®ä¾‹ï¼š åœ¨æ¯æ¬¡è·å–çš„æ—¶å€™åˆ›å»ºå¯¹è±¡ æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•åˆå§‹åŒ–ï¼šå¯¹è±¡åˆ›å»ºå®Œæˆåï¼Œå¹¶èµ‹å€¼åŒ–ï¼Œè°ƒç”¨åˆå§‹åŒ–æ–¹æ³• é”€æ¯ï¼šå•å®ä¾‹æ˜¯åœ¨å®¹å™¨å…³é—­çš„æ—¶å€™é”€æ¯ï¼Œå¤šå®ä¾‹å®¹å™¨ä¸ä¼šç®¡ç†è¿™ä¸ªBeanï¼Œå®¹å™¨ä¸ä¼šè°ƒç”¨é”€æ¯æ–¹æ³• ç¼–å†™ä¸€ä¸ªCarç±» 12345678910111213141516171819/** * @Author: cuzz * @Date: 2018/9/23 21:20 * @Description: */public class Car &#123; public Car () &#123; System.out.println("car constructor..."); &#125; public void init() &#123; System.out.println("car...init..."); &#125; public void destroy() &#123; System.out.println("car...destroy..."); &#125;&#125; åœ¨xmlä¸­æˆ‘ä»¬å¯ä»¥æŒ‡å®šinit-methodå’Œdestroy-methodæ–¹æ³•ï¼Œå¦‚ 1&lt;bean id="car" class="com.cuzz.bean.Car" init-method="init" destroy-method="destroy"&gt;&lt;/bean&gt; ä½¿ç”¨æ³¨è§£æˆ‘ä»¬å¯ä»¥ 12345678910111213/** * @Author: cuzz * @Date: 2018/9/24 12:49 * @Description: é…ç½®ç±» */@Configurationpublic class MainConfigOfLifecycle &#123; @Bean(initMethod = "init", destroyMethod = "destroy") public Car car() &#123; return new Car(); &#125;&#125; æµ‹è¯• 12345678910111213141516171819/** * @Author: cuzz * @Date: 2018/9/24 13:00 * @Description: */public class IOCTestLifeCycle &#123; @Test public void test01() &#123; // åˆ›å»ºiocå®¹å™¨ AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(MainConfigOfLifecycle.class); System.out.println("å®¹å™¨åˆ›å»ºå®Œæˆ..."); // å…³é—­å®¹å™¨ System.out.println("---&gt;å¼€å§‹å…³é—­å®¹å™¨"); applicationContext.close(); System.out.println("---&gt;å·²ç»å…³é—­å®¹å™¨"); &#125;&#125; å¯ä»¥çœ‹å‡ºå…ˆåˆ›å»ºcarï¼Œå†è°ƒç”¨initæ–¹æ³•ï¼Œåœ¨å®¹å™¨å…³é—­æ—¶é”€æ¯å®ä¾‹ 123456car constructor...car...init...å®¹å™¨åˆ›å»ºå®Œæˆ...---&gt;å¼€å§‹å…³é—­å®¹å™¨car...destroy...---&gt;å·²ç»å…³é—­å®¹å™¨ åœ¨é…ç½®æ•°æ®æºçš„æ—¶å€™ï¼Œæœ‰å¾ˆå¤šå±æ€§èµ‹å€¼ï¼Œé”€æ¯çš„æ—¶å€™è¦æŠŠè¿æ¥ç»™æ–­å¼€ ç”Ÿå‘½å‘¨æœŸInitializingBeanå’ŒDisposableBeanInitializingBeanå¯ä»¥é€šè¿‡Beanå®ç°InitializingBeanæ¥å®šä¹‰åˆå§‹åŒ–é€»è¾‘ï¼Œæ˜¯è®¾ç½®å¥½æ‰€æœ‰å±æ€§ä¼šè°ƒç”¨afterPropertiesSet()æ–¹æ³• 1234567891011121314public interface InitializingBean &#123; /** * Invoked by a BeanFactory after it has set all bean properties supplied * (and satisfied BeanFactoryAware and ApplicationContextAware). * &lt;p&gt;This method allows the bean instance to perform initialization only * possible when all bean properties have been set and to throw an * exception in the event of misconfiguration. * @throws Exception in the event of misconfiguration (such * as failure to set an essential property) or if initialization fails. */ void afterPropertiesSet() throws Exception;&#125; DisposableBeanå¯ä»¥é€šè¿‡Beanå®ç°DisposableBeanæ¥å®šä¹‰é”€æ¯é€»è¾‘ï¼Œä¼šè°ƒç”¨destroy()æ–¹æ³• 1234567891011public interface DisposableBean &#123; /** * Invoked by a BeanFactory on destruction of a singleton. * @throws Exception in case of shutdown errors. * Exceptions will get logged but not rethrown to allow * other beans to release their resources too. */ void destroy() throws Exception;&#125; ä¾‹å­ç¼–å†™ä¸€ä¸ªCatç±» 1234567891011121314151617181920212223/** * @Author: cuzz * @Date: 2018/9/24 13:36 * @Description: */public class Cat implements InitializingBean, DisposableBean&#123; public Cat() &#123; System.out.println("cat constructor..."); &#125; @Override public void afterPropertiesSet() throws Exception &#123; System.out.println("cat...init..."); &#125; @Override public void destroy() throws Exception &#123; System.out.println("cat...destroy..."); &#125;&#125; æµ‹è¯• 123456cat constructor...cat...init...å®¹å™¨åˆ›å»ºå®Œæˆ...---&gt;å¼€å§‹å…³é—­å®¹å™¨cat...destroy...---&gt;å·²ç»å…³é—­å®¹å™¨ ç”Ÿå‘½å‘¨æœŸ@PostContructå’Œ@PreDestroyæ³¨è§£@PostContructåœ¨Beanåˆ›å»ºå®Œæˆå¹¶ä¸”å±æ€§èµ‹å€¼å®Œæˆï¼Œæ¥æ‰§è¡Œåˆå§‹åŒ– @PreDestroyåœ¨å®¹å™¨é”€æ¯Beanä¹‹å‰é€šçŸ¥æˆ‘ä»¬è¿›è¡Œæ¸…ç†å·¥ä½œ ç¼–å†™ä¸€ä¸ªDogç±»ï¼Œå¹¶æŠŠä»–æ³¨å…¥åˆ°é…ç½®ç±»ä¸­ 123456789101112131415161718192021/** * @Author: cuzz * @Date: 2018/9/24 14:03 * @Description: */public class Dog &#123; public Dog() &#123; System.out.println("dog constructor..."); &#125; @PostConstruct public void postConstruct() &#123; System.out.println("post construct..."); &#125; @PreDestroy public void preDestroy() &#123; System.out.println("pre destroy..."); &#125;&#125; æµ‹è¯•ç»“æœ 123456dog constructor...post construct...å®¹å™¨åˆ›å»ºå®Œæˆ...---&gt;å¼€å§‹å…³é—­å®¹å™¨pre destroy...---&gt;å·²ç»å…³é—­å®¹å™¨ ç”Ÿå‘½å‘¨æœŸBeanPostProscessoråç½®å¤„ç†å™¨æˆ‘ä»¬å…ˆçœ‹çœ‹æºç ï¼Œè§£é‡Šçš„å¾ˆæ¸…æ¥šï¼ŒBeanPostProscessor ä¸­postProcessBeforeInitializationæ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªbeanå¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ä¹‹å‰å›è°ƒï¼›postProcessAfterInitializationæ–¹æ³•ä¼šåœ¨æ¯ä¸ªbeanå¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ä¹‹åè¢«å›è°ƒ ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * Factory hook that allows for custom modification of new bean instances, * e.g. checking for marker interfaces or wrapping them with proxies. * * &lt;p&gt;ApplicationContexts can autodetect BeanPostProcessor beans in their * bean definitions and apply them to any beans subsequently created. * Plain bean factories allow for programmatic registration of post-processors, * applying to all beans created through this factory. * * &lt;p&gt;Typically, post-processors that populate beans via marker interfaces * or the like will implement &#123;@link #postProcessBeforeInitialization&#125;, * while post-processors that wrap beans with proxies will normally * implement &#123;@link #postProcessAfterInitialization&#125;. */public interface BeanPostProcessor &#123; /** * Apply this BeanPostProcessor to the given new bean instance &lt;i&gt;before&lt;/i&gt; any bean * initialization callbacks (like InitializingBean's &#123;@code afterPropertiesSet&#125; * or a custom init-method). The bean will already be populated with property values. * The returned bean instance may be a wrapper around the original. * @param bean the new bean instance * @param beanName the name of the bean * @return the bean instance to use, either the original or a wrapped one; * if &#123;@code null&#125;, no subsequent BeanPostProcessors will be invoked * @throws org.springframework.beans.BeansException in case of errors * @see org.springframework.beans.factory.InitializingBean#afterPropertiesSet */ Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException; /** * Apply this BeanPostProcessor to the given new bean instance &lt;i&gt;after&lt;/i&gt; any bean * initialization callbacks (like InitializingBean's &#123;@code afterPropertiesSet&#125; * or a custom init-method). The bean will already be populated with property values. * The returned bean instance may be a wrapper around the original. * &lt;p&gt;In case of a FactoryBean, this callback will be invoked for both the FactoryBean * instance and the objects created by the FactoryBean (as of Spring 2.0). The * post-processor can decide whether to apply to either the FactoryBean or created * objects or both through corresponding &#123;@code bean instanceof FactoryBean&#125; checks. * &lt;p&gt;This callback will also be invoked after a short-circuiting triggered by a * &#123;@link InstantiationAwareBeanPostProcessor#postProcessBeforeInstantiation&#125; method, * in contrast to all other BeanPostProcessor callbacks. * @param bean the new bean instance * @param beanName the name of the bean * @return the bean instance to use, either the original or a wrapped one; * if &#123;@code null&#125;, no subsequent BeanPostProcessors will be invoked * @throws org.springframework.beans.BeansException in case of errors * @see org.springframework.beans.factory.InitializingBean#afterPropertiesSet * @see org.springframework.beans.factory.FactoryBean */ Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException;&#125; ç¼–å†™ä¸€ä¸ªMyBeanPostProcessorå®ç°BeanPostProcessoræ¥å£ 123456789101112131415161718/** * @Author: cuzz * @Date: 2018/9/24 14:21 * @Description: åç½®å¤„ç†å™¨ï¼Œåˆå§‹åŒ–å‰åè¿›è¡Œå¤„ç†å·¥ä½œ */public class MyBeanPostProcessor implements BeanPostProcessor&#123; @Override public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException &#123; System.out.println("---&gt;postProcessBeforeInitialization..." + beanName +"==&gt;" + bean); return bean; &#125; @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; System.out.println("---&gt;postProcessAfterInitialization..." + beanName +"==&gt;" + bean); return bean; &#125;&#125; æ·»åŠ åˆ°é…ç½®ä¸­ 12345678910111213@Configurationpublic class MainConfigOfLifecycle &#123; @Bean public Cat cat() &#123; return new Cat(); &#125; @Bean public MyBeanPostProcessor myBeanPostProcessor() &#123; return new MyBeanPostProcessor(); &#125;&#125; æµ‹è¯• 123456789101112---&gt;postProcessBeforeInitialization...org.springframework.context.event.internalEventListenerProcessor==&gt;org.springframework.context.event.EventListenerMethodProcessor@1dc67c2---&gt;postProcessAfterInitialization...org.springframework.context.event.internalEventListenerProcessor==&gt;org.springframework.context.event.EventListenerMethodProcessor@1dc67c2---&gt;postProcessBeforeInitialization...org.springframework.context.event.internalEventListenerFactory==&gt;org.springframework.context.event.DefaultEventListenerFactory@2bd765---&gt;postProcessAfterInitialization...org.springframework.context.event.internalEventListenerFactory==&gt;org.springframework.context.event.DefaultEventListenerFactory@2bd765cat constructor...---&gt;postProcessBeforeInitialization...cat==&gt;com.cuzz.bean.Cat@1d3b207cat...init...---&gt;postProcessAfterInitialization...cat==&gt;com.cuzz.bean.Cat@1d3b207å®¹å™¨åˆ›å»ºå®Œæˆ...---&gt;å¼€å§‹å…³é—­å®¹å™¨cat...destroy...---&gt;å·²ç»å…³é—­å®¹å™¨ åœ¨å®ä¾‹åˆ›å»ºä¹‹å‰ååˆ›å»ºä¹‹åä¼šè¢«æ‰§è¡Œ ç”Ÿå‘½å‘¨æœŸBeanPostProcessoråŸç†é€šè¿‡debugåˆ°populateBeanï¼Œå…ˆç»™å±æ€§èµ‹å€¼åœ¨æ‰§è¡ŒinitializeBeanæ–¹æ³• 123456try &#123; populateBean(beanName, mbd, instanceWrapper); if (exposedObject != null) &#123; exposedObject = initializeBean(beanName, exposedObject, mbd); &#125;&#125; initializeBeanæ–¹æ³•æ—¶ï¼Œ 1234567891011121314151617181920protected Object initializeBean(final String beanName, final Object bean, RootBeanDefinition mbd) &#123; Object wrappedBean = bean; if (mbd == null || !mbd.isSynthetic()) &#123; // æ‰§è¡Œbeforeæ–¹æ³• wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName); &#125; ... try &#123; // æ‰§è¡Œåˆå§‹åŒ– invokeInitMethods(beanName, wrappedBean, mbd); &#125; if (mbd == null || !mbd.isSynthetic()) &#123; // æ‰§è¡Œafteræ–¹æ³• wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName); &#125; return wrappedBean;&#125; Springåº•å±‚å¯¹BeanPostProcessorçš„ä½¿ç”¨ï¼š Beanèµ‹å€¼ã€æ³¨å…¥å…¶ä»–ç»„ä»¶ã€@Autowiredã€ç”Ÿå‘½å‘¨æœŸæ³¨è§£åŠŸèƒ½ã€@Asyncç­‰ç­‰éƒ½ä½¿ç”¨åˆ°äº†BeanPostProcessorè¿™ä¸ªæ¥å£çš„å®ç°ç±»ï¼Œå¾ˆé‡è¦ æ€»ç»“Bean çš„åˆå§‹åŒ–é¡ºåº é¦–å…ˆæ‰§è¡Œ bean çš„æ„é€ æ–¹æ³• BeanPostProcessor çš„ postProcessBeforeInitialization æ–¹æ³• InitializingBean çš„ afterPropertiesSet æ–¹æ³• @Bean æ³¨è§£çš„ initMethodæ–¹æ³• BeanPostProcesso rçš„ postProcessAfterInitialization æ–¹æ³• DisposableBean çš„ destroy æ–¹æ³• @Beanæ³¨è§£çš„ destroyMethod æ–¹æ³•]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>æ³¨è§£</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæ³¨è§£é©±åŠ¨å¼€å‘ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2018%2F09%2F23%2FSpring%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[æ³¨è§£å¯ä»¥ç®€åŒ–é…ç½®ï¼Œæé«˜æ•ˆç‡ The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. ç»„ä»¶æ³¨å†Œ@Configurationå’Œ@Beançš„æ³¨å…¥ä½¿ç”¨xmlæ–¹å¼æˆ‘ä»¬ä¸€èµ·æ³¨å…¥ä¸€ä¸ªbeanä½¿ç”¨xmlæ¥é…ç½® 123456789101112&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"&gt; &lt;bean id="person" class="com.cuzz.bean.Person"&gt; &lt;property name="name" value="cuzz"&gt;&lt;/property&gt; &lt;property name="age" value="18"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;/beans&gt; æˆ‘å¯ä»¥ä½¿ç”¨ClassPathXmlApplicationContextæ¥è·å– 12345678910111213/** * @Author: cuzz * @Date: 2018/9/23 10:48 * @Description: */public class MainTest &#123; public static void main(String[] args) &#123; ApplicationContext applicationContext = new ClassPathXmlApplicationContext("bean.xml"); // ç”¨idè·å– Person bean = (Person) applicationContext.getBean("person"); System.out.println(bean); &#125;&#125; è¾“å‡ºPerson(name=cuzz, age=18) æ³¨è§£ç¼–å†™ä¸€ä¸ªé…ç½®ç±» 1234567891011121314/** * @Author: cuzz * @Date: 2018/9/23 10:55 * @Description: é…ç½®ç±» */@Configuration // å‘Šè¯‰Springè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»public class MainConfig &#123; // ç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªBean,ç±»å‹ä¸ºè¿”å›å€¼ç±»å‹,idé»˜è®¤ç”¨æ–¹æ³•å // ä¹Ÿå¯ä»¥æŒ‡å®šid @Bean(value = "person01") public Person person() &#123; return new Person("vhsj", 16); &#125;&#125; å¯ä»¥é€šè¿‡AnnotationConfigApplicationContextæ¥è·å–ï¼Œå¹¶ä¸”è·å–id 1234567891011121314151617/** * @Author: cuzz * @Date: 2018/9/23 10:59 * @Description: */public class MainTest &#123; public static void main(String[] args) &#123; AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(MainConfig.class); Person person = (Person) context.getBean(Person.class); System.out.println(person); String[] names = context.getBeanNamesForType(Person.class); for (String name: names) &#123; System.out.println(name); &#125; &#125;&#125; è¾“å‡º 12Person(name=vhsj, age=16)person01 ç”±äºç»™beanæ·»åŠ ä¸€ä¸ªä¸€ä¸ªvalueï¼Œå¯ä»¥æ”¹å˜é»˜è®¤id ç»„ä»¶æ³¨å†Œ@ComponentScanä½¿ç”¨xmlåªè¦æ ‡æ³¨äº†æ³¨è§£å°±èƒ½æ‰«æåˆ°å¦‚ï¼š @Controller @Service @Repository @Component 1&lt;context:component-scan base-package="com.cuzz"&gt;&lt;/context:component-scan&gt; æ³¨è§£åœ¨é…ç½®ç±»ä¸­æ·»åŠ  12345678910/** * @Author: cuzz * @Date: 2018/9/23 10:55 * @Description: é…ç½®ç±» */@Configuration // å‘Šè¯‰Springè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»@ComponentScan(value = "com.cuzz") // æŒ‡å®šåŒ…public class MainConfig &#123; &#125; æ·»åŠ controllerã€serviceç­‰ æµ‹è¯• 1234567891011121314151617/** * @Author: cuzz * @Date: 2018/9/23 13:03 * @Description: */public class IOCTest &#123; @Test public void test01() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(MainConfig.class); // è·å–æ‰€æœ‰beanå®šä¹‰çš„åå­— String[] beanNames = applicationContext.getBeanDefinitionNames(); for (String name : beanNames) &#123; System.out.println(name); &#125; &#125;&#125; è¾“å‡ºç»“æœ 1234567891011org.springframework.context.annotation.internalConfigurationAnnotationProcessororg.springframework.context.annotation.internalAutowiredAnnotationProcessororg.springframework.context.annotation.internalRequiredAnnotationProcessororg.springframework.context.annotation.internalCommonAnnotationProcessororg.springframework.context.event.internalEventListenerProcessororg.springframework.context.event.internalEventListenerFactorymainConfigbookControllerbookDaobookServiceperson01 å¯ä»¥çœ‹å‡ºæ·»åŠ @Controller @Service @Repository @C omponentæ³¨è§£çš„éƒ½å¯ä»¥æ‰«æåˆ° è¿˜å¯ä»¥æŒ‡å®šæ·»åŠ æŸäº›ç±»ï¼Œå’Œæ’é™¤æŸäº›ç±»ï¼Œè¿›å…¥ComponentScanæ³¨è§£ä¸­æœ‰ä¸‹é¢ä¸¤ä¸ªæ–¹æ³• 12345ComponentScan.Filter[] includeFilters() default &#123;&#125;;ComponentScan.Filter[] excludeFilters() default &#123;&#125;;includeFilters = Filter[] ï¼šæŒ‡å®šæ‰«æçš„æ—¶å€™åªéœ€è¦åŒ…å«å“ªäº›ç»„ä»¶excludeFilters = Filter[] ï¼šæŒ‡å®šæ‰«æçš„æ—¶å€™æŒ‰ç…§ä»€ä¹ˆè§„åˆ™æ’é™¤é‚£äº›ç»„ä»¶ é…ç½®ç±»ï¼Œæ’é™¤Controller 1234567@Configuration // å‘Šè¯‰Springè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»@ComponentScan(value = "com.cuzz", excludeFilters = &#123; @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = &#123;Controller.class&#125;)&#125;)public class MainConfig &#123;&#125; è¿è¡Œæµ‹è¯•æ–¹æ³•ï¼Œå¯ä»¥å¾—å‡ºæ²¡æœ‰Controllerç±»çš„ 123456789org.springframework.context.annotation.internalAutowiredAnnotationProcessororg.springframework.context.annotation.internalRequiredAnnotationProcessororg.springframework.context.annotation.internalCommonAnnotationProcessororg.springframework.context.event.internalEventListenerProcessororg.springframework.context.event.internalEventListenerFactorymainConfigbookDaobookServiceperson01 è‡ªå®šä¹‰TypeFilteræŒ‡å®šè¿‡æ»¤è§„åˆ™ç¬¬ä¸€å’Œç¬¬äºŒæ¯”è¾ƒå¸¸ç”¨ 12345FilterType.ANNOTATIONï¼šæŒ‰ç…§æ³¨è§£FilterType.ASSIGNABLE_TYPEï¼šæŒ‰ç…§ç»™å®šçš„ç±»å‹ï¼›FilterType.ASPECTJï¼šä½¿ç”¨ASPECTJè¡¨è¾¾å¼FilterType.REGEXï¼šä½¿ç”¨æ­£åˆ™æŒ‡å®šFilterType.CUSTOMï¼šä½¿ç”¨è‡ªå®šä¹‰è§„åˆ™ æ–°å»ºä¸€ä¸ªMyTypeFilteç±»å®ç°TypeFilteræ¥å£ 1234567891011121314151617181920212223242526272829/** * @Author: cuzz * @Date: 2018/9/23 15:03 * @Description: */public class MyTypeFilter implements TypeFilter&#123; /** * metadataReaderï¼šè¯»å–åˆ°çš„å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„ä¿¡æ¯ * metadataReaderFactory:å¯ä»¥è·å–åˆ°å…¶ä»–ä»»ä½•ç±»ä¿¡æ¯çš„ */ @Override public boolean match(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory) throws IOException &#123; // è·å–å½“å‰ç±»æ³¨è§£çš„ä¿¡æ¯ AnnotationMetadata annotationMetadata = metadataReader.getAnnotationMetadata(); // è·å–å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„ç±»ä¿¡æ¯ ClassMetadata classMetadata = metadataReader.getClassMetadata(); // è·å–å½“å‰ç±»èµ„æºï¼ˆç±»çš„è·¯å¾„ï¼‰ Resource resource = metadataReader.getResource(); String className = classMetadata.getClassName(); System.out.println("---&gt;"+className); // è¿™äº›ç±»åä¸­åŒ…å«erå°±è¿”å›true if(className.contains("er"))&#123; return true; &#125; return false; &#125;&#125; ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£è®°å¾—éœ€è¦å…³é—­é»˜è®¤è¿‡æ»¤å™¨useDefaultFilters = false 123456789101112131415161718/** * @Author: cuzz * @Date: 2018/9/23 10:55 * @Description: é…ç½®ç±» */@Configuration @ComponentScan(value = "com.cuzz", includeFilters = @ComponentScan.Filter(type = FilterType.CUSTOM, classes = MyTypeFilter.class), useDefaultFilters = false)public class MainConfig &#123; // ç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªBean,ç±»å‹ä¸ºè¿”å›å€¼ç±»å‹,idé»˜è®¤ç”¨æ–¹æ³•å // ä¹Ÿå¯ä»¥æŒ‡å®šid @Bean(value = "person01") public Person person() &#123; return new Person("vhsj", 16); &#125;&#125; æµ‹è¯•12345678910111213141516171819202122---&gt;com.cuzz.AppTest---&gt;com.cuzz.bean.MainTest---&gt;com.cuzz.config.IOCTest---&gt;com.cuzz.config.MainTest---&gt;com.cuzz.App---&gt;com.cuzz.bean.Person---&gt;com.cuzz.config.MyTypeFilter---&gt;com.cuzz.controller.BookController---&gt;com.cuzz.dao.BookDao---&gt;com.cuzz.sevice.BookServiceorg.springframework.context.annotation.internalConfigurationAnnotationProcessororg.springframework.context.annotation.internalAutowiredAnnotationProcessororg.springframework.context.annotation.internalRequiredAnnotationProcessororg.springframework.context.annotation.internalCommonAnnotationProcessororg.springframework.context.event.internalEventListenerProcessororg.springframework.context.event.internalEventListenerFactorymainConfig // ä¸æ˜¯æ‰«æçš„ person // è¿™ä¸ªæ˜¯åœ¨beanä¸­myTypeFilter // æœ‰erbookController // æœ‰erbookService // æœ‰erperson01 // è¿™ä¸ªæ˜¯åœ¨beanä¸­ ç»„ä»¶æ³¨å†Œ@Scopeè®¾ç½®ä½œç”¨åŸŸSpringçš„beané»˜è®¤æ˜¯å•ä¾‹çš„123456789101112@Testpublic void test02() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(MainConfig2.class); // è·å–æ‰€æœ‰beanå®šä¹‰çš„åå­— String[] beanNames = applicationContext.getBeanDefinitionNames(); for (String name : beanNames) &#123; System.out.println(name); &#125; Object bean = applicationContext.getBean("person"); Object bean2 = applicationContext.getBean("person"); System.out.println(bean == bean2); // è¾“å‡ºtrue&#125; Scopeçš„å››ä¸ªèŒƒå›´1234ConfigurableBeanFactory#SCOPE_PROTOTYPE // å¤šå®ä¾‹ æ¯æ¬¡è·å–æ—¶åˆ›å»ºå¯¹è±¡ï¼Œä¸ä¼šæ”¾åœ¨iocå®¹å™¨ä¸­ConfigurableBeanFactory#SCOPE_SINGLETON // å•å®ä¾‹ iocå®¹å™¨å¯åŠ¨æ˜¯åˆ›å»ºå¯¹è±¡ï¼Œä»¥åä»å®¹å™¨ä¸­è·å–WebApplicationContext#SCOPE_REQUEST // webåŒä¸€æ¬¡è¯·æ±‚åˆ›å»ºä¸€ä¸ªå®ä¾‹WebApplicationContext#SCOPE_SESSION // webåŒä¸€ä¸ªsessionåˆ›å»ºä¸€ä¸ªå®ä¾‹ å¦‚æœæˆ‘ä»¬æŠŠScopeä¿®æ”¹ 1234567891011121314/** * @Author: cuzz * @Date: 2018/9/23 15:40 * @Description: */@Configurationpublic class MainConfig2 &#123; @Scope(value = "prototype") @Bean public Person person() &#123; return new Person("vhuj", 25); &#125;&#125; åˆ™æµ‹è¯•è¾“å‡ºfalse ç»„ä»¶æ³¨å†Œ@Lazy-beanæ‡’åŠ è½½æ‡’åŠ è½½æ‡’åŠ è½½çš„æ˜¯é’ˆå¯¹å•å®ä¾‹Beanï¼Œé»˜è®¤æ˜¯åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶åˆ›å»ºçš„ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æ‡’åŠ è½½å®¹å™¨å¯åŠ¨æ˜¯ä¸åˆ›å»ºå¯¹è±¡ï¼Œåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆè·å–ï¼‰Beanåˆ›å»ºå¯¹è±¡ï¼Œå¹¶åˆå§‹åŒ– æµ‹è¯•å…ˆç»™æ·»åŠ ä¸€ä¸ª@Lazyæ³¨è§£ 12345678910@Configurationpublic class MainConfig2 &#123; @Lazy @Bean public Person person() &#123; System.out.println("ç»™å®¹å™¨ä¸­æ·»åŠ Person..."); return new Person("vhuj", 25); &#125;&#125; ç¼–å†™ä¸€ä¸ªæµ‹è¯•æ–¹æ³• 1234567@Testpublic void test03() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(MainConfig2.class); System.out.println("iocå®¹å™¨åˆ›å»ºå®Œæˆ..."); Object bean = applicationContext.getBean("person");&#125; è¾“å‡º 12iocå®¹å™¨åˆ›å»ºå®Œæˆ...ç»™å®¹å™¨ä¸­æ·»åŠ Person... æ·»åŠ ä¸€ä¸ª@Lazyæ˜¯åœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶ï¼Œåˆ›å»ºå¯¹è±¡ï¼Œä»¥åè·å–å°±ä¸éœ€è¦åˆ›å»ºäº†ï¼Œç›´æ¥ä»å®¹å™¨ä¸­è·å–ï¼Œå› ä¸ºå®ƒæ˜¯å•å®ä¾‹ ç»„ä»¶æ³¨å†Œ@ConditionalæŒ‰æ¡ä»¶æ³¨å†ŒæŒ‰ç…§ä¸€å®šæ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶ç»™å®¹å™¨ä¸­æ³¨å†ŒBean ç¼–å†™è‡ªå·±çš„Conditionç±»å¦‚æœç³»ç»Ÿæ˜¯windowsï¼Œç»™å®¹å™¨ä¸­æ³¨å…¥â€billâ€ å¦‚æœç³»ç»Ÿæ˜¯linuxï¼Œç»™å®¹å™¨ä¸­æ³¨å…¥â€linusâ€ ç¼–å†™WindowConditionç±»å¹¶é‡å†™matchesæ–¹æ³• 12345678910111213141516171819202122/** * @Author: cuzz * @Date: 2018/9/23 20:30 * @Description: åˆ¤æ–­æ˜¯å¦æ˜¯windows */ public class WindowCondition implements Condition&#123; /** * @param context åˆ¤æ–­æ¡ä»¶ * @param metadata æ³¨é‡Šä¿¡æ¯ * @return boolean */ @Override public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) &#123; Environment environment = context.getEnvironment(); String property = environment.getProperty("os.name"); if (property.contains("Windows")) &#123; return true; &#125; return false; &#125; &#125; contextæœ‰ä»¥ä¸‹æ–¹æ³• 12345678// èƒ½è·å–iocä½¿ç”¨çš„beanfactoryConfigurableListableBeanFactory beanFactory = context.getBeanFactory();// èƒ½è·å–åˆ°ç±»åŠ è½½å™¨ClassLoader classLoader = context.getClassLoader();// è·å–åˆ°ç¯å¢ƒå˜é‡Environment environment = context.getEnvironment();// è·å–åˆ°Beanå®šä¹‰çš„æ³¨å†Œç±»BeanDefinitionRegistry registry = context.getRegistry(); é…ç½®ç±»æ·»åŠ Beanæ·»åŠ Conditionæ¡ä»¶ 123456789101112131415@Configurationpublic class MainConfig2 &#123; @Conditional(&#123;WindowCondition.class&#125;) @Bean("bill") public Person person01() &#123; return new Person("Bill Gates", 60); &#125; @Conditional(&#123;LinuxCondition.class&#125;) @Bean("linux") public Person person02() &#123; return new Person("linus", 45); &#125;&#125; æµ‹è¯•12345678910111213141516171819@Testpublic void test04() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(MainConfig2.class); // è·å–ç¯å¢ƒå˜é‡ ConfigurableEnvironment environment = applicationContext.getEnvironment(); String property = environment.getProperty("os.name"); System.out.println(property); // è·å–æ‰€æœ‰beanå®šä¹‰çš„åå­— String[] beanNames = applicationContext.getBeanDefinitionNames(); for (String name : beanNames) &#123; System.out.println(name); &#125; // key æ˜¯id Map&lt;String, Person&gt; map = applicationContext.getBeansOfType(Person.class); System.out.println(map);&#125; å‘ç°åªæœ‰â€œbillâ€è¿™ä¸ªBeanè¢«æ³¨å…¥ 12345678910Windows 7org.springframework.context.annotation.internalConfigurationAnnotationProcessororg.springframework.context.annotation.internalAutowiredAnnotationProcessororg.springframework.context.annotation.internalRequiredAnnotationProcessororg.springframework.context.annotation.internalCommonAnnotationProcessororg.springframework.context.event.internalEventListenerProcessororg.springframework.context.event.internalEventListenerFactorymainConfig2bill&#123;bill=Person(name=Bill Gates, age=60)&#125; ç»„ä»¶æ³¨å†Œ@Improtç»™å®¹å™¨ä¸­å¿«é€Ÿå¯¼å…¥ä¸€ä¸ªç»„ä»¶@Importå¯¼å…¥@Importå¯ä»¥å¯¼å…¥ç¬¬ä¸‰æ–¹åŒ…ï¼Œæˆ–åˆ™è‡ªå·±å†™çš„ç±»ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼ŒIdé»˜è®¤ä¸ºå…¨ç±»å æ¯”å¦‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç±» 1234567/** * @Author: cuzz * @Date: 2018/9/23 21:08 * @Description: */public class Color &#123;&#125; æˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®ç±»æ·»åŠ ä¸€ä¸ª@ImportæŠŠè¿™ä¸ªç±»å¯¼å…¥ 123@Import(&#123;Color.class&#125;)@Configurationpublic class MainConfig2 &#123;&#125; ImportSelectoræ¥å£å¯¼å…¥çš„é€‰æ‹©å™¨è¿”å›å¯¼å…¥ç»„ä»¶éœ€è¦çš„å…¨ç±»åçš„æ•°ç»„ 123456789public interface ImportSelector &#123; /** * Select and return the names of which class(es) should be imported based on * the &#123;@link AnnotationMetadata&#125; of the importing @&#123;@link Configuration&#125; class. */ String[] selectImports(AnnotationMetadata importingClassMetadata);&#125; ç¼–å†™ä¸€ä¸ªMyImportSelectorç±»å®ç°ImportSelectoræ¥å£ 1234567891011121314/** * @Author: cuzz * @Date: 2018/9/23 21:15 * @Description: */public class MyImportSelector implements ImportSelector&#123; // è¿”å›å€¼å°±å¯¼å…¥å®¹å™¨ç»„ä»¶çš„å…¨ç±»å // AnnotationMetadata:å½“å‰ç±»æ ‡æ³¨çš„@Importæ³¨è§£ç±»çš„æ‰€æœ‰æ³¨è§£ä¿¡æ¯ @Override public String[] selectImports(AnnotationMetadata importingClassMetadata) &#123; return new String[] &#123;"com.cuzz.bean.Car"&#125;; &#125;&#125; åœ¨é…ç½®ç±»ä¸­ï¼Œé€šè¿‡@Importå¯¼å…¥ 12345678/** * @Author: cuzz * @Date: 2018/9/23 15:40 * @Description: é…ç½®ç±» */@Import(&#123;Color.class, MyImportSelector.class&#125;)@Configurationpublic class MainConfig2 &#123;&#125; æµ‹è¯•ç»“æœï¼Œcom.cuzz.bean.Caræ³¨å…¥äº† 123456789org.springframework.context.annotation.internalConfigurationAnnotationProcessororg.springframework.context.annotation.internalAutowiredAnnotationProcessororg.springframework.context.annotation.internalRequiredAnnotationProcessororg.springframework.context.annotation.internalCommonAnnotationProcessororg.springframework.context.event.internalEventListenerProcessororg.springframework.context.event.internalEventListenerFactorymainConfig2com.cuzz.bean.Colorcom.cuzz.bean.Car ImportBeanDefinitionRegistraræ¥å£é€‰æ‹©å™¨123456789101112131415public interface ImportBeanDefinitionRegistrar &#123; /** * Register bean definitions as necessary based on the given annotation metadata of * the importing &#123;@code @Configuration&#125; class. * &lt;p&gt;Note that &#123;@link BeanDefinitionRegistryPostProcessor&#125; types may &lt;em&gt;not&lt;/em&gt; be * registered here, due to lifecycle constraints related to &#123;@code @Configuration&#125; * class processing. * @param importingClassMetadata annotation metadata of the importing class * @param registry current bean definition registry */ public void registerBeanDefinitions( AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry);&#125; ç¼–å†™ä¸€ä¸ªImportBeanDefinitionRegistrarå®ç°ç±» 123456789101112131415161718192021222324/** * @Author: cuzz * @Date: 2018/9/23 21:29 * @Description: */public class MyImportBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar &#123; /** * @param importingClassMetadata å½“å‰ç±»çš„æ³¨è§£ä¿¡æ¯ * @param registry æ³¨å†Œç±» */ @Override public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123; // æŸ¥è¯¢å®¹å™¨ boolean b = registry.containsBeanDefinition("com.cuzz.bean.Car"); // å¦‚æœæœ‰car, æ³¨å†Œä¸€ä¸ªæ±½æ²¹ç±» if (b == true) &#123; // éœ€è¦æ·»åŠ ä¸€ä¸ªbeançš„å®šä¹‰ä¿¡æ¯ RootBeanDefinition rootBeanDefinition = new RootBeanDefinition(Petrol.class); // æ³¨å†Œä¸€ä¸ªbean, æŒ‡å®šbeanå registry.registerBeanDefinition("petrol", rootBeanDefinition); &#125; &#125;&#125; é…ç½®ç±» 12345678/** * @Author: cuzz * @Date: 2018/9/23 15:40 * @Description: é…ç½®ç±» */@Import(&#123;Color.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class&#125;)@Configurationpublic class MainConfig2 &#123;&#125; æµ‹è¯•ç»“æœï¼Œå‡ºç°äº†petrol 12345678910org.springframework.context.annotation.internalConfigurationAnnotationProcessororg.springframework.context.annotation.internalAutowiredAnnotationProcessororg.springframework.context.annotation.internalRequiredAnnotationProcessororg.springframework.context.annotation.internalCommonAnnotationProcessororg.springframework.context.event.internalEventListenerProcessororg.springframework.context.event.internalEventListenerFactorymainConfig2com.cuzz.bean.Colorcom.cuzz.bean.Car petrol ç»„ä»¶æ³¨å†Œä½¿ç”¨FactoryBeanæ³¨å†Œç»„ä»¶ç¼–å†™ä¸€ä¸ªColorFactoryBeanç±» 12345678910111213141516171819202122/** * @Author: cuzz * @Date: 2018/9/23 21:55 * @Description: Springå®šä¹‰çš„å·¥å‚Bean */public class ColorFactoryBean implements FactoryBean&lt;Color&gt; &#123; // è¿”å›ä¸€ä¸ªColorå¯¹è±¡ @Override public Color getObject() throws Exception &#123; return new Color(); &#125; @Override public Class&lt;?&gt; getObjectType() &#123; return Color.class; &#125; // æ˜¯å¦ä¸ºå•ä¾‹ @Override public boolean isSingleton() &#123; return true; &#125;&#125; æ³¨å…¥åˆ°å®¹å™¨ä¸­ 1234@Beanpublic ColorFactoryBean colorFactoryBean() &#123; return new ColorFactoryBean();&#125; æµ‹è¯• 12345678@Testpublic void test05() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(MainConfig2.class); Object bean = applicationContext.getBean("colorFactoryBean"); // å·¥å‚beanè°ƒç”¨çš„æ˜¯getClass()æ–¹æ³• System.out.println("colorFactoryBeançš„ç±»å‹æ˜¯: " + bean.getClass());&#125; è¾“å‡ºï¼Œå‘ç°æ­¤æ—¶çš„beanè°ƒç”¨çš„æ–¹æ³•æ˜¯getObjectTypeæ–¹æ³• 1colorFactoryBeançš„ç±»å‹æ˜¯: class com.cuzz.bean.Color å¦‚æœéœ€è¦è·å–BeanFactoryæœ¬èº«ï¼Œå¯ä»¥åœ¨idå‰é¢åŠ ä¸€ä¸ªâ€œ&amp;â€æ ‡è¯† 1234567891011@Testpublic void test05() &#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(MainConfig2.class); Object bean = applicationContext.getBean("colorFactoryBean"); // å·¥å‚beanè°ƒç”¨çš„æ˜¯getClass()æ–¹æ³• System.out.println("colorFactoryBeançš„ç±»å‹æ˜¯: " + bean.getClass()); Object bean2 = applicationContext.getBean("&amp;colorFactoryBean"); // å·¥å‚beanè°ƒç”¨çš„æ˜¯getClass()æ–¹æ³• System.out.println("colorFactoryBeançš„ç±»å‹æ˜¯: " + bean2.getClass());&#125; æ­¤æ—¶è¾“å‡º 12colorFactoryBeançš„ç±»å‹æ˜¯: class com.cuzz.bean.ColorcolorFactoryBeançš„ç±»å‹æ˜¯: class com.cuzz.bean.ColorFactoryBean æ€»ç»“ç»™å®¹å™¨ä¸­æ³¨å†Œç»„ä»¶ï¼š åŒ…æ‰«æ + ç»„ä»¶ç»„ä»¶ï¼ˆ@Controller / @Service / @Repository / @Componentï¼‰ @Bean[å¯¼å…¥ç¬¬ä¸‰æ–¹åŒ…ç»„ä»¶] @Import[å¿«é€Ÿç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶] @Importï¼ˆè¦å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„ç»„ä»¶ï¼‰ï¼Œå®¹å™¨ä¸­å°±ä¼šè‡ªåŠ¨æ³¨å†Œè¿™ä¸ªç»„ä»¶ï¼Œid é»˜è®¤æ˜¯å…¨ç±»å ImportSelectorï¼Œè¿”å›éœ€è¦å¯¼å…¥çš„ç»„ä»¶çš„å…¨ç±»åæ•°ç»„ ImportBeanDefinitionRegistrarï¼Œæ‰‹åŠ¨æ³¨å†Œbeanåˆ°å®¹å™¨ä¸­ ä½¿ç”¨ Spring æä¾›çš„ FactoryBean ï¼ˆå·¥å‚Beanï¼‰ é»˜è®¤è·å–åˆ°çš„æ˜¯å·¥å‚ bean è°ƒç”¨çš„ getObject åˆ›å»ºçš„å¯¹è±¡ è¦è·å–å·¥å‚ Bean æœ¬èº«ï¼Œæˆ‘ä»¬éœ€è¦ä¸ª id å‰é¢åŠ ä¸€ä¸ª &amp; ç¬¦å·ï¼Œå¦‚ &amp;colorFactoryBean]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>æ³¨è§£</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å®ä¹ ç»“æŸç¯‡]]></title>
    <url>%2F2018%2F09%2F10%2F%E5%AE%9E%E4%B9%A0%E7%BB%93%E6%9D%9F%E7%AF%87%2F</url>
    <content type="text"><![CDATA[å¸¸æ€€æ„Ÿæ©çš„å¿ƒ æ˜¨å¤©æäº¤äº†ç¦»èŒä¿¡ï¼Œå®Œäº†æˆäº†ä¸€ç³»åˆ—è¾èŒæ‰‹ç»­ æ€»ç»ç†æ‰¾æˆ‘èŠäº†ä¸€ä¼šï¼Œè°ˆäº†è°ˆäººç”Ÿè§„åˆ’ï¼Œå¾ˆæ„Ÿè°¢ä»–èƒ½ç»™äºˆæˆ‘å»ºè®®ï¼Œä¹Ÿå¸Œæœ›æˆ‘æ¯•ä¸šåèƒ½å†å›å…¬å¸ å…ˆæ˜¯å’Œæˆ‘å¸ˆçˆ¶å‘Šåˆ«ï¼Œå¸ˆçˆ¶å…ˆæ˜¯è¯¢é—®äº†æˆ‘çš„æƒ…å†µï¼Œåæ¥æŠŠæˆ‘å¸¦åˆ°å…¬å¸æ¥¼ä¸‹èŠäº†ä¸€ä¼šï¼Œè¯¢é—®äº†æˆ‘ä¸€ä¸‹è§„åˆ’ï¼Œæ€»ç»“ä¸€ä¸‹ä»–ç»™æˆ‘æçš„æ„è§ æ¯•ä¸šåˆšå‡ºå»ï¼Œå…ˆå»ä¸€çº¿äº’è”ç½‘åŸå¸‚ï¼Œé¦–å…ˆé€‰æ‹©å¤§å‚ï¼Œå‰ä¸‰å¹´ä¸è¦å¤ªåœ¨æ„å·¥èµ„ï¼Œä¸»è¦æ˜¯çœ¼ç•Œ ä¸è¦æœ¬æœ«å€’ç½®ï¼Œç°åœ¨ä¸è¦å¤©å¤©å»èƒŒé‚£äº›é¢è¯•é¢˜å’Œåˆ·é¢˜ï¼Œå½“å‰é‡è¦çš„æ˜¯çŸ¥è¯†çš„æ²‰æ·€ï¼ŒæŠŠå…¬å¸ç”¨åˆ°çš„ä¸­é—´ä»¶ï¼Œå¥½å¥½ç ”ç©¶ä¸€ä¸‹ï¼Œä¸è¦åªæ˜¯çœ‹çœ‹ï¼Œè€Œè¦åŠ¨æ‰‹å»æ­å»º ä¸æ˜¯ç§‘ç­å‡ºèº«çš„ï¼Œèº«è¾¹ç¼ºå°‘è¿™ç§æŠ€æœ¯çš„æ°›å›´ï¼Œå¹³æ—¶å¤šåŠªåŠ›åŠªåŠ›ï¼Œå¤šè®¤è¯†è®¤è¯†æœ‹å‹ å­¦æ ¡æœ‰é¡¹ç›®ï¼Œå³ä½¿æ²¡æŠ¥é…¬ï¼Œä¹Ÿè¦å»å‚ä¸ï¼Œå¤šç§¯ç´¯ç»éªŒ ç„¶åæ˜¯è·Ÿå¤–å–ç»„çš„äººå‘Šåˆ«ï¼Œæ„Ÿè°¢ç»„é•¿CJGï¼Œå°å¸ˆå…„HLï¼Œä»¥åŠCWZï¼ŒBWï¼ŒNZè¿™äº›äººå¯¹æˆ‘çš„å¸®åŠ©ï¼Œè¿™ä¸€æ®µæ—¶é—´åœ¨è¿™é‡Œå­¦ä¹ åˆ°äº†è®¸å¤šï¼Œæ„Ÿè°¢è¿™äº›äºº HLå°å¸ˆå…„ï¼Œä¹Ÿå•ç‹¬å’Œæˆ‘èŠäº†èŠï¼Œè¯¢é—®äº†æˆ‘çš„æƒ…å†µï¼Œä¹Ÿç»™æˆ‘ä¸€äº›å·¥ä½œç»éªŒï¼Œä¸èƒ½è¢«äººå½±å“åˆ°è‡ªå·±ï¼Œå¹³æ—¶åšäº‹è®¤çœŸä¸€ç‚¹ï¼Œä¸è¦æ‹…å¿ƒçŠ¯é”™ç­‰ å°å¸ˆå…„è¿˜é€æˆ‘ä¸‹æ¥¼ï¼Œæœ€åå°å¸ˆå…„æ‹¥æŠ±ä¸€ä¸ªå°±å‘Šåˆ«äº† èµ°åˆ°åœ°é“ç«™å‘ç°èº«ä¸Šè¿˜æœ‰ä¸€å¼ 48çš„çš„å£«ç¥¨è¿˜æ²¡æŠ¥ï¼Œåˆå›å…¬å¸äº† ç„¶ååˆè·ŸåŒäº‹å‘Šåˆ«äº†ä¸€æ³¢]]></content>
      <categories>
        <category>æ—¥è®°</category>
      </categories>
      <tags>
        <tag>å®ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å®ä¹ è®°å½•]]></title>
    <url>%2F2018%2F07%2F23%2F%E5%AE%9E%E4%B9%A0%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[å®ä¹ ç»™äº†æˆ‘å¾ˆå¤§ä¿¡å¿ƒ å®ä¹ ä¸€æ®µæ—¶é—´äº†ï¼Œè¯´è¯´æœ€è¿‘çš„æ„Ÿå—å§ æˆ‘æ˜¯è½¬è¡Œçš„ï¼Œç°åœ¨æ˜¯ä¸€åææ–™è®¡ç®—çš„ç ”ç©¶ç”Ÿï¼Œä¸ºä»€ä¹ˆè¦è¯´ææ–™è®¡ç®—å‘¢ï¼Œæˆ‘æ˜¯å¸Œæœ›å»é¢è¯•çš„æ—¶å€™è‡³å°‘æœ‰è®¡ç®—è¿™ä¸¤ä¸ªå­—ï¼ŒHRè‡³å°‘ä¼šè§‰å¾—æˆ‘è·Ÿè®¡ç®—æœºæœ‰ç‚¹é è¾¹ï¼Œå‡å°‘è¢«HRç»™è¿‡æ»¤æ‰ å­¦javaå¤§æ¦‚åŠå¹´äº†ï¼ŒæŠŠjavaåŸºç¡€å­¦å®Œï¼Œåœ¨æ…•è¯¾ç½‘ä¸Šæ‰¾äº†ä¸€ä¸ªå®æˆ˜è¯¾ç¨‹ï¼Œè¿™æ˜¯æˆ‘éƒ¨ç½²ä¸Šçº¿çš„ç½‘ç«™ï¼ˆè¿˜æ²¡å†™å®Œï¼‰ï¼Œå°±å»æ‰¾å®ä¹ äº† ç”±äºæ˜¯æš‘å‡ï¼Œè€å¸ˆç®¡çš„ä¹Ÿæ²¡é‚£ä¹ˆä¸¥ï¼Œä¸ç”¨å»å®éªŒå®¤ åˆšå¼€å§‹çš„æ—¶å€™ï¼Œä¸æ˜¯å¾ˆè‡ªä¿¡ï¼Œåœ¨æ‹‰é’©ã€Bossç›´è˜å’Œæ™ºè”æŠ•ç®€å†ï¼Œå¤§æ¦‚æŠ•äº†100æ¥ä»½ï¼Œæ”¶åˆ°5-6ä¸ªé¢è¯•ï¼Œæ­¦æ±‰çš„å¤å¤©çœŸçš„çƒ­ï¼Œæœ€æ°”æ„¤çš„æ˜¯ï¼Œé‡åˆ°ä¸€ä¸¤ä¸ªåŸ¹è®­æœºæ„ï¼Œæµªè´¹æ—¶é—´ï¼Œåæ¥å»é¢è¯•éƒ½ä¼šåœ¨ç½‘ä¸Šå…ˆæŸ¥æŸ¥ï¼Œåˆšå¼€å§‹é¢è¯•çš„éƒ½æ˜¯ä¸€äº›å°å…¬å¸ï¼Œå°å…¬å¸åŸºæœ¬éƒ½æ˜¯é—®ä½ é¡¹ç›®ï¼Œç„¶è€Œæˆ‘é¡¹ç›®ç»éªŒåˆä¸å¤šï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯å›å»ç­‰æ¶ˆæ¯ æ¥ç€é¢è¯•äº†å¦ä¸€å®¶å°å…¬å¸ï¼Œå…¬å¸çš„è€æ¿å’Œæˆ‘æ˜¯ä¸€ä¸ªå­¦æ ¡çš„ï¼Œè·Ÿæˆ‘èŠçš„ä¹Ÿå¾ˆä¸é”™ï¼Œæœ¬æ¥æ‰“ç®—åœ¨è¿™é‡Œå®ä¹ çš„ï¼Œåæ¥æ”¶åˆ°è‰¯å“çš„å®ä¹ offerï¼Œå°±æ²¡å»äº†ï¼Œä¹Ÿè·Ÿè¿™ä½å­¦é•¿æ²Ÿé€šäº†ï¼Œä»–ä¹Ÿæ”¯æŒæˆ‘ åæ¥è‰¯å“é“ºå­æ‰“ç”µè¯ç»™æˆ‘ï¼Œè®©æˆ‘å»é¢è¯•ï¼Œè‰¯å“é“ºå­åœ¨æ­¦æ±‰æ¥è¯´ç®—æ¯”è¾ƒå¤§çš„ä¼ä¸šï¼Œé¢è¯•æˆ‘çš„æ˜¯ä¸€åæ¶æ„å¸ˆï¼Œå¤§å…¬å¸æ¯”è¾ƒå–œæ¬¢é—®åŸºç¡€ï¼Œæˆ‘å¯¹javaåŸºç¡€æŒæ¡çš„è¿˜ä¸é”™ï¼Œç­”çš„ä¹Ÿè¿˜å¯ä»¥ï¼Œå¾—åˆ°äº†ä»–çš„è®¤å¯ï¼Œåé¢çš„é¢è¯•å°±å¾ˆè½»æ¾ï¼Œä»–è¿˜ä¸»åŠ¨è¦å¸®æˆ‘åŠ å·¥èµ„ï¼Œåæ¥æˆ‘å°±è®¤ä»–å½“æˆ‘å¸ˆå‚…ï¼ŒçœŸçš„å¾ˆå¥½ï¼Œå¾ˆæ„Ÿè°¢ä»– ä»–è¿˜å¤¸æˆ‘åŸºç¡€æŒºå¥½çš„ï¼Œåæ¥è¢«æˆ‘åˆ†é…åˆ°å¤–å–ç»„ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒå¥½çš„ç»„ï¼Œå±äºç”µå•†ï¼Œæ‰€ç”¨çš„æŠ€æœ¯ä¹Ÿæ˜¯æ¯”è¾ƒæ–° æ¥ç»„é‡Œåˆç¢°åˆ°äº†åŒä¸€ä¸ªå­¦æ ¡çš„å°å¸ˆå…„è¿˜æ˜¯è€ä¹¡ï¼ŒçœŸæ˜¯å¤ªå¹¸è¿äº†ï¼Œè¿˜æœ‰æˆ‘ç»„é•¿ï¼Œäººéƒ½è¶…çº§niceï¼Œä¹Ÿä»ä»–ä»¬é‚£é‡Œå­¦åˆ°å¾ˆå¤š å¹³æ—¶æŠŠéœ€æ±‚åšå®Œï¼Œè‡ªå·±çœ‹çœ‹åšå®¢ï¼Œçœ‹çœ‹ä¹¦ï¼Œå­¦å­¦å…¬å¸æ‰€æœ‰çš„æ¡†æ¶ï¼Œå‘ç°å…¬å¸ç”¨çš„æ¡†æ¶å¾ˆå¤šéƒ½æ˜¯é˜¿é‡Œçš„ï¼Œæ¯”èµ·ä»¥å‰åœ¨å·¥å‚å®ä¹ ç®€ç›´å¤ªçˆ½äº† å®ä¹ è¿™ä¸€æ®µæ—¶é—´è‡ªå·±çš„æå‡çœŸçš„å¾ˆå¤šï¼Œæ‰€ä»¥æœ‰æœºä¼šä¸€å®šè¦å‡ºå»å®ä¹ ï¼Œå¹³æ—¶æˆ‘ä»¬éƒ¨é—¨è¿˜ä¼šç»„ç»‡æŠ€æœ¯åˆ†äº«ï¼Œä¹Ÿå¯ä»¥å¢åŠ è‡ªå·±çš„çœ¼ç•Œï¼Œå¹³æ—¶é‡åˆ°é—®é¢˜ï¼Œä¹Ÿå¯ä»¥å¿«é€Ÿå¯»æ±‚å¸®åŠ©ï¼Œå¿«é€Ÿè§£å†³é—®é¢˜ï¼ŒçŸ¥é“ä¸€ä¸ªå…¬å¸æ˜¯æ€ä¹ˆå¼€å‘äº§å“çš„ æœ€åæ”¶è·æœ€å¤šçš„è¿˜æ˜¯è‡ªä¿¡ï¼Œåˆšå¼€å§‹è§‰å¾—è‡ªå·±ä¸æ˜¯ç§‘ç­çš„æœ‰ç‚¹ä¸å¤ªè‡ªä¿¡ï¼Œå®ä¹ æ±‡æŠ¥å®Œåå°å¸ˆå…„è¯´æˆ‘å­¦ä¹ èƒ½åŠ›æ¯”è¾ƒå¼ºï¼Œä¸Šæ‰‹å¿«ï¼Œä¸ç”¨è®©ä»–æ“å¿ƒï¼Œæˆ‘çš„ç»„é•¿å¯¹æˆ‘çš„è¯„ä»·è¯´æˆ‘è¾¾åˆ°2å¹´çš„æ°´å¹³ï¼Œå“ˆå“ˆï¼ŒçœŸçš„æŠŠæˆ‘é«˜å…´åäº†ï¼Œæˆ‘ä»¬çš„ç»„é•¿çš„bossä¹Ÿç»™æˆ‘çš„è¯„ä»·ä¹Ÿä¸é”™ï¼Œæˆ‘ä¸æ˜¯æ¥ç‚«è€€è¿™äº›ï¼Œåªæ˜¯è¿™äº›è‚¯å®šç»™æˆ‘å¾ˆå¤§çš„ä¿¡å¿ƒï¼Œè®©æˆ‘åœ¨è½¬è¡Œçš„é“è·¯ä¸Šè¶Šèµ°è¶Šæœ‰å‹‡æ°”ï¼Œæœ€åè¿˜æ˜¯è¦é è‡ªå·±åŠªåŠ›ï¼Œå¹³æ—¶å¤šå†™å†™ä»£ç ï¼Œå¤šçœ‹çœ‹ä¹¦ æœ€åæ„Ÿè°¢åœ¨æˆ‘è½¬è¡Œæ—¶æ‰€é‡è§çš„è¿™äº›äººã€‚]]></content>
      <categories>
        <category>æ—¥è®°</category>
      </categories>
      <tags>
        <tag>å®ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[jQueryå­¦ä¹ ]]></title>
    <url>%2F2018%2F06%2F24%2FjQuery%E5%AD%A6%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[jQueryæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´çš„JavaScriptæ¡†æ¶ jQueryè®¾è®¡çš„å®—æ—¨æ˜¯â€œwrite Lessï¼ŒDo Moreâ€ åˆè¯†jQueryjQueryæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´çš„JavaScriptæ¡†æ¶ï¼Œæ˜¯ç»§Prototypeä¹‹ååˆä¸€ä¸ªä¼˜ç§€çš„JavaScriptä»£ç åº“ï¼ˆæˆ–JavaScriptæ¡†æ¶ï¼‰ã€‚jQueryè®¾è®¡çš„å®—æ—¨æ˜¯â€œwrite Lessï¼ŒDo Moreâ€ï¼Œå³å€¡å¯¼å†™æ›´å°‘çš„ä»£ç ï¼Œåšæ›´å¤šçš„äº‹æƒ…ã€‚å®ƒå°è£…JavaScriptå¸¸ç”¨çš„åŠŸèƒ½ä»£ç ï¼Œæä¾›ä¸€ç§ç®€ä¾¿çš„JavaScriptè®¾è®¡æ¨¡å¼ï¼Œä¼˜åŒ–HTMLæ–‡æ¡£æ“ä½œã€äº‹ä»¶å¤„ç†ã€åŠ¨ç”»è®¾è®¡å’ŒAjaxäº¤äº’ æ€»ç»“æ¥è¯´ä¸ºä¸‹é¢ä¸‰ç‚¹ï¼š jQuery æ˜¯ä¸€ä¸ª JavaScript jQuery æå¤§åœ°ç®€åŒ–äº† JavaScript ç¼–ç¨‹ jQuery å¾ˆå®¹æ˜“å­¦ä¹  ä½¿ç”¨jQueryç¼–å†™HelloWorld ä¸‹è½½jQueryåº“ å¼•å…¥jQuery 12345&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;01-åˆè¯†jQuery&lt;/title&gt; &lt;script src=&quot;js/jquery-1.11.3/jquery.js&quot;&gt;&lt;/script&gt;&lt;/head&gt; ç¼–å†™helloWorld 1234567891011121314151617181920&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;02-jQuery-HelloWorld&lt;/title&gt; &lt;script src=&quot;js/jquery-1.11.3/jquery.js&quot;&gt;&lt;/script&gt; &lt;script&gt; // åŸç”Ÿjsçš„å›ºå®šå†™æ³• window.onload = function(ev) &#123; &#125;; // jQueryçš„å›ºå®šå†™æ³• $(document).ready(function () &#123; alert(&quot;Hello World&quot;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; jQueryå’Œjså…¥å£å‡½æ•°çš„åŒºåˆ«12345678910111213141516171819&lt;script&gt; window.onload = function (ev) &#123; // é€šè¿‡åŸç”Ÿçš„jså…¥å£å‡½æ•°å¯ä»¥æ‹¿åˆ°Domå…ƒç´  var img = document.getElementsByTagName(&quot;img&quot;)[0]; console.log(img); // é€šè¿‡åŸç”Ÿçš„jså…¥å£å‡½æ•°å¯ä»¥æ‹¿åˆ°domå…ƒç´ çš„å®½é«˜ var width = window.getComputedStyle(img).width; console.log(width); &#125;; $(document).ready(function () &#123; // é€šè¿‡jQueryå…¥å£å‡½æ•°å¯ä»¥æ‹¿åˆ°Domå…ƒç´  var $img = $(&quot;img&quot;)[0]; console.log($img); // é€šè¿‡jQueryå…¥å£å‡½æ•°ä¸èƒ½æ‹¿åˆ°domå…ƒç´ çš„å®½é«˜ var $width = $img.width(); console.log($width); &#125;);&lt;/script&gt; åŒºåˆ«: åŸç”ŸjQueryå…¥å£å‡½æ•°çš„åŠ è½½æ¨¡å¼ä¸åŒ åŸç”Ÿjsä¼šç­‰åˆ°domåŠ è½½å®Œæ¯•ï¼Œå¹¶ä¸”å›¾ç‰‡ä¹ŸåŠ è½½å®Œæ¯•æ‰ä¼šæ‰§è¡Œ jQueryä¼šç­‰åˆ°domåŠ è½½å®Œæ¯•ï¼Œä½†ä¸ä¼šç­‰åˆ°å›¾ç‰‡ä¹ŸåŠ è½½å®Œæ¯•å°±ä¼šæ‰§è¡Œ 12345678910111213141516&lt;script&gt; window.onload = function (ev) &#123; alert(&quot;hello cuzz&quot;); // ä¸ä¼šæ˜¾ç¤º &#125;; window.onload = function (ev) &#123; alert(&quot;hello cuxx&quot;); // ä¼šæ˜¾ç¤º &#125;;&lt;/script&gt;&lt;script&gt; $(document).ready(function () &#123; alert(&quot;hello cuzz&quot;); // ä¼šæ˜¾ç¤º &#125;); $(document).ready(function () &#123; alert(&quot;hello cuxx&quot;); // ä¼šæ˜¾ç¤º &#125;);&lt;/script&gt; åŒºåˆ«ï¼š å¤šä¸ªwindow.onloadåªä¼šæ‰§è¡Œä¸€æ¬¡, åé¢çš„ä¼šè¦†ç›–å‰é¢çš„ å¤šä¸ª$(document).ready()ä¼šæ‰§è¡Œå¤šæ¬¡,åé¢çš„ä¸ä¼šè¦†ç›–å‰é¢çš„ åŸå› ï¼šjQueryæ¡†æ¶æœ¬è´¨æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œæ¯æ¬¡æ‰§è¡Œæˆ‘ä»¬éƒ½ä¼šç»™readyå‡½æ•°ä¼ é€’ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œä¸åŒå‡½æ•°å†…éƒ¨çš„æ•°æ®ä¸ä¼šç›¸äº’å¹²æ‰° 1234567891011&lt;script&gt; // ç›¸å½“äºè¿™æ ·å†™ var test1 = function () &#123; alert(&quot;hello cuzz&quot;); &#125; var test2 = function () &#123; alert(&quot;hello cuxx&quot;); &#125; $(document).ready(test1); $(document).ready(test2);&lt;/script&gt; å¯¹æ¯”ï¼š window.onload $(document).ready() æ‰§è¡Œæ—¶æœº å¿…é¡»ç­‰å¾…ç½‘é¡µå…¨éƒ¨åŠ è½½å®Œæ¯•(åŒ…æ‹¬ å›¾ç‰‡ç­‰),ç„¶åå†æ‰§è¡ŒåŒ…è£¹ä»£ç  åªéœ€è¦ç­‰å¾…ç½‘é¡µä¸­çš„DOMç»“æ„ åŠ è½½å®Œæ¯•,å°±èƒ½æ‰§è¡ŒåŒ…è£¹çš„ä»£ç  æ‰§è¡Œæ¬¡æ•° åªèƒ½æ‰§è¡Œä¸€æ¬¡,å¦‚æœç¬¬äºŒæ¬¡,é‚£ä¹ˆ ç¬¬ä¸€æ¬¡çš„æ‰§è¡Œä¼šè¢«è¦†ç›– å¯ä»¥æ‰§è¡Œå¤šæ¬¡,ç¬¬Næ¬¡éƒ½ä¸ä¼šè¢«ä¸Š ä¸€æ¬¡è¦†ç›– ç®€å†™æ–¹æ¡ˆ æ—  $(function () { }); jQueryçš„å››ç§å†™æ³•123456789101112131415161718&lt;script&gt; // ç¬¬ä¸€ç§å†™æ³• $(document).ready(function () &#123; alert(&quot;hello cuzz&quot;); &#125;); // ç¬¬äºŒç§å†™æ³• jQuery(document).ready(function () &#123; alert(&quot;hello cuzz&quot;); &#125;); // ç¬¬ä¸‰ç§å†™æ³• $(function () &#123; alert(&quot;hello cuzz&quot;); &#125;); // ç¬¬å››ç§å†™æ³• jQuery(function () &#123; alert(&quot;hello cuzz&quot;); &#125;);&lt;/script&gt; æ¨èä½¿ç”¨ç¬¬ä¸‰ç§å†™æ³• jQueryçš„æ ¸å¿ƒå‡½æ•° jQuery(callback)ï¼Œå½“domåŠ è½½å®Œæˆä¹‹åæ‰§è¡Œä¼ å…¥çš„å›è°ƒå‡½æ•° 12345&lt;script&gt; $(function () &#123; alert(&quot;123&quot;); &#125;);&lt;/script&gt; jQuery([sel,[context]])ï¼Œæ¥æ”¶ä¸€ä¸ªåŒ…å« CSS é€‰æ‹©å™¨çš„å­—ç¬¦ä¸²ï¼Œç„¶åç”¨è¿™ä¸ªå­—ç¬¦ä¸²å»åŒ¹é…ä¸€ç»„å…ƒç´ ,å¹¶åŒ…è£…æˆjQueryå¯¹è±¡ 1234567891011&lt;script&gt; $(function () &#123; // åˆ©ç”¨jQueryè·å–çš„div,å¾—åˆ°çš„æ˜¯ä¸€ä¸ªjQueryå¯¹è±¡ var $box = $(&quot;div&quot;); console.log($box); // åˆ©ç”¨åŸç”Ÿjsè¯­æ³•è·å–çš„div,å¾—åˆ°çš„æ˜¯ä¸€ä¸ªjså¯¹è±¡ var box = document.getElementsByTagName(&quot;div&quot;); console.log(box); &#125;);&lt;/script&gt; åŸç”ŸJSå¯¹è±¡å’ŒjQueryå¯¹è±¡ç›¸äº’è½¬æ¢ jQuery(html, [ownerDoc]) æ ¹æ® HTML æ ‡è®°å­—ç¬¦ä¸²ï¼ŒåŠ¨æ€åˆ›å»ºDOM å…ƒç´ 123456789&lt;script&gt; $(function () &#123; var $eles = $(&quot;&lt;p&gt;æˆ‘æ˜¯span&lt;/p&gt;&lt;u&gt;æˆ‘æ˜¯u&lt;/u&gt;&quot;); // æ— è®ºæ˜¯jQueryæ‰¾åˆ°çš„è¿˜æ˜¯åˆ›å»ºçš„,æˆ‘ä»¬æœ€ç»ˆæ‹¿åˆ°çš„æ°¸è¿œéƒ½æ˜¯jQueryå¯¹è±¡ console.log($eles); // å°†åˆ›å»ºå¥½çš„DOMå…ƒç´ æ·»åŠ åˆ°bodyä¸­ $(&quot;body&quot;).append($eles); &#125;);&lt;/script&gt; jQueryçš„æœ¬è´¨æ˜¯ä¸€ä¸ªä¼ªæ•°ç»„ï¼Œæœ‰0åˆ°length-1çš„å±æ€§ jQueryé™æ€æ–¹æ³• é™æ€æ–¹æ³• 12345678910111213&lt;script&gt; // å®šä¹‰ä¸€ä¸ªç±» function AClass() &#123; &#125;; // ç»™è¿™ä¸ªç±»æ·»åŠ ä¸€ä¸ªé™æ€æ–¹æ³• AClass.staticMethod = function () &#123; alert(&quot;staticMethod&quot;) &#125;; // é™æ€æ–¹æ³•çš„è°ƒç”¨ AClass.staticMethod();&lt;/script&gt; å®ä¾‹æ–¹æ³• 123456789101112131415&lt;script&gt; // å®šä¹‰ä¸€ä¸ªç±» function AClass() &#123; &#125; // ç»™è¿™ä¸ªç±»æ·»åŠ ä¸€ä¸ªå®ä¾‹æ–¹æ³• AClass.prototype.instanceMethod = function () &#123; alert(&quot;instanceMethod&quot;); &#125; // å®ä¾‹æ–¹æ³•çš„è°ƒç”¨ var a = new AClass(); a.instanceMethod();&lt;/script&gt; å¸¸ç”¨é™æ€æ–¹æ³• $.each(object, [callback]) 1234567891011121314151617181920212223242526272829303132$(function () &#123; // éå†æ•°ç»„ var arr = [1, 3, 5, 7, 9]; // é€šè¿‡åŸç”Ÿæ–¹æ³•éå†æ•°ç»„ // ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å‚æ•°æ˜¯éå†åˆ°çš„å…ƒç´  // ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°å‚æ•°æ˜¯å½“å‰éå†çš„ç´¢å¼• // è¿”å›å€¼: æ²¡æœ‰è¿”å›å€¼ var res = arr.forEach(function (ele, idx) &#123; console.log(idx, ele); &#125;); console.log(res); // é€šè¿‡jQueryé™æ€æ–¹æ³•éå†æ•°ç»„ // ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å‚æ•°æ˜¯å½“å‰éå†çš„ç´¢å¼• // ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°å‚æ•°æ˜¯éå†åˆ°çš„å…ƒç´  // è¿”å›å€¼: è¢«éå†çš„æ•°ç»„ var $res2 = $.each(arr, function (idx, ele) &#123; console.log(idx, ele); &#125;); console.log($res2); // éå†å¯¹è±¡ var obj = &#123;name: &quot;&quot;, age:&quot;33&quot;, gender:&quot;male&quot;&#125;; // jså¯¹è±¡æ²¡æœ‰forEachæ–¹æ³•,æ‰€ä»¥é€šè¿‡forinæ–¹æ³•éå†å¯¹è±¡ for(var key in obj)&#123; console.log(key, obj[key]); &#125; // é€šè¿‡jQueryé™æ€æ–¹æ³•éå†å¯¹è±¡ $.each(obj,function (key, value) &#123; console.log(key, value); &#125;);&#125;); $.holdReady(hold)ï¼Œä¼ å…¥trueæˆ–falseæ¥æš‚åœæˆ–åˆ™æ¢å¤ready()äº‹ä»¶ $.trim(str) å»æ‰å­—ç¬¦ä¸²èµ·å§‹å’Œç»“å°¾çš„ç©ºæ ¼ $.isArray(obj) åˆ¤æ–­æ˜¯å¦æ˜¯æ•°ç»„ $.isFunction(obj)åˆ¤æ–­æ˜¯å¦æ˜¯å‡½æ•° $.isWindow(obj)åˆ¤æ–­æ˜¯å¦æ˜¯windowå¯¹è±¡å­¦ä¹ ç½‘ç«™åœ¨ç½‘ä¸Šï¼Œå‘ç°èœé¸Ÿæ•™ç¨‹æ¯”è¾ƒè¯¦ç»†ï¼Œæ’ç‰ˆä¹Ÿæ¯”è¾ƒå¥½ï¼Œä¸å†æ›´æ–°jQuery]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>jQuery</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythoné›¶åŸºç¡€å…¥é—¨ç¬”è®°]]></title>
    <url>%2F2018%2F01%2F02%2FPython%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[å¤ä¹ æ˜¯ä¸ºäº†æ›´å¥½çš„å­¦ä¹ æ›´æ–°çš„çŸ¥è¯†ã€‚ å­¦ä¹ pythonæœ‰ä¸€å¹´å¤šäº†ï¼Œå¸Œæœ›é€šè¿‡å­¦ä¹ ç¬”è®°æ¥å¤ä¹ äº†ï¼Œä¹Ÿèƒ½è®©åæ¥è€…å°‘èµ°ä¸€ç‚¹å¼¯è·¯ã€‚åœ¨è¯¾ç¨‹ç¬”è®°çš„åŒæ—¶åŠ å…¥äº†ä¸€éƒ¨åˆ†è‡ªå·±çš„ç»éªŒè¡¥å……ã€‚ [âˆš] å»–é›ªå³°è€å¸ˆåœ¨æ…•è¯¾ç½‘çš„è¯¾ç¨‹: Pythonå…¥é—¨ Pythonçš„åˆæ¬¡ä½“éªŒpythonè¯­è¨€ä»‹ç»å…¨ä¸–ç•Œæœ‰å‡ ç™¾ç§ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯æµè¡Œçš„åªæœ‰åå‡ ç§ï¼Œpythonå°±æ˜¯å…¶ä¸­ä¸€ç§ã€‚è·å…°äººé¾Ÿå”äº1989å¹´åœ£è¯èŠ‚åˆ›ç«‹ã€‚ ç‰¹ç‚¹ï¼šä¼˜é›…ï¼Œæ˜ç¡®ï¼Œç®€å•ã€‚ é€‚åˆçš„é¢†åŸŸï¼š webç½‘ç«™å’Œå„ç§ç½‘ç»œæœåŠ¡ï¼› ç³»ç»Ÿå·¥å…·å’Œè„šæœ¬ï¼› ä½œä¸ºèƒ¶æ°´è¯­è¨€æŠŠå…¶ä»–è¯­è¨€å¼€å‘çš„æ¨¡å—åŒ…è£…èµ·æ¥æ–¹ä¾¿ä½¿ç”¨ã€‚ Pythonæ˜¯ä¸€é—¨é«˜çº§è¯­è¨€ï¼Œæ‰€ä»¥ä¸é€‚åˆè´´è¿‘ç¡¬ä»¶çš„ä»£ç : æ¯”å¦‚é©±åŠ¨ç¨‹åºï¼ˆé¦–é€‰Cï¼‰ ç§»åŠ¨å¼€å‘ï¼Œæœ‰å„è‡ªçš„è¯­è¨€ï¼Œï¼ˆobjectCï¼Œswift/javaï¼‰ æ¸¸æˆå¼€å‘ï¼ˆé¦–é€‰C/C++ï¼‰ã€‚ Pythonå®é™…åº”ç”¨ï¼š YouTubeï¼Œè±†ç“£ï¼Œæœç‹é‚®ç®±ï¼›Openstackå¼€æºäº‘è®¡ç®—å¹³å°ã€‚Googleï¼ŒYahooï¼ŒNASAã€‚ è¯­è¨€ä¹‹é—´çš„å¯¹æ¯”ï¼š Cç¼–è¯‘ä¸ºæœºå™¨ç ï¼›JAVAç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼›pythonä¸ºè§£é‡Šæ‰§è¡Œã€‚ ç¼ºç‚¹ï¼š è¿è¡Œæ…¢ï¼ŒPythonæºç ä¸èƒ½åŠ å¯†ã€‚ Pythonç‰ˆæœ¬çš„é€‰æ‹©åšä¸»å»ºè®®é€‰æ‹©å®‰è£…ç¯å¢ƒç¯‡çš„è¿›é˜¶ç‰ˆï¼š2.7ç‰ˆæœ¬ä¸3.xç‰ˆæœ¬å…±å­˜ã€‚ 3.xç‰ˆæœ¬å»ºè®®é€‰æ‹©Python 3.5.1 |Anaconda 4.1.0 (64-bit)ä»¥åå¦‚æœè¦ä½¿ç”¨pythonè¿›è¡ŒTensorFlow windowsç‰ˆçš„é…ç½®å¯ä»¥çœä¸‹æ—¶é—´ã€‚ windowsä¸‹å®‰è£…pythonå‚è€ƒï¼šæ­å»ºPythonå¼€å‘ç¯å¢ƒ ç¬¬ä¸€ä¸ªpythonç¨‹åºcmdä¸‹è¾“å…¥pythonã€‚è¿›å…¥äº¤äº’å¼ç¯å¢ƒã€‚ å‘½ä»¤è¡Œæ¨¡å¼å¯åŠ¨python:python å‘½ä»¤è¡Œæ¨¡å¼æ‰§è¡Œpythonæ–‡ä»¶python ç›®å½•/xxx.py å‘½ä»¤è¡Œæ¨¡å¼å…³é—­pythonï¼šexit() æ³¨æ„ï¼šä¸è¦ä½¿ç”¨wordï¼Œæˆ–è€…windowsä¸‹è‡ªå¸¦çš„è®°äº‹æœ¬æ¥è¿›è¡Œä»£ç ç¼–å†™ã€‚ æ¨èä½¿ç”¨ï¼š è½»é‡çº§ï¼šsublime Text æˆ– editplus é‡é‡çº§(è¾ƒå¤§å·¥ç¨‹) : pycharm Professional 2.7ç‰ˆæœ¬ä¸“å±ï¼š print &#39;hello,world!&#39; 3.xç‰ˆæœ¬(2.7ç‰ˆæœ¬ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œ)ï¼š print (&quot;hello,world!&quot;) Pythonå˜é‡å’Œæ•°æ®ç±»å‹ è®²è§£PythonåŸºæœ¬çš„æ•°æ®ç±»å‹.åŒ…æ‹¬æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”ç±»å‹ï¼Œä»¥åŠå˜é‡çš„æ¦‚å¿µå’ŒåŸºæœ¬çš„æ•°æ®è¿ç®—ã€‚ æ•°æ®ç±»å‹æ•´æ•°åœ¨Pythonç¨‹åºä¸­ï¼Œæ•´æ•°çš„è¡¨ç¤ºæ–¹æ³•å’Œæ•°å­¦ä¸Šçš„å†™æ³•ä¸€æ¨¡ä¸€æ ·. ä¾‹å¦‚ï¼š1ï¼Œ100ï¼Œ-8080ï¼Œ0ï¼Œç­‰ç­‰ã€‚åå…­è¿›åˆ¶ç”¨0xå‰ç¼€å’Œ0-9ï¼Œa-fè¡¨ç¤º. ä¾‹å¦‚ï¼š0xff00ï¼Œ0xa5b4c3d2ï¼Œç­‰ç­‰ã€‚ æµ®ç‚¹æ•°æµ®ç‚¹æ•°ä¹Ÿå°±æ˜¯å°æ•°ï¼Œä¹‹æ‰€ä»¥ç§°ä¸ºæµ®ç‚¹æ•°: å› ä¸ºæŒ‰ç…§ç§‘å­¦è®°æ•°æ³•è¡¨ç¤ºæ—¶ï¼Œä¸€ä¸ªæµ®ç‚¹æ•°çš„å°æ•°ç‚¹ä½ç½®æ˜¯å¯å˜çš„ æ¯”å¦‚ï¼Œ1.23x10^9å’Œ12.3x10^8æ˜¯ç›¸ç­‰çš„ã€‚ æµ®ç‚¹æ•°å¯ä»¥ç”¨æ•°å­¦å†™æ³•: å¦‚1.23ï¼Œ3.14ï¼Œ-9.01ï¼Œç­‰ç­‰ã€‚ä½†æ˜¯å¯¹äºå¾ˆå¤§æˆ–å¾ˆå°çš„æµ®ç‚¹æ•°ï¼Œå°±å¿…é¡»ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼ŒæŠŠ10ç”¨eæ›¿ä»£ï¼Œ1.23x10^9å°±æ˜¯1.23e9ï¼Œæˆ–è€…12.3e8ï¼Œ0.000012å¯ä»¥å†™æˆ1.2e-5ï¼Œç­‰ç­‰ã€‚ æ•´æ•°å’Œæµ®ç‚¹æ•°åœ¨è®¡ç®—æœºå†…éƒ¨å­˜å‚¨çš„æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œæ•´æ•°è¿ç®—æ°¸è¿œæ˜¯ç²¾ç¡®çš„ï¼ˆé™¤æ³•éš¾é“ä¹Ÿæ˜¯ç²¾ç¡®çš„ï¼Ÿæ˜¯çš„ï¼ï¼‰ï¼Œè€Œæµ®ç‚¹æ•°è¿ç®—åˆ™å¯èƒ½ä¼šæœ‰å››èˆäº”å…¥çš„è¯¯å·®ã€‚ çŸ¥è¯†ç‚¹ï¼špython2ä¸3ä¸åŒæ•´é™¤ python2.7ä¸‹ï¼š/ å’Œ // éƒ½æ˜¯æ•´æ•°é™¤æ³•ã€‚ ä¾‹: 1/2ç»“æœä¸º0.åé¢å°æ•°éƒ¨åˆ†ä¼šç›´æ¥å»é™¤æ‰ã€‚ python3.xä¸‹ï¼š / ä¸ºæµ®ç‚¹æ•°é™¤æ³•(å¦‚ï¼š1/2=0.5) //ä¸ºæ•´æ•°é™¤æ³•(å¦‚: 1//2 = 0ï¼‰ 12345a = 1 b = 2print a+b#python2.7ä¸‹æƒ³è¦æµ®ç‚¹æ•°é™¤æ³•å°±å¾—ä½¿ç”¨ç±»å‹è½¬æ¢ã€‚print float(a)/b å­—ç¬¦ä¸²å­—ç¬¦ä¸²æ˜¯ä»¥â€™â€™æˆ–â€â€æ‹¬èµ·æ¥çš„ä»»æ„æ–‡æœ¬ï¼Œæ¯”å¦‚â€™abcâ€™ï¼Œâ€xyzâ€ç­‰ç­‰ã€‚è¯·æ³¨æ„ï¼Œâ€™â€™æˆ–â€â€æœ¬èº«åªæ˜¯ä¸€ç§è¡¨ç¤ºæ–¹å¼ï¼Œä¸æ˜¯å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†. å› æ­¤ï¼Œå­—ç¬¦ä¸²â€™abcâ€™åªæœ‰aï¼Œbï¼Œcè¿™3ä¸ªå­—ç¬¦ã€‚ å¸ƒå°”å€¼å¸ƒå°”å€¼å’Œå¸ƒå°”ä»£æ•°çš„è¡¨ç¤ºå®Œå…¨ä¸€è‡´ï¼Œä¸€ä¸ªå¸ƒå°”å€¼åªæœ‰Trueã€Falseä¸¤ç§å€¼ï¼Œè¦ä¹ˆæ˜¯Trueï¼Œè¦ä¹ˆæ˜¯Falseï¼Œåœ¨Pythonä¸­ï¼Œå¯ä»¥ç›´æ¥ç”¨Trueã€Falseè¡¨ç¤ºå¸ƒå°”å€¼ï¼ˆè¯·æ³¨æ„å¤§å°å†™ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¸ƒå°”è¿ç®—è®¡ç®—å‡ºæ¥ã€‚ å¸ƒå°”å€¼å¯ä»¥ç”¨andã€orå’Œnotè¿ç®—ã€‚ andè¿ç®—æ˜¯ä¸è¿ç®—ï¼Œåªæœ‰æ‰€æœ‰éƒ½ä¸º Trueï¼Œandè¿ç®—ç»“æœæ‰æ˜¯ Trueã€‚ orè¿ç®—æ˜¯æˆ–è¿ç®—ï¼Œåªè¦å…¶ä¸­æœ‰ä¸€ä¸ªä¸º Trueï¼Œor è¿ç®—ç»“æœå°±æ˜¯ Trueã€‚ notè¿ç®—æ˜¯éè¿ç®—ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ç›®è¿ç®—ç¬¦ï¼ŒæŠŠ True å˜æˆ Falseï¼ŒFalse å˜æˆ Trueã€‚ ç©ºå€¼ç©ºå€¼æ˜¯Pythoné‡Œä¸€ä¸ªç‰¹æ®Šçš„å€¼ï¼Œç”¨Noneè¡¨ç¤ºã€‚ Noneä¸èƒ½ç†è§£ä¸º0ï¼Œå› ä¸º0æ˜¯æœ‰æ„ä¹‰çš„ï¼Œè€ŒNoneæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå€¼ã€‚ ç¼–ç¨‹å°ä»»åŠ¡ï¼š è®¡ç®—åè¿›åˆ¶æ•´æ•° 45678 å’Œåå…­è¿›åˆ¶æ•´æ•° 0x12fd2 ä¹‹å’Œã€‚ è¯·ç”¨å­—ç¬¦ä¸²è¡¨ç¤ºå‡ºLearn Python in imoocã€‚ è¯·è®¡ç®—ä»¥ä¸‹è¡¨è¾¾å¼çš„å¸ƒå°”å€¼ï¼ˆæ³¨æ„==è¡¨ç¤ºåˆ¤æ–­æ˜¯å¦ç›¸ç­‰ï¼‰ï¼š12100 &lt; 990xff == 255 é¢˜ç›®ç­”æ¡ˆï¼š 1234print 45678+0x12fd2print "Learn Python in imooc" print 100&lt;99 print 0xff == 255 è¿è¡Œç»“æœï¼š 1234123456Learn Python in imoocFalseTrue printè¯­å¥printè¯­å¥å¯ä»¥å‘å±å¹•ä¸Šè¾“å‡ºæŒ‡å®šçš„æ–‡å­—ã€‚æ¯”å¦‚è¾“å‡ºâ€™hello, worldâ€™ï¼Œç”¨ä»£ç å®ç°å¦‚ä¸‹ï¼š 1print 'hello, world' æ³¨æ„ï¼š å½“æˆ‘ä»¬åœ¨Pythonäº¤äº’å¼ç¯å¢ƒä¸‹ç¼–å†™ä»£ç æ—¶ï¼Œ&gt;&gt;&gt;æ˜¯Pythonè§£é‡Šå™¨çš„æç¤ºç¬¦ï¼Œä¸æ˜¯ä»£ç çš„ä¸€éƒ¨åˆ†ã€‚ å½“æˆ‘ä»¬åœ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­ç¼–å†™ä»£ç æ—¶ï¼Œåƒä¸‡ä¸è¦è‡ªå·±æ·»åŠ  &gt;&gt;&gt;ã€‚ printè¯­å¥ä¹Ÿå¯ä»¥è·Ÿä¸Šå¤šä¸ªå­—ç¬¦ä¸²ï¼Œç”¨é€—å·,éš”å¼€ï¼Œå°±å¯ä»¥è¿æˆä¸€ä¸²è¾“å‡ºï¼š 1print 'The quick brown fox', 'jumps over', 'the lazy dog' è¿è¡Œç»“æœï¼š 1The quick brown fox jumps over the lazy dog printä¼šä¾æ¬¡æ‰“å°æ¯ä¸ªå­—ç¬¦ä¸²ï¼ŒçŸ¥è¯†ç‚¹ï¼šé‡åˆ°é€—å·,ä¼šè¾“å‡ºä¸€ä¸ªç©ºæ ¼. printä¹Ÿå¯ä»¥æ‰“å°æ•´æ•°ï¼Œæˆ–è€…è®¡ç®—ç»“æœï¼š 1234&gt;&gt;&gt; print 300300 #è¿è¡Œç»“æœ&gt;&gt;&gt; print 100 + 200300 #è¿è¡Œç»“æœ æ¼‚äº®åšæ³•ï¼š 12&gt;&gt;&gt; print '100 + 200 =', 100 + 200100 + 200 = 300 #è¿è¡Œç»“æœ æ³¨æ„: å¯¹äº100 + 200ï¼ŒPythonè§£é‡Šå™¨è‡ªåŠ¨è®¡ç®—å‡ºç»“æœ300.ä½†æ˜¯ï¼Œâ€™100 + 200 =â€™æ˜¯å­—ç¬¦ä¸²è€Œéæ•°å­¦å…¬å¼ï¼ŒPythonæŠŠå®ƒè§†ä¸ºå­—ç¬¦ä¸². ç¼–ç¨‹ä»»åŠ¡ï¼šè¯·ç”¨ä¸¤ç§æ–¹å¼æ‰“å°å‡º hello, python.å®ç°ä»£ç ï¼š 123#input codeprint 'hello, python.'print 'hello,','python.' è¿è¡Œç»“æœï¼š 12hello, python.hello, python. æ³¨é‡ŠPythonçš„æ³¨é‡Šä»¥#å¼€å¤´ï¼Œåé¢çš„æ–‡å­—ç›´åˆ°è¡Œå°¾éƒ½ç®—æ³¨é‡Š 12345# è¿™ä¸€è¡Œå…¨éƒ¨éƒ½æ˜¯æ³¨é‡Š...print 'hello' # è¿™ä¹Ÿæ˜¯æ³¨é‡Š# æš‚æ—¶ä¸æƒ³è¿è¡Œä¸‹é¢ä¸€è¡Œä»£ç :# print 'hello, python.' æ³¨é‡Šè¿˜æœ‰ä¸€ä¸ªå·§å¦™çš„ç”¨é€”ï¼Œå°±æ˜¯ä¸€äº›ä»£ç æˆ‘ä»¬ä¸æƒ³è¿è¡Œï¼Œä½†åˆä¸æƒ³åˆ é™¤ï¼Œå°±å¯ä»¥ç”¨æ³¨é‡Šæš‚æ—¶å±è”½æ‰ï¼š ç¼–ç¨‹ä»»åŠ¡:å°†ä»£ç ç¼–è¾‘å™¨ä¸­çš„ â€œprint â€˜helloâ€™â€ è¯­å¥ä¿®æ”¹æˆæ³¨é‡Šè¯­å¥ å®ç°ä»£ç ï¼š 1# print 'hello' æ³¨é‡Šï¼šå¤šè¡Œæ³¨é‡Š1234'''ä¸‹é¢æ˜¯ä¸€è¡Œè¢«æ³¨é‡Šä»£ç ä¸‹é¢æ˜¯ä¸¤è¡Œè¢«æ³¨é‡Šä»£ç ''' ä»€ä¹ˆæ˜¯å˜é‡åœ¨Pythonä¸­ï¼Œå˜é‡çš„æ¦‚å¿µåŸºæœ¬ä¸Šå’Œåˆä¸­ä»£æ•°çš„æ–¹ç¨‹å˜é‡æ˜¯ä¸€è‡´çš„ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºæ–¹ç¨‹å¼y=x*x ï¼Œxå°±æ˜¯å˜é‡ã€‚ å½“x=2æ—¶ï¼Œè®¡ç®—ç»“æœæ˜¯4ã€‚å½“x=5æ—¶ï¼Œè®¡ç®—ç»“æœæ˜¯25ã€‚ åªæ˜¯åœ¨è®¡ç®—æœºç¨‹åºä¸­ï¼Œå˜é‡ä¸ä»…å¯ä»¥æ˜¯æ•°å­—ï¼Œè¿˜å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹ã€‚ åœ¨Pythonç¨‹åºä¸­ï¼Œå˜é‡æ˜¯ç”¨ä¸€ä¸ªå˜é‡åè¡¨ç¤ºã€‚ çŸ¥è¯†ç‚¹ï¼šå˜é‡åå¿…é¡»æ˜¯å¤§å°å†™è‹±æ–‡ã€æ•°å­—å’Œä¸‹åˆ’çº¿ _ çš„ç»„åˆï¼Œä¸”ä¸èƒ½ç”¨æ•°å­—å¼€å¤´ã€‚æ¯”å¦‚ï¼š 12a = 1t_007 = 'T007' å˜é‡aæ˜¯ä¸€ä¸ªæ•´æ•°ã€‚å˜é‡t_007æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ åœ¨Pythonä¸­ï¼Œç­‰å·=æ˜¯èµ‹å€¼è¯­å¥ï¼Œå¯ä»¥æŠŠä»»æ„æ•°æ®ç±»å‹èµ‹å€¼ç»™å˜é‡ï¼ŒåŒä¸€ä¸ªå˜é‡å¯ä»¥åå¤èµ‹å€¼ï¼Œè€Œä¸”å¯ä»¥æ˜¯ä¸åŒç±»å‹çš„å˜é‡ï¼Œä¾‹å¦‚ï¼š 1234a = 123 # aæ˜¯æ•´æ•°print aa = 'imooc' # aå˜ä¸ºå­—ç¬¦ä¸²print a çŸ¥è¯†ç‚¹: è¿™ç§å˜é‡æœ¬èº«ç±»å‹ä¸å›ºå®šçš„è¯­è¨€ç§°ä¹‹ä¸ºåŠ¨æ€è¯­è¨€ï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯é™æ€è¯­è¨€ã€‚ é™æ€è¯­è¨€åœ¨å®šä¹‰å˜é‡æ—¶å¿…é¡»æŒ‡å®šå˜é‡ç±»å‹ï¼Œå¦‚æœèµ‹å€¼çš„æ—¶å€™ç±»å‹ä¸åŒ¹é…ï¼Œå°±ä¼šæŠ¥é”™ã€‚ä¾‹å¦‚Javaæ˜¯é™æ€è¯­è¨€ï¼Œèµ‹å€¼è¯­å¥å¦‚ä¸‹ï¼ˆ// è¡¨ç¤ºæ³¨é‡Šï¼‰ï¼š 123//è¿™äº›æ˜¯javaä»£ç int a = 123; // aæ˜¯æ•´æ•°ç±»å‹å˜é‡a = "mooc"; // é”™è¯¯ï¼šä¸èƒ½æŠŠå­—ç¬¦ä¸²èµ‹ç»™æ•´å‹å˜é‡ å’Œé™æ€è¯­è¨€ç›¸æ¯”ï¼ŒåŠ¨æ€è¯­è¨€æ›´çµæ´»ï¼Œå°±æ˜¯è¿™ä¸ªåŸå› ã€‚è¯·ä¸è¦æŠŠèµ‹å€¼è¯­å¥çš„ç­‰å·ç­‰åŒäºæ•°å­¦çš„ç­‰å·ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š 12x = 10x = x + 2 å¦‚æœä»æ•°å­¦ä¸Šç†è§£x = x + 2é‚£æ— è®ºå¦‚ä½•æ˜¯ä¸æˆç«‹çš„. åœ¨ç¨‹åºä¸­ï¼Œèµ‹å€¼è¯­å¥å…ˆè®¡ç®—å³ä¾§çš„è¡¨è¾¾å¼x + 2ï¼Œå¾—åˆ°ç»“æœ12ï¼Œå†èµ‹ç»™å˜é‡xã€‚ç”±äºxä¹‹å‰çš„å€¼æ˜¯10ï¼Œé‡æ–°èµ‹å€¼åï¼Œxçš„å€¼å˜æˆ12ã€‚ æœ€åï¼ŒçŸ¥è¯†ç‚¹: ç†è§£å˜é‡åœ¨è®¡ç®—æœºå†…å­˜ä¸­çš„è¡¨ç¤ºä¹Ÿéå¸¸é‡è¦ã€‚å½“æˆ‘ä»¬å†™ï¼ša = â€˜ABCâ€™æ—¶ï¼ŒPythonè§£é‡Šå™¨å¹²äº†ä¸¤ä»¶äº‹æƒ…ï¼š åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªâ€™ABCâ€™çš„å­—ç¬¦ä¸²ï¼› åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªåä¸ºaçš„å˜é‡ï¼Œå¹¶æŠŠå®ƒæŒ‡å‘â€™ABCâ€™ã€‚ ä¹Ÿå¯ä»¥æŠŠä¸€ä¸ªå˜é‡aèµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡bï¼Œè¿™ä¸ªæ“ä½œå®é™…ä¸Šæ˜¯æŠŠå˜é‡bæŒ‡å‘å˜é‡aæ‰€æŒ‡å‘çš„æ•°æ®ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š 1234a = 'ABC'b = aa = 'XYZ'print b æœ€åä¸€è¡Œæ‰“å°å‡ºå˜é‡bçš„å†…å®¹åˆ°åº•æ˜¯â€™ABCâ€™å‘¢è¿˜æ˜¯â€™XYZâ€™ï¼Ÿå¦‚æœä»æ•°å­¦æ„ä¹‰ä¸Šç†è§£ï¼Œå°±ä¼šé”™è¯¯åœ°å¾—å‡ºbå’Œaç›¸åŒï¼Œä¹Ÿåº”è¯¥æ˜¯â€™XYZâ€™ï¼Œä½†å®é™…ä¸Šbçš„å€¼æ˜¯â€™ABCâ€™ï¼Œè®©æˆ‘ä»¬ä¸€è¡Œä¸€è¡Œåœ°æ‰§è¡Œä»£ç ï¼Œå°±å¯ä»¥çœ‹åˆ°åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼š æ‰§è¡Œa = &#39;ABC&#39;ï¼Œè§£é‡Šå™¨åˆ›å»ºäº†å­—ç¬¦ä¸² &#39;ABC&#39;å’Œå˜é‡ aï¼Œå¹¶æŠŠaæŒ‡å‘ &#39;ABC&#39;ï¼š æ‰§è¡Œb = aï¼Œè§£é‡Šå™¨åˆ›å»ºäº†å˜é‡ bï¼Œå¹¶æŠŠbæŒ‡å‘ a æŒ‡å‘çš„å­—ç¬¦ä¸²&#39;ABC&#39;ï¼š æ‰§è¡Œa = &#39;XYZ&#39;ï¼Œè§£é‡Šå™¨åˆ›å»ºäº†å­—ç¬¦ä¸²&#39;XYZ&#39;ï¼Œå¹¶æŠŠaçš„æŒ‡å‘æ”¹ä¸ºâ€™XYZâ€™ï¼Œä½†bå¹¶æ²¡æœ‰æ›´æ”¹ï¼š æ‰€ä»¥ï¼Œæœ€åæ‰“å°å˜é‡bçš„ç»“æœè‡ªç„¶æ˜¯â€™ABCâ€™äº†ã€‚ ç¼–ç¨‹ä»»åŠ¡ï¼š ç­‰å·®æ•°åˆ—å¯ä»¥å®šä¹‰ä¸ºæ¯ä¸€é¡¹ä¸å®ƒçš„å‰ä¸€é¡¹çš„å·®ç­‰äºä¸€ä¸ªå¸¸æ•°ï¼Œå¯ä»¥ç”¨å˜é‡ x1 è¡¨ç¤ºç­‰å·®æ•°åˆ—çš„ç¬¬ä¸€é¡¹ï¼Œç”¨ d è¡¨ç¤ºå…¬å·®ï¼Œè¯·è®¡ç®—æ•°åˆ— 1 4 7 10 13 16 19 â€¦ å‰ 100 é¡¹çš„å’Œã€‚ å®ç°ä»£ç : 1234567x1 = 1d = 3n = 100x100 = x1+(100-1)*ds2 = (x1+x100)*100/2s = n*x1+n*(n-1)*d/2print s,s2 ç­‰å·®æ•°åˆ—å…¬å¼ï¼š ï¼ˆé¦–é¡¹+å°¾é¡¹ï¼‰*é¡¹æ•°/2 é¡¹æ•°*é¦–é¡¹+é¡¹æ•°*(é¡¹æ•°-1)*å…¬å·®/2 è¿è¡Œç»“æœï¼š 114950 14950 å®šä¹‰å­—ç¬¦ä¸²å­—ç¬¦ä¸²å¯ä»¥ç”¨&#39;&#39;æˆ–è€…&quot;&quot;æ‹¬èµ·æ¥è¡¨ç¤ºã€‚ å¦‚æœå­—ç¬¦ä¸²æœ¬èº«åŒ…å«&#39;æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚æˆ‘ä»¬è¦è¡¨ç¤ºå­—ç¬¦ä¸² I&#39;m OKï¼Œè¿™æ—¶ï¼Œå¯ä»¥ç”¨&quot; &quot;æ‹¬èµ·æ¥è¡¨ç¤ºï¼š 12"I'm OK"'Learn "Python" in imooc' ç±»ä¼¼çš„ï¼ŒçŸ¥è¯†ç‚¹: å¦‚æœå­—ç¬¦ä¸²åŒ…å«&quot;ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨&#39; &#39;æ‹¬èµ·æ¥è¡¨ç¤ºï¼š å¦‚æœå­—ç¬¦ä¸²æ—¢åŒ…å«&#39;åˆåŒ…å«&quot;æ€ä¹ˆåŠï¼Ÿ çŸ¥è¯†ç‚¹ï¼šè½¬ä¹‰ è¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦å¯¹å­—ç¬¦ä¸²çš„æŸäº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼ŒPythonå­—ç¬¦ä¸²ç”¨\è¿›è¡Œè½¬ä¹‰ã€‚ è¦è¡¨ç¤ºå­—ç¬¦ä¸² Bob said &quot;I&#39;m OK&quot;.ç”±äº &#39; å’Œ&quot;ä¼šå¼•èµ·æ­§ä¹‰ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åœ¨å®ƒå‰é¢æ’å…¥ä¸€ä¸ª\è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ™®é€šå­—ç¬¦ï¼Œä¸ä»£è¡¨å­—ç¬¦ä¸²çš„èµ·å§‹ï¼Œå› æ­¤ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²åˆå¯ä»¥è¡¨ç¤ºä¸º 12'Bob said \"I\'m OK\".'# åœ¨è¦ä¿ç•™åŸçŠ¶çš„å­—ç¬¦ä¸²å‰é¢åŠ ä¸Šå³æ–œæ  æ³¨æ„ï¼šè½¬ä¹‰å­—ç¬¦ \ä¸è®¡å…¥å­—ç¬¦ä¸²çš„å†…å®¹ä¸­ã€‚ å¸¸ç”¨çš„è½¬ä¹‰å­—ç¬¦è¿˜æœ‰ï¼š \nè¡¨ç¤ºæ¢è¡Œ \t è¡¨ç¤ºä¸€ä¸ªåˆ¶è¡¨ç¬¦ \\ è¡¨ç¤º \ å­—ç¬¦æœ¬èº« ç¼–ç¨‹ä»»åŠ¡ï¼š è¯·å°†ä¸‹é¢ä¸¤è¡Œå†…å®¹ç”¨Pythonçš„å­—ç¬¦ä¸²è¡¨ç¤ºå¹¶æ‰“å°å‡ºæ¥ï¼š 12 Python was started in 1989 by &quot;Guido&quot;. Python is free and easy to learn. 12s = 'Python was started in 1989 by"Guido".\nPython is free and easy to learn.'print s rawå­—ç¬¦ä¸²ä¸å¤šè¡Œå­—ç¬¦ä¸²å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²åŒ…å«å¾ˆå¤šéœ€è¦è½¬ä¹‰çš„å­—ç¬¦ï¼Œå¯¹æ¯ä¸€ä¸ªå­—ç¬¦éƒ½è¿›è¡Œè½¬ä¹‰ä¼šå¾ˆéº»çƒ¦ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å­—ç¬¦ä¸²å‰é¢åŠ ä¸ªå‰ç¼€ r ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª raw å­—ç¬¦ä¸²ï¼Œé‡Œé¢çš„å­—ç¬¦å°±ä¸éœ€è¦è½¬ä¹‰äº†ã€‚ä¾‹å¦‚ï¼š 1r'\(~_~)/ \(~_~)/' è§£é‡Šï¼š è¿™ä¸ªä¾‹å­ä¸¾å¾—ä¸æ˜¯å¾ˆå¥½ã€‚å¯ä»¥çœ‹å‡ºrawåŠ ä¸Šä¹‹åã€‚å¯èƒ½äº§ç”Ÿè¯¯ä¼šçš„\è¢«ä¿®æ”¹ä¸º\\(\\ è¡¨ç¤º \ å­—ç¬¦æœ¬èº«) ä¸åŠ ä¸Šr åªæœ‰\å’Œ(å¹¶æ²¡æœ‰åˆæˆè½¬ä¹‰å­—ç¬¦ã€‚ åŠ ä¸Šrã€‚\éœ€è¦è¢«è½¬ä¹‰ï¼Œç»è¿‡è½¬ä¹‰åæ˜¾ç¤ºå‡ºæ¥è¿˜æ˜¯è‡ªå·±ã€‚ çŸ¥è¯†ç‚¹: ä¸ªäººå°é¢˜(rçš„å¼ºå¤§ä½œç”¨) ä¸Šå›¾æ•ˆæœå¯ä»¥çœ‹å‡ºrçš„å¼ºå¤§ä½œç”¨ã€‚ ä½†æ˜¯r&#39;æˆ‘æ˜¯ä¸€æ®µå­—ç¬¦&#39;è¡¨ç¤ºæ³•ä¸èƒ½è¡¨ç¤ºå¤šè¡Œå­—ç¬¦ä¸²(r&#39;&#39;&#39;ä¸€æ®µå­—ç¬¦&#39;&#39;&#39;)ï¼Œä¹Ÿä¸èƒ½è¡¨ç¤ºåŒ…å«&#39;å’Œ &quot;çš„å­—ç¬¦ä¸²ï¼ˆä¸ºä»€ä¹ˆï¼Ÿï¼‰ å› ä¸ºå¦‚æœr&#39;mtian&#39;yan&#39; ré‡åˆ°å·¦è¾¹ç¬¬ä¸€ä¸ª&#39;,ä¼šç»§ç»­å¾€åæ‰¾é—­åˆçš„æ ‡å¿—&#39;ç„¶åæ‰¾åˆ°mtiançš„åœ°æ–¹ã€‚å®ƒä»»åŠ¡ç»“æŸäº†ã€‚ä»£ç ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å½“æ‰«åˆ°yanè¿™é‡Œä»–å°±ä¼šæŠ¥é”™ã€‚ ???(æ›´æ·±å±‚å¾…ç»­) æˆ–è€…r&quot;mtian&quot;yan&quot; æˆ–å¯¼è‡´ræå‰ç»“æŸæ‰ã€‚åé¢çš„å°±æ— æ³•ç»§ç»­åŒ¹é…åˆ°å¯¹åº”çš„ã€‚ çŸ¥è¯†ç‚¹: å¤šè¡Œå­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨&#39;&#39;&#39;...&#39;&#39;&#39;è¡¨ç¤ºï¼š 12345'''Line 1Line 2Line 3'''#ä¸Šé¢è¿™ä¸ªå­—ç¬¦ä¸²çš„è¡¨ç¤ºæ–¹æ³•å’Œä¸‹é¢çš„æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼š'Line 1\nLine 2\nLine 3' è¿˜å¯ä»¥åœ¨å¤šè¡Œå­—ç¬¦ä¸²å‰é¢æ·»åŠ  r ï¼ŒæŠŠè¿™ä¸ªå¤šè¡Œå­—ç¬¦ä¸²ä¹Ÿå˜æˆä¸€ä¸ªrawå­—ç¬¦ä¸²ï¼š 123r'''Python is created by "Guido".It is free and easy to learn.Let's start learn Python in imooc!''' ç¼–ç¨‹ä»»åŠ¡ï¼šè¯·æŠŠä¸‹é¢çš„å­—ç¬¦ä¸²ç”¨r&#39;&#39;&#39;...&#39;&#39;&#39;çš„å½¢å¼æ”¹å†™ï¼Œå¹¶ç”¨printæ‰“å°å‡ºæ¥ï¼š 1&apos;\&quot;To be, or not to be\&quot;: that is the question.\nWhether it\&apos;s nobler in the mind to suffer.&apos; 12print r'''"To be,or not to be":that is the question.Whether it's nobler in the mind to suffer.''' çŸ¥è¯†ç‚¹: Unicodeå­—ç¬¦ä¸²å­—ç¬¦ä¸²è¿˜æœ‰ä¸€ä¸ªç¼–ç é—®é¢˜ã€‚ å› ä¸ºè®¡ç®—æœºåªèƒ½å¤„ç†æ•°å­—ï¼Œå¦‚æœè¦å¤„ç†æ–‡æœ¬ï¼Œå°±å¿…é¡»å…ˆæŠŠæ–‡æœ¬è½¬æ¢ä¸ºæ•°å­—æ‰èƒ½å¤„ç†ã€‚æœ€æ—©çš„è®¡ç®—æœºåœ¨è®¾è®¡æ—¶é‡‡ç”¨8ä¸ªæ¯”ç‰¹ï¼ˆbitï¼‰ä½œä¸ºä¸€ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªå­—èŠ‚èƒ½è¡¨ç¤ºçš„æœ€å¤§çš„æ•´æ•°å°±æ˜¯255ï¼ˆäºŒè¿›åˆ¶11111111=åè¿›åˆ¶255ï¼‰ï¼Œ0 - 255è¢«ç”¨æ¥è¡¨ç¤ºå¤§å°å†™è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸€äº›ç¬¦å·ï¼Œè¿™ä¸ªç¼–ç è¡¨è¢«ç§°ä¸ºASCIIç¼–ç ï¼Œæ¯”å¦‚å¤§å†™å­—æ¯ A çš„ç¼–ç æ˜¯65ï¼Œå°å†™å­—æ¯ z çš„ç¼–ç æ˜¯122ã€‚ å¦‚æœè¦è¡¨ç¤ºä¸­æ–‡ï¼Œæ˜¾ç„¶ä¸€ä¸ªå­—èŠ‚æ˜¯ä¸å¤Ÿçš„ï¼Œè‡³å°‘éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œè€Œä¸”è¿˜ä¸èƒ½å’ŒASCIIç¼–ç å†²çªï¼Œæ‰€ä»¥ï¼Œä¸­å›½åˆ¶å®šäº†GB2312ç¼–ç ï¼Œç”¨æ¥æŠŠä¸­æ–‡ç¼–è¿›å»ã€‚ ç±»ä¼¼çš„ï¼Œæ—¥æ–‡å’ŒéŸ©æ–‡ç­‰å…¶ä»–è¯­è¨€ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ã€‚ä¸ºäº†ç»Ÿä¸€æ‰€æœ‰æ–‡å­—çš„ç¼–ç ï¼ŒUnicodeåº”è¿è€Œç”Ÿã€‚UnicodeæŠŠæ‰€æœ‰è¯­è¨€éƒ½ç»Ÿä¸€åˆ°ä¸€å¥—ç¼–ç é‡Œï¼Œè¿™æ ·å°±ä¸ä¼šå†æœ‰ä¹±ç é—®é¢˜äº†ã€‚ Unicodeé€šå¸¸ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼ŒåŸæœ‰çš„è‹±æ–‡ç¼–ç ä»å•å­—èŠ‚å˜æˆåŒå­—èŠ‚ï¼Œåªéœ€è¦æŠŠé«˜å­—èŠ‚å…¨éƒ¨å¡«ä¸º0å°±å¯ä»¥ã€‚ å› ä¸ºPythonçš„è¯ç”Ÿæ¯”Unicodeæ ‡å‡†å‘å¸ƒçš„æ—¶é—´è¿˜è¦æ—©ï¼Œæ‰€ä»¥æœ€æ—©çš„Pythonåªæ”¯æŒASCIIç¼–ç ï¼Œæ™®é€šçš„å­—ç¬¦ä¸²â€™ABCâ€™åœ¨Pythonå†…éƒ¨éƒ½æ˜¯ASCIIç¼–ç çš„ã€‚ Pythonåœ¨åæ¥æ·»åŠ äº†å¯¹Unicodeçš„æ”¯æŒï¼Œä»¥Unicodeè¡¨ç¤ºçš„å­—ç¬¦ä¸²ç”¨uâ€™â€¦â€™è¡¨ç¤ºï¼Œæ¯”å¦‚ï¼š 123print u'ä¸­æ–‡'ä¸­æ–‡æ³¨æ„: ä¸åŠ  u ï¼Œä¸­æ–‡å°±ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚(è¿™ä¸ªåº”è¯¥æ˜¯å¾ˆæ—©ç‰ˆæœ¬æ‰ä¼šã€‚ç¬”è€…ç°åœ¨å·²ç»æ— æ³•å¤ç°) è½¬è½½: http://blog.csdn.net/lxdcyh/article/details/4018054 å­—ç¬¦ä¸²åœ¨Pythonå†…éƒ¨çš„è¡¨ç¤ºæ˜¯unicodeç¼–ç ï¼Œå› æ­¤ï¼Œåœ¨åšç¼–ç è½¬æ¢æ—¶ï¼Œé€šå¸¸éœ€è¦ä»¥unicodeä½œä¸ºä¸­é—´ç¼–ç ï¼Œå³å…ˆå°†å…¶ä»–ç¼–ç çš„å­—ç¬¦ä¸²è§£ç decodeæˆunicodeï¼Œå†ä»unicodeç¼–ç encodeæˆå¦ä¸€ç§ç¼–ç ã€‚ decodeçš„ä½œç”¨æ˜¯å°†å…¶ä»–ç¼–ç çš„å­—ç¬¦ä¸²è½¬æ¢æˆunicodeç¼–ç ï¼Œå¦‚str1.decode(&#39;gb2312&#39;)ï¼Œè¡¨ç¤ºå°†gb2312ç¼–ç çš„å­—ç¬¦ä¸²str1è½¬æ¢æˆunicodeç¼–ç ã€‚ encodeçš„ä½œç”¨æ˜¯å°†unicodeç¼–ç è½¬æ¢æˆå…¶ä»–ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå¦‚str2.encode(â€˜gb2312â€™)ï¼Œè¡¨ç¤ºå°†unicodeç¼–ç çš„å­—ç¬¦ä¸²str2è½¬æ¢æˆgb2312ç¼–ç  ä»£ç ä¸­å­—ç¬¦ä¸²çš„é»˜è®¤ç¼–ç ä¸ä»£ç æ–‡ä»¶æœ¬èº«çš„ç¼–ç ä¸€è‡´ã€‚ å¦‚ï¼šs=â€™ä¸­æ–‡â€™ å¦‚æœæ˜¯åœ¨utf8çš„æ–‡ä»¶ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²å°±æ˜¯utf8ç¼–ç ï¼Œå¦‚æœæ˜¯åœ¨gb2312çš„æ–‡ä»¶ä¸­ï¼Œåˆ™å…¶ç¼–ç ä¸ºgb2312ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¦è¿›è¡Œç¼–ç è½¬æ¢ï¼Œéƒ½éœ€è¦å…ˆç”¨decodeæ–¹æ³•å°†å…¶è½¬æ¢æˆunicodeç¼–ç ï¼Œå†ä½¿ç”¨encodeæ–¹æ³•å°†å…¶è½¬æ¢æˆå…¶ä»–ç¼–ç ã€‚é€šå¸¸ï¼Œåœ¨æ²¡æœ‰æŒ‡å®šç‰¹å®šçš„ç¼–ç æ–¹å¼æ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„ç³»ç»Ÿé»˜è®¤ç¼–ç åˆ›å»ºçš„ä»£ç æ–‡ä»¶ å¦‚æœå­—ç¬¦ä¸²æ˜¯è¿™æ ·å®šä¹‰ï¼šs=uâ€™ä¸­æ–‡â€™ åˆ™è¯¥å­—ç¬¦ä¸²çš„ç¼–ç å°±è¢«æŒ‡å®šä¸ºunicodeäº†ï¼Œå³pythonçš„å†…éƒ¨ç¼–ç ï¼Œè€Œä¸ä»£ç æ–‡ä»¶æœ¬èº«çš„ç¼–ç æ— å…³ã€‚å› æ­¤ï¼Œå¯¹äºè¿™ç§æƒ…å†µåšç¼–ç è½¬æ¢ï¼Œåªéœ€è¦ç›´æ¥ä½¿ç”¨encodeæ–¹æ³•å°†å…¶è½¬æ¢æˆæŒ‡å®šç¼–ç å³å¯ã€‚ å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²å·²ç»æ˜¯unicodeäº†ï¼Œå†è¿›è¡Œè§£ç åˆ™å°†å‡ºé”™ï¼Œå› æ­¤é€šå¸¸è¦å¯¹å…¶ç¼–ç æ–¹å¼æ˜¯å¦ä¸ºunicodeè¿›è¡Œåˆ¤æ–­ï¼š 12isinstance(s, unicode) #ç”¨æ¥åˆ¤æ–­æ˜¯å¦ä¸ºunicode ç”¨éunicodeç¼–ç å½¢å¼çš„stræ¥encodeä¼šæŠ¥é”™ å¦‚ä½•è·å¾—ç³»ç»Ÿçš„é»˜è®¤ç¼–ç ï¼Ÿ 1234#!/usr/bin/env python#coding=utf-8import sysprint sys.getdefaultencoding() è¯¥æ®µç¨‹åºåœ¨Win10(1079)ä¸Šè¾“å‡ºä¸ºï¼šascii åœ¨æŸäº›IDEä¸­ï¼Œå­—ç¬¦ä¸²çš„è¾“å‡ºæ€»æ˜¯å‡ºç°ä¹±ç ï¼Œç”šè‡³é”™è¯¯ï¼Œå…¶å®æ˜¯ç”±äºIDEçš„ç»“æœè¾“å‡ºæ§åˆ¶å°è‡ªèº«ä¸èƒ½æ˜¾ç¤ºå­—ç¬¦ä¸²çš„ç¼–ç ï¼Œè€Œä¸æ˜¯ç¨‹åºæœ¬èº«çš„é—®é¢˜ã€‚ å¦‚åœ¨UliPad(æ³¨:UliPadæ˜¯wxPythonçš„åŠ¨åŠ›ï¼Œå¯¼å‘å’Œçµæ´»çš„ç¼–ç¨‹å™¨)ä¸­è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š 12s=u&quot;ä¸­æ–‡&quot;print s ä¼šæç¤ºï¼šUnicodeEncodeError: â€˜asciiâ€™ codec canâ€™t encode characters in position 0-1: ordinal not in range(128)ã€‚è¿™æ˜¯å› ä¸ºUliPadåœ¨æ§åˆ¶å°ä¿¡æ¯è¾“å‡ºçª—å£æ˜¯æŒ‰ç…§asciiç¼–ç è¾“å‡ºçš„ï¼ˆç³»ç»Ÿçš„é»˜è®¤ç¼–ç æ˜¯asciiï¼‰ï¼Œè€Œä¸Šé¢ä»£ç ä¸­çš„å­—ç¬¦ä¸²æ˜¯Unicodeç¼–ç çš„ï¼Œæ‰€ä»¥è¾“å‡ºæ—¶äº§ç”Ÿäº†é”™è¯¯ã€‚ å°†æœ€åä¸€å¥æ”¹ä¸ºï¼šprint s.encode(&#39;gb2312&#39;) åˆ™èƒ½æ­£ç¡®è¾“å‡ºâ€œä¸­æ–‡â€ä¸¤ä¸ªå­—ã€‚ è‹¥æœ€åä¸€å¥æ”¹ä¸ºï¼šprint s.encode(&#39;utf8&#39;) åˆ™è¾“å‡ºï¼š/xe4/xb8/xad/xe6/x96/x87ï¼Œè¿™æ˜¯æ§åˆ¶å°ä¿¡æ¯è¾“å‡ºçª—å£æŒ‰ç…§asciiç¼–ç è¾“å‡ºutf8ç¼–ç çš„å­—ç¬¦ä¸²çš„ç»“æœã€‚ unicode(str,&#39;gb2312&#39;)ä¸str.decode(&#39;gb2312&#39;)æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å°†gb2312ç¼–ç çš„strè½¬ä¸ºunicodeç¼–ç  ä½¿ç”¨str.__class__å¯ä»¥æŸ¥çœ‹strçš„ç¼–ç å½¢å¼ä¸ºstrç±»å‹ã€‚ windowé»˜è®¤ç¼–ç gbkï¼›linuxé»˜è®¤ç¼–ç utf8 åŸç†è¯´äº†åŠå¤©ï¼Œæœ€åæ¥ä¸ªåŒ…æ²»ç™¾ç—…çš„å§ï¼š(å¤©æ¶¯)ï¼šä¸‹é¢ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657#!/usr/bin/env python #coding=utf-8def getCoding(strInput): ''' è·å–ç¼–ç æ ¼å¼ ''' if isinstance(strInput, unicode): return "unicode" try: strInput.decode("utf8") return 'utf8' except: pass try: strInput.decode("gbk") return 'gbk' except: pass def tran2UTF8(strInput): ''' è½¬åŒ–ä¸ºutf8æ ¼å¼ ''' strCodingFmt = getCoding(strInput) if strCodingFmt == "utf8": return strInput elif strCodingFmt == "unicode": return strInput.encode("utf8") elif strCodingFmt == "gbk": return strInput.decode("gbk").encode("utf8")def tran2GBK(strInput): ''' è½¬åŒ–ä¸ºgbkæ ¼å¼ ''' strCodingFmt = getCoding(strInput) if strCodingFmt == "gbk": return strInput elif strCodingFmt == "unicode": return strInput.encode("gbk") elif strCodingFmt == "utf8": return strInput.decode("utf8").encode("gbk")s = "ä¸­æ–‡"if isinstance(s, unicode): #s=u"ä¸­æ–‡" print s.encode('gb2312') print "æˆ‘æ˜¯Unicodeç¼–ç çš„"elif getCoding(s) == "utf8": #s="ä¸­æ–‡" print s.decode('utf-8').encode('gb2312') print "æˆ‘æ˜¯utf-8ç¼–ç çš„"else: print s.decode('gbk').encode('gbk') print "æˆ‘æ˜¯gbkç¼–ç çš„" ä¸Šå›¾ç»“æœä¸€ï¼šä»¥utf-8æ ¼å¼ä¿å­˜çš„pyæ–‡ä»¶ã€‚å›¾äºŒï¼šä»¥asciiæ ¼å¼ä¿å­˜çš„pyæ–‡ä»¶ã€‚ ç¼–ç æ£€æµ‹åŒ… chardet çŸ¥è¯†ç‚¹ï¼šå› æ­¤ï¼Œè½¬ç çš„æ—¶å€™ä¸€å®šè¦å…ˆææ˜ç™½ï¼Œå­—ç¬¦ä¸²stræ˜¯ä»€ä¹ˆç¼–ç ï¼Œç„¶ådecodeæˆunicodeï¼Œç„¶åå†encodeæˆå…¶ä»–ç¼–ç  æ’å…¥æ•°æ®åº“æŠ¥é”™çš„è§£å†³æ–¹æ¡ˆ:UnicodeDecodeError: â€˜asciiâ€™ codec canâ€™t decode byte 123import sysreload(sys)sys.setdefaultencoding(&apos;utf8&apos;) Unicodeå­—ç¬¦ä¸²é™¤äº†å¤šäº†ä¸€ä¸ª u ä¹‹å¤–ï¼Œä¸æ™®é€šå­—ç¬¦ä¸²æ²¡å•¥åŒºåˆ«ï¼Œè½¬ä¹‰å­—ç¬¦å’Œå¤šè¡Œè¡¨ç¤ºæ³•ä»ç„¶æœ‰æ•ˆï¼š è½¬ä¹‰ï¼š 1234567891011u'ä¸­æ–‡\næ—¥æ–‡\néŸ©æ–‡'#å¤šè¡Œï¼šu'''ç¬¬ä¸€è¡Œç¬¬äºŒè¡Œ'''#raw+å¤šè¡Œï¼šur'''Pythonçš„Unicodeå­—ç¬¦ä¸²æ”¯æŒ"ä¸­æ–‡","æ—¥æ–‡","éŸ©æ–‡"ç­‰å¤šç§è¯­è¨€''' å¦‚æœä¸­æ–‡å­—ç¬¦ä¸²åœ¨Pythonç¯å¢ƒä¸‹é‡åˆ° UnicodeDecodeErrorï¼Œè¿™æ˜¯å› ä¸º.pyæ–‡ä»¶ä¿å­˜çš„æ ¼å¼æœ‰é—®é¢˜ã€‚å¯ä»¥åœ¨ç¬¬ä¸€è¡Œæ·»åŠ æ³¨é‡Š 1234# -*- coding: utf-8 -*-#ç®€æ´ç‰ˆ#coding=utf-8 ç›®çš„æ˜¯å‘Šè¯‰Pythonè§£é‡Šå™¨ï¼Œç”¨UTF-8ç¼–ç è¯»å–æºä»£ç ã€‚ç„¶åç”¨Notepad++ å¦å­˜ä¸ºâ€¦ å¹¶é€‰æ‹©UTF-8æ ¼å¼ä¿å­˜ã€‚ ç¼–ç¨‹ä»»åŠ¡ï¼šç”¨å¤šè¡ŒUnicodeå­—ç¬¦ä¸²è¡¨ç¤ºä¸‹é¢çš„å”è¯—å¹¶æ‰“å°ï¼š é™å¤œæ€ åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚ çŸ¥è¯†ç‚¹: https://www.python.org/dev/peps/pep-0263/ pythonå®šä¹‰æ–‡ä»¶ç¼–ç åˆ°åº•ç”¨å“ªç§ï¼Ÿ 12345# coding=&lt;encoding name&gt; #!/usr/bin/python# -*- coding: &lt;encoding name&gt; -*-#!/usr/bin/python# vim: set fileencoding=&lt;encoding name&gt; : è¿™äº›éƒ½å¯ä»¥åªè¦ç¬¬ä¸€äºŒè¡Œèƒ½æ»¡è¶³å¦‚ä¸‹æ­£åˆ™è¡¨è¾¾å¼ 1^[ \t\v]*#.*?coding[:=][ \t]*([-_.a-zA-Z0-9]+) 12345678910# -*- coding: utf-8 -*-# This Python file uses the following encoding: utf-8# èŠ±å¼æ ‡æ˜print '''é™å¤œæ€åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚''' å¦‚æœä¸æ ‡æ˜æ–‡ä»¶ç¼–ç æˆ–æ‰¾ä¸åˆ°ã€‚pythonä¼šé»˜è®¤ä½ æ˜¯ASCII æ•´æ•°å’Œæµ®ç‚¹æ•°Pythonæ”¯æŒå¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°ç›´æ¥è¿›è¡Œå››åˆ™æ··åˆè¿ç®—ï¼Œè¿ç®—è§„åˆ™å’Œæ•°å­¦ä¸Šçš„å››åˆ™è¿ç®—è§„åˆ™å®Œå…¨ä¸€è‡´ã€‚ åŸºæœ¬çš„è¿ç®—ï¼š 1231 + 2 + 3 # ==&gt; 64 * 5 - 6 # ==&gt; 147.5 / 8 + 2.1 # ==&gt; 3.0375 ä½¿ç”¨æ‹¬å·å¯ä»¥æå‡ä¼˜å…ˆçº§ï¼Œè¿™å’Œæ•°å­¦è¿ç®—å®Œå…¨ä¸€è‡´ï¼Œæ³¨æ„åªèƒ½ä½¿ç”¨å°æ‹¬å·ï¼Œä½†æ˜¯æ‹¬å·å¯ä»¥åµŒå¥—å¾ˆå¤šå±‚ï¼š 12(1 + 2) * 3 # ==&gt; 9(2.2 + 3.3) / (1.5 * (9 - 0.3)) # ==&gt; 0.42145593869731807 å’Œæ•°å­¦è¿ç®—ä¸åŒçš„åœ°æ–¹æ˜¯ï¼ŒPythonçš„æ•´æ•°è¿ç®—ç»“æœä»ç„¶æ˜¯æ•´æ•°ï¼Œæµ®ç‚¹æ•°è¿ç®—ç»“æœä»ç„¶æ˜¯æµ®ç‚¹æ•°ï¼š 121 + 2 # ==&gt; æ•´æ•° 31.0 + 2.0 # ==&gt; æµ®ç‚¹æ•° 3.0 ä½†æ˜¯æ•´æ•°å’Œæµ®ç‚¹æ•°æ··åˆè¿ç®—çš„ç»“æœå°±å˜æˆæµ®ç‚¹æ•°äº†ï¼š 11 + 2.0 # ==&gt; æµ®ç‚¹æ•° 3.0 ä¸ºä»€ä¹ˆè¦åŒºåˆ†æ•´æ•°è¿ç®—å’Œæµ®ç‚¹æ•°è¿ç®—å‘¢ï¼Ÿ è¿™æ˜¯å› ä¸ºæ•´æ•°è¿ç®—çš„ç»“æœæ°¸è¿œæ˜¯ç²¾ç¡®çš„ï¼Œè€Œæµ®ç‚¹æ•°è¿ç®—çš„ç»“æœä¸ä¸€å®šç²¾ç¡®ï¼Œå› ä¸ºè®¡ç®—æœºå†…å­˜å†å¤§ï¼Œä¹Ÿæ— æ³•ç²¾ç¡®è¡¨ç¤ºå‡ºæ— é™å¾ªç¯å°æ•°ï¼Œæ¯”å¦‚ 0.1 æ¢æˆäºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯æ— é™å¾ªç¯å°æ•°ã€‚ é‚£æ•´æ•°çš„é™¤æ³•è¿ç®—é‡åˆ°é™¤ä¸å°½çš„æ—¶å€™ï¼Œç»“æœéš¾é“ä¸æ˜¯æµ®ç‚¹æ•°å—ï¼Ÿæˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ï¼š 111 / 4 # ==&gt; 2 ä»¤å¾ˆå¤šåˆå­¦è€…æƒŠè®¶çš„æ˜¯ï¼ŒPythonçš„æ•´æ•°é™¤æ³•ï¼Œå³ä½¿é™¤ä¸å°½ï¼Œç»“æœä»ç„¶æ˜¯æ•´æ•°ï¼Œä½™æ•°ç›´æ¥è¢«æ‰”æ‰ã€‚ä¸è¿‡ï¼ŒPythonæä¾›äº†ä¸€ä¸ªæ±‚ä½™çš„è¿ç®— % å¯ä»¥è®¡ç®—ä½™æ•°ï¼š 111 % 4 # ==&gt; 3 å¦‚æœæˆ‘ä»¬è¦è®¡ç®— 11 / 4 çš„ç²¾ç¡®ç»“æœï¼ŒæŒ‰ç…§â€œæ•´æ•°å’Œæµ®ç‚¹æ•°æ··åˆè¿ç®—çš„ç»“æœæ˜¯æµ®ç‚¹æ•°â€çš„æ³•åˆ™ï¼ŒæŠŠä¸¤ä¸ªæ•°ä¸­çš„ä¸€ä¸ªå˜æˆæµ®ç‚¹æ•°å†è¿ç®—å°±æ²¡é—®é¢˜äº†ï¼š 111.0 / 4 # ==&gt; 2.75 ç¼–ç¨‹ä»»åŠ¡ï¼šè¯·è®¡ç®— 2.5 + 10 / 4 ,å¹¶è§£é‡Šè®¡ç®—ç»“æœä¸ºä»€ä¹ˆä¸æ˜¯æœŸæœ›çš„ 5.0 ? è¯·ä¿®å¤ä¸Šè¿°è¿ç®—ï¼Œä½¿å¾—è®¡ç®—ç»“æœæ˜¯ 5.0 1print 2.5 + 10.0 / 4 è¿è¡Œç»“æœï¼š 15.0 å¸ƒå°”ç±»å‹æˆ‘ä»¬å·²ç»äº†è§£äº†Pythonæ”¯æŒå¸ƒå°”ç±»å‹çš„æ•°æ®ï¼Œå¸ƒå°”ç±»å‹åªæœ‰Trueå’ŒFalseä¸¤ç§å€¼ï¼Œä½†æ˜¯å¸ƒå°”ç±»å‹æœ‰ä»¥ä¸‹å‡ ç§è¿ç®—ï¼š ä¸è¿ç®—ï¼šåªæœ‰ä¸¤ä¸ªå¸ƒå°”å€¼éƒ½ä¸º True æ—¶ï¼Œè®¡ç®—ç»“æœæ‰ä¸º Trueã€‚ 1234True and True # ==&gt; TrueTrue and False # ==&gt; FalseFalse and True # ==&gt; FalseFalse and False # ==&gt; False æˆ–è¿ç®—ï¼šåªè¦æœ‰ä¸€ä¸ªå¸ƒå°”å€¼ä¸º Trueï¼Œè®¡ç®—ç»“æœå°±æ˜¯ Trueã€‚ 1234True or True # ==&gt; TrueTrue or False # ==&gt; TrueFalse or True # ==&gt; TrueFalse or False # ==&gt; False éè¿ç®—ï¼šæŠŠTrueå˜ä¸ºFalseï¼Œæˆ–è€…æŠŠFalseå˜ä¸ºTrueï¼š 12not True # ==&gt; Falsenot False # ==&gt; True å¸ƒå°”è¿ç®—åœ¨è®¡ç®—æœºä¸­ç”¨æ¥åšæ¡ä»¶åˆ¤æ–­ï¼Œæ ¹æ®è®¡ç®—ç»“æœä¸ºTrueæˆ–è€…Falseï¼Œè®¡ç®—æœºå¯ä»¥è‡ªåŠ¨æ‰§è¡Œä¸åŒçš„åç»­ä»£ç ã€‚ åœ¨Pythonä¸­ï¼Œå¸ƒå°”ç±»å‹è¿˜å¯ä»¥ä¸å…¶ä»–æ•°æ®ç±»å‹åš andã€orå’Œnotè¿ç®—ï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼š çŸ¥è¯†ç‚¹ï¼šPythonæŠŠ0ã€ç©ºå­—ç¬¦ä¸²â€™â€™å’ŒNoneçœ‹æˆ Falseï¼Œå…¶ä»–æ•°å€¼å’Œéç©ºå­—ç¬¦ä¸²éƒ½çœ‹æˆ Trueã€‚çŸ­è·¯è¿ç®— 12a = Trueprint a and 'a=T' or 'a=F' è®¡ç®—ç»“æœä¸æ˜¯å¸ƒå°”ç±»å‹ï¼Œè€Œæ˜¯å­—ç¬¦ä¸² &#39;a=T&#39;ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ å› ä¸ºPythonæŠŠ0ã€ç©ºå­—ç¬¦ä¸²â€™â€™å’ŒNoneçœ‹æˆ Falseï¼Œå…¶ä»–æ•°å€¼å’Œéç©ºå­—ç¬¦ä¸²éƒ½çœ‹æˆ Trueï¼Œæ‰€ä»¥ï¼š True and â€˜a=Tâ€™ è®¡ç®—ç»“æœæ˜¯ â€˜a=Tâ€™ç»§ç»­è®¡ç®— â€˜a=Tâ€™ or â€˜a=Fâ€™ è®¡ç®—ç»“æœè¿˜æ˜¯ â€˜a=Tâ€™è¦è§£é‡Šä¸Šè¿°ç»“æœï¼Œåˆæ¶‰åŠåˆ° and å’Œ or è¿ç®—çš„ä¸€æ¡é‡è¦æ³•åˆ™ï¼šçŸ­è·¯è®¡ç®—ã€‚ åœ¨è®¡ç®— a and bæ—¶ï¼Œå¦‚æœ a æ˜¯ Falseï¼Œåˆ™æ ¹æ®ä¸è¿ç®—æ³•åˆ™ï¼Œæ•´ä¸ªç»“æœå¿…å®šä¸º Falseï¼Œå› æ­¤è¿”å› aï¼›å¦‚æœ a æ˜¯ Trueï¼Œåˆ™æ•´ä¸ªè®¡ç®—ç»“æœå¿…å®šå–å†³ä¸ bï¼Œå› æ­¤è¿”å› bã€‚ åœ¨è®¡ç®— a or b æ—¶ï¼Œå¦‚æœ a æ˜¯ Trueï¼Œåˆ™æ ¹æ®æˆ–è¿ç®—æ³•åˆ™ï¼Œæ•´ä¸ªè®¡ç®—ç»“æœå¿…å®šä¸º Trueï¼Œå› æ­¤è¿”å› aï¼›å¦‚æœ a æ˜¯ Falseï¼Œåˆ™æ•´ä¸ªè®¡ç®—ç»“æœå¿…å®šå–å†³äº bï¼Œå› æ­¤è¿”å› bã€‚ æ‰€ä»¥Pythonè§£é‡Šå™¨åœ¨åšå¸ƒå°”è¿ç®—æ—¶ï¼Œåªè¦èƒ½æå‰ç¡®å®šè®¡ç®—ç»“æœï¼Œå®ƒå°±ä¸ä¼šå¾€åç®—äº†ï¼Œç›´æ¥è¿”å›ç»“æœã€‚ ç¼–ç ä»»åŠ¡ï¼šè¯·è¿è¡Œå¦‚ä¸‹ä»£ç ï¼Œå¹¶è§£é‡Šæ‰“å°çš„ç»“æœï¼š 1234a = 'python'print 'hello,', a or 'world'b = ''print 'hello,', b or 'world' 1234567# -*- coding: utf-8 -*-a = 'python'print 'hello,', a or 'world'#aä¸ºéç©ºï¼Œåˆ™è¾“å‡ºab = ''#bä¸ºç©ºï¼Œè¾“å‡ºworldprint 'hello,', b or 'world' è¿è¡Œç»“æœï¼š 12hello, pythonhello, world Pythoné›†åˆç±»å‹:listå’Œtupleåˆ›å»ºlistPythonå†…ç½®çš„ä¸€ç§æ•°æ®ç±»å‹æ˜¯åˆ—è¡¨ï¼šlistã€‚listæ˜¯ä¸€ç§æœ‰åºçš„é›†åˆï¼Œå¯ä»¥éšæ—¶æ·»åŠ å’Œåˆ é™¤å…¶ä¸­çš„å…ƒç´ ã€‚ æ¯”å¦‚ï¼Œåˆ—å‡ºç­é‡Œæ‰€æœ‰åŒå­¦çš„åå­—ï¼Œå°±å¯ä»¥ç”¨ä¸€ä¸ªlistè¡¨ç¤ºï¼š 12&gt;&gt;&gt; ['Michael', 'Bob', 'Tracy']['Michael', 'Bob', 'Tracy'] listæ˜¯æ•°å­¦æ„ä¹‰ä¸Šçš„æœ‰åºé›†åˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œlistä¸­çš„å…ƒç´ æ˜¯æŒ‰ç…§é¡ºåºæ’åˆ—çš„ã€‚ æ„é€ listéå¸¸ç®€å•ï¼ŒæŒ‰ç…§ä¸Šé¢çš„ä»£ç ï¼Œç›´æ¥ç”¨ [ ]æŠŠlistçš„æ‰€æœ‰å…ƒç´ éƒ½æ‹¬èµ·æ¥ï¼Œå°±æ˜¯ä¸€ä¸ªlistå¯¹è±¡ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šæŠŠlistèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥é€šè¿‡å˜é‡æ¥å¼•ç”¨listï¼š 123&gt;&gt;&gt; classmates = ['Michael', 'Bob', 'Tracy']&gt;&gt;&gt; classmates # æ‰“å°classmateså˜é‡çš„å†…å®¹['Michael', 'Bob', 'Tracy'] ç”±äºPythonæ˜¯åŠ¨æ€è¯­è¨€ï¼Œæ‰€ä»¥listä¸­åŒ…å«çš„å…ƒç´ å¹¶ä¸è¦æ±‚éƒ½å¿…é¡»æ˜¯åŒä¸€ç§æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨listä¸­åŒ…å«å„ç§æ•°æ®ï¼š 1&gt;&gt;&gt; L = [&apos;Michael&apos;, 100, True] ä¸€ä¸ªå…ƒç´ ä¹Ÿæ²¡æœ‰çš„listï¼Œå°±æ˜¯ç©ºlistï¼š 1&gt;&gt;&gt; empty_list = [] ç¼–ç¨‹ä»»åŠ¡ å‡è®¾ç­é‡Œæœ‰3ååŒå­¦ï¼šAdamï¼ŒLisaå’ŒBartï¼Œä»–ä»¬çš„æˆç»©åˆ†åˆ«æ˜¯ 95.5ï¼Œ85 å’Œ 59ï¼Œè¯·æŒ‰ç…§ åå­—, åˆ†æ•°, åå­—, åˆ†æ•°â€¦ çš„é¡ºåºæŒ‰ç…§åˆ†æ•°ä»é«˜åˆ°ä½ç”¨ä¸€ä¸ªlistè¡¨ç¤ºï¼Œç„¶åæ‰“å°å‡ºæ¥ã€‚ 12L = ['Adam', 95.5,'Lisa', 85, 'Bart', 59]print L è¿è¡Œç»“æœ: 1[&apos;Adam&apos;, 95.5, &apos;Lisa&apos;, 85, &apos;Bart&apos;, 59] æ³¨ï¼šlistæœ¬èº«å°±æ˜¯æœ‰åºçš„ã€‚æ‰€ä»¥ç›´æ¥æ‰“å°å³å¯ã€‚ PythonæŒ‰ç…§ç´¢å¼•è®¿é—®listç”±äºlistæ˜¯ä¸€ä¸ªæœ‰åºé›†åˆï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªlistæŒ‰åˆ†æ•°ä»é«˜åˆ°ä½è¡¨ç¤ºå‡ºç­é‡Œçš„3ä¸ªåŒå­¦ï¼š 1&gt;&gt;&gt; L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;] é‚£æˆ‘ä»¬å¦‚ä½•ä»listä¸­è·å–æŒ‡å®šç¬¬ N åçš„åŒå­¦å‘¢ï¼Ÿæ–¹æ³•æ˜¯é€šè¿‡ç´¢å¼•æ¥è·å–listä¸­çš„æŒ‡å®šå…ƒç´ ã€‚ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œç´¢å¼•ä» 0 å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯0ï¼Œç¬¬äºŒä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯1ï¼Œä»¥æ­¤ç±»æ¨ã€‚ å› æ­¤ï¼Œè¦æ‰“å°ç¬¬ä¸€ååŒå­¦çš„åå­—ï¼Œç”¨ L[0]: 12345678910&gt;&gt;&gt; print L[0]Adam#è¦æ‰“å°ç¬¬äºŒååŒå­¦çš„åå­—ï¼Œç”¨ L[1]:&gt;&gt;&gt; print L[1]Lisa#è¦æ‰“å°ç¬¬ä¸‰ååŒå­¦çš„åå­—ï¼Œç”¨ L[2]:&gt;&gt;&gt; print L[2]Bart è¦æ‰“å°ç¬¬å››ååŒå­¦çš„åå­—ï¼Œç”¨ L[3]: 1234&gt;&gt;&gt; print L[3]Traceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;IndexError: list index out of range æŠ¥é”™äº†ï¼IndexErroræ„æ€å°±æ˜¯ç´¢å¼•è¶…å‡ºäº†èŒƒå›´ï¼Œå› ä¸ºä¸Šé¢çš„liståªæœ‰3ä¸ªå…ƒç´ ï¼Œæœ‰æ•ˆçš„ç´¢å¼•æ˜¯ 0ï¼Œ1ï¼Œ2ã€‚ æ‰€ä»¥ï¼Œä½¿ç”¨ç´¢å¼•æ—¶ï¼Œåƒä¸‡æ³¨æ„ä¸è¦è¶Šç•Œã€‚ ç¼–ç¨‹ä»»åŠ¡ ä¸‰ååŒå­¦çš„æˆç»©å¯ä»¥ç”¨ä¸€ä¸ªlistè¡¨ç¤ºï¼šL = [95.5, 85, 59] è¯·æŒ‰ç…§ç´¢å¼•åˆ†åˆ«æ‰“å°å‡ºç¬¬ä¸€åã€ç¬¬äºŒåã€ç¬¬ä¸‰åï¼ŒåŒæ—¶æµ‹è¯• print L[3]ã€‚ å®ç°ä»£ç ï¼š 12345L = [95.5,85,59]print L[0]print L[1]print L[2]print L[3] è¿è¡Œç»“æœï¼š 1234567Traceback (most recent call last): File &quot;index.py&quot;, line 5, in print L[3]IndexError: list index out of range95.58559 çŸ¥è¯†ç‚¹ï¼šæ­£åºä»0å¼€å§‹ï¼Œé€†åºä»-1å¼€å§‹æ˜¯æœ€å¥½ä¸€ä¸ªlistå†…å®¹ã€‚ å½“ç´¢å¼•æ•°å­—ä¸ºè´Ÿæ•°æ—¶ï¼Œè¡¨ç¤ºé€†åºè¯»å‡ºListä¸­çš„å†…å®¹ï¼Œè®°ä½Listçš„æœ€åä¸€ä¸ªç©ºé—´çš„ç¼–å·ä¸º-1å¼€å§‹ å€’åºè®¿é—®listæˆ‘ä»¬è¿˜æ˜¯ç”¨ä¸€ä¸ªlistæŒ‰åˆ†æ•°ä»é«˜åˆ°ä½è¡¨ç¤ºå‡ºç­é‡Œçš„3ä¸ªåŒå­¦ï¼š 1&gt;&gt;&gt; L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;] è¿™æ—¶ï¼Œè€å¸ˆè¯´ï¼Œè¯·åˆ†æ•°æœ€ä½çš„åŒå­¦ç«™å‡ºæ¥ã€‚ è¦å†™ä»£ç å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ•°ä¸€æ•°è¿™ä¸ª listï¼Œå‘ç°å®ƒåŒ…å«3ä¸ªå…ƒç´ ï¼Œå› æ­¤ï¼Œæœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯2ï¼š 12&gt;&gt;&gt; print L[2]Bart BartåŒå­¦æ˜¯æœ€åä¸€åï¼Œä¿—ç§°å€’æ•°ç¬¬ä¸€ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ -1 è¿™ä¸ªç´¢å¼•æ¥è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ï¼š 12&gt;&gt;&gt; print L[-1]Bart BartåŒå­¦è¡¨ç¤ºèººæªã€‚ ç±»ä¼¼çš„ï¼Œå€’æ•°ç¬¬äºŒç”¨ -2 è¡¨ç¤ºï¼Œå€’æ•°ç¬¬ä¸‰ç”¨ -3 è¡¨ç¤ºï¼Œå€’æ•°ç¬¬å››ç”¨ -4 è¡¨ç¤ºï¼š 123456789&gt;&gt;&gt; print L[-2]Lisa&gt;&gt;&gt; print L[-3]Adam&gt;&gt;&gt; print L[-4]Traceback (most recent call last): File "&lt;stdin&gt;", line 1, in &lt;module&gt;IndexError: list index out of rangeL[-4] æŠ¥é”™äº†ï¼Œå› ä¸ºå€’æ•°ç¬¬å››ä¸å­˜åœ¨ï¼Œä¸€å…±åªæœ‰3ä¸ªå…ƒç´ ã€‚ ä½¿ç”¨å€’åºç´¢å¼•æ—¶ï¼Œä¹Ÿè¦æ³¨æ„ä¸è¦è¶Šç•Œã€‚ ç¼–ç¨‹ä»»åŠ¡ ä¸‰ååŒå­¦çš„æˆç»©å¯ä»¥ç”¨ä¸€ä¸ªlistè¡¨ç¤ºï¼šL = [95.5, 85, 59] è¯·æŒ‰ç…§å€’åºç´¢å¼•åˆ†åˆ«æ‰“å°å‡ºå€’æ•°ç¬¬ä¸€ã€å€’æ•°ç¬¬äºŒã€å€’æ•°ç¬¬ä¸‰ã€‚ å®ç°ä»£ç ï¼š 12345L = [95.5, 85, 59]print L[-1]print L[-2]print L[-3]print L[-4] è¿è¡Œç»“æœï¼š 1234567Traceback (most recent call last): File &quot;index.py&quot;, line 5, in print L[-4]IndexError: list index out of range598595.5 listæ·»åŠ æ–°å…ƒç´ (append insert)ç°åœ¨ï¼Œç­é‡Œæœ‰3ååŒå­¦ï¼š 1&gt;&gt;&gt; L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;] ä»Šå¤©ï¼Œç­é‡Œè½¬æ¥ä¸€åæ–°åŒå­¦ Paulï¼Œå¦‚ä½•æŠŠæ–°åŒå­¦æ·»åŠ åˆ°ç°æœ‰çš„ list ä¸­å‘¢ï¼Ÿ ç¬¬ä¸€ä¸ªåŠæ³•æ˜¯ç”¨ list çš„ append() æ–¹æ³•ï¼ŒæŠŠæ–°åŒå­¦è¿½åŠ åˆ° list çš„æœ«å°¾ï¼š 1234&gt;&gt;&gt; L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;]&gt;&gt;&gt; L.append(&apos;Paul&apos;)&gt;&gt;&gt; print L[&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;, &apos;Paul&apos;] append()æ€»æ˜¯æŠŠæ–°çš„å…ƒç´ æ·»åŠ åˆ° list çš„å°¾éƒ¨ã€‚ å¦‚æœ Paul åŒå­¦è¡¨ç¤ºè‡ªå·±æ€»æ˜¯è€ƒæ»¡åˆ†ï¼Œè¦æ±‚æ·»åŠ åˆ°ç¬¬ä¸€çš„ä½ç½®ï¼Œæ€ä¹ˆåŠï¼Ÿ æ–¹æ³•æ˜¯ç”¨listçš„ insert()æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç´¢å¼•å·ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¾…æ·»åŠ çš„æ–°å…ƒç´ ï¼š 1234&gt;&gt;&gt; L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;]&gt;&gt;&gt; L.insert(0, &apos;Paul&apos;)&gt;&gt;&gt; print L[&apos;Paul&apos;, &apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;] L.insert(0, &#39;Paul&#39;) çš„æ„æ€æ˜¯ï¼Œâ€™Paulâ€™å°†è¢«æ·»åŠ åˆ°ç´¢å¼•ä¸º 0 çš„ä½ç½®ä¸Šï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªï¼‰ï¼Œè€ŒåŸæ¥ç´¢å¼•ä¸º 0 çš„AdamåŒå­¦ï¼Œä»¥åŠåé¢çš„æ‰€æœ‰åŒå­¦ï¼Œéƒ½è‡ªåŠ¨å‘åç§»åŠ¨ä¸€ä½ã€‚ ç¼–ç¨‹ä»»åŠ¡ å‡è®¾æ–°æ¥ä¸€åå­¦ç”ŸPaulï¼ŒPaul åŒå­¦çš„æˆç»©æ¯”Bartå¥½ï¼Œä½†æ˜¯æ¯”Lisaå·®ï¼Œä»–åº”è¯¥æ’åˆ°ç¬¬ä¸‰åçš„ä½ç½®ï¼Œè¯·ç”¨ä»£ç å®ç°ã€‚ ä»£ç å®ç°: 123L = ['Adam', 'Lisa', 'Bart']L.insert(2,'paul')print L è¿è¡Œç»“æœ: 1['Adam', 'Lisa', 'paul', 'Bart'] æ­£å‘ç¬¬ä¸‰åç´¢å¼•å·ä¸º2.å€’æ•°ç¬¬ä¸‰åç´¢å¼•å·ä¸º-3 liståˆ é™¤å…ƒç´ (pop)PaulåŒå­¦åˆšæ¥å‡ å¤©åˆè¦è½¬èµ°äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæŠŠPaul ä»ç°æœ‰çš„listä¸­åˆ é™¤å‘¢ï¼Ÿ å¦‚æœPaulåŒå­¦æ’åœ¨æœ€åä¸€ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥ç”¨listçš„pop()æ–¹æ³•åˆ é™¤ï¼š 12345&gt;&gt;&gt; L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;, &apos;Paul&apos;]&gt;&gt;&gt; L.pop()&apos;Paul&apos;&gt;&gt;&gt; print L[&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;] pop()æ–¹æ³•æ€»æ˜¯åˆ æ‰listçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”å®ƒè¿˜è¿”å›è¿™ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰§è¡Œ L.pop() åï¼Œä¼šæ‰“å°å‡º â€˜Paulâ€™ã€‚ å¦‚æœPaulåŒå­¦ä¸æ˜¯æ’åœ¨æœ€åä¸€ä¸ªæ€ä¹ˆåŠï¼Ÿæ¯”å¦‚PaulåŒå­¦æ’åœ¨ç¬¬ä¸‰ï¼š 1&gt;&gt;&gt; L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Paul&apos;, &apos;Bart&apos;] è¦æŠŠPaulè¸¢å‡ºlistï¼Œæˆ‘ä»¬å°±å¿…é¡»å…ˆå®šä½Paulçš„ä½ç½®ã€‚ç”±äºPaulçš„ç´¢å¼•æ˜¯2ï¼Œå› æ­¤ï¼Œç”¨ pop(2)æŠŠPaulåˆ æ‰ï¼š 1234&gt;&gt;&gt; L.pop(2)&apos;Paul&apos;&gt;&gt;&gt; print L[&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;] ä¸¤ç§æ–¹å¼ï¼šç›´æ¥pop()é»˜è®¤åˆ é™¤ç¬¬ä¸€ä¸ªï¼Œæ‹¬å·å†…æŒ‡å®šå‚æ•°ï¼šç´¢å¼•ï¼Œåˆ é™¤ç´¢å¼•ä½ç½®ä¸Šã€‚ ç¼–ç ä»»åŠ¡1L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Paul&apos;, &apos;Bart&apos;] Paulçš„ç´¢å¼•æ˜¯2ï¼ŒBartçš„ç´¢å¼•æ˜¯3ï¼Œå¦‚æœæˆ‘ä»¬è¦æŠŠPaulå’ŒBartéƒ½åˆ æ‰ï¼Œè¯·è§£é‡Šä¸‹é¢çš„ä»£ç ä¸ºä»€ä¹ˆä¸èƒ½æ­£ç¡®è¿è¡Œï¼š 12L.pop(2)L.pop(3) æ€æ ·è°ƒæ•´ä»£ç å¯ä»¥æŠŠPaulå’ŒBartéƒ½æ­£ç¡®åˆ é™¤æ‰ï¼Ÿ è§£é‡Šï¼šå› ä¸ºè¯­å¥æ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„åˆ é™¤äº†Paulä¹‹åã€‚ç´¢å¼•å·3å·²ç»è¶Šç•Œã€‚æˆ‘ä»¬è¦åˆ é™¤çš„Bartå·²ç»å˜æˆ2äº†ã€‚ çŸ¥è¯†ç‚¹ï¼šè¿™æ•™è‚²æˆ‘ä»¬åˆ é™¤listæ—¶è¦ç§‰ç€ä»å‰åˆ°åé¡ºåºã€‚ Listæ›¿æ¢å…ƒç´ å‡è®¾ç°åœ¨ç­é‡Œä»ç„¶æ˜¯3ååŒå­¦ï¼š &gt;&gt;&gt; L = [&#39;Adam&#39;, &#39;Lisa&#39;, &#39;Bart&#39;] ç°åœ¨ï¼ŒBartåŒå­¦è¦è½¬å­¦èµ°äº†ï¼Œç¢°å·§æ¥äº†ä¸€ä¸ªPaulåŒå­¦ï¼Œè¦æ›´æ–°ç­çº§æˆå‘˜åå•ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠŠBartåˆ æ‰ï¼Œå†æŠŠPaulæ·»åŠ è¿›æ¥ã€‚ å¦ä¸€ä¸ªåŠæ³•æ˜¯ç›´æ¥ç”¨PaulæŠŠBartç»™æ›¿æ¢æ‰ï¼š 123&gt;&gt;&gt; L[2] = &apos;Paul&apos;&gt;&gt;&gt; print LL = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Paul&apos;] å¯¹listä¸­çš„æŸä¸€ä¸ªç´¢å¼•èµ‹å€¼ï¼Œå°±å¯ä»¥ç›´æ¥ç”¨æ–°çš„å…ƒç´ æ›¿æ¢æ‰åŸæ¥çš„å…ƒç´ ï¼ŒliståŒ…å«çš„å…ƒç´ ä¸ªæ•°ä¿æŒä¸å˜ã€‚ ç”±äºBartè¿˜å¯ä»¥ç”¨ -1 åšç´¢å¼•ï¼Œå› æ­¤ï¼Œä¸‹é¢çš„ä»£ç ä¹Ÿå¯ä»¥å®ŒæˆåŒæ ·çš„æ›¿æ¢å·¥ä½œï¼š &gt;&gt;&gt; L[-1] = &#39;Paul&#39; ç¼–ç¨‹ä»»åŠ¡ ç­é‡Œçš„åŒå­¦æŒ‰ç…§åˆ†æ•°æ’åæ˜¯è¿™æ ·çš„ï¼šL = [â€˜Adamâ€™, â€˜Lisaâ€™, â€˜Bartâ€™]ä½†æ˜¯ï¼Œåœ¨ä¸€æ¬¡è€ƒè¯•åï¼ŒBartåŒå­¦æ„å¤–å–å¾—ç¬¬ä¸€ï¼Œè€ŒAdamåŒå­¦è€ƒäº†å€’æ•°ç¬¬ä¸€ã€‚ è¯·é€šè¿‡å¯¹listçš„ç´¢å¼•èµ‹å€¼ï¼Œç”Ÿæˆæ–°çš„æ’åã€‚ å®ç°ä»£ç ï¼š 1234L = ['Adam', 'Lisa', 'Bart']L[0]='Bart'L[-1]='Adam'print L è¿è¡Œç»“æœï¼š 1[&apos;Bart&apos;, &apos;Lisa&apos;, &apos;Adam&apos;] åˆ›å»ºtupletupleæ˜¯å¦ä¸€ç§æœ‰åºçš„åˆ—è¡¨ï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºâ€œ å…ƒç»„ â€ã€‚tuple å’Œ list éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯ï¼ŒçŸ¥è¯†ç‚¹ï¼štupleä¸€æ—¦åˆ›å»ºå®Œæ¯•ï¼Œå°±ä¸èƒ½ä¿®æ”¹äº†ã€‚ åŒæ ·æ˜¯è¡¨ç¤ºç­é‡ŒåŒå­¦çš„åç§°ï¼Œç”¨tupleè¡¨ç¤ºå¦‚ä¸‹ï¼š 1&gt;&gt;&gt; t = (&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;) åˆ›å»ºtupleå’Œåˆ›å»ºlistå”¯ä¸€ä¸åŒä¹‹å¤„æ˜¯ç”¨( )æ›¿ä»£äº†[ ]ã€‚ ç°åœ¨ï¼Œè¿™ä¸ª t å°±ä¸èƒ½æ”¹å˜äº†ï¼Œtupleæ²¡æœ‰ append()æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰insert()å’Œpop()æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œæ–°åŒå­¦æ²¡æ³•ç›´æ¥å¾€ tuple ä¸­æ·»åŠ ï¼Œè€åŒå­¦æƒ³é€€å‡º tuple ä¹Ÿä¸è¡Œã€‚ è·å– tuple å…ƒç´ çš„æ–¹å¼å’Œ list æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¸¸ä½¿ç”¨ t[0]ï¼Œt[-1]ç­‰ç´¢å¼•æ–¹å¼è®¿é—®å…ƒç´ ï¼Œä½†æ˜¯ä¸èƒ½èµ‹å€¼æˆåˆ«çš„å…ƒç´ ï¼Œä¸ä¿¡å¯ä»¥è¯•è¯•ï¼š 1234&gt;&gt;&gt; t[0] = &apos;Paul&apos;Traceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;TypeError: &apos;tuple&apos; object does not support item assignment ç¼–ç¨‹ä»»åŠ¡ åˆ›å»ºä¸€ä¸ªtupleï¼Œé¡ºåºåŒ…å«0 - 9è¿™10ä¸ªæ•°ã€‚ å®ç°ä»£ç ï¼š 12t = (0,1,2,3,4,5,6,7,8,9)print t è¿è¡Œç»“æœï¼š 1(0, 1, 2, 3, 4, 5, 6, 7, 8, 9) åˆ›å»ºå•å…ƒç´ tupletupleå’Œlistä¸€æ ·ï¼Œå¯ä»¥åŒ…å« 0 ä¸ªã€1ä¸ªå’Œä»»æ„å¤šä¸ªå…ƒç´ ã€‚ åŒ…å«å¤šä¸ªå…ƒç´ çš„ tupleï¼Œå‰é¢æˆ‘ä»¬å·²ç»åˆ›å»ºè¿‡äº†ã€‚ åŒ…å« 0 ä¸ªå…ƒç´ çš„ tupleï¼Œä¹Ÿå°±æ˜¯ç©ºtupleï¼Œç›´æ¥ç”¨ ()è¡¨ç¤ºï¼š 123&gt;&gt;&gt; t = ()&gt;&gt;&gt; print t() åˆ›å»ºåŒ…å«1ä¸ªå…ƒç´ çš„ tuple å‘¢ï¼Ÿæ¥è¯•è¯•ï¼š 123&gt;&gt;&gt; t = (1)&gt;&gt;&gt; print t1 å¥½åƒå“ªé‡Œä¸å¯¹ï¼t ä¸æ˜¯ tuple ï¼Œè€Œæ˜¯æ•´æ•°1ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ çŸ¥è¯†ç‚¹ï¼šå•å…ƒç´ tupleçš„()è¢«å½“åšä¼˜å…ˆçº§ã€‚(1)å˜æˆæ•´æ•°1.å•å…ƒç´ æ‹¬å·ç»“å°¾åŠ , å› ä¸º()æ—¢å¯ä»¥è¡¨ç¤ºtupleï¼Œåˆå¯ä»¥ä½œä¸ºæ‹¬å·è¡¨ç¤ºè¿ç®—æ—¶çš„ä¼˜å…ˆçº§ï¼Œç»“æœ (1) è¢«Pythonè§£é‡Šå™¨è®¡ç®—å‡ºç»“æœ 1ï¼Œå¯¼è‡´æˆ‘ä»¬å¾—åˆ°çš„ä¸æ˜¯tupleï¼Œè€Œæ˜¯æ•´æ•° 1ã€‚ æ­£æ˜¯å› ä¸ºç”¨()å®šä¹‰å•å…ƒç´ çš„tupleæœ‰æ­§ä¹‰ï¼Œæ‰€ä»¥ Python è§„å®šï¼Œå•å…ƒç´  tuple è¦å¤šåŠ ä¸€ä¸ªé€—å·,ï¼Œè¿™æ ·å°±é¿å…äº†æ­§ä¹‰ï¼š 123&gt;&gt;&gt; t = (1,)&gt;&gt;&gt; print t(1,) Pythonåœ¨æ‰“å°å•å…ƒç´ tupleæ—¶ï¼Œä¹Ÿè‡ªåŠ¨æ·»åŠ äº†ä¸€ä¸ª,ï¼Œä¸ºäº†æ›´æ˜ç¡®åœ°å‘Šè¯‰ä½ è¿™æ˜¯ä¸€ä¸ªtupleã€‚ å¤šå…ƒç´  tuple åŠ ä¸åŠ è¿™ä¸ªé¢å¤–çš„,æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š 123&gt;&gt;&gt; t = (1, 2, 3,)&gt;&gt;&gt; print t(1, 2, 3) ç¼–ç¨‹ä»»åŠ¡ä¸‹é¢ä»£ç ä¸ºä»€ä¹ˆæ²¡æœ‰åˆ›å»ºå‡ºåŒ…å«ä¸€ä¸ªå­¦ç”Ÿçš„ tupleï¼š 12t = ('Adam')print t è¯·ä¿®æ”¹ä»£ç ï¼Œç¡®ä¿ t æ˜¯ä¸€ä¸ªtupleã€‚ å› ä¸ºå•å…ƒç´ tupleçš„æ‹¬å·è¢«å½“åšæ˜¯ä¼˜å…ˆçº§æ ‡å¿—ã€‚è¦åŠ ä¸Šé¢å¤–,æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªå…ƒç»„ã€‚ å®ç°ä»£ç ï¼š 12t = ('Adam',)print t è¿è¡Œç»“æœ: 1(&apos;Adam&apos;,) â€œå¯å˜â€çš„tuple(æŒ‡å‘ä¸å˜ã€‚æŒ‡å‘çš„ä¸œè¥¿å¯ä»¥å˜)å‰é¢æˆ‘ä»¬çœ‹åˆ°äº†tupleä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¯å˜çš„tupleï¼š 1&gt;&gt;&gt; t = (&apos;a&apos;, &apos;b&apos;, [&apos;A&apos;, &apos;B&apos;]) æ³¨æ„åˆ° t æœ‰ 3 ä¸ªå…ƒç´ ï¼š&#39;a&#39;ï¼Œ&#39;b&#39;å’Œä¸€ä¸ªlistï¼š[&#39;A&#39;, &#39;B&#39;]ã€‚listä½œä¸ºä¸€ä¸ªæ•´ä½“æ˜¯tupleçš„ç¬¬3ä¸ªå…ƒç´ ã€‚listå¯¹è±¡å¯ä»¥é€šè¿‡ t[2] æ‹¿åˆ°ï¼š 12345&gt;&gt;&gt; L = t[2]# ç„¶åï¼Œæˆ‘ä»¬æŠŠlistçš„ä¸¤ä¸ªå…ƒç´ æ”¹ä¸€æ”¹ï¼š&gt;&gt;&gt; L[0] = 'X'&gt;&gt;&gt; L[1] = 'Y' å†çœ‹çœ‹tupleçš„å†…å®¹ï¼š 12&gt;&gt;&gt; print t(&apos;a&apos;, &apos;b&apos;, [&apos;X&apos;, &apos;Y&apos;]) ä¸æ˜¯è¯´tupleä¸€æ—¦å®šä¹‰åå°±ä¸å¯å˜äº†å—ï¼Ÿæ€ä¹ˆç°åœ¨åˆå˜äº†ï¼Ÿ åˆ«æ€¥ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å®šä¹‰çš„æ—¶å€™tupleåŒ…å«çš„3ä¸ªå…ƒç´ ï¼š å½“æˆ‘ä»¬æŠŠlistçš„å…ƒç´ â€™Aâ€™å’Œâ€™Bâ€™ä¿®æ”¹ä¸ºâ€™Xâ€™å’Œâ€™Yâ€™åï¼Œtupleå˜ä¸ºï¼š è¡¨é¢ä¸Šçœ‹ï¼Œtupleçš„å…ƒç´ ç¡®å®å˜äº†ï¼Œä½†å…¶å®å˜çš„ä¸æ˜¯ tuple çš„å…ƒç´ ï¼Œè€Œæ˜¯listçš„å…ƒç´ ã€‚ tupleä¸€å¼€å§‹æŒ‡å‘çš„listå¹¶æ²¡æœ‰æ”¹æˆåˆ«çš„listï¼Œæ‰€ä»¥ï¼Œtupleæ‰€è°“çš„â€œä¸å˜â€æ˜¯è¯´ï¼Œtupleçš„æ¯ä¸ªå…ƒç´ ï¼ŒæŒ‡å‘æ°¸è¿œä¸å˜ã€‚å³æŒ‡å‘â€™aâ€™ï¼Œå°±ä¸èƒ½æ”¹æˆæŒ‡å‘â€™bâ€™ï¼ŒæŒ‡å‘ä¸€ä¸ªlistï¼Œå°±ä¸èƒ½æ”¹æˆæŒ‡å‘å…¶ä»–å¯¹è±¡ï¼Œä½†æŒ‡å‘çš„è¿™ä¸ªlistæœ¬èº«æ˜¯å¯å˜çš„ï¼ ç†è§£äº†æŒ‡å‘ä¸å˜åï¼Œè¦åˆ›å»ºä¸€ä¸ªå†…å®¹ä¹Ÿä¸å˜çš„tupleæ€ä¹ˆåšï¼Ÿé‚£å°±å¿…é¡»ä¿è¯tupleçš„æ¯ä¸€ä¸ªå…ƒç´ æœ¬èº«ä¹Ÿä¸èƒ½å˜ã€‚ ç¼–ç¨‹ä»»åŠ¡ï¼š å®šä¹‰äº†tupleï¼št = (â€˜aâ€™, â€˜bâ€™, [â€˜Aâ€™, â€˜Bâ€™]) ç”±äº t åŒ…å«ä¸€ä¸ªlistå…ƒç´ ï¼Œå¯¼è‡´tupleçš„å†…å®¹æ˜¯å¯å˜çš„ã€‚èƒ½å¦ä¿®æ”¹ä¸Šè¿°ä»£ç ï¼Œè®©tupleå†…å®¹ä¸å¯å˜ï¼Ÿ è§£ç­”ï¼šå°†é‡Œé¢çš„listæ›¿æ¢æˆä¸€ä¸ªä¸å¯å˜çš„å…ƒç´ ã€‚æ¯”å¦‚tupleã€‚ å®ç°ä»£ç : 12t = (&apos;a&apos;, &apos;b&apos;, (&apos;A&apos;, &apos;B&apos;))print t è¿è¡Œç»“æœï¼š 1(&apos;a&apos;, &apos;b&apos;, (&apos;A&apos;, &apos;B&apos;)) Pythonçš„æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯è¯­å¥ifè¯­å¥è®¡ç®—æœºä¹‹æ‰€ä»¥èƒ½åšå¾ˆå¤šè‡ªåŠ¨åŒ–çš„ä»»åŠ¡ï¼Œå› ä¸ºå®ƒå¯ä»¥è‡ªå·±åšæ¡ä»¶åˆ¤æ–­ã€‚ æ¯”å¦‚ï¼Œè¾“å…¥ç”¨æˆ·å¹´é¾„ï¼Œæ ¹æ®å¹´é¾„æ‰“å°ä¸åŒçš„å†…å®¹ï¼Œåœ¨Pythonç¨‹åºä¸­ï¼Œå¯ä»¥ç”¨ifè¯­å¥å®ç°ï¼š 12345age = 20if age &gt;= 18: print 'your age is', age print 'adult'print 'END' æ³¨æ„: Pythonä»£ç çš„ç¼©è¿›è§„åˆ™ã€‚å…·æœ‰ç›¸åŒç¼©è¿›çš„ä»£ç è¢«è§†ä¸ºä»£ç å—ï¼Œä¸Šé¢çš„3ï¼Œ4è¡Œ print è¯­å¥å°±æ„æˆä¸€ä¸ªä»£ç å—ï¼ˆä½†ä¸åŒ…æ‹¬ç¬¬5è¡Œçš„printï¼‰ã€‚å¦‚æœ if è¯­å¥åˆ¤æ–­ä¸º Trueï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªä»£ç å—ã€‚ çŸ¥è¯†ç‚¹: ç¼©è¿›è¯·ä¸¥æ ¼æŒ‰ç…§Pythonçš„ä¹ æƒ¯å†™æ³•ï¼š4ä¸ªç©ºæ ¼ï¼Œä¸è¦ä½¿ç”¨Tabï¼Œæ›´ä¸è¦æ··åˆTabå’Œç©ºæ ¼ï¼Œå¦åˆ™å¾ˆå®¹æ˜“é€ æˆå› ä¸ºç¼©è¿›å¼•èµ·çš„è¯­æ³•é”™è¯¯ã€‚ æ³¨æ„: if è¯­å¥åæ¥è¡¨è¾¾å¼ï¼Œç„¶åç”¨:è¡¨ç¤ºä»£ç å—å¼€å§‹ã€‚ å¦‚æœä½ åœ¨Pythonäº¤äº’ç¯å¢ƒä¸‹æ•²ä»£ç ï¼Œè¿˜è¦ç‰¹åˆ«ç•™æ„ç¼©è¿›ï¼Œå¹¶ä¸”é€€å‡ºç¼©è¿›éœ€è¦å¤šæ•²ä¸€è¡Œå›è½¦ï¼š 12345&gt;&gt;&gt; age = 20&gt;&gt;&gt; if age &gt;= 18:... print &apos;your age is&apos;, age... print &apos;adult&apos;... 12your age is 20adult ç¼–ç¨‹ä»»åŠ¡ å¦‚æœæˆç»©è¾¾åˆ°60åˆ†æˆ–ä»¥ä¸Šï¼Œè§†ä¸ºpassedã€‚ å‡è®¾BartåŒå­¦çš„åˆ†æ•°æ˜¯75ï¼Œè¯·ç”¨ifè¯­å¥åˆ¤æ–­æ˜¯å¦èƒ½æ‰“å°å‡º passed: å®ç°ä»£ç : 123score = 75if score&gt;=60: print 'passed' è¿è¡Œç»“æœ: 1passed if-elseå½“ if è¯­å¥åˆ¤æ–­è¡¨è¾¾å¼çš„ç»“æœä¸º True æ—¶ï¼Œå°±ä¼šæ‰§è¡Œ if åŒ…å«çš„ä»£ç å—ï¼š 12if age &gt;= 18: print 'adult' å¦‚æœæˆ‘ä»¬æƒ³åˆ¤æ–­å¹´é¾„åœ¨18å²ä»¥ä¸‹æ—¶ï¼Œæ‰“å°å‡º â€˜teenagerâ€™ï¼Œæ€ä¹ˆåŠï¼Ÿ æ–¹æ³•æ˜¯å†å†™ä¸€ä¸ª if: 12if age &lt; 18: print 'teenager' æˆ–è€…ç”¨ not è¿ç®—ï¼š 12if not age &gt;= 18: print 'teenager' ç»†å¿ƒçš„åŒå­¦å¯ä»¥å‘ç°ï¼Œè¿™ä¸¤ç§æ¡ä»¶åˆ¤æ–­æ˜¯â€œéæ­¤å³å½¼â€çš„ï¼Œè¦ä¹ˆç¬¦åˆæ¡ä»¶1ï¼Œè¦ä¹ˆç¬¦åˆæ¡ä»¶2ï¼Œå› æ­¤ï¼Œå®Œå…¨å¯ä»¥ç”¨ä¸€ä¸ª if ... else ... è¯­å¥æŠŠå®ƒä»¬ç»Ÿä¸€èµ·æ¥ï¼š 1234if age &gt;= 18: print 'adult'else: print 'teenager' åˆ©ç”¨ if ... else ...è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ¡ä»¶è¡¨è¾¾å¼çš„å€¼ä¸º True æˆ–è€… False ï¼Œåˆ†åˆ«æ‰§è¡Œ if ä»£ç å—æˆ–è€… else ä»£ç å—ã€‚ æ³¨æ„: else åé¢æœ‰ä¸ª:ã€‚ ç¼–ç¨‹ä»»åŠ¡ å¦‚æœæˆç»©è¾¾åˆ°60åˆ†æˆ–ä»¥ä¸Šï¼Œè§†ä¸ºpassedï¼Œå¦åˆ™è§†ä¸ºfailedã€‚ å‡è®¾BartåŒå­¦çš„åˆ†æ•°æ˜¯55ï¼Œè¯·ç”¨ifè¯­å¥æ‰“å°å‡º passed æˆ–è€… failed: å®ç°ä»£ç ï¼š 12345score = 55if score&gt;=60: print 'passed'else: print 'failed' è¿è¡Œç»“æœ: 1failed if-elif-elseæœ‰çš„æ—¶å€™ï¼Œä¸€ä¸ª if â€¦ else â€¦ è¿˜ä¸å¤Ÿç”¨ã€‚æ¯”å¦‚ï¼Œæ ¹æ®å¹´é¾„çš„åˆ’åˆ†ï¼š æ¡ä»¶1ï¼š18å²æˆ–ä»¥ä¸Šï¼šadult æ¡ä»¶2ï¼š6å²æˆ–ä»¥ä¸Šï¼šteenager æ¡ä»¶3ï¼š6å²ä»¥ä¸‹ï¼škid æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª if age &gt;= 18 åˆ¤æ–­æ˜¯å¦ç¬¦åˆæ¡ä»¶1ï¼Œå¦‚æœä¸ç¬¦åˆï¼Œå†é€šè¿‡ä¸€ä¸ª if åˆ¤æ–­ age &gt;= 6 æ¥åˆ¤æ–­æ˜¯å¦ç¬¦åˆæ¡ä»¶2ï¼Œå¦åˆ™ï¼Œæ‰§è¡Œæ¡ä»¶3ï¼š 1234567if age &gt;= 18: print &apos;adult&apos;else: if age &gt;= 6: print &apos;teenager&apos; else: print &apos;kid&apos; è¿™æ ·å†™å‡ºæ¥ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªä¸¤å±‚åµŒå¥—çš„ if â€¦ else â€¦ è¯­å¥ã€‚è¿™ä¸ªé€»è¾‘æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå¦‚æœç»§ç»­å¢åŠ æ¡ä»¶ï¼Œæ¯”å¦‚3å²ä»¥ä¸‹æ˜¯ babyï¼š 12345678910if age &gt;= 18: print &apos;adult&apos;else: if age &gt;= 6: print &apos;teenager&apos; else: if age &gt;= 3: print &apos;kid&apos; else: print &apos;baby&apos; è¿™ç§ç¼©è¿›åªä¼šè¶Šæ¥è¶Šå¤šï¼Œä»£ç ä¹Ÿä¼šè¶Šæ¥è¶Šéš¾çœ‹ã€‚ è¦é¿å…åµŒå¥—ç»“æ„çš„ if â€¦ else â€¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ if â€¦ å¤šä¸ªelif â€¦ else â€¦ çš„ç»“æ„ï¼Œä¸€æ¬¡å†™å®Œæ‰€æœ‰çš„è§„åˆ™ï¼š 12345678if age &gt;= 18: print &apos;adult&apos;elif age &gt;= 6: print &apos;teenager&apos;elif age &gt;= 3: print &apos;kid&apos;else: print &apos;baby&apos; elif æ„æ€å°±æ˜¯ else ifã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å†™å‡ºäº†ç»“æ„éå¸¸æ¸…æ™°çš„ä¸€ç³»åˆ—æ¡ä»¶åˆ¤æ–­ã€‚ ç‰¹åˆ«æ³¨æ„: è¿™ä¸€ç³»åˆ—æ¡ä»¶åˆ¤æ–­ä¼šä»ä¸Šåˆ°ä¸‹ä¾æ¬¡åˆ¤æ–­ï¼Œå¦‚æœæŸä¸ªåˆ¤æ–­ä¸º Trueï¼Œæ‰§è¡Œå®Œå¯¹åº”çš„ä»£ç å—ï¼Œåé¢çš„æ¡ä»¶åˆ¤æ–­å°±ç›´æ¥å¿½ç•¥ï¼Œä¸å†æ‰§è¡Œäº†ã€‚ è¯·æ€è€ƒä¸‹é¢çš„ä»£ç ï¼š 1234567age = 8if age &gt;= 6: print &apos;teenager&apos;elif age &gt;= 18: print &apos;adult&apos;else: print &apos;kid&apos; å½“ age = 8 æ—¶ï¼Œç»“æœæ­£ç¡®ï¼Œä½† age = 20 æ—¶ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰æ‰“å°å‡º adultï¼Ÿ å¦‚æœè¦ä¿®å¤ï¼Œåº”è¯¥å¦‚ä½•ä¿®å¤ï¼Ÿ çŸ¥è¯†ç‚¹è§£ç­”: å› ä¸ºå½“age=20.ç¬¬ä¸€ä¸ªæ¡ä»¶&gt;=6æ»¡è¶³å°±çŸ­è·¯äº†ã€‚å› æ­¤æˆ‘ä»¬åœ¨è®¾ç½®æ¡ä»¶åº”è¯¥ä»ä¸¥æ ¼åˆ°æ¾æ³›. 1234567age = 20if age &gt;= 18: print &apos;teenager&apos;elif age &gt;= 6: print &apos;adult&apos;else: print &apos;kid&apos; ç¼–ç¨‹ä»»åŠ¡ å¦‚æœæŒ‰ç…§åˆ†æ•°åˆ’å®šç»“æœï¼š 90åˆ†æˆ–ä»¥ä¸Šï¼šexcellent 80åˆ†æˆ–ä»¥ä¸Šï¼šgood 60åˆ†æˆ–ä»¥ä¸Šï¼špassed 60åˆ†ä»¥ä¸‹ï¼šfailed è¯·ç¼–å†™ç¨‹åºæ ¹æ®åˆ†æ•°æ‰“å°ç»“æœã€‚ å®ç°ä»£ç : 12345678910score = 85if score&gt;=90: print 'excellent'elif score&gt;=80: print 'good'elif score&gt;=60: print 'passed'else: print 'failed' è¿è¡Œç»“æœ: 1good forå¾ªç¯listæˆ–tupleå¯ä»¥è¡¨ç¤ºä¸€ä¸ªæœ‰åºé›†åˆã€‚å¦‚æœæˆ‘ä»¬æƒ³ä¾æ¬¡è®¿é—®ä¸€ä¸ªlistä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å‘¢ï¼Ÿæ¯”å¦‚ listï¼š 1234L = ['Adam', 'Lisa', 'Bart']print L[0]print L[1]print L[2] å¦‚æœliståªåŒ…å«å‡ ä¸ªå…ƒç´ ï¼Œè¿™æ ·å†™è¿˜è¡Œï¼Œå¦‚æœliståŒ…å«1ä¸‡ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å°±ä¸å¯èƒ½å†™1ä¸‡è¡Œprintã€‚ è¿™æ—¶ï¼Œå¾ªç¯å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ Pythonçš„ for å¾ªç¯å°±å¯ä»¥ä¾æ¬¡æŠŠlistæˆ–tupleçš„æ¯ä¸ªå…ƒç´ è¿­ä»£å‡ºæ¥ï¼š 123L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;]for name in L: print name æ³¨æ„: name è¿™ä¸ªå˜é‡æ˜¯åœ¨ for å¾ªç¯ä¸­å®šä¹‰çš„(è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶å˜é‡åå­—å¯è‡ªå®šä¹‰)ï¼Œæ„æ€æ˜¯ï¼Œä¾æ¬¡å–å‡ºlistä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶æŠŠå…ƒç´ èµ‹å€¼ç»™ nameï¼Œç„¶åæ‰§è¡Œforå¾ªç¯ä½“ï¼ˆå°±æ˜¯ç¼©è¿›çš„ä»£ç å—ï¼‰ã€‚ è¿™æ ·ä¸€æ¥ï¼Œéå†ä¸€ä¸ªlistæˆ–tupleå°±éå¸¸å®¹æ˜“äº†ã€‚ ç¼–ç¨‹ä»»åŠ¡ ç­é‡Œè€ƒè¯•åï¼Œè€å¸ˆè¦ç»Ÿè®¡å¹³å‡æˆç»©ï¼Œå·²çŸ¥4ä½åŒå­¦çš„æˆç»©ç”¨listè¡¨ç¤ºå¦‚ä¸‹ï¼šL = [75, 92, 59, 68] è¯·åˆ©ç”¨forå¾ªç¯è®¡ç®—å‡ºå¹³å‡æˆç»©ã€‚ å®ç°ä»£ç : 12345L = [75, 92, 59, 68]sum = 0.0for x in L: sum =sum+xprint sum / 4 è¿è¡Œç»“æœï¼š 173.5 whileå¾ªç¯å’Œ for å¾ªç¯ä¸åŒçš„å¦ä¸€ç§å¾ªç¯æ˜¯ while å¾ªç¯ï¼Œwhile å¾ªç¯ä¸ä¼šè¿­ä»£ list æˆ– tuple çš„å…ƒç´ ï¼Œè€Œæ˜¯æ ¹æ®è¡¨è¾¾å¼åˆ¤æ–­å¾ªç¯æ˜¯å¦ç»“æŸã€‚ æ¯”å¦‚è¦ä» 0 å¼€å§‹æ‰“å°ä¸å¤§äº N çš„æ•´æ•°ï¼š 12345N = 10x = 0while x &lt; N: print x x = x + 1 whileå¾ªç¯æ¯æ¬¡å…ˆåˆ¤æ–­ x &lt; Nï¼Œå¦‚æœä¸ºTrueï¼Œåˆ™æ‰§è¡Œå¾ªç¯ä½“çš„ä»£ç å—,å¦åˆ™ï¼Œé€€å‡ºå¾ªç¯ã€‚ åœ¨å¾ªç¯ä½“å†…ï¼Œx = x + 1 ä¼šè®© x ä¸æ–­å¢åŠ ï¼Œæœ€ç»ˆå› ä¸º x &lt; N ä¸æˆç«‹è€Œé€€å‡ºå¾ªç¯ã€‚ å¦‚æœæ²¡æœ‰è¿™ä¸€ä¸ªè¯­å¥ï¼Œwhileå¾ªç¯åœ¨åˆ¤æ–­ x &lt; N æ—¶æ€»æ˜¯ä¸ºTrueï¼Œå°±ä¼šæ— é™å¾ªç¯ä¸‹å»ï¼Œå˜æˆæ­»å¾ªç¯ï¼Œæ‰€ä»¥è¦ç‰¹åˆ«ç•™æ„whileå¾ªç¯çš„é€€å‡ºæ¡ä»¶ã€‚ ç¼–ç¨‹ä»»åŠ¡ åˆ©ç”¨whileå¾ªç¯è®¡ç®—100ä»¥å†…å¥‡æ•°çš„å’Œã€‚ å®ç°ä»£ç : 123456sum = 0x = 1while x&lt;=100: sum=sum+x x=x+2print sum çŸ¥è¯†ç‚¹: å¥‡æ•°åªéœ€è¦ä»1å¼€å§‹ä¸æ–­åŠ 2éƒ½æ˜¯å¥‡æ•°ã€‚ è¿è¡Œç»“æœï¼š 12500 breaké€€å‡ºå¾ªç¯ç”¨for å¾ªç¯æˆ–è€… while å¾ªç¯æ—¶ï¼Œå¦‚æœè¦åœ¨å¾ªç¯ä½“å†…ç›´æ¥é€€å‡ºå¾ªç¯ï¼Œå¯ä»¥ä½¿ç”¨ break è¯­å¥ã€‚ æ¯”å¦‚è®¡ç®—1è‡³100çš„æ•´æ•°å’Œï¼Œæˆ‘ä»¬ç”¨whileæ¥å®ç°ï¼š 12345678sum = 0x = 1while True: sum = sum + x x = x + 1 if x &gt; 100: breakprint sum å’‹ä¸€çœ‹ï¼Œ while True å°±æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä½†æ˜¯åœ¨å¾ªç¯ä½“å†…ï¼Œæˆ‘ä»¬è¿˜åˆ¤æ–­äº† x &gt; 100 æ¡ä»¶æˆç«‹æ—¶ï¼Œç”¨breakè¯­å¥é€€å‡ºå¾ªç¯ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å®ç°å¾ªç¯çš„ç»“æŸã€‚ ç¼–ç¨‹ä»»åŠ¡ åˆ©ç”¨ while True æ— é™å¾ªç¯é…åˆ break è¯­å¥ï¼Œè®¡ç®— 1 + 2 + 4 + 8 + 16 + â€¦ çš„å‰20é¡¹çš„å’Œã€‚ å®ç°ä»£ç : 12345678910sum = 0x = 1n = 1while True: sum =sum+x x =2*x n =n+1 if n &gt;20: breakprint sum è¿è¡Œç»“æœ: 11048575 continueç»§ç»­å¾ªç¯åœ¨å¾ªç¯è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç”¨breaké€€å‡ºå½“å‰å¾ªç¯ï¼Œè¿˜å¯ä»¥ç”¨continueè·³è¿‡åç»­å¾ªç¯ä»£ç ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚ å‡è®¾æˆ‘ä»¬å·²ç»å†™å¥½äº†åˆ©ç”¨forå¾ªç¯è®¡ç®—å¹³å‡åˆ†çš„ä»£ç ï¼š 1234567L = [75, 98, 59, 81, 66, 43, 69, 85]sum = 0.0n = 0for x in L: sum = sum + x n = n + 1print sum / n ç°åœ¨è€å¸ˆåªæƒ³ç»Ÿè®¡åŠæ ¼åˆ†æ•°çš„å¹³å‡åˆ†ï¼Œå°±è¦æŠŠ x &lt; 60 çš„åˆ†æ•°å‰”é™¤æ‰ï¼Œè¿™æ—¶ï¼Œåˆ©ç”¨continueï¼Œå¯ä»¥åšåˆ°å½“ x &lt; 60çš„æ—¶å€™ï¼Œä¸ç»§ç»­æ‰§è¡Œå¾ªç¯ä½“çš„åç»­ä»£ç ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼š 12345for x in L: if x &lt; 60: continue sum = sum + x n = n + 1 coutinue: è·³è¿‡ä¸‹é¢çš„ä»£ç ã€‚å¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚ ç¼–ç¨‹ä»»åŠ¡ å¯¹å·²æœ‰çš„è®¡ç®— 0 - 100 çš„whileå¾ªç¯è¿›è¡Œæ”¹é€ ï¼Œé€šè¿‡å¢åŠ  continue è¯­å¥ï¼Œä½¿å¾—åªè®¡ç®—å¥‡æ•°çš„å’Œï¼š 12345678sum = 0x = 1while True: sum = sum + x x = x + 1 if x &gt; 100: breakprint sum æ€è·¯: ifåˆ¤æ–­åˆ°æ˜¯å¶æ•°ï¼Œcontinueè·³è¿‡ã€‚ å®ç°ä»£ç : 1234567891011sum = 0x = 0while True: x = x + 1 if x &gt; 100: break if x%2==0: continue sum = sum+x print sum è¿è¡Œç»“æœ: 12500 å¤šé‡å¾ªç¯(åµŒå¥—å¾ªç¯)åœ¨å¾ªç¯å†…éƒ¨ï¼Œè¿˜å¯ä»¥åµŒå¥—å¾ªç¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š 123for x in [&apos;A&apos;, &apos;B&apos;, &apos;C&apos;]: for y in [&apos;1&apos;, &apos;2&apos;, &apos;3&apos;]: print x + y x æ¯å¾ªç¯ä¸€æ¬¡ï¼Œyå°±ä¼šå¾ªç¯ 3 æ¬¡ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å°å‡ºä¸€ä¸ªå…¨æ’åˆ—ï¼š 123456789A1A2A3B1B2B3C1C2C3 ç¼–ç¨‹ä»»åŠ¡ å¯¹100ä»¥å†…çš„ä¸¤ä½æ•°ï¼Œè¯·ä½¿ç”¨ä¸€ä¸ªä¸¤é‡å¾ªç¯æ‰“å°å‡ºæ‰€æœ‰åä½æ•°æ•°å­—æ¯”ä¸ªä½æ•°æ•°å­—å°çš„æ•°ï¼Œä¾‹å¦‚ï¼Œ23ï¼ˆ2 &lt; 3ï¼‰ã€‚ ä»£ç å®ç°ã€‚ 123456tens_place = [1,2,3,4,5,6,7,8,9]ones_place = [0,1,2,3,4,5,6,7,8,9]for x in tens_place: for y in ones_place: if x&lt;y: print x*10 + y è¿è¡Œç»“æœï¼š 12345678910121314151617181923ç•¥ é‡è¦çš„æ•°æ®ç±»å‹Dictå’ŒSetä»€ä¹ˆæ˜¯dictæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œlist å’Œ tuple å¯ä»¥ç”¨æ¥è¡¨ç¤ºé¡ºåºé›†åˆï¼Œä¾‹å¦‚ï¼Œç­é‡ŒåŒå­¦çš„åå­—ï¼š 1[&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;] æˆ–è€…è€ƒè¯•çš„æˆç»©åˆ—è¡¨ï¼š 1[95, 85, 59] ä½†æ˜¯ï¼Œè¦æ ¹æ®åå­—æ‰¾åˆ°å¯¹åº”çš„æˆç»©ï¼Œç”¨ä¸¤ä¸ª list è¡¨ç¤ºå°±ä¸æ–¹ä¾¿ã€‚ å¦‚æœæŠŠåå­—å’Œåˆ†æ•°å…³è”èµ·æ¥ï¼Œç»„æˆç±»ä¼¼çš„æŸ¥æ‰¾è¡¨ï¼š 123&apos;Adam&apos; ==&gt; 95&apos;Lisa&apos; ==&gt; 85&apos;Bart&apos; ==&gt; 59 ç»™å®šä¸€ä¸ªåå­—ï¼Œå°±å¯ä»¥ç›´æ¥æŸ¥åˆ°åˆ†æ•°ã€‚ Pythonçš„ dict å°±æ˜¯ä¸“é—¨å¹²è¿™ä»¶äº‹çš„ã€‚ç”¨ dict è¡¨ç¤ºåå­—-æˆç»©çš„æŸ¥æ‰¾è¡¨å¦‚ä¸‹ï¼š 12345d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59&#125; æˆ‘ä»¬æŠŠåå­—ç§°ä¸ºkeyï¼Œå¯¹åº”çš„æˆç»©ç§°ä¸ºvalueï¼Œdictå°±æ˜¯é€šè¿‡ keyæ¥æŸ¥æ‰¾ valueã€‚ èŠ±æ‹¬å· {} è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªdictï¼Œç„¶åæŒ‰ç…§ key: value, å†™å‡ºæ¥å³å¯ã€‚æœ€åä¸€ä¸ª key: value çš„é€—å·å¯ä»¥çœç•¥ã€‚ çŸ¥è¯†ç‚¹ï¼š åŒºåˆ«å°è¯¾å ‚ å•å…ƒç´ çš„tupleå¿…é¡»åœ¨åé¢å¤šåŠ ä¸€ä¸ªé€—å·ã€‚ dictæœ€åçš„é€—å·å¯ä»¥çœç•¥ ç”±äºdictä¹Ÿæ˜¯é›†åˆï¼Œlen() å‡½æ•°å¯ä»¥è®¡ç®—ä»»æ„é›†åˆçš„å¤§å°ï¼š 12&gt;&gt;&gt; len(d)3 çŸ¥è¯†ç‚¹ï¼šæ³¨æ„: ä¸€ä¸ª key-value ç®—ä¸€ä¸ªï¼Œå› æ­¤ï¼Œdictå¤§å°ä¸º3ã€‚ ç¼–ç¨‹ä»»åŠ¡ æ–°æ¥çš„PaulåŒå­¦æˆç»©æ˜¯ 75 åˆ†ï¼Œè¯·ç¼–å†™ä¸€ä¸ªdictï¼ŒæŠŠPaulåŒå­¦çš„æˆç»©ä¹ŸåŠ è¿›å»ã€‚ 12345d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59&#125; å®ç°ä»£ç : 1234567d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59, &apos;Paul&apos;: 75 &#125; è®¿é—®dictæˆ‘ä»¬å·²ç»èƒ½åˆ›å»ºä¸€ä¸ªdictï¼Œç”¨äºè¡¨ç¤ºåå­—å’Œæˆç»©çš„å¯¹åº”å…³ç³»ï¼š 12345d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59&#125; é‚£ä¹ˆï¼Œå¦‚ä½•æ ¹æ®åå­—æ¥æŸ¥æ‰¾å¯¹åº”çš„æˆç»©å‘¢ï¼Ÿ å¯ä»¥ç®€å•åœ°ä½¿ç”¨ d[key] çš„å½¢å¼æ¥æŸ¥æ‰¾å¯¹åº”çš„ valueï¼Œè¿™å’Œ list å¾ˆåƒï¼Œä¸åŒä¹‹å¤„æ˜¯ï¼Œlist å¿…é¡»ä½¿ç”¨ç´¢å¼•è¿”å›å¯¹åº”çš„å…ƒç´ ï¼Œè€Œdictä½¿ç”¨keyï¼š 1234567&gt;&gt;&gt; print d[&apos;Adam&apos;]95&gt;&gt;&gt; print d[&apos;Paul&apos;]Traceback (most recent call last): File &quot;index.py&quot;, line 11, in &lt;module&gt; print d[&apos;Paul&apos;]KeyError: &apos;Paul&apos; æ³¨æ„: é€šè¿‡ key è®¿é—® dict çš„valueï¼Œåªè¦ key å­˜åœ¨ï¼Œdictå°±è¿”å›å¯¹åº”çš„valueã€‚å¦‚æœkeyä¸å­˜åœ¨ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼šKeyErrorã€‚ çŸ¥è¯†ç‚¹ï¼šé¿å… KeyError å‘ç”Ÿï¼Œæœ‰ä¸¤ä¸ªåŠæ³•ï¼š æ˜¯å…ˆåˆ¤æ–­ä¸€ä¸‹ key æ˜¯å¦å­˜åœ¨ï¼Œç”¨ in æ“ä½œç¬¦ï¼š 12if &apos;Paul&apos; in d: print d[&apos;Paul&apos;] å¦‚æœ â€˜Paulâ€™ ä¸å­˜åœ¨ï¼Œifè¯­å¥åˆ¤æ–­ä¸ºFalseï¼Œè‡ªç„¶ä¸ä¼šæ‰§è¡Œ print d[â€˜Paulâ€™] ï¼Œä»è€Œé¿å…äº†é”™è¯¯ã€‚ æ˜¯ä½¿ç”¨dictæœ¬èº«æä¾›çš„ä¸€ä¸ªgetæ–¹æ³•ï¼Œåœ¨Keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å›Noneï¼š 1234&gt;&gt;&gt; print d.get(&apos;Bart&apos;)59&gt;&gt;&gt; print d.get(&apos;Paul&apos;)None ç¼–ç¨‹ä»»åŠ¡æ ¹æ®å¦‚ä¸‹dictï¼š12345d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59&#125; è¯·æ‰“å°å‡ºï¼šAdam: 95Lisa: 85Bart: 59 å®ç°ä»£ç : 12345678d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59&#125;print &apos;Adam:&apos;,d[&apos;Adam&apos;]print &apos;Lisa:&apos;,d.get(&apos;Lisa&apos;)print &apos;Bart:&apos;,d[&apos;Bart&apos;] è¿è¡Œç»“æœï¼š 123Adam: 95Lisa: 85Bart: 59 dictçš„ç‰¹ç‚¹çŸ¥è¯†ç‚¹ï¼šdictæŸ¥æ‰¾é€Ÿåº¦å¿«ã€‚listæŸ¥æ‰¾é€Ÿåº¦éšç€å…ƒç´ å¢åŠ è€Œé€æ¸ä¸‹é™ã€‚ç¼ºç‚¹ï¼šå†…å­˜å ç”¨å¤§ã€‚listæ…¢ä½†å†…å­˜å ç”¨å°ã€‚ dictçš„ç¬¬ä¸€ä¸ªç‰¹ç‚¹æ˜¯æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œæ— è®ºdictæœ‰10ä¸ªå…ƒç´ è¿˜æ˜¯10ä¸‡ä¸ªå…ƒç´ ï¼ŒæŸ¥æ‰¾é€Ÿåº¦éƒ½ä¸€æ ·ã€‚è€Œlistçš„æŸ¥æ‰¾é€Ÿåº¦éšç€å…ƒç´ å¢åŠ è€Œé€æ¸ä¸‹é™ã€‚ ä¸è¿‡dictçš„æŸ¥æ‰¾é€Ÿåº¦å¿«ä¸æ˜¯æ²¡æœ‰ä»£ä»·çš„ï¼Œdictçš„ç¼ºç‚¹æ˜¯å ç”¨å†…å­˜å¤§ï¼Œè¿˜ä¼šæµªè´¹å¾ˆå¤šå†…å®¹ï¼Œlistæ­£å¥½ç›¸åï¼Œå ç”¨å†…å­˜å°ï¼Œä½†æ˜¯æŸ¥æ‰¾é€Ÿåº¦æ…¢ã€‚ ç”±äºdictæ˜¯æŒ‰ key æŸ¥æ‰¾ï¼Œæ‰€ä»¥ï¼Œåœ¨ä¸€ä¸ªdictä¸­ï¼Œkeyä¸èƒ½é‡å¤ã€‚ dictçš„ç¬¬äºŒä¸ªç‰¹ç‚¹å°±æ˜¯å­˜å‚¨çš„key-valueåºå¯¹æ˜¯æ²¡æœ‰é¡ºåºçš„ï¼è¿™å’Œlistä¸ä¸€æ ·ï¼š 12345d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59&#125; å½“æˆ‘ä»¬è¯•å›¾æ‰“å°è¿™ä¸ªdictæ—¶ï¼š 12&gt;&gt;&gt; print d&#123;&apos;Lisa&apos;: 85, &apos;Adam&apos;: 95, &apos;Bart&apos;: 59&#125; æ‰“å°çš„é¡ºåºä¸ä¸€å®šæ˜¯æˆ‘ä»¬åˆ›å»ºæ—¶çš„é¡ºåºï¼Œè€Œä¸”ï¼Œä¸åŒçš„æœºå™¨æ‰“å°çš„é¡ºåºéƒ½å¯èƒ½ä¸åŒï¼Œè¿™è¯´æ˜ çŸ¥è¯†ç‚¹:dictå†…éƒ¨æ˜¯æ— åºçš„ï¼Œä¸èƒ½ç”¨dictå­˜å‚¨æœ‰åºçš„é›†åˆã€‚ çŸ¥è¯†ç‚¹ï¼šdictçš„ç¬¬ä¸‰ä¸ªç‰¹ç‚¹æ˜¯ä½œä¸º key çš„å…ƒç´ å¿…é¡»ä¸å¯å˜ï¼ŒPythonçš„åŸºæœ¬ç±»å‹å¦‚å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œéƒ½å¯ä»¥ä½œä¸º keyã€‚ ä½†æ˜¯listæ˜¯å¯å˜çš„ï¼Œå°±ä¸èƒ½ä½œä¸º keyã€‚ å¯ä»¥è¯•è¯•ç”¨listä½œä¸ºkeyæ—¶ä¼šæŠ¥ä»€ä¹ˆæ ·çš„é”™è¯¯ã€‚ ä¸å¯å˜è¿™ä¸ªé™åˆ¶ä»…ä½œç”¨äºkeyï¼Œvalueæ˜¯å¦å¯å˜æ— æ‰€è°“ï¼š 12345&#123; &apos;123&apos;: [1, 2, 3], # key æ˜¯ strï¼Œvalueæ˜¯list 123: &apos;123&apos;, # key æ˜¯ intï¼Œvalue æ˜¯ str (&apos;a&apos;, &apos;b&apos;): True # key æ˜¯ tupleï¼Œå¹¶ä¸”tupleçš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œvalueæ˜¯ boolean&#125; æœ€å¸¸ç”¨çš„keyè¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œå› ä¸ºç”¨èµ·æ¥æœ€æ–¹ä¾¿ã€‚ ç¼–ç¨‹ä»»åŠ¡ è¯·è®¾è®¡ä¸€ä¸ªdictï¼Œå¯ä»¥æ ¹æ®åˆ†æ•°æ¥æŸ¥æ‰¾åå­—ï¼Œå·²çŸ¥æˆç»©å¦‚ä¸‹ï¼š 123Adam: 95,Lisa: 85,Bart: 59. å®ç°ä»£ç : 12345d = &#123; 95:&apos;Adam&apos;, 85:&apos;Lisa&apos;, 59:&apos;Bart&apos;&#125; è¿è¡Œç»“æœï¼šæ—  æ›´æ–°dictdictæ˜¯å¯å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶å¾€dictä¸­æ·»åŠ æ–°çš„ key-valueã€‚æ¯”å¦‚å·²æœ‰dictï¼š 12345d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59&#125; è¦æŠŠæ–°åŒå­¦â€™Paulâ€™çš„æˆç»© 72 åŠ è¿›å»ï¼Œç”¨èµ‹å€¼è¯­å¥ï¼š 1&gt;&gt;&gt; d[&apos;Paul&apos;] = 72 å†çœ‹çœ‹dictçš„å†…å®¹ï¼š 12&gt;&gt;&gt; print d&#123;&apos;Lisa&apos;: 85, &apos;Paul&apos;: 72, &apos;Adam&apos;: 95, &apos;Bart&apos;: 59&#125; å¦‚æœ key å·²ç»å­˜åœ¨ï¼Œåˆ™èµ‹å€¼ä¼šç”¨æ–°çš„ value æ›¿æ¢æ‰åŸæ¥çš„ valueï¼š 123&gt;&gt;&gt; d[&apos;Bart&apos;] = 60&gt;&gt;&gt; print d&#123;&apos;Lisa&apos;: 85, &apos;Paul&apos;: 72, &apos;Adam&apos;: 95, &apos;Bart&apos;: 60&#125; ç¼–ç¨‹ä»»åŠ¡ è¯·æ ¹æ®Paulçš„æˆç»© 72 æ›´æ–°ä¸‹é¢çš„dictï¼š123456789d = &#123; 95: &apos;Adam&apos;, 85: &apos;Lisa&apos;, 59: &apos;Bart&apos;&#125; å®ç°ä»£ç : 1234567d = &#123; 95: 'Adam', 85: 'Lisa', 59: 'Bart'&#125;d[72] = 'Paul'print d è¿è¡Œç»“æœï¼š 1&#123;72: &apos;Paul&apos;, 59: &apos;Bart&apos;, 85: &apos;Lisa&apos;, 95: &apos;Adam&apos;&#125; éå†dictç”±äºdictä¹Ÿæ˜¯ä¸€ä¸ªé›†åˆï¼Œæ‰€ä»¥ï¼Œéå†dictå’Œéå†listç±»ä¼¼ï¼Œéƒ½å¯ä»¥é€šè¿‡ for å¾ªç¯å®ç°ã€‚ ç›´æ¥ä½¿ç”¨forå¾ªç¯å¯ä»¥éå† dict çš„ keyï¼š 1234567&gt;&gt;&gt; d = &#123; 'Adam': 95, 'Lisa': 85, 'Bart': 59 &#125;&gt;&gt;&gt; for key in d:... print key... LisaAdamBart ç”±äºé€šè¿‡ key å¯ä»¥è·å–å¯¹åº”çš„ valueï¼Œå› æ­¤ï¼Œåœ¨å¾ªç¯ä½“å†…ï¼Œå¯ä»¥è·å–åˆ°valueçš„å€¼ã€‚ æ³¨ï¼šè¿™é‡Œçš„keyåªæ˜¯ä¸€ä¸ªçº¦å®šä¿—ç§°çš„å˜é‡ï¼Œå¯ä»¥æ”¹ä¸ºå…¶ä»–åå­—ã€‚ä½†æ˜¯æ¨èç”¨keyã€‚ ç¼–ç¨‹ä»»åŠ¡ è¯·ç”¨ for å¾ªç¯éå†å¦‚ä¸‹çš„dictï¼Œæ‰“å°å‡º name: score æ¥ã€‚ 12345d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59&#125; å®ç°ä»£ç ï¼š 1234567d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59&#125;for key in d: print key+&quot;:&quot;,d[key] è¿è¡Œç»“æœ: 123Lisa: 85Adam: 95Bart: 59 ä»€ä¹ˆæ˜¯setdictçš„ä½œç”¨æ˜¯å»ºç«‹ä¸€ç»„ key å’Œä¸€ç»„ value çš„æ˜ å°„å…³ç³»ï¼Œdictçš„keyæ˜¯ä¸èƒ½é‡å¤çš„ã€‚ æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªæƒ³è¦ dict çš„ keyï¼Œä¸å…³å¿ƒ key å¯¹åº”çš„ valueï¼Œç›®çš„å°±æ˜¯ä¿è¯è¿™ä¸ªé›†åˆçš„å…ƒç´ ä¸ä¼šé‡å¤ï¼Œè¿™æ—¶ï¼Œsetå°±æ´¾ä¸Šç”¨åœºäº†ã€‚ set æŒæœ‰ä¸€ç³»åˆ—å…ƒç´ ï¼Œè¿™ä¸€ç‚¹å’Œ list å¾ˆåƒï¼Œä½†æ˜¯setçš„å…ƒç´ æ²¡æœ‰é‡å¤ï¼Œè€Œä¸”æ˜¯æ— åºçš„ï¼Œè¿™ç‚¹å’Œ dict çš„ keyå¾ˆåƒã€‚ çŸ¥è¯†ç‚¹: åˆ›å»º set çš„æ–¹å¼æ˜¯è°ƒç”¨ set() å¹¶ä¼ å…¥ä¸€ä¸ª listï¼Œlistçš„å…ƒç´ å°†ä½œä¸ºsetçš„å…ƒç´ ï¼š 12345&gt;&gt;&gt; s = set(['A', 'B', 'C'])å¯ä»¥æŸ¥çœ‹ set çš„å†…å®¹ï¼š&gt;&gt;&gt; print sset(['A', 'C', 'B']) è¯·æ³¨æ„ï¼Œä¸Šè¿°æ‰“å°çš„å½¢å¼ç±»ä¼¼ listï¼Œ ä½†å®ƒä¸æ˜¯ listï¼Œä»”ç»†çœ‹è¿˜å¯ä»¥å‘ç°ï¼Œæ‰“å°çš„é¡ºåºå’ŒåŸå§‹ list çš„é¡ºåºæœ‰å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œå› ä¸ºsetå†…éƒ¨å­˜å‚¨çš„å…ƒç´ æ˜¯æ— åºçš„ã€‚ å› ä¸ºsetä¸èƒ½åŒ…å«é‡å¤çš„å…ƒç´ ï¼Œæ‰€ä»¥ï¼Œå½“æˆ‘ä»¬ä¼ å…¥åŒ…å«é‡å¤å…ƒç´ çš„ list ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ 12345&gt;&gt;&gt; s = set([&apos;A&apos;, &apos;B&apos;, &apos;C&apos;, &apos;C&apos;])&gt;&gt;&gt; print sset([&apos;A&apos;, &apos;C&apos;, &apos;B&apos;])&gt;&gt;&gt; len(s)3 ç»“æœæ˜¾ç¤ºï¼Œsetä¼šè‡ªåŠ¨å»æ‰é‡å¤çš„å…ƒç´ ï¼ŒåŸæ¥çš„listæœ‰4ä¸ªå…ƒç´ ï¼Œä½†setåªæœ‰3ä¸ªå…ƒç´ ã€‚ ç¼–ç¨‹ä»»åŠ¡ è¯·ç”¨setè¡¨ç¤ºç­é‡Œçš„4ä½åŒå­¦ï¼šAdam, Lisa, Bart, Paul å®ç°ä»£ç : 12s = set(['Adam', 'Lisa', 'Bart', 'Paul'])print s è¿è¡Œç»“æœ: 1set([&apos;Lisa&apos;, &apos;Paul&apos;, &apos;Adam&apos;, &apos;Bart&apos;]) è®¿é—®setç”±äºsetå­˜å‚¨çš„æ˜¯æ— åºé›†åˆï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æ³•é€šè¿‡ç´¢å¼•æ¥è®¿é—®ã€‚ è®¿é—® setä¸­çš„æŸä¸ªå…ƒç´ å®é™…ä¸Šå°±æ˜¯åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨setä¸­ã€‚ ä¾‹å¦‚ï¼Œå­˜å‚¨äº†ç­é‡ŒåŒå­¦åå­—çš„setï¼š 1&gt;&gt;&gt; s = set([&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;, &apos;Paul&apos;]) æˆ‘ä»¬å¯ä»¥ç”¨ in æ“ä½œç¬¦åˆ¤æ–­ï¼š Bartæ˜¯è¯¥ç­çš„åŒå­¦å—ï¼Ÿ 12345678910&gt;&gt;&gt; &apos;Bart&apos; in sTrueBillæ˜¯è¯¥ç­çš„åŒå­¦å—ï¼Ÿ&gt;&gt;&gt; &apos;Bill&apos; in sFalsebartæ˜¯è¯¥ç­çš„åŒå­¦å—ï¼Ÿ&gt;&gt;&gt; &apos;bart&apos; in sFalse çŸ¥è¯†ç‚¹ï¼šå¤§å°å†™å¾ˆé‡è¦ï¼Œâ€™Bartâ€™ å’Œ â€˜bartâ€™è¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„å…ƒç´ ã€‚ ç¼–ç¨‹ä»»åŠ¡ ç”±äºä¸Šè¿°setä¸èƒ½è¯†åˆ«å°å†™çš„åå­—ï¼Œè¯·æ”¹è¿›setï¼Œä½¿å¾— â€˜adamâ€™ å’Œ â€˜bartâ€™éƒ½èƒ½è¿”å›Trueã€‚ æ—¢ç„¶å¤§å°å†™æ˜¯ä¸åŒçš„ã€‚é‚£æˆ‘ä»¬çš„setä¸­å°±æŠŠå¤§å°å†™éƒ½åŒ…å«ã€‚ å®ç°ä»£ç : 123s = set(['Adam', 'Lisa', 'Bart', 'Paul','adam', 'lisa', 'bart', 'paul'])print 'adam' in sprint 'bart' in s è¿è¡Œç»“æœ. 12TrueTrue setçš„ç‰¹ç‚¹setçš„å†…éƒ¨ç»“æ„å’Œdictå¾ˆåƒï¼Œå”¯ä¸€åŒºåˆ«æ˜¯ä¸å­˜å‚¨valueï¼Œå› æ­¤ï¼Œåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨setä¸­é€Ÿåº¦å¾ˆå¿«ã€‚ setå­˜å‚¨çš„å…ƒç´ å’Œdictçš„keyç±»ä¼¼ï¼Œå¿…é¡»æ˜¯ä¸å˜å¯¹è±¡ï¼Œå› æ­¤ï¼Œä»»ä½•å¯å˜å¯¹è±¡æ˜¯ä¸èƒ½æ”¾å…¥setä¸­çš„ã€‚ æœ€åï¼Œsetå­˜å‚¨çš„å…ƒç´ ä¹Ÿæ˜¯æ²¡æœ‰é¡ºåºçš„ã€‚ setçš„è¿™äº›ç‰¹ç‚¹ï¼Œå¯ä»¥åº”ç”¨åœ¨å“ªäº›åœ°æ–¹å‘¢ï¼Ÿ æ˜ŸæœŸä¸€åˆ°æ˜ŸæœŸæ—¥å¯ä»¥ç”¨å­—ç¬¦ä¸²&#39;MON&#39;, &#39;TUE&#39;, ... &#39;SUN&#39;è¡¨ç¤ºã€‚ å‡è®¾æˆ‘ä»¬è®©ç”¨æˆ·è¾“å…¥æ˜ŸæœŸä¸€è‡³æ˜ŸæœŸæ—¥çš„æŸå¤©ï¼Œå¦‚ä½•åˆ¤æ–­ç”¨æˆ·çš„è¾“å…¥æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ˜ŸæœŸå‘¢ï¼Ÿ å¯ä»¥ç”¨ if è¯­å¥åˆ¤æ–­ï¼Œä½†è¿™æ ·åšéå¸¸ç¹çï¼š 12345x = '???' # ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²if x!= 'MON' and x!= 'TUE' and x!= 'WED' ... and x!= 'SUN': print 'input error'else: print 'input ok' æ³¨æ„ï¼šif è¯­å¥ä¸­çš„â€¦è¡¨ç¤ºæ²¡æœ‰åˆ—å‡ºçš„å…¶å®ƒæ˜ŸæœŸåç§°ï¼Œæµ‹è¯•æ—¶ï¼Œè¯·è¾“å…¥å®Œæ•´ã€‚ å¦‚æœäº‹å…ˆåˆ›å»ºå¥½ä¸€ä¸ªsetï¼ŒåŒ…å«&#39;MON&#39; ~ &#39;SUN&#39;ï¼š 1weekdays = set([&apos;MON&apos;, &apos;TUE&apos;, &apos;WED&apos;, &apos;THU&apos;, &apos;FRI&apos;, &apos;SAT&apos;, &apos;SUN&apos;]) å†åˆ¤æ–­è¾“å…¥æ˜¯å¦æœ‰æ•ˆï¼Œåªéœ€è¦åˆ¤æ–­è¯¥å­—ç¬¦ä¸²æ˜¯å¦åœ¨setä¸­ï¼š 123456x = '???' # ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²if x in weekdays: print 'input ok'else: print 'input error'è¿™æ ·ä¸€æ¥ï¼Œä»£ç å°±ç®€å•å¤šäº†ã€‚ ç¼–ç¨‹ä»»åŠ¡ æœˆä»½ä¹Ÿå¯ä»¥ç”¨setè¡¨ç¤ºï¼Œè¯·è®¾è®¡ä¸€ä¸ªsetå¹¶åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„æœˆä»½æ˜¯å¦æœ‰æ•ˆã€‚æœˆä»½å¯ä»¥ç”¨å­—ç¬¦ä¸²&#39;Jan&#39;, &#39;Feb&#39;, ...è¡¨ç¤ºã€‚ å®ç°ä»£ç : 12345678910111213months = set(['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul','Aug','Sep','Oct','Nov','Dec'])x1 = 'Feb'x2 = 'Sun'if x1 in months: print 'x1: ok'else: print 'x1: error'if x2 in months: print 'x2: ok'else: print 'x2: error' è¿è¡Œç»“æœ: 12x1: okx2: error éå†setç”±äº set ä¹Ÿæ˜¯ä¸€ä¸ªé›†åˆï¼Œæ‰€ä»¥ï¼Œéå† set å’Œéå† list ç±»ä¼¼ï¼Œéƒ½å¯ä»¥é€šè¿‡ for å¾ªç¯å®ç°ã€‚ ç›´æ¥ä½¿ç”¨ for å¾ªç¯å¯ä»¥éå† set çš„å…ƒç´ ï¼š 1234567&gt;&gt;&gt; s = set(['Adam', 'Lisa', 'Bart'])&gt;&gt;&gt; for name in s:... print name... LisaAdamBart æ³¨æ„: è§‚å¯Ÿ for å¾ªç¯åœ¨éå†setæ—¶ï¼Œå…ƒç´ çš„é¡ºåºå’Œlistçš„é¡ºåºå¾ˆå¯èƒ½æ˜¯ä¸åŒçš„ï¼Œè€Œä¸”ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œçš„ç»“æœä¹Ÿå¯èƒ½ä¸åŒã€‚ ç¼–ç¨‹ä»»åŠ¡ è¯·ç”¨ for å¾ªç¯éå†å¦‚ä¸‹çš„setï¼Œæ‰“å°å‡º name: score æ¥ã€‚ 1s = set([(&apos;Adam&apos;, 95), (&apos;Lisa&apos;, 85), (&apos;Bart&apos;, 59)]) ä¸Šé¢è¿™ä¸ªsetä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ªå­—å…¸ã€‚ set([ ])æ˜¯å£³å­ã€‚ (&#39;Adam&#39;, 95), (&#39;Lisa&#39;, 85), (&#39;Bart&#39;, 59)æ‰æ˜¯çœŸæ­£çš„å†…å®¹ å®ç°ä»£ç ï¼š 123s = set([('Adam', 95), ('Lisa', 85), ('Bart', 59)])for name,score in s: print name,':',score è¿è¡Œç»“æœ: 123Lisa : 85Adam : 95Bart : 59 æ›´æ–°set(add remove)ç”±äºsetå­˜å‚¨çš„æ˜¯ä¸€ç»„ä¸é‡å¤çš„æ— åºå…ƒç´ ï¼Œå› æ­¤ï¼Œæ›´æ–°setä¸»è¦åšä¸¤ä»¶äº‹ï¼š æ˜¯æŠŠæ–°çš„å…ƒç´ æ·»åŠ åˆ°setä¸­ æ˜¯æŠŠå·²æœ‰å…ƒç´ ä»setä¸­åˆ é™¤ã€‚(å‰ææ˜¯å¦‚æœæœ‰) æ·»åŠ å…ƒç´ æ—¶ï¼Œç”¨setçš„add()æ–¹æ³•ï¼š 1234&gt;&gt;&gt; s = set([1, 2, 3])&gt;&gt;&gt; s.add(4)&gt;&gt;&gt; print sset([1, 2, 3, 4]) å¦‚æœæ·»åŠ çš„å…ƒç´ å·²ç»å­˜åœ¨äºsetä¸­ï¼Œadd()ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¸ä¼šåŠ è¿›å»äº†ï¼š 1234&gt;&gt;&gt; s = set([1, 2, 3])&gt;&gt;&gt; s.add(3)&gt;&gt;&gt; print sset([1, 2, 3]) åˆ é™¤setä¸­çš„å…ƒç´ æ—¶ï¼Œç”¨setçš„remove()æ–¹æ³•ï¼š 1234&gt;&gt;&gt; s = set([1, 2, 3, 4])&gt;&gt;&gt; s.remove(4)&gt;&gt;&gt; print sset([1, 2, 3]) å¦‚æœåˆ é™¤çš„å…ƒç´ ä¸å­˜åœ¨setä¸­ï¼Œremove()ä¼šæŠ¥é”™ï¼š 12345&gt;&gt;&gt; s = set([1, 2, 3])&gt;&gt;&gt; s.remove(4)Traceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;KeyError: 4 æ‰€ä»¥ç”¨add()å¯ä»¥ç›´æ¥æ·»åŠ ï¼Œè€Œremove()å‰éœ€è¦åˆ¤æ–­ã€‚ ç¼–ç¨‹ä»»åŠ¡ é’ˆå¯¹ä¸‹é¢çš„setï¼Œç»™å®šä¸€ä¸ªlistï¼Œå¯¹listä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåœ¨setä¸­ï¼Œå°±å°†å…¶åˆ é™¤ï¼Œå¦‚æœä¸åœ¨setä¸­ï¼Œå°±æ·»åŠ è¿›å»ã€‚ 12s = set([&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Paul&apos;])L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;, &apos;Paul&apos;] å®ç°ä»£ç ï¼š 12345678s = set(['Adam', 'Lisa', 'Paul'])L = ['Adam', 'Lisa', 'Bart', 'Paul']for name in L: if name in s: s.remove(name) else: s.add(name)print s å‡½æ•°å®šä¹‰ä¸è°ƒç”¨ä»€ä¹ˆæ˜¯å‡½æ•°æˆ‘ä»¬çŸ¥é“åœ†çš„é¢ç§¯è®¡ç®—å…¬å¼ä¸ºï¼š S = Ï€rÂ² å½“æˆ‘ä»¬çŸ¥é“åŠå¾„rçš„å€¼æ—¶ï¼Œå°±å¯ä»¥æ ¹æ®å…¬å¼è®¡ç®—å‡ºé¢ç§¯ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦è®¡ç®—3ä¸ªä¸åŒå¤§å°çš„åœ†çš„é¢ç§¯ï¼š 123456r1 = 12.34r2 = 9.08r3 = 73.1s1 = 3.14 * r1 * r1s2 = 3.14 * r2 * r2s3 = 3.14 * r3 * r3 å½“ä»£ç å‡ºç°æœ‰è§„å¾‹çš„é‡å¤çš„æ—¶å€™ï¼Œä½ å°±éœ€è¦å½“å¿ƒäº†ï¼Œæ¯æ¬¡å†™3.14 * x * xä¸ä»…å¾ˆéº»çƒ¦ï¼Œè€Œä¸”ï¼Œå¦‚æœè¦æŠŠ3.14æ”¹æˆ3.14159265359çš„æ—¶å€™ï¼Œå¾—å…¨éƒ¨æ›¿æ¢ã€‚ æœ‰äº†å‡½æ•°ï¼Œæˆ‘ä»¬å°±ä¸å†æ¯æ¬¡å†™s = 3.14 * x * xï¼Œè€Œæ˜¯å†™æˆæ›´æœ‰æ„ä¹‰çš„å‡½æ•°è°ƒç”¨ s = area_of_circle(x)ï¼Œè€Œå‡½æ•° area_of_circleæœ¬èº«åªéœ€è¦å†™ä¸€æ¬¡ï¼Œå°±å¯ä»¥å¤šæ¬¡è°ƒç”¨ã€‚ æŠ½è±¡æ˜¯æ•°å­¦ä¸­éå¸¸å¸¸è§çš„æ¦‚å¿µã€‚ä¸¾ä¸ªä¾‹å­ï¼š è®¡ç®—æ•°åˆ—çš„å’Œï¼Œæ¯”å¦‚ï¼š1 + 2 + 3 + â€¦ + 100ï¼Œå†™èµ·æ¥ååˆ†ä¸æ–¹ä¾¿ï¼Œäºæ˜¯æ•°å­¦å®¶å‘æ˜äº†æ±‚å’Œç¬¦å·âˆ‘ï¼Œå¯ä»¥æŠŠ1 + 2 + 3 + â€¦ + 100è®°ä½œï¼š 123100âˆ‘nn=1 è¿™ç§æŠ½è±¡è®°æ³•éå¸¸å¼ºå¤§ï¼Œå› ä¸ºæˆ‘ä»¬çœ‹åˆ°âˆ‘å°±å¯ä»¥ç†è§£æˆæ±‚å’Œï¼Œè€Œä¸æ˜¯è¿˜åŸæˆä½çº§çš„åŠ æ³•è¿ç®—ã€‚ è€Œä¸”ï¼Œè¿™ç§æŠ½è±¡è®°æ³•æ˜¯å¯æ‰©å±•çš„ï¼Œæ¯”å¦‚ï¼š 123100âˆ‘(nÂ²+1)n=1 è¿˜åŸæˆåŠ æ³•è¿ç®—å°±å˜æˆäº†ï¼š (1 x 1 + 1) + (2 x 2 + 1) + (3 x 3 + 1) + ... + (100 x 100 + 1)å¯è§ï¼Œå€ŸåŠ©æŠ½è±¡ï¼Œæˆ‘ä»¬æ‰èƒ½ä¸å…³å¿ƒåº•å±‚çš„å…·ä½“è®¡ç®—è¿‡ç¨‹ï¼Œè€Œç›´æ¥åœ¨æ›´é«˜çš„å±‚æ¬¡ä¸Šæ€è€ƒé—®é¢˜ã€‚ å†™è®¡ç®—æœºç¨‹åºä¹Ÿæ˜¯ä¸€æ ·ï¼Œå‡½æ•°å°±æ˜¯æœ€åŸºæœ¬çš„ä¸€ç§ä»£ç æŠ½è±¡çš„æ–¹å¼ã€‚ Pythonä¸ä½†èƒ½éå¸¸çµæ´»åœ°å®šä¹‰å‡½æ•°ï¼Œè€Œä¸”æœ¬èº«å†…ç½®äº†å¾ˆå¤šæœ‰ç”¨çš„å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚ ç¼–ç¨‹ä»»åŠ¡ å†™ä¸€ä¸ªå‡½æ•° å®ç°ä»£ç ï¼š 12s = area_of_circle(x)area_of_circle(x) è¿è¡Œç»“æœï¼š è°ƒç”¨å‡½æ•°,å†…ç½®å‡½æ•°Pythonå†…ç½®äº†å¾ˆå¤šæœ‰ç”¨çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚ è¦è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œéœ€è¦çŸ¥é“å‡½æ•°çš„åç§°å’Œå‚æ•°ï¼Œæ¯”å¦‚æ±‚ç»å¯¹å€¼çš„å‡½æ•° absï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°ã€‚ å¯ä»¥ç›´æ¥ä»Pythonçš„å®˜æ–¹ç½‘ç«™æŸ¥çœ‹æ–‡æ¡£ï¼šhttp://docs.python.org/2/library/functions.html#abs ä¹Ÿå¯ä»¥åœ¨äº¤äº’å¼å‘½ä»¤è¡Œé€šè¿‡ help(abs)æŸ¥çœ‹abså‡½æ•°çš„å¸®åŠ©ä¿¡æ¯ã€‚ è°ƒç”¨ abs å‡½æ•°ï¼š 123456&gt;&gt;&gt; abs(100)100&gt;&gt;&gt; abs(-20)20&gt;&gt;&gt; abs(12.34)12.34 è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°æ•°é‡ä¸å¯¹ï¼Œä¼šæŠ¥TypeErrorçš„é”™è¯¯ï¼Œå¹¶ä¸”Pythonä¼šæ˜ç¡®åœ°å‘Šè¯‰ä½ ï¼šabs()æœ‰ä¸”ä»…æœ‰1ä¸ªå‚æ•°ï¼Œä½†ç»™å‡ºäº†ä¸¤ä¸ªï¼š 1234&gt;&gt;&gt; abs(1, 2)Traceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;TypeError: abs() takes exactly one argument (2 given) å¦‚æœä¼ å…¥çš„å‚æ•°æ•°é‡æ˜¯å¯¹çš„ï¼Œä½†å‚æ•°ç±»å‹ä¸èƒ½è¢«å‡½æ•°æ‰€æ¥å—ï¼Œä¹Ÿä¼šæŠ¥TypeErrorçš„é”™è¯¯ï¼Œå¹¶ä¸”ç»™å‡ºé”™è¯¯ä¿¡æ¯ï¼šstræ˜¯é”™è¯¯çš„å‚æ•°ç±»å‹ï¼š 1234&gt;&gt;&gt; abs(&apos;a&apos;)Traceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;TypeError: bad operand type for abs(): &apos;str&apos; è€Œæ¯”è¾ƒå‡½æ•° cmp(x, y) å°±éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œå¦‚æœ x&lt;yï¼Œè¿”å› -1ï¼Œå¦‚æœ x==yï¼Œè¿”å›0ï¼Œå¦‚æœ x&gt;yï¼Œè¿”å› 1ï¼š 123456&gt;&gt;&gt; cmp(1, 2)-1&gt;&gt;&gt; cmp(2, 1)1&gt;&gt;&gt; cmp(3, 3)0 Pythonå†…ç½®çš„å¸¸ç”¨å‡½æ•°è¿˜åŒ…æ‹¬æ•°æ®ç±»å‹è½¬æ¢å‡½æ•°ï¼Œæ¯”å¦‚ int()å‡½æ•°å¯ä»¥æŠŠå…¶ä»–æ•°æ®ç±»å‹è½¬æ¢ä¸ºæ•´æ•°ï¼š 1234&gt;&gt;&gt; int(&apos;123&apos;)123&gt;&gt;&gt; int(12.34)12 str()å‡½æ•°æŠŠå…¶ä»–ç±»å‹è½¬æ¢æˆ strï¼š 1234&gt;&gt;&gt; str(123)&apos;123&apos;&gt;&gt;&gt; str(1.23)&apos;1.23&apos; ç¼–ç¨‹ä»»åŠ¡ sum()å‡½æ•°æ¥å—ä¸€ä¸ªlistä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›listæ‰€æœ‰å…ƒç´ ä¹‹å’Œã€‚è¯·è®¡ç®— 1*1 + 2*2 + 3*3 + ... + 100*100ã€‚ å®ç°ä»£ç ï¼š 1234567L = []L = []x = 1while x &lt;= 100: L.append(x * x) x = x + 1print sum(L) è¿è¡Œç»“æœ: 1338350 ç¼–å†™å‡½æ•°åœ¨Pythonä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°è¦ä½¿ç”¨ def è¯­å¥ï¼Œä¾æ¬¡å†™å‡ºå‡½æ•°åã€æ‹¬å·ã€æ‹¬å·ä¸­çš„å‚æ•°å’Œå†’å·:ï¼Œç„¶åï¼Œåœ¨ç¼©è¿›å—ä¸­ç¼–å†™å‡½æ•°ä½“ï¼Œå‡½æ•°çš„è¿”å›å€¼ç”¨ returnè¯­å¥è¿”å›ã€‚ æˆ‘ä»¬ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ±‚ç»å¯¹å€¼çš„ my_abs å‡½æ•°ä¸ºä¾‹ï¼š 12345def my_abs(x): if x &gt;= 0: return x else: return -x è¯·æ³¨æ„ï¼Œå‡½æ•°ä½“å†…éƒ¨çš„è¯­å¥åœ¨æ‰§è¡Œæ—¶ï¼Œä¸€æ—¦æ‰§è¡Œåˆ°returnæ—¶ï¼Œå‡½æ•°å°±æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶å°†ç»“æœè¿”å›ã€‚å› æ­¤ï¼Œå‡½æ•°å†…éƒ¨é€šè¿‡æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯å¯ä»¥å®ç°éå¸¸å¤æ‚çš„é€»è¾‘ã€‚ çŸ¥è¯†ç‚¹ï¼› å¦‚æœæ²¡æœ‰returnè¯­å¥ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•åä¹Ÿä¼šè¿”å›ç»“æœï¼Œåªæ˜¯ç»“æœä¸º Noneã€‚return Noneå¯ä»¥ç®€å†™ä¸ºreturnã€‚ ç¼–ç¨‹ä»»åŠ¡ è¯·å®šä¹‰ä¸€ä¸ª square_of_sum å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªlistï¼Œè¿”å›listä¸­æ¯ä¸ªå…ƒç´ å¹³æ–¹çš„å’Œã€‚ å®ç°ä»£ç : 12345678def square_of_sum(L): sum = 0 for x in L: sum = x*x+sum return sumprint square_of_sum([1, 2, 3, 4, 5])print square_of_sum([-5, 0, 5, 15, 25]) è¿è¡Œç»“æœ: 1255900 å‡½æ•°ä¹‹è¿”å›â€å¤šå€¼â€å‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚ æ¯”å¦‚åœ¨æ¸¸æˆä¸­ç»å¸¸éœ€è¦ä»ä¸€ä¸ªç‚¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªç‚¹ï¼Œç»™å‡ºåæ ‡ã€ä½ç§»å’Œè§’åº¦ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºæ–°çš„åæ ‡ï¼š mathåŒ…æä¾›äº†sin()å’Œ cos()å‡½æ•°ï¼Œæˆ‘ä»¬å…ˆç”¨importå¼•ç”¨å®ƒï¼š 12345import mathdef move(x, y, step, angle): nx = x + step * math.cos(angle) ny = y - step * math.sin(angle) return nx, ny è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åŒæ—¶è·å¾—è¿”å›å€¼ï¼š 123&gt;&gt;&gt; x, y = move(100, 100, 60, math.pi / 6)&gt;&gt;&gt; print x, y151.961524227 70.0 ä½†å…¶å®è¿™åªæ˜¯ä¸€ç§å‡è±¡ï¼ŒPythonå‡½æ•°è¿”å›çš„ä»ç„¶æ˜¯å•ä¸€å€¼ï¼š 123&gt;&gt;&gt; r = move(100, 100, 60, math.pi / 6)&gt;&gt;&gt; print r(151.96152422706632, 70.0) çŸ¥è¯†ç‚¹ï¼šç”¨printæ‰“å°è¿”å›ç»“æœï¼ŒåŸæ¥è¿”å›å€¼æ˜¯ä¸€ä¸ªtupleï¼ ä½†æ˜¯ï¼Œåœ¨è¯­æ³•ä¸Šï¼Œè¿”å›ä¸€ä¸ªtupleå¯ä»¥çœç•¥æ‹¬å·ï¼Œè€Œå¤šä¸ªå˜é‡å¯ä»¥åŒæ—¶æ¥æ”¶ä¸€ä¸ªtupleï¼ŒæŒ‰ä½ç½®èµ‹ç»™å¯¹åº”çš„å€¼ï¼Œæ‰€ä»¥ï¼ŒçŸ¥è¯†ç‚¹ï¼šPythonçš„å‡½æ•°è¿”å›å¤šå€¼å…¶å®å°±æ˜¯è¿”å›ä¸€ä¸ªtupleï¼Œä½†å†™èµ·æ¥æ›´æ–¹ä¾¿ã€‚ ç¼–ç¨‹ä»»åŠ¡ ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹çš„å®šä¹‰æ˜¯ï¼šaxÂ² + bx + c = 0 è¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹çš„ä¸¤ä¸ªè§£ã€‚ æ³¨æ„ï¼šPythonçš„mathåŒ…æä¾›äº†sqrt()å‡½æ•°ç”¨äºè®¡ç®—å¹³æ–¹æ ¹ã€‚ å®ç°ä»£ç : 12345678import mathdef quadratic_equation(a, b, c): t = math.sqrt(b*b - 4*a*c) return (-b + t) / (2 * a),( -b - t )/ (2 * a)print quadratic_equation(2, 3, 0)print quadratic_equation(1, -6, 5) è¿è¡Œç»“æœ: 12(0.0, -1.5)(5.0, 1.0) é€’å½’å‡½æ•°åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥è°ƒç”¨å…¶ä»–å‡½æ•°ã€‚çŸ¥è¯†ç‚¹: å¦‚æœä¸€ä¸ªå‡½æ•°åœ¨å†…éƒ¨è°ƒç”¨è‡ªèº«æœ¬èº«ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯é€’å½’å‡½æ•°ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥è®¡ç®—é˜¶ä¹˜ n! = 1 * 2 * 3 * ... * nï¼Œç”¨å‡½æ•° fact(n)è¡¨ç¤ºï¼Œå¯ä»¥çœ‹å‡ºï¼š fact(n) = n! = 1 * 2 * 3 * ... * (n-1) * n = (n-1)! * n = fact(n-1) * næ‰€ä»¥ï¼Œfact(n)å¯ä»¥è¡¨ç¤ºä¸º n * fact(n-1)ï¼Œåªæœ‰n=1æ—¶éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚ äºæ˜¯ï¼Œfact(n)ç”¨é€’å½’çš„æ–¹å¼å†™å‡ºæ¥å°±æ˜¯ï¼š 1234def fact(n): if n==1: return 1 return n * fact(n - 1) ä¸Šé¢å°±æ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ã€‚å¯ä»¥è¯•è¯•ï¼š 123456&gt;&gt;&gt; fact(1)1&gt;&gt;&gt; fact(5)120&gt;&gt;&gt; fact(100)93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000 å¦‚æœæˆ‘ä»¬è®¡ç®—fact(5)ï¼Œå¯ä»¥æ ¹æ®å‡½æ•°å®šä¹‰çœ‹åˆ°è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š 12345678910===&gt; fact(5)===&gt; 5 * fact(4)===&gt; 5 * (4 * fact(3))===&gt; 5 * (4 * (3 * fact(2)))===&gt; 5 * (4 * (3 * (2 * fact(1))))===&gt; 5 * (4 * (3 * (2 * 1)))===&gt; 5 * (4 * (3 * 2))===&gt; 5 * (4 * 6)===&gt; 5 * 24===&gt; 120 é€’å½’å‡½æ•°çš„ä¼˜ç‚¹æ˜¯å®šä¹‰ç®€å•ï¼Œé€»è¾‘æ¸…æ™°ã€‚çŸ¥è¯†ç‚¹: ç†è®ºä¸Šï¼Œæ‰€æœ‰çš„é€’å½’å‡½æ•°éƒ½å¯ä»¥å†™æˆå¾ªç¯çš„æ–¹å¼ï¼Œä½†å¾ªç¯çš„é€»è¾‘ä¸å¦‚é€’å½’æ¸…æ™°ã€‚ çŸ¥è¯†ç‚¹: ä½¿ç”¨é€’å½’å‡½æ•°éœ€è¦æ³¨æ„é˜²æ­¢æ ˆæº¢å‡ºã€‚åœ¨è®¡ç®—æœºä¸­ï¼Œå‡½æ•°è°ƒç”¨æ˜¯é€šè¿‡æ ˆï¼ˆstackï¼‰è¿™ç§æ•°æ®ç»“æ„å®ç°çš„ï¼Œæ¯å½“è¿›å…¥ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œæ ˆå°±ä¼šåŠ ä¸€å±‚æ ˆå¸§ï¼Œæ¯å½“å‡½æ•°è¿”å›ï¼Œæ ˆå°±ä¼šå‡ä¸€å±‚æ ˆå¸§ã€‚ç”±äºæ ˆçš„å¤§å°ä¸æ˜¯æ— é™çš„ï¼Œæ‰€ä»¥ï¼Œé€’å½’è°ƒç”¨çš„æ¬¡æ•°è¿‡å¤šï¼Œä¼šå¯¼è‡´æ ˆæº¢å‡ºã€‚å¯ä»¥è¯•è¯•è®¡ç®— fact(10000)ã€‚ ç¼–ç¨‹ä»»åŠ¡(å¤©æ¶¯) æ±‰è¯ºå¡” (http://baike.baidu.com/view/191666.htm) çš„ç§»åŠ¨ä¹Ÿå¯ä»¥çœ‹åšæ˜¯é€’å½’å‡½æ•°ã€‚ æˆ‘ä»¬å¯¹æŸ±å­ç¼–å·ä¸ºa, b, cï¼Œå°†æ‰€æœ‰åœ†ç›˜ä»aç§»åˆ°cå¯ä»¥æè¿°ä¸ºï¼š å¦‚æœaåªæœ‰ä¸€ä¸ªåœ†ç›˜ï¼Œå¯ä»¥ç›´æ¥ç§»åŠ¨åˆ°cï¼› å¦‚æœaæœ‰Nä¸ªåœ†ç›˜ï¼Œå¯ä»¥çœ‹æˆaæœ‰1ä¸ªåœ†ç›˜ï¼ˆåº•ç›˜ï¼‰ + (N-1)ä¸ªåœ†ç›˜ï¼Œé¦–å…ˆéœ€è¦æŠŠ (N-1) ä¸ªåœ†ç›˜ç§»åŠ¨åˆ° bï¼Œç„¶åï¼Œå°† açš„æœ€åä¸€ä¸ªåœ†ç›˜ç§»åŠ¨åˆ°cï¼Œå†å°†bçš„(N-1)ä¸ªåœ†ç›˜ç§»åŠ¨åˆ°cã€‚ è¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œç»™å®šè¾“å…¥ n, a, b, cï¼Œæ‰“å°å‡ºç§»åŠ¨çš„æ­¥éª¤ï¼š 1move(n, a, b, c) ä¾‹å¦‚ï¼Œè¾“å…¥ move(2, â€˜Aâ€™, â€˜Bâ€™, â€˜Câ€™)ï¼Œæ‰“å°å‡ºï¼š 123A --&gt; BA --&gt; CB --&gt; C å®ç°ä»£ç ï¼š 12345678def move(n, a, b, c): if n ==1: print a, '--&gt;', c return move(n-1, a, c, b) print a, '--&gt;', c move(n-1, b, a, c)move(4, 'A', 'B', 'C') è¿è¡Œç»“æœ: 123456789101112131415A --&gt; BA --&gt; CB --&gt; CA --&gt; BC --&gt; AC --&gt; BA --&gt; BA --&gt; CB --&gt; CB --&gt; AC --&gt; AB --&gt; CA --&gt; BA --&gt; CB --&gt; C å®šä¹‰é»˜è®¤å‚æ•°å®šä¹‰å‡½æ•°çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥æœ‰é»˜è®¤å‚æ•°ã€‚ ä¾‹å¦‚Pythonè‡ªå¸¦çš„ int() å‡½æ•°ï¼Œå…¶å®å°±æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥ä¼ ä¸€ä¸ªå‚æ•°ï¼Œåˆå¯ä»¥ä¼ ä¸¤ä¸ªå‚æ•°ï¼š 1234&gt;&gt;&gt; int(&apos;123&apos;)123&gt;&gt;&gt; int(&apos;123&apos;, 8)83 çŸ¥è¯†ç‚¹: int()å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯è½¬æ¢è¿›åˆ¶ï¼Œå¦‚æœä¸ä¼ ï¼Œé»˜è®¤æ˜¯åè¿›åˆ¶ (base=10)ï¼Œå¦‚æœä¼ äº†ï¼Œå°±ç”¨ä¼ å…¥çš„å‚æ•°ã€‚ å¯è§ï¼Œå‡½æ•°çš„é»˜è®¤å‚æ•°çš„ä½œç”¨æ˜¯ç®€åŒ–è°ƒç”¨ï¼Œä½ åªéœ€è¦æŠŠå¿…é¡»çš„å‚æ•°ä¼ è¿›å»ã€‚ä½†æ˜¯åœ¨éœ€è¦çš„æ—¶å€™ï¼Œåˆå¯ä»¥ä¼ å…¥é¢å¤–çš„å‚æ•°æ¥è¦†ç›–é»˜è®¤å‚æ•°å€¼ã€‚ æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªè®¡ç®— x çš„Næ¬¡æ–¹çš„å‡½æ•°: 123456def power(x, n): s = 1 while n &gt; 0: n = n - 1 s = s * x return s å‡è®¾è®¡ç®—å¹³æ–¹çš„æ¬¡æ•°æœ€å¤šï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠ n çš„é»˜è®¤å€¼è®¾å®šä¸º 2ï¼š 123456def power(x, n=2): s = 1 while n &gt; 0: n = n - 1 s = s * x return s è¿™æ ·ä¸€æ¥ï¼Œè®¡ç®—å¹³æ–¹å°±ä¸éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°äº†ï¼š 12&gt;&gt;&gt; power(5)25 çŸ¥è¯†ç‚¹: ç”±äºå‡½æ•°çš„å‚æ•°æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºåŒ¹é…ï¼Œæ‰€ä»¥é»˜è®¤å‚æ•°åªèƒ½å®šä¹‰åœ¨å¿…éœ€å‚æ•°çš„åé¢ï¼š 123456# OK:def fn1(a, b=1, c=2): pass# Error:def fn2(a=1, b): pass ä¸ªäºº: è¿™é‡Œæˆ‘ä»¬å¯ä»¥æŠŠè‡ªå·±æƒ³è±¡æˆè®¡ç®—æœºã€‚åœ¨è‡ªå·±æ„Ÿåˆ°ä¸ºéš¾ä¸çŸ¥é“å“ªä¸ªæ˜¯å“ªä¸ªçš„æ—¶å€™ã€‚é‚£ä¹ˆæ­å–œä½ ï¼Œè®¡ç®—æœºä¹Ÿä¸çŸ¥é“ã€‚ ç¼–ç¨‹ä»»åŠ¡ è¯·å®šä¹‰ä¸€ä¸ª greet()å‡½æ•°ï¼Œå®ƒåŒ…å«ä¸€ä¸ªé»˜è®¤å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰ä¼ å…¥ï¼Œæ‰“å° &#39;Hello, world.&#39;ï¼Œå¦‚æœä¼ å…¥ï¼Œæ‰“å° &#39;Hello, xxx.&#39; å®ç°ä»£ç : 12345def greet(x = 'World'): print 'Hello,'+x+'.'greet()greet('mtianyan') è¿è¡Œç»“æœ: 12Hello,World.Hello,mtianyan. çŸ¥è¯†ç‚¹: å®šä¹‰å¯å˜å‚æ•°å¦‚æœæƒ³è®©ä¸€ä¸ªå‡½æ•°èƒ½æ¥å—ä»»æ„ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªå¯å˜å‚æ•°ï¼š 12def fn(*args): print args å¯å˜å‚æ•°çš„åå­—å‰é¢æœ‰ä¸ª * å·ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªå‚æ•°ç»™å¯å˜å‚æ•°ï¼š 12345678&gt;&gt;&gt; fn()()&gt;&gt;&gt; fn('a')('a',)&gt;&gt;&gt; fn('a', 'b')('a', 'b')&gt;&gt;&gt; fn('a', 'b', 'c')('a', 'b', 'c') å¯å˜å‚æ•°ä¹Ÿä¸æ˜¯å¾ˆç¥ç§˜ï¼ŒPythonè§£é‡Šå™¨ä¼šæŠŠä¼ å…¥çš„ä¸€ç»„å‚æ•°ç»„è£…æˆä¸€ä¸ªtupleä¼ é€’ç»™å¯å˜å‚æ•°ï¼Œå› æ­¤ï¼Œåœ¨å‡½æ•°å†…éƒ¨ï¼Œç›´æ¥æŠŠå˜é‡ args çœ‹æˆä¸€ä¸ª tuple å°±å¥½äº†ã€‚ å®šä¹‰å¯å˜å‚æ•°çš„ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†ç®€åŒ–è°ƒç”¨ã€‚å‡è®¾æˆ‘ä»¬è¦è®¡ç®—ä»»æ„ä¸ªæ•°çš„å¹³å‡å€¼ï¼Œå°±å¯ä»¥å®šä¹‰ä¸€ä¸ªå¯å˜å‚æ•°ï¼š 12def average(*args): ... è¿™æ ·ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š 123456&gt;&gt;&gt; average()0&gt;&gt;&gt; average(1, 2)1.5&gt;&gt;&gt; average(1, 2, 2, 3, 4)2.4 ç¼–ç¨‹ä»»åŠ¡ è¯·ç¼–å†™æ¥å—å¯å˜å‚æ•°çš„ average() å‡½æ•°ã€‚ 12345678910def average(*args): sum = 0.0 if len(args) == 0: return sum for x in args: sum = sum + x return sum / len(args)print average()print average(1, 2)print average(1, 2, 2, 3, 4) è¿è¡Œç»“æœ: 1230.01.52.4 åˆ‡ç‰‡æ“ä½œå¯¹listè¿›è¡Œåˆ‡ç‰‡å–ä¸€ä¸ªlistçš„éƒ¨åˆ†å…ƒç´ æ˜¯éå¸¸å¸¸è§çš„æ“ä½œã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªlistå¦‚ä¸‹ï¼š 1&gt;&gt;&gt; L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;, &apos;Paul&apos;] å–å‰3ä¸ªå…ƒç´ ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ ç¬¨åŠæ³•ï¼š 12&gt;&gt;&gt; [L[0], L[1], L[2]][&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;] ä¹‹æ‰€ä»¥æ˜¯ç¬¨åŠæ³•æ˜¯å› ä¸ºæ‰©å±•ä¸€ä¸‹ï¼Œå–å‰Nä¸ªå…ƒç´ å°±æ²¡è¾™äº†ã€‚ å–å‰Nä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•ä¸º0-(N-1)çš„å…ƒç´ ï¼Œå¯ä»¥ç”¨å¾ªç¯ï¼š 1234567&gt;&gt;&gt; r = []&gt;&gt;&gt; n = 3&gt;&gt;&gt; for i in range(n):... r.append(L[i])... &gt;&gt;&gt; r[&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;] å¯¹è¿™ç§ç»å¸¸å–æŒ‡å®šç´¢å¼•èŒƒå›´çš„æ“ä½œï¼Œç”¨å¾ªç¯ååˆ†ç¹çï¼Œå› æ­¤ï¼ŒPythonæä¾›äº†åˆ‡ç‰‡ï¼ˆSliceï¼‰æ“ä½œç¬¦ï¼Œèƒ½å¤§å¤§ç®€åŒ–è¿™ç§æ“ä½œã€‚ å¯¹åº”ä¸Šé¢çš„é—®é¢˜ï¼Œå–å‰3ä¸ªå…ƒç´ ï¼Œç”¨ä¸€è¡Œä»£ç å°±å¯ä»¥å®Œæˆåˆ‡ç‰‡ï¼š 123&gt;&gt;&gt; L[0:3][&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;]L[0:3]è¡¨ç¤ºï¼Œä»ç´¢å¼•0å¼€å§‹å–ï¼Œç›´åˆ°ç´¢å¼•3ä¸ºæ­¢ï¼Œä½†ä¸åŒ…æ‹¬ç´¢å¼•3ã€‚å³ç´¢å¼•0ï¼Œ1ï¼Œ2ï¼Œæ­£å¥½æ˜¯3ä¸ªå…ƒç´ ã€‚ çŸ¥è¯†ç‚¹ï¼š [0:3]è¡¨ç¤ºï¼Œä»ç´¢å¼•0å¼€å§‹å–ï¼Œç›´åˆ°ç´¢å¼•3ä¸ºæ­¢ï¼Œä½†ä¸åŒ…æ‹¬ç´¢å¼•3ã€‚å³ç´¢å¼•0ï¼Œ1ï¼Œ2ï¼Œæ­£å¥½æ˜¯3ä¸ªå…ƒç´ ã€‚ å¦‚æœç¬¬ä¸€ä¸ªç´¢å¼•æ˜¯0ï¼Œè¿˜å¯ä»¥çœç•¥ï¼š 12&gt;&gt;&gt; L[:3][&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;] ä¹Ÿå¯ä»¥ä»ç´¢å¼•1å¼€å§‹ï¼Œå–å‡º2ä¸ªå…ƒç´ å‡ºæ¥ï¼š 12&gt;&gt;&gt; L[1:3][&apos;Lisa&apos;, &apos;Bart&apos;] åªç”¨ä¸€ä¸ª : ï¼Œè¡¨ç¤ºä»å¤´åˆ°å°¾ï¼š 12&gt;&gt;&gt; L[:][&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;, &apos;Paul&apos;] å› æ­¤ï¼ŒL[:]å®é™…ä¸Šå¤åˆ¶å‡ºäº†ä¸€ä¸ªæ–°listã€‚ çŸ¥è¯†ç‚¹: åˆ‡ç‰‡æ“ä½œè¿˜å¯ä»¥æŒ‡å®šç¬¬ä¸‰ä¸ªå‚æ•°ï¼š 12&gt;&gt;&gt; L[::2][&apos;Adam&apos;, &apos;Bart&apos;] ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ¯Nä¸ªå–ä¸€ä¸ªï¼Œä¸Šé¢çš„ L[::2] ä¼šæ¯ä¸¤ä¸ªå…ƒç´ å–å‡ºä¸€ä¸ªæ¥ï¼Œä¹Ÿå°±æ˜¯éš”ä¸€ä¸ªå–ä¸€ä¸ªã€‚ æŠŠlistæ¢æˆtupleï¼Œåˆ‡ç‰‡æ“ä½œå®Œå…¨ç›¸åŒï¼Œåªæ˜¯åˆ‡ç‰‡çš„ç»“æœä¹Ÿå˜æˆäº†tupleã€‚ ç¼–ç¨‹ä»»åŠ¡ range()å‡½æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªæ•°åˆ—ï¼š 12&gt;&gt;&gt; range(1, 101)[1, 2, 3, ..., 100] è¯·åˆ©ç”¨åˆ‡ç‰‡ï¼Œå–å‡ºï¼š å‰10ä¸ªæ•°ï¼› 3çš„å€æ•°ï¼› ä¸å¤§äº50çš„5çš„å€æ•°ã€‚ å®ç°ä»£ç : 12345L = range(1, 101)print L[:10]print L[2::3]print L[4:50:5] è¿è¡Œç»“æœ: 123[1, 2, 3, 4, 5, 6, 7, 8, 9, 10][3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87, 90, 93, 96, 99][5, 10, 15, 20, 25, 30, 35, 40, 45, 50] å€’åºåˆ‡ç‰‡å¯¹äºlistï¼Œæ—¢ç„¶Pythonæ”¯æŒL[-1]å–å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå®ƒåŒæ ·æ”¯æŒå€’æ•°åˆ‡ç‰‡ï¼Œè¯•è¯•ï¼š 12345678910111213&gt;&gt;&gt; L = ['Adam', 'Lisa', 'Bart', 'Paul']&gt;&gt;&gt; L[-2:]['Bart', 'Paul']&gt;&gt;&gt; L[:-2]['Adam', 'Lisa']&gt;&gt;&gt; L[-3:-1]['Lisa', 'Bart']&gt;&gt;&gt; L[-4:-1:2]['Adam', 'Bart'] è®°ä½å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯-1ã€‚çŸ¥è¯†ç‚¹ï¼šå€’åºåˆ‡ç‰‡åŒ…å«èµ·å§‹ç´¢å¼•ï¼Œä¸åŒ…å«ç»“æŸç´¢å¼•ã€‚ ç¼–ç¨‹ä»»åŠ¡ åˆ©ç”¨å€’åºåˆ‡ç‰‡å¯¹ 1 - 100 çš„æ•°åˆ—å–å‡ºï¼š æœ€å10ä¸ªæ•°ï¼› æœ€å10ä¸ª5çš„å€æ•°ã€‚ å®ç°ä»£ç ï¼š 123L = range(1, 101)print L[-10:]print L[-46::5] å¯¹å­—ç¬¦ä¸²åˆ‡ç‰‡å­—ç¬¦ä¸² &#39;xxx&#39;å’Œ Unicodeå­—ç¬¦ä¸² u&#39;xxx&#39;ä¹Ÿå¯ä»¥çœ‹æˆæ˜¯ä¸€ç§listï¼Œæ¯ä¸ªå…ƒç´ å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ç”¨åˆ‡ç‰‡æ“ä½œï¼Œåªæ˜¯æ“ä½œç»“æœä»æ˜¯å­—ç¬¦ä¸²ï¼š 123456&gt;&gt;&gt; &apos;ABCDEFG&apos;[:3]&apos;ABC&apos;&gt;&gt;&gt; &apos;ABCDEFG&apos;[-3:]&apos;EFG&apos;&gt;&gt;&gt; &apos;ABCDEFG&apos;[::2]&apos;ACEG&apos; åœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­ï¼Œé’ˆå¯¹å­—ç¬¦ä¸²æä¾›äº†å¾ˆå¤šå„ç§æˆªå–å‡½æ•°ï¼Œå…¶å®ç›®çš„å°±æ˜¯å¯¹å­—ç¬¦ä¸²åˆ‡ç‰‡ã€‚çŸ¥è¯†ç‚¹ï¼šPythonæ²¡æœ‰é’ˆå¯¹å­—ç¬¦ä¸²çš„æˆªå–å‡½æ•°ï¼Œåªéœ€è¦åˆ‡ç‰‡ä¸€ä¸ªæ“ä½œå°±å¯ä»¥å®Œæˆï¼Œéå¸¸ç®€å•ã€‚ ç¼–ç¨‹ä»»åŠ¡ å­—ç¬¦ä¸²æœ‰ä¸ªæ–¹æ³• upper() å¯ä»¥æŠŠå­—ç¬¦å˜æˆå¤§å†™å­—æ¯ï¼š 12&gt;&gt;&gt; &apos;abc&apos;.upper()&apos;ABC&apos; ä½†å®ƒä¼šæŠŠæ‰€æœ‰å­—æ¯éƒ½å˜æˆå¤§å†™ã€‚è¯·è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åè¿”å›ä¸€ä¸ªä»…é¦–å­—æ¯å˜æˆå¤§å†™çš„å­—ç¬¦ä¸²ã€‚ æç¤ºï¼šåˆ©ç”¨åˆ‡ç‰‡æ“ä½œç®€åŒ–å­—ç¬¦ä¸²æ“ä½œã€‚ å®ç°ä»£ç : 123456def firstCharUpper(s): return s[0].upper() + s[1:]print firstCharUpper('hello')print firstCharUpper('sunday')print firstCharUpper('september') è¿è¡Œç»“æœï¼š 123HelloSundaySeptember å„ç§è¿­ä»£æ–¹å¼ä»€ä¹ˆæ˜¯è¿­ä»£åœ¨Pythonä¸­ï¼Œå¦‚æœç»™å®šä¸€ä¸ªlistæˆ–tupleï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡forå¾ªç¯æ¥éå†è¿™ä¸ªlistæˆ–tupleï¼Œè¿™ç§éå†æˆ‘ä»¬ç§°ä¸ºè¿­ä»£ï¼ˆIterationï¼‰ã€‚ åœ¨Pythonä¸­ï¼Œè¿­ä»£æ˜¯é€šè¿‡ for ... in æ¥å®Œæˆçš„ï¼Œè€Œå¾ˆå¤šè¯­è¨€æ¯”å¦‚Cæˆ–è€…Javaï¼Œè¿­ä»£listæ˜¯é€šè¿‡ä¸‹æ ‡å®Œæˆçš„ï¼Œæ¯”å¦‚Javaä»£ç ï¼š 123for (i=0; i&lt;list.length; i++) &#123; n = list[i];&#125; å¯ä»¥çœ‹å‡ºï¼ŒPythonçš„forå¾ªç¯æŠ½è±¡ç¨‹åº¦è¦é«˜äºJavaçš„forå¾ªç¯ã€‚ å› ä¸º Python çš„ forå¾ªç¯ä¸ä»…å¯ä»¥ç”¨åœ¨listæˆ–tupleä¸Šï¼Œè¿˜å¯ä»¥ä½œç”¨åœ¨å…¶ä»–ä»»ä½•å¯è¿­ä»£å¯¹è±¡ä¸Šã€‚ å› æ­¤ï¼Œè¿­ä»£æ“ä½œå°±æ˜¯å¯¹äºä¸€ä¸ªé›†åˆï¼Œæ— è®ºè¯¥é›†åˆæ˜¯æœ‰åºè¿˜æ˜¯æ— åºï¼Œæˆ‘ä»¬ç”¨ for å¾ªç¯æ€»æ˜¯å¯ä»¥ä¾æ¬¡å–å‡ºé›†åˆçš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚ æ³¨æ„: é›†åˆæ˜¯æŒ‡åŒ…å«ä¸€ç»„å…ƒç´ çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»çš„åŒ…æ‹¬ï¼š æœ‰åºé›†åˆï¼šlistï¼Œtupleï¼ŒçŸ¥è¯†ç‚¹: strå’Œunicodeï¼› æ— åºé›†åˆï¼šset æ— åºé›†åˆå¹¶ä¸”å…·æœ‰ key-value å¯¹ï¼šdict è€Œè¿­ä»£æ˜¯ä¸€ä¸ªåŠ¨è¯ï¼Œå®ƒæŒ‡çš„æ˜¯ä¸€ç§æ“ä½œï¼Œåœ¨Pythonä¸­ï¼Œå°±æ˜¯ for å¾ªç¯ã€‚ è¿­ä»£ä¸æŒ‰ä¸‹æ ‡è®¿é—®æ•°ç»„æœ€å¤§çš„ä¸åŒæ˜¯ï¼Œåè€…æ˜¯ä¸€ç§å…·ä½“çš„è¿­ä»£å®ç°æ–¹å¼ï¼Œè€Œå‰è€…åªå…³å¿ƒè¿­ä»£ç»“æœï¼Œæ ¹æœ¬ä¸å…³å¿ƒè¿­ä»£å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ã€‚ ç¼–ç¨‹ä»»åŠ¡ è¯·ç”¨forå¾ªç¯è¿­ä»£æ•°åˆ— 1-100 å¹¶æ‰“å°å‡º7çš„å€æ•°ã€‚ å®ç°ä»£ç : 123for i in range(1, 101): if i % 7 == 0: print i è¿è¡Œç»“æœ: 1234567891011121314714212835424956637077849198 ç´¢å¼•è¿­ä»£çŸ¥è¯†ç‚¹ï¼šPythonä¸­ï¼Œè¿­ä»£æ°¸è¿œæ˜¯å–å‡ºå…ƒç´ æœ¬èº«ï¼Œè€Œéå…ƒç´ çš„ç´¢å¼•ã€‚ å¯¹äºæœ‰åºé›†åˆï¼Œå…ƒç´ ç¡®å®æ˜¯æœ‰ç´¢å¼•çš„ã€‚æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç¡®å®æƒ³åœ¨ for å¾ªç¯ä¸­æ‹¿åˆ°ç´¢å¼•ï¼Œæ€ä¹ˆåŠï¼Ÿ æ–¹æ³•æ˜¯ä½¿ç”¨ enumerate()å‡½æ•°ï¼š 12345678&gt;&gt;&gt; L = [&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;, &apos;Paul&apos;]&gt;&gt;&gt; for index, name in enumerate(L):... print index, &apos;-&apos;, name... 0 - Adam1 - Lisa2 - Bart3 - Paul ä½¿ç”¨ enumerate()å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨forå¾ªç¯ä¸­åŒæ—¶ç»‘å®šç´¢å¼•indexå’Œå…ƒç´ nameã€‚ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯ enumerate() çš„ç‰¹æ®Šè¯­æ³•ã€‚å®é™…ä¸Šï¼Œenumerate() å‡½æ•°æŠŠï¼š 1[&apos;Adam&apos;, &apos;Lisa&apos;, &apos;Bart&apos;, &apos;Paul&apos;] å˜æˆäº†ç±»ä¼¼ï¼š 1[(0, &apos;Adam&apos;), (1, &apos;Lisa&apos;), (2, &apos;Bart&apos;), (3, &apos;Paul&apos;)] å› æ­¤ï¼Œè¿­ä»£çš„æ¯ä¸€ä¸ªå…ƒç´ å®é™…ä¸Šæ˜¯ä¸€ä¸ªtupleï¼š 1234for t in enumerate(L): index = t[0] name = t[1] print index, &apos;-&apos;, name å¦‚æœæˆ‘ä»¬çŸ¥é“æ¯ä¸ªtupleå…ƒç´ éƒ½åŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼Œforå¾ªç¯åˆå¯ä»¥è¿›ä¸€æ­¥ç®€å†™ä¸ºï¼š 12for index, name in enumerate(L): print index, &apos;-&apos;, name è¿™æ ·ä¸ä½†ä»£ç æ›´ç®€å•ï¼Œè€Œä¸”è¿˜å°‘äº†ä¸¤æ¡èµ‹å€¼è¯­å¥ã€‚ å¯è§ï¼ŒçŸ¥è¯†ç‚¹: ç´¢å¼•è¿­ä»£ä¹Ÿä¸æ˜¯çœŸçš„æŒ‰ç´¢å¼•è®¿é—®ï¼Œè€Œæ˜¯ç”± enumerate() å‡½æ•°è‡ªåŠ¨æŠŠæ¯ä¸ªå…ƒç´ å˜æˆ (index, element) è¿™æ ·çš„tupleï¼Œå†è¿­ä»£ï¼Œå°±åŒæ—¶è·å¾—äº†ç´¢å¼•å’Œå…ƒç´ æœ¬èº«ã€‚ ç¼–ç¨‹ä»»åŠ¡(å¤©æ¶¯) zip()å‡½æ•°å¯ä»¥æŠŠä¸¤ä¸ª list å˜æˆä¸€ä¸ª listï¼š 12&gt;&gt;&gt; zip([10, 20, 30], [&apos;A&apos;, &apos;B&apos;, &apos;C&apos;])[(10, &apos;A&apos;), (20, &apos;B&apos;), (30, &apos;C&apos;)] åœ¨è¿­ä»£ [&#39;Adam&#39;, &#39;Lisa&#39;, &#39;Bart&#39;, &#39;Paul&#39;]æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ‰“å°å‡ºåæ¬¡ - åå­—ï¼ˆåæ¬¡ä»1å¼€å§‹)ï¼Œè¯·è€ƒè™‘å¦‚ä½•åœ¨è¿­ä»£ä¸­æ‰“å°å‡ºæ¥ã€‚ æç¤ºï¼šè€ƒè™‘ä½¿ç”¨zip()å‡½æ•°å’Œrange()å‡½æ•° å®ç°ä»£ç : 123L = ['Adam', 'Lisa', 'Bart', 'Paul']for index, name in zip(range(1, len(L)+1), L): print index, '-', name è¿è¡Œç»“æœ: 12341 - Adam2 - Lisa3 - Bart4 - Paul è¿­ä»£dictçš„valueè¿­ä»£dictçš„valueæˆ‘ä»¬å·²ç»äº†è§£äº†dictå¯¹è±¡æœ¬èº«å°±æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œç”¨ for å¾ªç¯ç›´æ¥è¿­ä»£ dictï¼Œå¯ä»¥æ¯æ¬¡æ‹¿åˆ°dictçš„ä¸€ä¸ªkeyã€‚ å¦‚æœæˆ‘ä»¬å¸Œæœ›è¿­ä»£ dict å¯¹è±¡çš„valueï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ çŸ¥è¯†ç‚¹ï¼švalues()æŠŠdictè½¬æ¢æˆä¸€ä¸ªåŒ…å«æ‰€æœ‰valueçš„listdict å¯¹è±¡æœ‰ä¸€ä¸ª values() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æŠŠdictè½¬æ¢æˆä¸€ä¸ªåŒ…å«æ‰€æœ‰valueçš„listï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬è¿­ä»£çš„å°±æ˜¯ dictçš„æ¯ä¸€ä¸ª valueï¼š 12345678d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59 &#125;print d.values()# [85, 95, 59]for v in d.values(): print v# 85# 95# 59 å¦‚æœä»”ç»†é˜…è¯»Pythonçš„æ–‡æ¡£ï¼Œè¿˜å¯ä»¥å‘ç°ï¼Œdicté™¤äº†values()æ–¹æ³•å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª itervalues() æ–¹æ³•ï¼Œç”¨ itervalues() æ–¹æ³•æ›¿ä»£ values() æ–¹æ³•ï¼Œè¿­ä»£æ•ˆæœå®Œå…¨ä¸€æ ·ï¼š 12345678d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59 &#125;print d.itervalues()# &lt;dictionary-valueiterator object at 0x106adbb50&gt;for v in d.itervalues(): print v# 85# 95# 59 é‚£è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä½•ä¸åŒä¹‹å¤„å‘¢ï¼Ÿ values() æ–¹æ³•å®é™…ä¸ŠæŠŠä¸€ä¸ª dict è½¬æ¢æˆäº†åŒ…å« value çš„listã€‚ ä½†æ˜¯ itervalues() æ–¹æ³•ä¸ä¼šè½¬æ¢ï¼Œå®ƒä¼šåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¾æ¬¡ä» dict ä¸­å–å‡º valueï¼Œæ‰€ä»¥ itervalues() æ–¹æ³•æ¯” values() æ–¹æ³•èŠ‚çœäº†ç”Ÿæˆ list æ‰€éœ€çš„å†…å­˜ã€‚ æ‰“å° itervalues() å‘ç°å®ƒè¿”å›ä¸€ä¸ª å¯¹è±¡ï¼Œè¿™è¯´æ˜åœ¨Pythonä¸­ï¼Œfor å¾ªç¯å¯ä½œç”¨çš„è¿­ä»£å¯¹è±¡è¿œä¸æ­¢ listï¼Œtupleï¼Œstrï¼Œunicodeï¼Œdictç­‰ï¼ŒçŸ¥è¯†ç‚¹: ä»»ä½•å¯è¿­ä»£å¯¹è±¡éƒ½å¯ä»¥ä½œç”¨äºforå¾ªç¯ï¼Œè€Œå†…éƒ¨å¦‚ä½•è¿­ä»£æˆ‘ä»¬é€šå¸¸å¹¶ä¸ç”¨å…³å¿ƒã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡è¯´è‡ªå·±å¯è¿­ä»£ï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥ç”¨ for å¾ªç¯å»è¿­ä»£å®ƒï¼ŒçŸ¥è¯†ç‚¹: å¯è§ï¼Œè¿­ä»£æ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®æ“ä½œï¼Œå®ƒä¸å¯¹è¿­ä»£å¯¹è±¡å†…éƒ¨çš„æ•°æ®æœ‰ä»»ä½•è¦æ±‚ã€‚ ç¼–ç¨‹ä»»åŠ¡ ç»™å®šä¸€ä¸ªdictï¼šd = { â€˜Adamâ€™: 95, â€˜Lisaâ€™: 85, â€˜Bartâ€™: 59, â€˜Paulâ€™: 74 } è¯·è®¡ç®—æ‰€æœ‰åŒå­¦çš„å¹³å‡åˆ†ã€‚ å®ç°ä»£ç : 12345d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59, &apos;Paul&apos;: 74 &#125;sum = 0.0for v in d.itervalues(): sum = sum + vprint sum / len(d) è¿è¡Œç»“æœ: 178.25 è¿­ä»£dictçš„keyå’Œvalueæˆ‘ä»¬äº†è§£äº†å¦‚ä½•è¿­ä»£ dict çš„keyå’Œvalueï¼Œé‚£ä¹ˆï¼Œåœ¨ä¸€ä¸ª for å¾ªç¯ä¸­ï¼Œèƒ½å¦åŒæ—¶è¿­ä»£ keyå’Œvalueï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹çœ‹ dict å¯¹è±¡çš„ items()æ–¹æ³•è¿”å›çš„å€¼ï¼š 123&gt;&gt;&gt; d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59 &#125;&gt;&gt;&gt; print d.items()[(&apos;Lisa&apos;, 85), (&apos;Adam&apos;, 95), (&apos;Bart&apos;, 59)] å¯ä»¥çœ‹åˆ°ï¼Œitems() æ–¹æ³•æŠŠdictå¯¹è±¡è½¬æ¢æˆäº†åŒ…å«tupleçš„listï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªlistè¿›è¡Œè¿­ä»£ï¼Œå¯ä»¥åŒæ—¶è·å¾—keyå’Œvalueï¼š 123456&gt;&gt;&gt; for key, value in d.items():... print key, &apos;:&apos;, value... Lisa : 85Adam : 95Bart : 59 å’Œ values()æœ‰ä¸€ä¸ª itervalues() ç±»ä¼¼ï¼Œitems() ä¹Ÿæœ‰ä¸€ä¸ªå¯¹åº”çš„ iteritems()ï¼ŒçŸ¥è¯†ç‚¹ï¼š iteritems() ä¸æŠŠdictè½¬æ¢æˆlistï¼Œè€Œæ˜¯åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¸æ–­ç»™å‡º tupleï¼Œæ‰€ä»¥ï¼Œ iteritems() ä¸å ç”¨é¢å¤–çš„å†…å­˜ã€‚ ç¼–ç¨‹ä»»åŠ¡ è¯·æ ¹æ®dictï¼šd = { â€˜Adamâ€™: 95, â€˜Lisaâ€™: 85, â€˜Bartâ€™: 59, â€˜Paulâ€™: 74 } æ‰“å°å‡º name : scoreï¼Œæœ€åå†æ‰“å°å‡ºå¹³å‡åˆ† average : scoreã€‚ å®ç°ä»£ç ï¼š 123456d = &#123; 'Adam': 95, 'Lisa': 85, 'Bart': 59, 'Paul': 74 &#125;sum = 0.0for k, v in d.iteritems(): sum = sum + v print k, ':', vprint 'average', ':', sum / len(d) è¿è¡Œç»“æœï¼š 12345Lisa : 85Paul : 74Adam : 95Bart : 59average : 78.25 åˆ—è¡¨ç”Ÿæˆå¼:å¿«é€Ÿç”Ÿæˆåˆ—è¡¨ç”Ÿæˆåˆ—è¡¨è¦ç”Ÿæˆlist [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨range(1, 11)ï¼š 12&gt;&gt;&gt; range(1, 11)[1, 2, 3, 4, 5, 6, 7, 8, 9, 10] ä½†å¦‚æœè¦ç”Ÿæˆ[1x1, 2x2, 3x3, ..., 10x10]æ€ä¹ˆåšï¼Ÿ æ–¹æ³•ä¸€æ˜¯å¾ªç¯ï¼š 123456&gt;&gt;&gt; L = []&gt;&gt;&gt; for x in range(1, 11):... L.append(x * x)... &gt;&gt;&gt; L[1, 4, 9, 16, 25, 36, 49, 64, 81, 100] ä½†æ˜¯å¾ªç¯å¤ªç¹çï¼Œè€Œåˆ—è¡¨ç”Ÿæˆå¼åˆ™å¯ä»¥ç”¨ä¸€è¡Œè¯­å¥ä»£æ›¿å¾ªç¯ç”Ÿæˆä¸Šé¢çš„listï¼š 12&gt;&gt;&gt; [x * x for x in range(1, 11)][1, 4, 9, 16, 25, 36, 49, 64, 81, 100] è¿™ç§å†™æ³•å°±æ˜¯Pythonç‰¹æœ‰çš„åˆ—è¡¨ç”Ÿæˆå¼ã€‚åˆ©ç”¨åˆ—è¡¨ç”Ÿæˆå¼ï¼Œå¯ä»¥ä»¥éå¸¸ç®€æ´çš„ä»£ç ç”Ÿæˆ listã€‚ çŸ¥è¯†ç‚¹: å†™åˆ—è¡¨ç”Ÿæˆå¼æ—¶ï¼ŒæŠŠè¦ç”Ÿæˆçš„å…ƒç´  x * xæ”¾åˆ°å‰é¢ï¼Œåé¢è·Ÿ for å¾ªç¯ï¼Œå°±å¯ä»¥æŠŠliståˆ›å»ºå‡ºæ¥ï¼Œååˆ†æœ‰ç”¨ï¼Œå¤šå†™å‡ æ¬¡ï¼Œå¾ˆå¿«å°±å¯ä»¥ç†Ÿæ‚‰è¿™ç§è¯­æ³•ã€‚ ç¼–ç¨‹ä»»åŠ¡ è¯·åˆ©ç”¨åˆ—è¡¨ç”Ÿæˆå¼ç”Ÿæˆåˆ—è¡¨ [1x2, 3x4, 5x6, 7x8, ..., 99x100] æç¤ºï¼šrange(1, 100, 2)å¯ä»¥ç”Ÿæˆlist [1, 3, 5, 7, 9,...] å®ç°ä»£ç ï¼š 1print [x * (x + 1) for x in range(1, 100, 2)] è¿è¡Œç»“æœï¼š 1[2, 12, 30, 56, 90, 132, 182, 240, 306, 380, 462, 552, 650, 756, 870, 992, 1122, 1260, 1406, 1560, 1722, 1892, 2070, 2256, 2450, 2652, 2862, 3080, 3306, 3540, 3782, 4032, 4290, 4556, 4830, 5112, 5402, 5700, 6006, 6320, 6642, 6972, 7310, 7656, 8010, 8372, 8742, 9120, 9506, 9900] å¤æ‚è¡¨è¾¾å¼ä½¿ç”¨forå¾ªç¯çš„è¿­ä»£ä¸ä»…å¯ä»¥è¿­ä»£æ™®é€šçš„listï¼Œè¿˜å¯ä»¥è¿­ä»£dictã€‚ å‡è®¾æœ‰å¦‚ä¸‹çš„dictï¼š 1d = &#123; 'Adam': 95, 'Lisa': 85, 'Bart': 59 &#125; å®Œå…¨å¯ä»¥é€šè¿‡ä¸€ä¸ªå¤æ‚çš„åˆ—è¡¨ç”Ÿæˆå¼æŠŠå®ƒå˜æˆä¸€ä¸ª HTML è¡¨æ ¼ï¼š 12345tds = ['&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;' % (name, score) for name, score in d.iteritems()]print '&lt;table&gt;'print '&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Score&lt;/th&gt;&lt;tr&gt;'print '\n'.join(tds)print '&lt;/table&gt;' ä¸ªäººï¼š&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt; ä¸­ï¼š ç¬¬ä¸€ä¸ª%sæ˜¯nameçš„å¡«å……ä½ç½®ã€‚ ç¬¬äºŒä¸ª%sä¸ºscoreçš„å¡«å……ä½ç½®ã€‚ æœ‰å¤šå°‘ä¸ªnameå’Œscoreï¼Œä¼šé€šè¿‡å¾ªç¯ç”Ÿæˆå¤šå°‘ä¸ªã€‚&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Score&lt;/th&gt;&lt;tr&gt;è®¾ç½®è¡¨æ ¼å¤´print â€˜\nâ€™.join(tds)ã€‚åˆ—è¡¨é‡Œçš„é¡¹é€šè¿‡\nè¿æ¥æˆå­—ç¬¦ä¸²ã€‚ æ³¨ï¼šå­—ç¬¦ä¸²å¯ä»¥é€šè¿‡%è¿›è¡Œæ ¼å¼åŒ–ï¼Œç”¨æŒ‡å®šçš„å‚æ•°æ›¿ä»£ %sã€‚å­—ç¬¦ä¸²çš„join()æ–¹æ³•å¯ä»¥æŠŠä¸€ä¸ª listæ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ æŠŠæ‰“å°å‡ºæ¥çš„ç»“æœä¿å­˜ä¸ºä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œå°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°æ•ˆæœäº†ï¼š 123456&lt;table border="1"&gt;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Score&lt;/th&gt;&lt;tr&gt;&lt;tr&gt;&lt;td&gt;Lisa&lt;/td&gt;&lt;td&gt;85&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Adam&lt;/td&gt;&lt;td&gt;95&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Bart&lt;/td&gt;&lt;td&gt;59&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; ç¼–ç¨‹ä»»åŠ¡(å¤©æ¶¯) åœ¨ç”Ÿæˆçš„è¡¨æ ¼ä¸­ï¼Œå¯¹äºæ²¡æœ‰åŠæ ¼çš„åŒå­¦ï¼Œè¯·æŠŠåˆ†æ•°æ ‡è®°ä¸ºçº¢è‰²ã€‚ æç¤ºï¼šçº¢è‰²å¯ä»¥ç”¨ &lt;td style=&quot;color:red&quot;&gt; å®ç°ã€‚ å®ç°ä»£ç : 12345678910d = &#123; &apos;Adam&apos;: 95, &apos;Lisa&apos;: 85, &apos;Bart&apos;: 59 &#125;def generate_tr(name, score): if score &lt; 60: return &apos;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td style=&quot;color:red&quot;&gt;%s&lt;/td&gt;&lt;/tr&gt;&apos; % (name, score) return &apos;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&apos; % (name, score)tds = [generate_tr(name, score) for name, score in d.iteritems()]print &apos;&lt;table border=&quot;1&quot;&gt;&apos;print &apos;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Score&lt;/th&gt;&lt;tr&gt;&apos;print &apos;\n&apos;.join(tds)print &apos;&lt;/table&gt;&apos; è¿è¡Œç»“æœ: æ¡ä»¶è¿‡æ»¤åˆ—è¡¨ç”Ÿæˆå¼çš„ for å¾ªç¯åé¢è¿˜å¯ä»¥åŠ ä¸Š if åˆ¤æ–­ã€‚ä¾‹å¦‚ï¼š 12&gt;&gt;&gt; [x * x for x in range(1, 11)][1, 4, 9, 16, 25, 36, 49, 64, 81, 100] å¦‚æœæˆ‘ä»¬åªæƒ³è¦å¶æ•°çš„å¹³æ–¹ï¼Œä¸æ”¹åŠ¨ range()çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åŠ ä¸Š if æ¥ç­›é€‰ï¼š 12&gt;&gt;&gt; [x * x for x in range(1, 11) if x % 2 == 0][4, 16, 36, 64, 100] æœ‰äº† if æ¡ä»¶ï¼Œåªæœ‰ if åˆ¤æ–­ä¸º True çš„æ—¶å€™ï¼Œæ‰æŠŠå¾ªç¯çš„å½“å‰å…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚ ç¼–ç¨‹ä»»åŠ¡ è¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ª listï¼Œç„¶åæŠŠlistä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²å˜æˆå¤§å†™åè¿”å›ï¼Œéå­—ç¬¦ä¸²å…ƒç´ å°†è¢«å¿½ç•¥ã€‚ æç¤ºï¼š isinstance(x, str) å¯ä»¥åˆ¤æ–­å˜é‡ x æ˜¯å¦æ˜¯å­—ç¬¦ä¸²ï¼› å­—ç¬¦ä¸²çš„ upper() æ–¹æ³•å¯ä»¥è¿”å›å¤§å†™çš„å­—æ¯ã€‚ å®ç°ä»£ç : 123def toUppers(L): return [x.upper() for x in L if isinstance(x, str)]print toUppers(['Hello', 'world', 101]) è¿è¡Œç»“æœ: 1[&apos;HELLO&apos;, &apos;WORLD&apos;] å¤šå±‚è¡¨è¾¾å¼(çŸ¥è¯†ç‚¹)forå¾ªç¯å¯ä»¥åµŒå¥—ï¼ŒçŸ¥è¯†ç‚¹ï¼šå› æ­¤ï¼Œåœ¨åˆ—è¡¨ç”Ÿæˆå¼ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨å¤šå±‚ for å¾ªç¯æ¥ç”Ÿæˆåˆ—è¡¨ã€‚ å¯¹äºå­—ç¬¦ä¸² &#39;ABC&#39; å’Œ &#39;123&#39;ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤å±‚å¾ªç¯ï¼Œç”Ÿæˆå…¨æ’åˆ—ï¼š 12&gt;&gt;&gt; [m + n for m in 'ABC' for n in '123']['A1', 'A2', 'A3', 'B1', 'B2', 'B3', 'C1', 'C2', 'C3'] ç¿»è¯‘æˆå¾ªç¯ä»£ç å°±åƒä¸‹é¢è¿™æ ·ï¼š 1234L = []for m in 'ABC': for n in '123': L.append(m + n) ç¼–ç¨‹ä»»åŠ¡(å¤©æ¶¯) åˆ©ç”¨ 3 å±‚forå¾ªç¯çš„åˆ—è¡¨ç”Ÿæˆå¼ï¼Œæ‰¾å‡ºå¯¹ç§°çš„ 3 ä½æ•°ã€‚ä¾‹å¦‚ï¼Œ121 å°±æ˜¯å¯¹ç§°æ•°ï¼Œå› ä¸ºä»å³åˆ°å·¦å€’è¿‡æ¥è¿˜æ˜¯ 121ã€‚ å®ç°ä»£ç : 1print [100 * n1 + 10 * n2 + n3 for n1 in range(1, 10) for n2 in range(10) for n3 in range(10) if n1==n3] è¿è¡Œç»“æœï¼š 1101, 111, 121, 131, 141, 151, 161, 171, 181, 191, 202, 212, 222, 232, 242, 252, 262, 272, 282, 292, 303, 313, 323, 333, 343, 353, 363, 373, 383, 393, 404, 414, 424, 434, 444, 454, 464, 474, 484, 494, 505, 515, 525, 535, 545, 555, 565, 575, 585, 595, 606, 616, 626, 636, 646, 656, 666, 676, 686, 696, 707, 717, 727, 737, 747, 757, 767, 777, 787, 797, 808, 818, 828, 838, 848, 858, 868, 878, 888, 898, 909, 919, 929, 939, 949, 959, 969, 979, 989, 999]]]></content>
      <categories>
        <category>pythonä»å…¥é—¨åˆ°ç²¾é€š</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>é›¶åŸºç¡€å…¥é—¨</tag>
        <tag>å­¦ä¹ ç¬”è®°</tag>
      </tags>
  </entry>
</search>
